{"file_contents":{"client/src/components/empty-state.tsx":{"content":"import { cn } from \"@/lib/utils\";\nimport type { LucideIcon } from \"lucide-react\";\n\ninterface EmptyStateProps {\n  icon: LucideIcon;\n  title: string;\n  description: string;\n  action?: React.ReactNode;\n  className?: string;\n}\n\nexport function EmptyState({\n  icon: Icon,\n  title,\n  description,\n  action,\n  className,\n}: EmptyStateProps) {\n  return (\n    <div\n      className={cn(\n        \"flex flex-col items-center justify-center py-12 text-center\",\n        className\n      )}\n      data-testid=\"empty-state\"\n    >\n      <div className=\"flex h-16 w-16 items-center justify-center rounded-full bg-muted\">\n        <Icon className=\"h-8 w-8 text-muted-foreground\" />\n      </div>\n      <h3 className=\"mt-4 text-base font-medium text-foreground\">{title}</h3>\n      <p className=\"mt-1 max-w-sm text-sm text-muted-foreground\">{description}</p>\n      {action && <div className=\"mt-6\">{action}</div>}\n    </div>\n  );\n}\n","path":null,"size_bytes":908,"size_tokens":null},"client/src/components/ui/tabs.tsx":{"content":"import * as React from \"react\"\nimport * as TabsPrimitive from \"@radix-ui/react-tabs\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Tabs = TabsPrimitive.Root\n\nconst TabsList = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.List\n    ref={ref}\n    className={cn(\n      \"inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsList.displayName = TabsPrimitive.List.displayName\n\nconst TabsTrigger = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.Trigger>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsTrigger.displayName = TabsPrimitive.Trigger.displayName\n\nconst TabsContent = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.Content\n    ref={ref}\n    className={cn(\n      \"mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsContent.displayName = TabsPrimitive.Content.displayName\n\nexport { Tabs, TabsList, TabsTrigger, TabsContent }\n","path":null,"size_bytes":1883,"size_tokens":null},"client/src/pages/clients.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { useForm } from \"react-hook-form\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport { z } from \"zod\";\nimport { Plus, Pencil, Trash2, Search, Building2, Users, UserPlus, Briefcase } from \"lucide-react\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Badge } from \"@/components/ui/badge\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogDescription,\n  DialogFooter,\n  DialogHeader,\n  DialogTitle,\n} from \"@/components/ui/dialog\";\nimport {\n  Form,\n  FormControl,\n  FormField,\n  FormItem,\n  FormLabel,\n  FormMessage,\n} from \"@/components/ui/form\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport {\n  Table,\n  TableBody,\n  TableCell,\n  TableHead,\n  TableHeader,\n  TableRow,\n} from \"@/components/ui/table\";\nimport {\n  AlertDialog,\n  AlertDialogAction,\n  AlertDialogCancel,\n  AlertDialogContent,\n  AlertDialogDescription,\n  AlertDialogFooter,\n  AlertDialogHeader,\n  AlertDialogTitle,\n} from \"@/components/ui/alert-dialog\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { queryClient, apiRequest } from \"@/lib/queryClient\";\nimport { EmptyState } from \"@/components/empty-state\";\nimport { DataTableSkeleton } from \"@/components/data-table-skeleton\";\nimport type { ClientOrganization, InsertClientOrganization, ClientPoc, InsertClientPoc } from \"@shared/schema\";\n\nconst orgFormSchema = z.object({\n  name: z.string().min(1, \"Organization name is required\"),\n  industry: z.string().min(1, \"Industry is required\"),\n  billingAddress: z.string().optional(),\n});\n\nconst pocFormSchema = z.object({\n  name: z.string().min(1, \"Name is required\"),\n  email: z.string().email(\"Valid email is required\"),\n  phone: z.string().optional(),\n  jobTitle: z.string().optional(),\n});\n\ntype OrgFormData = z.infer<typeof orgFormSchema>;\ntype PocFormData = z.infer<typeof pocFormSchema>;\n\nconst industries = [\n  \"Technology\",\n  \"Healthcare\",\n  \"Finance\",\n  \"Manufacturing\",\n  \"Energy\",\n  \"Retail\",\n  \"Consulting\",\n  \"Legal\",\n  \"Real Estate\",\n  \"Education\",\n  \"Other\",\n];\n\nexport default function Clients() {\n  const { toast } = useToast();\n  const [searchQuery, setSearchQuery] = useState(\"\");\n  const [isOrgDialogOpen, setIsOrgDialogOpen] = useState(false);\n  const [isPocDialogOpen, setIsPocDialogOpen] = useState(false);\n  const [editingOrg, setEditingOrg] = useState<ClientOrganization | null>(null);\n  const [selectedOrg, setSelectedOrg] = useState<ClientOrganization | null>(null);\n  const [deletingOrg, setDeletingOrg] = useState<ClientOrganization | null>(null);\n\n  const { data: organizations, isLoading } = useQuery<ClientOrganization[]>({\n    queryKey: [\"/api/client-organizations\"],\n  });\n\n  const { data: pocs } = useQuery<ClientPoc[]>({\n    queryKey: [\"/api/client-pocs\", selectedOrg?.id],\n    enabled: !!selectedOrg,\n  });\n\n  const orgForm = useForm<OrgFormData>({\n    resolver: zodResolver(orgFormSchema),\n    defaultValues: {\n      name: \"\",\n      industry: \"\",\n      billingAddress: \"\",\n    },\n  });\n\n  const pocForm = useForm<PocFormData>({\n    resolver: zodResolver(pocFormSchema),\n    defaultValues: {\n      name: \"\",\n      email: \"\",\n      phone: \"\",\n      jobTitle: \"\",\n    },\n  });\n\n  const createOrgMutation = useMutation({\n    mutationFn: (data: InsertClientOrganization) => apiRequest(\"POST\", \"/api/client-organizations\", data),\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/client-organizations\"] });\n      setIsOrgDialogOpen(false);\n      orgForm.reset();\n      toast({ title: \"Client organization created successfully\" });\n    },\n    onError: () => {\n      toast({ title: \"Failed to create client organization\", variant: \"destructive\" });\n    },\n  });\n\n  const updateOrgMutation = useMutation({\n    mutationFn: (data: InsertClientOrganization & { id: number }) =>\n      apiRequest(\"PATCH\", `/api/client-organizations/${data.id}`, data),\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/client-organizations\"] });\n      setIsOrgDialogOpen(false);\n      setEditingOrg(null);\n      orgForm.reset();\n      toast({ title: \"Client organization updated successfully\" });\n    },\n    onError: () => {\n      toast({ title: \"Failed to update client organization\", variant: \"destructive\" });\n    },\n  });\n\n  const deleteOrgMutation = useMutation({\n    mutationFn: (id: number) => apiRequest(\"DELETE\", `/api/client-organizations/${id}`),\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/client-organizations\"] });\n      setDeletingOrg(null);\n      if (selectedOrg?.id === deletingOrg?.id) {\n        setSelectedOrg(null);\n      }\n      toast({ title: \"Client organization deleted successfully\" });\n    },\n    onError: () => {\n      toast({ title: \"Failed to delete client organization\", variant: \"destructive\" });\n    },\n  });\n\n  const createPocMutation = useMutation({\n    mutationFn: (data: InsertClientPoc) => apiRequest(\"POST\", \"/api/client-pocs\", data),\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/client-pocs\", selectedOrg?.id] });\n      setIsPocDialogOpen(false);\n      pocForm.reset();\n      toast({ title: \"Contact added successfully\" });\n    },\n    onError: () => {\n      toast({ title: \"Failed to add contact\", variant: \"destructive\" });\n    },\n  });\n\n  const filteredOrgs = organizations?.filter((org) =>\n    org.name.toLowerCase().includes(searchQuery.toLowerCase()) ||\n    org.industry?.toLowerCase().includes(searchQuery.toLowerCase())\n  );\n\n  const handleOpenOrgDialog = (org?: ClientOrganization) => {\n    if (org) {\n      setEditingOrg(org);\n      orgForm.reset({\n        name: org.name,\n        industry: org.industry || \"\",\n        billingAddress: org.billingAddress || \"\",\n      });\n    } else {\n      setEditingOrg(null);\n      orgForm.reset();\n    }\n    setIsOrgDialogOpen(true);\n  };\n\n  const onOrgSubmit = (data: OrgFormData) => {\n    const orgData: InsertClientOrganization = {\n      ...data,\n      billingAddress: data.billingAddress || null,\n    };\n\n    if (editingOrg) {\n      updateOrgMutation.mutate({ ...orgData, id: editingOrg.id });\n    } else {\n      createOrgMutation.mutate(orgData);\n    }\n  };\n\n  const onPocSubmit = (data: PocFormData) => {\n    if (!selectedOrg) return;\n    \n    const pocData: InsertClientPoc = {\n      ...data,\n      organizationId: selectedOrg.id,\n      phone: data.phone || null,\n      jobTitle: data.jobTitle || null,\n    };\n    createPocMutation.mutate(pocData);\n  };\n\n  return (\n    <div className=\"space-y-6 p-8\">\n      <div className=\"flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between\">\n        <div>\n          <h1 className=\"text-3xl font-semibold text-foreground\">Client Organizations</h1>\n          <p className=\"text-sm text-muted-foreground\">\n            Manage client organizations and their points of contact.\n          </p>\n        </div>\n        <Button onClick={() => handleOpenOrgDialog()} className=\"gap-2\" data-testid=\"button-add-client\">\n          <Plus className=\"h-4 w-4\" /> Add Client\n        </Button>\n      </div>\n\n      <div className=\"grid gap-6 lg:grid-cols-3\">\n        <Card className=\"lg:col-span-1\">\n          <CardHeader className=\"pb-4\">\n            <div className=\"flex flex-col gap-3\">\n              <CardTitle className=\"text-base font-medium\">Organizations</CardTitle>\n              <div className=\"relative\">\n                <Search className=\"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground\" />\n                <Input\n                  placeholder=\"Search clients...\"\n                  value={searchQuery}\n                  onChange={(e) => setSearchQuery(e.target.value)}\n                  className=\"pl-9\"\n                  data-testid=\"input-search-clients\"\n                />\n              </div>\n            </div>\n          </CardHeader>\n          <CardContent className=\"max-h-[500px] overflow-y-auto\">\n            {isLoading ? (\n              <DataTableSkeleton columns={1} rows={5} />\n            ) : filteredOrgs?.length === 0 ? (\n              <EmptyState\n                icon={Building2}\n                title=\"No clients found\"\n                description=\"Add your first client organization to get started.\"\n              />\n            ) : (\n              <div className=\"space-y-2\">\n                {filteredOrgs?.map((org) => (\n                  <div\n                    key={org.id}\n                    className={`cursor-pointer rounded-md border p-3 transition-colors hover-elevate ${\n                      selectedOrg?.id === org.id ? \"border-primary bg-primary/5\" : \"\"\n                    }`}\n                    onClick={() => setSelectedOrg(org)}\n                    data-testid={`card-client-${org.id}`}\n                  >\n                    <div className=\"flex items-start justify-between gap-2\">\n                      <div className=\"min-w-0 flex-1\">\n                        <p className=\"truncate font-medium\">{org.name}</p>\n                        <p className=\"text-xs text-muted-foreground\">{org.industry}</p>\n                      </div>\n                      <Badge variant=\"default\" className=\"shrink-0\">\n                        {parseFloat(org.totalCuUsed || \"0\").toFixed(1)} CU\n                      </Badge>\n                    </div>\n                  </div>\n                ))}\n              </div>\n            )}\n          </CardContent>\n        </Card>\n\n        <Card className=\"lg:col-span-2\">\n          {selectedOrg ? (\n            <>\n              <CardHeader className=\"pb-4\">\n                <div className=\"flex flex-col gap-4 sm:flex-row sm:items-start sm:justify-between\">\n                  <div>\n                    <CardTitle className=\"text-xl\">{selectedOrg.name}</CardTitle>\n                    <p className=\"text-sm text-muted-foreground\">{selectedOrg.industry}</p>\n                    {selectedOrg.billingAddress && (\n                      <p className=\"mt-1 text-xs text-muted-foreground\">{selectedOrg.billingAddress}</p>\n                    )}\n                  </div>\n                  <div className=\"flex gap-2\">\n                    <Button\n                      variant=\"outline\"\n                      size=\"sm\"\n                      onClick={() => handleOpenOrgDialog(selectedOrg)}\n                      data-testid=\"button-edit-client\"\n                    >\n                      <Pencil className=\"mr-1 h-3 w-3\" /> Edit\n                    </Button>\n                    <Button\n                      variant=\"outline\"\n                      size=\"sm\"\n                      onClick={() => setDeletingOrg(selectedOrg)}\n                      className=\"text-destructive\"\n                      data-testid=\"button-delete-client\"\n                    >\n                      <Trash2 className=\"mr-1 h-3 w-3\" /> Delete\n                    </Button>\n                  </div>\n                </div>\n              </CardHeader>\n              <CardContent>\n                <Tabs defaultValue=\"pocs\">\n                  <TabsList>\n                    <TabsTrigger value=\"pocs\" className=\"gap-2\">\n                      <Users className=\"h-4 w-4\" /> Contacts\n                    </TabsTrigger>\n                    <TabsTrigger value=\"projects\" className=\"gap-2\">\n                      <Briefcase className=\"h-4 w-4\" /> Projects\n                    </TabsTrigger>\n                  </TabsList>\n                  <TabsContent value=\"pocs\" className=\"mt-4\">\n                    <div className=\"flex items-center justify-between pb-4\">\n                      <p className=\"text-sm text-muted-foreground\">\n                        {pocs?.length || 0} point(s) of contact\n                      </p>\n                      <Button\n                        size=\"sm\"\n                        onClick={() => {\n                          pocForm.reset();\n                          setIsPocDialogOpen(true);\n                        }}\n                        className=\"gap-1\"\n                        data-testid=\"button-add-poc\"\n                      >\n                        <UserPlus className=\"h-3 w-3\" /> Add Contact\n                      </Button>\n                    </div>\n                    {pocs?.length === 0 ? (\n                      <EmptyState\n                        icon={Users}\n                        title=\"No contacts yet\"\n                        description=\"Add a point of contact for this organization.\"\n                      />\n                    ) : (\n                      <Table>\n                        <TableHeader>\n                          <TableRow>\n                            <TableHead className=\"text-xs font-semibold uppercase\">Name</TableHead>\n                            <TableHead className=\"text-xs font-semibold uppercase\">Email</TableHead>\n                            <TableHead className=\"text-xs font-semibold uppercase\">Job Title</TableHead>\n                            <TableHead className=\"text-xs font-semibold uppercase\">Phone</TableHead>\n                          </TableRow>\n                        </TableHeader>\n                        <TableBody>\n                          {pocs?.map((poc) => (\n                            <TableRow key={poc.id} data-testid={`row-poc-${poc.id}`}>\n                              <TableCell className=\"font-medium\">{poc.name}</TableCell>\n                              <TableCell className=\"text-muted-foreground\">{poc.email}</TableCell>\n                              <TableCell className=\"text-muted-foreground\">{poc.jobTitle || \"-\"}</TableCell>\n                              <TableCell className=\"text-muted-foreground\">{poc.phone || \"-\"}</TableCell>\n                            </TableRow>\n                          ))}\n                        </TableBody>\n                      </Table>\n                    )}\n                  </TabsContent>\n                  <TabsContent value=\"projects\" className=\"mt-4\">\n                    <EmptyState\n                      icon={Briefcase}\n                      title=\"No projects yet\"\n                      description=\"Projects linked to this organization will appear here.\"\n                    />\n                  </TabsContent>\n                </Tabs>\n              </CardContent>\n            </>\n          ) : (\n            <CardContent className=\"flex h-[400px] items-center justify-center\">\n              <EmptyState\n                icon={Building2}\n                title=\"Select an organization\"\n                description=\"Choose an organization from the list to view details.\"\n              />\n            </CardContent>\n          )}\n        </Card>\n      </div>\n\n      <Dialog open={isOrgDialogOpen} onOpenChange={setIsOrgDialogOpen}>\n        <DialogContent className=\"max-w-lg\">\n          <DialogHeader>\n            <DialogTitle>{editingOrg ? \"Edit Organization\" : \"Add Client Organization\"}</DialogTitle>\n            <DialogDescription>\n              {editingOrg\n                ? \"Update the organization details below.\"\n                : \"Fill in the details to add a new client organization.\"}\n            </DialogDescription>\n          </DialogHeader>\n          <Form {...orgForm}>\n            <form onSubmit={orgForm.handleSubmit(onOrgSubmit)} className=\"space-y-4\">\n              <FormField\n                control={orgForm.control}\n                name=\"name\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>Organization Name *</FormLabel>\n                    <FormControl>\n                      <Input placeholder=\"Enter organization name\" {...field} data-testid=\"input-org-name\" />\n                    </FormControl>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n              <FormField\n                control={orgForm.control}\n                name=\"industry\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>Industry *</FormLabel>\n                    <Select onValueChange={field.onChange} value={field.value}>\n                      <FormControl>\n                        <SelectTrigger data-testid=\"select-org-industry\">\n                          <SelectValue placeholder=\"Select industry\" />\n                        </SelectTrigger>\n                      </FormControl>\n                      <SelectContent>\n                        {industries.map((industry) => (\n                          <SelectItem key={industry} value={industry}>\n                            {industry}\n                          </SelectItem>\n                        ))}\n                      </SelectContent>\n                    </Select>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n              <FormField\n                control={orgForm.control}\n                name=\"billingAddress\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>Billing Address</FormLabel>\n                    <FormControl>\n                      <Textarea\n                        placeholder=\"Enter billing address...\"\n                        className=\"resize-none\"\n                        rows={3}\n                        {...field}\n                        data-testid=\"input-org-billing\"\n                      />\n                    </FormControl>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n              <DialogFooter>\n                <Button type=\"button\" variant=\"outline\" onClick={() => setIsOrgDialogOpen(false)}>\n                  Cancel\n                </Button>\n                <Button\n                  type=\"submit\"\n                  disabled={createOrgMutation.isPending || updateOrgMutation.isPending}\n                  data-testid=\"button-save-org\"\n                >\n                  {createOrgMutation.isPending || updateOrgMutation.isPending\n                    ? \"Saving...\"\n                    : editingOrg\n                      ? \"Update\"\n                      : \"Create\"}\n                </Button>\n              </DialogFooter>\n            </form>\n          </Form>\n        </DialogContent>\n      </Dialog>\n\n      <Dialog open={isPocDialogOpen} onOpenChange={setIsPocDialogOpen}>\n        <DialogContent className=\"max-w-lg\">\n          <DialogHeader>\n            <DialogTitle>Add Point of Contact</DialogTitle>\n            <DialogDescription>\n              Add a contact person for {selectedOrg?.name}.\n            </DialogDescription>\n          </DialogHeader>\n          <Form {...pocForm}>\n            <form onSubmit={pocForm.handleSubmit(onPocSubmit)} className=\"space-y-4\">\n              <FormField\n                control={pocForm.control}\n                name=\"name\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>Name *</FormLabel>\n                    <FormControl>\n                      <Input placeholder=\"Enter name\" {...field} data-testid=\"input-poc-name\" />\n                    </FormControl>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n              <FormField\n                control={pocForm.control}\n                name=\"email\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>Email *</FormLabel>\n                    <FormControl>\n                      <Input type=\"email\" placeholder=\"Enter email\" {...field} data-testid=\"input-poc-email\" />\n                    </FormControl>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n              <div className=\"grid gap-4 sm:grid-cols-2\">\n                <FormField\n                  control={pocForm.control}\n                  name=\"phone\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Phone</FormLabel>\n                      <FormControl>\n                        <Input placeholder=\"Enter phone\" {...field} data-testid=\"input-poc-phone\" />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n                <FormField\n                  control={pocForm.control}\n                  name=\"jobTitle\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Job Title</FormLabel>\n                      <FormControl>\n                        <Input placeholder=\"e.g. Director\" {...field} data-testid=\"input-poc-job-title\" />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n              </div>\n              <DialogFooter>\n                <Button type=\"button\" variant=\"outline\" onClick={() => setIsPocDialogOpen(false)}>\n                  Cancel\n                </Button>\n                <Button\n                  type=\"submit\"\n                  disabled={createPocMutation.isPending}\n                  data-testid=\"button-save-poc\"\n                >\n                  {createPocMutation.isPending ? \"Saving...\" : \"Add Contact\"}\n                </Button>\n              </DialogFooter>\n            </form>\n          </Form>\n        </DialogContent>\n      </Dialog>\n\n      <AlertDialog open={!!deletingOrg} onOpenChange={() => setDeletingOrg(null)}>\n        <AlertDialogContent>\n          <AlertDialogHeader>\n            <AlertDialogTitle>Delete Organization</AlertDialogTitle>\n            <AlertDialogDescription>\n              Are you sure you want to delete \"{deletingOrg?.name}\"? This action cannot be undone\n              and will also remove all associated contacts and project links.\n            </AlertDialogDescription>\n          </AlertDialogHeader>\n          <AlertDialogFooter>\n            <AlertDialogCancel>Cancel</AlertDialogCancel>\n            <AlertDialogAction\n              onClick={() => deletingOrg && deleteOrgMutation.mutate(deletingOrg.id)}\n              className=\"bg-destructive text-destructive-foreground hover:bg-destructive/90\"\n            >\n              {deleteOrgMutation.isPending ? \"Deleting...\" : \"Delete\"}\n            </AlertDialogAction>\n          </AlertDialogFooter>\n        </AlertDialogContent>\n      </AlertDialog>\n    </div>\n  );\n}\n","path":null,"size_bytes":22561,"size_tokens":null},"client/src/pages/consultations.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { useForm } from \"react-hook-form\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport { format } from \"date-fns\";\nimport { z } from \"zod\";\nimport { Plus, Phone, Calendar, Clock, Video, CheckCircle, XCircle, AlertCircle } from \"lucide-react\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Badge } from \"@/components/ui/badge\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogDescription,\n  DialogFooter,\n  DialogHeader,\n  DialogTitle,\n} from \"@/components/ui/dialog\";\nimport {\n  Form,\n  FormControl,\n  FormField,\n  FormItem,\n  FormLabel,\n  FormMessage,\n} from \"@/components/ui/form\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport {\n  Table,\n  TableBody,\n  TableCell,\n  TableHead,\n  TableHeader,\n  TableRow,\n} from \"@/components/ui/table\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { useAuth } from \"@/lib/auth\";\nimport { queryClient, apiRequest } from \"@/lib/queryClient\";\nimport { EmptyState } from \"@/components/empty-state\";\nimport { DataTableSkeleton } from \"@/components/data-table-skeleton\";\nimport type { CallRecord, InsertCallRecord, Project, Expert } from \"@shared/schema\";\n\nconst callFormSchema = z.object({\n  projectId: z.number().min(1, \"Project is required\"),\n  expertId: z.number().min(1, \"Expert is required\"),\n  callDate: z.string().min(1, \"Call date is required\"),\n  durationMinutes: z.number().min(1, \"Duration is required\"),\n  scheduledStartTime: z.string().optional(),\n  scheduledEndTime: z.string().optional(),\n  zoomLink: z.string().optional(),\n  notes: z.string().optional(),\n});\n\nconst completeFormSchema = z.object({\n  actualDurationMinutes: z.number().min(1, \"Duration is required\"),\n  recordingUrl: z.string().optional(),\n  notes: z.string().optional(),\n});\n\ntype CallFormData = z.infer<typeof callFormSchema>;\ntype CompleteFormData = z.infer<typeof completeFormSchema>;\n\nfunction getStatusIcon(status: string) {\n  switch (status) {\n    case \"scheduled\":\n      return <Calendar className=\"h-4 w-4 text-blue-500\" />;\n    case \"completed\":\n      return <CheckCircle className=\"h-4 w-4 text-green-500\" />;\n    case \"cancelled\":\n      return <XCircle className=\"h-4 w-4 text-destructive\" />;\n    default:\n      return <AlertCircle className=\"h-4 w-4 text-muted-foreground\" />;\n  }\n}\n\nfunction getStatusBadge(status: string) {\n  const variants: Record<string, \"default\" | \"secondary\" | \"destructive\" | \"outline\"> = {\n    scheduled: \"default\",\n    completed: \"secondary\",\n    cancelled: \"destructive\",\n    pending: \"outline\",\n  };\n  return (\n    <Badge variant={variants[status] || \"outline\"}>\n      {status.charAt(0).toUpperCase() + status.slice(1)}\n    </Badge>\n  );\n}\n\nexport default function Consultations() {\n  const { toast } = useToast();\n  const { user } = useAuth();\n  const [isDialogOpen, setIsDialogOpen] = useState(false);\n  const [isCompleteDialogOpen, setIsCompleteDialogOpen] = useState(false);\n  const [selectedCall, setSelectedCall] = useState<CallRecord | null>(null);\n  const [statusFilter, setStatusFilter] = useState<string>(\"all\");\n\n  const { data: callRecords, isLoading } = useQuery<CallRecord[]>({\n    queryKey: [\"/api/call-records\"],\n  });\n  \n  const isRA = user?.role === \"ra\";\n\n  const { data: projects } = useQuery<Project[]>({\n    queryKey: [\"/api/projects\"],\n  });\n\n  const { data: experts } = useQuery<Expert[]>({\n    queryKey: [\"/api/experts\"],\n  });\n\n  const form = useForm<CallFormData>({\n    resolver: zodResolver(callFormSchema),\n    defaultValues: {\n      projectId: 0,\n      expertId: 0,\n      callDate: format(new Date(), \"yyyy-MM-dd\"),\n      durationMinutes: 30,\n      scheduledStartTime: \"\",\n      scheduledEndTime: \"\",\n      zoomLink: \"\",\n      notes: \"\",\n    },\n  });\n\n  const completeForm = useForm<CompleteFormData>({\n    resolver: zodResolver(completeFormSchema),\n    defaultValues: {\n      actualDurationMinutes: 30,\n      recordingUrl: \"\",\n      notes: \"\",\n    },\n  });\n\n  const createMutation = useMutation({\n    mutationFn: (data: InsertCallRecord) => apiRequest(\"POST\", \"/api/call-records\", data),\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/call-records\"] });\n      setIsDialogOpen(false);\n      form.reset();\n      toast({ title: \"Call scheduled successfully\" });\n    },\n    onError: () => {\n      toast({ title: \"Failed to schedule call\", variant: \"destructive\" });\n    },\n  });\n\n  const completeMutation = useMutation({\n    mutationFn: (data: CompleteFormData) =>\n      apiRequest(\"POST\", `/api/call-records/${selectedCall?.id}/complete`, data),\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/call-records\"] });\n      setIsCompleteDialogOpen(false);\n      setSelectedCall(null);\n      completeForm.reset();\n      toast({ title: \"Call marked as completed\" });\n    },\n    onError: () => {\n      toast({ title: \"Failed to complete call\", variant: \"destructive\" });\n    },\n  });\n\n  const cancelMutation = useMutation({\n    mutationFn: (id: number) =>\n      apiRequest(\"POST\", `/api/call-records/${id}/cancel`, { reason: \"Cancelled by admin\" }),\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/call-records\"] });\n      toast({ title: \"Call cancelled\" });\n    },\n    onError: () => {\n      toast({ title: \"Failed to cancel call\", variant: \"destructive\" });\n    },\n  });\n\n  const filteredRecords = callRecords?.filter((record) =>\n    statusFilter === \"all\" || record.status === statusFilter\n  );\n\n  const onSubmit = (data: CallFormData) => {\n    const cuUsed = Math.ceil((data.durationMinutes / 60) * 4) / 4;\n    const callData: InsertCallRecord = {\n      ...data,\n      callDate: new Date(data.callDate),\n      cuUsed: cuUsed.toString(),\n      status: data.scheduledStartTime ? \"scheduled\" : \"pending\",\n      scheduledStartTime: data.scheduledStartTime ? new Date(data.scheduledStartTime) : null,\n      scheduledEndTime: data.scheduledEndTime ? new Date(data.scheduledEndTime) : null,\n      zoomLink: data.zoomLink || null,\n      notes: data.notes || null,\n    };\n    createMutation.mutate(callData);\n  };\n\n  const onCompleteSubmit = (data: CompleteFormData) => {\n    completeMutation.mutate(data);\n  };\n\n  const getProjectName = (projectId: number) => {\n    return projects?.find((p) => p.id === projectId)?.name || \"Unknown\";\n  };\n\n  const getExpertName = (expertId: number) => {\n    return experts?.find((e) => e.id === expertId)?.name || \"Unknown\";\n  };\n\n  const totalCuUsed = callRecords\n    ?.filter((r) => r.status === \"completed\")\n    .reduce((sum, r) => sum + parseFloat(r.cuUsed || \"0\"), 0) || 0;\n\n  const scheduledCalls = callRecords?.filter((r) => r.status === \"scheduled\").length || 0;\n  const completedCalls = callRecords?.filter((r) => r.status === \"completed\").length || 0;\n\n  return (\n    <div className=\"space-y-6 p-8\">\n      <div className=\"flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between\">\n        <div>\n          <h1 className=\"text-3xl font-semibold text-foreground\">Consultations</h1>\n          <p className=\"text-sm text-muted-foreground\">\n            {isRA ? \"Monitor calls for your assigned projects.\" : \"Schedule and track expert consultations with CU usage.\"}\n          </p>\n        </div>\n        {!isRA && (\n          <Button onClick={() => setIsDialogOpen(true)} className=\"gap-2\" data-testid=\"button-schedule-call\">\n            <Plus className=\"h-4 w-4\" /> Schedule Call\n          </Button>\n        )}\n      </div>\n\n      <div className={`grid gap-4 ${isRA ? \"sm:grid-cols-2\" : \"sm:grid-cols-3\"}`}>\n        <Card>\n          <CardContent className=\"flex items-center gap-4 pt-6\">\n            <div className=\"flex h-12 w-12 items-center justify-center rounded-lg bg-blue-500/10\">\n              <Calendar className=\"h-6 w-6 text-blue-500\" />\n            </div>\n            <div>\n              <p className=\"text-2xl font-bold\">{scheduledCalls}</p>\n              <p className=\"text-sm text-muted-foreground\">Scheduled</p>\n            </div>\n          </CardContent>\n        </Card>\n        <Card>\n          <CardContent className=\"flex items-center gap-4 pt-6\">\n            <div className=\"flex h-12 w-12 items-center justify-center rounded-lg bg-green-500/10\">\n              <CheckCircle className=\"h-6 w-6 text-green-500\" />\n            </div>\n            <div>\n              <p className=\"text-2xl font-bold\">{completedCalls}</p>\n              <p className=\"text-sm text-muted-foreground\">Completed</p>\n            </div>\n          </CardContent>\n        </Card>\n        {!isRA && (\n          <Card>\n            <CardContent className=\"flex items-center gap-4 pt-6\">\n              <div className=\"flex h-12 w-12 items-center justify-center rounded-lg bg-primary/10\">\n                <Clock className=\"h-6 w-6 text-primary\" />\n              </div>\n              <div>\n                <p className=\"text-2xl font-bold\">{totalCuUsed.toFixed(1)}</p>\n                <p className=\"text-sm text-muted-foreground\">Total CU Used</p>\n              </div>\n            </CardContent>\n          </Card>\n        )}\n      </div>\n\n      <Card>\n        <CardHeader className=\"pb-4\">\n          <div className=\"flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between\">\n            <CardTitle className=\"text-base font-medium\">All Consultations</CardTitle>\n            <Select value={statusFilter} onValueChange={setStatusFilter}>\n              <SelectTrigger className=\"w-40\" data-testid=\"select-status-filter\">\n                <SelectValue placeholder=\"Filter by status\" />\n              </SelectTrigger>\n              <SelectContent>\n                <SelectItem value=\"all\">All Statuses</SelectItem>\n                <SelectItem value=\"pending\">Pending</SelectItem>\n                <SelectItem value=\"scheduled\">Scheduled</SelectItem>\n                <SelectItem value=\"completed\">Completed</SelectItem>\n                <SelectItem value=\"cancelled\">Cancelled</SelectItem>\n              </SelectContent>\n            </Select>\n          </div>\n        </CardHeader>\n        <CardContent>\n          {isLoading ? (\n            <DataTableSkeleton columns={isRA ? 6 : 7} rows={5} />\n          ) : filteredRecords?.length === 0 ? (\n            <EmptyState\n              icon={Phone}\n              title=\"No consultations found\"\n              description={isRA \n                ? \"No consultations yet. Once your projects have scheduled calls, they will appear here.\"\n                : \"Schedule your first call to get started.\"}\n              action={!isRA && (\n                <Button onClick={() => setIsDialogOpen(true)} className=\"gap-2\">\n                  <Plus className=\"h-4 w-4\" /> Schedule Call\n                </Button>\n              )}\n            />\n          ) : (\n            <div className=\"overflow-x-auto\">\n              <Table>\n                <TableHeader>\n                  <TableRow>\n                    <TableHead className=\"text-xs font-semibold uppercase\">Project</TableHead>\n                    <TableHead className=\"text-xs font-semibold uppercase\">Expert</TableHead>\n                    <TableHead className=\"text-xs font-semibold uppercase\">Date</TableHead>\n                    <TableHead className=\"text-xs font-semibold uppercase\">Duration</TableHead>\n                    {!isRA && <TableHead className=\"text-xs font-semibold uppercase\">CU</TableHead>}\n                    <TableHead className=\"text-xs font-semibold uppercase\">Status</TableHead>\n                    {!isRA && <TableHead className=\"text-right text-xs font-semibold uppercase\">Actions</TableHead>}\n                  </TableRow>\n                </TableHeader>\n                <TableBody>\n                  {filteredRecords?.map((record) => (\n                    <TableRow key={record.id} data-testid={`row-call-${record.id}`}>\n                      <TableCell className=\"font-medium\">{getProjectName(record.projectId)}</TableCell>\n                      <TableCell className=\"text-muted-foreground\">{getExpertName(record.expertId)}</TableCell>\n                      <TableCell className=\"font-mono text-xs text-muted-foreground\">\n                        {format(new Date(record.callDate), \"MMM dd, yyyy\")}\n                      </TableCell>\n                      <TableCell className=\"text-muted-foreground\">\n                        {record.actualDurationMinutes || record.durationMinutes} min\n                      </TableCell>\n                      {!isRA && (\n                        <TableCell className=\"font-mono font-medium\">\n                          {parseFloat(record.cuUsed || \"0\").toFixed(1)}\n                        </TableCell>\n                      )}\n                      <TableCell>{getStatusBadge(record.status)}</TableCell>\n                      {!isRA && (\n                        <TableCell className=\"text-right\">\n                          <div className=\"flex justify-end gap-1\">\n                            {record.status === \"scheduled\" && (\n                              <>\n                                <Button\n                                  variant=\"outline\"\n                                  size=\"sm\"\n                                  onClick={() => {\n                                    setSelectedCall(record);\n                                    completeForm.reset({\n                                      actualDurationMinutes: record.durationMinutes,\n                                      notes: record.notes || \"\",\n                                    });\n                                    setIsCompleteDialogOpen(true);\n                                  }}\n                                  data-testid={`button-complete-call-${record.id}`}\n                                >\n                                  <CheckCircle className=\"mr-1 h-3 w-3\" /> Complete\n                                </Button>\n                                <Button\n                                  variant=\"ghost\"\n                                  size=\"sm\"\n                                  onClick={() => cancelMutation.mutate(record.id)}\n                                  className=\"text-destructive\"\n                                  data-testid={`button-cancel-call-${record.id}`}\n                                >\n                                  <XCircle className=\"mr-1 h-3 w-3\" /> Cancel\n                                </Button>\n                              </>\n                            )}\n                            {record.zoomLink && (\n                              <Button\n                                variant=\"ghost\"\n                                size=\"icon\"\n                                asChild\n                              >\n                                <a href={record.zoomLink} target=\"_blank\" rel=\"noopener noreferrer\">\n                                  <Video className=\"h-4 w-4\" />\n                                </a>\n                              </Button>\n                            )}\n                          </div>\n                        </TableCell>\n                      )}\n                    </TableRow>\n                  ))}\n                </TableBody>\n              </Table>\n            </div>\n          )}\n        </CardContent>\n      </Card>\n\n      <Dialog open={isDialogOpen} onOpenChange={setIsDialogOpen}>\n        <DialogContent className=\"max-w-lg\">\n          <DialogHeader>\n            <DialogTitle>Schedule Consultation</DialogTitle>\n            <DialogDescription>\n              Schedule a new consultation call between a project and an expert.\n            </DialogDescription>\n          </DialogHeader>\n          <Form {...form}>\n            <form onSubmit={form.handleSubmit(onSubmit)} className=\"space-y-4\">\n              <FormField\n                control={form.control}\n                name=\"projectId\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>Project *</FormLabel>\n                    <Select onValueChange={(v) => field.onChange(parseInt(v))} value={field.value?.toString()}>\n                      <FormControl>\n                        <SelectTrigger data-testid=\"select-project\">\n                          <SelectValue placeholder=\"Select project\" />\n                        </SelectTrigger>\n                      </FormControl>\n                      <SelectContent>\n                        {projects?.map((project) => (\n                          <SelectItem key={project.id} value={project.id.toString()}>\n                            {project.name}\n                          </SelectItem>\n                        ))}\n                      </SelectContent>\n                    </Select>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n              <FormField\n                control={form.control}\n                name=\"expertId\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>Expert *</FormLabel>\n                    <Select onValueChange={(v) => field.onChange(parseInt(v))} value={field.value?.toString()}>\n                      <FormControl>\n                        <SelectTrigger data-testid=\"select-expert\">\n                          <SelectValue placeholder=\"Select expert\" />\n                        </SelectTrigger>\n                      </FormControl>\n                      <SelectContent>\n                        {experts?.map((expert) => (\n                          <SelectItem key={expert.id} value={expert.id.toString()}>\n                            {expert.name}\n                          </SelectItem>\n                        ))}\n                      </SelectContent>\n                    </Select>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n              <div className=\"grid gap-4 sm:grid-cols-2\">\n                <FormField\n                  control={form.control}\n                  name=\"callDate\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Call Date *</FormLabel>\n                      <FormControl>\n                        <Input type=\"date\" {...field} data-testid=\"input-call-date\" />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n                <FormField\n                  control={form.control}\n                  name=\"durationMinutes\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Duration (minutes) *</FormLabel>\n                      <FormControl>\n                        <Input\n                          type=\"number\"\n                          min={15}\n                          step={15}\n                          {...field}\n                          onChange={(e) => field.onChange(parseInt(e.target.value) || 0)}\n                          data-testid=\"input-duration\"\n                        />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n              </div>\n              <FormField\n                control={form.control}\n                name=\"zoomLink\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>Zoom Link</FormLabel>\n                    <FormControl>\n                      <Input placeholder=\"https://zoom.us/j/...\" {...field} data-testid=\"input-zoom-link\" />\n                    </FormControl>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n              <FormField\n                control={form.control}\n                name=\"notes\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>Notes</FormLabel>\n                    <FormControl>\n                      <Textarea\n                        placeholder=\"Additional notes...\"\n                        className=\"resize-none\"\n                        rows={2}\n                        {...field}\n                        data-testid=\"input-call-notes\"\n                      />\n                    </FormControl>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n              <DialogFooter>\n                <Button type=\"button\" variant=\"outline\" onClick={() => setIsDialogOpen(false)}>\n                  Cancel\n                </Button>\n                <Button type=\"submit\" disabled={createMutation.isPending} data-testid=\"button-save-call\">\n                  {createMutation.isPending ? \"Saving...\" : \"Schedule Call\"}\n                </Button>\n              </DialogFooter>\n            </form>\n          </Form>\n        </DialogContent>\n      </Dialog>\n\n      <Dialog open={isCompleteDialogOpen} onOpenChange={setIsCompleteDialogOpen}>\n        <DialogContent className=\"max-w-lg\">\n          <DialogHeader>\n            <DialogTitle>Complete Consultation</DialogTitle>\n            <DialogDescription>\n              Mark this consultation as completed and record the actual duration.\n            </DialogDescription>\n          </DialogHeader>\n          <Form {...completeForm}>\n            <form onSubmit={completeForm.handleSubmit(onCompleteSubmit)} className=\"space-y-4\">\n              <FormField\n                control={completeForm.control}\n                name=\"actualDurationMinutes\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>Actual Duration (minutes) *</FormLabel>\n                    <FormControl>\n                      <Input\n                        type=\"number\"\n                        min={1}\n                        {...field}\n                        onChange={(e) => field.onChange(parseInt(e.target.value) || 0)}\n                        data-testid=\"input-actual-duration\"\n                      />\n                    </FormControl>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n              <FormField\n                control={completeForm.control}\n                name=\"recordingUrl\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>Recording URL</FormLabel>\n                    <FormControl>\n                      <Input placeholder=\"https://...\" {...field} data-testid=\"input-recording-url\" />\n                    </FormControl>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n              <FormField\n                control={completeForm.control}\n                name=\"notes\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>Notes</FormLabel>\n                    <FormControl>\n                      <Textarea\n                        placeholder=\"Call summary...\"\n                        className=\"resize-none\"\n                        rows={3}\n                        {...field}\n                        data-testid=\"input-complete-notes\"\n                      />\n                    </FormControl>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n              <DialogFooter>\n                <Button type=\"button\" variant=\"outline\" onClick={() => setIsCompleteDialogOpen(false)}>\n                  Cancel\n                </Button>\n                <Button type=\"submit\" disabled={completeMutation.isPending} data-testid=\"button-complete-call\">\n                  {completeMutation.isPending ? \"Saving...\" : \"Mark Complete\"}\n                </Button>\n              </DialogFooter>\n            </form>\n          </Form>\n        </DialogContent>\n      </Dialog>\n    </div>\n  );\n}\n","path":null,"size_bytes":23963,"size_tokens":null},"client/src/components/ui/alert.tsx":{"content":"import * as React from \"react\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst alertVariants = cva(\n  \"relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-background text-foreground\",\n        destructive:\n          \"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nconst Alert = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement> & VariantProps<typeof alertVariants>\n>(({ className, variant, ...props }, ref) => (\n  <div\n    ref={ref}\n    role=\"alert\"\n    className={cn(alertVariants({ variant }), className)}\n    {...props}\n  />\n))\nAlert.displayName = \"Alert\"\n\nconst AlertTitle = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLHeadingElement>\n>(({ className, ...props }, ref) => (\n  <h5\n    ref={ref}\n    className={cn(\"mb-1 font-medium leading-none tracking-tight\", className)}\n    {...props}\n  />\n))\nAlertTitle.displayName = \"AlertTitle\"\n\nconst AlertDescription = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"text-sm [&_p]:leading-relaxed\", className)}\n    {...props}\n  />\n))\nAlertDescription.displayName = \"AlertDescription\"\n\nexport { Alert, AlertTitle, AlertDescription }\n","path":null,"size_bytes":1584,"size_tokens":null},"client/src/components/ui/tooltip.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as TooltipPrimitive from \"@radix-ui/react-tooltip\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst TooltipProvider = TooltipPrimitive.Provider\n\nconst Tooltip = TooltipPrimitive.Root\n\nconst TooltipTrigger = TooltipPrimitive.Trigger\n\nconst TooltipContent = React.forwardRef<\n  React.ElementRef<typeof TooltipPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof TooltipPrimitive.Content>\n>(({ className, sideOffset = 4, ...props }, ref) => (\n  <TooltipPrimitive.Content\n    ref={ref}\n    sideOffset={sideOffset}\n    className={cn(\n      \"z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-tooltip-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nTooltipContent.displayName = TooltipPrimitive.Content.displayName\n\nexport { Tooltip, TooltipTrigger, TooltipContent, TooltipProvider }\n","path":null,"size_bytes":1209,"size_tokens":null},"server/seed.ts":{"content":"import { db } from \"./db\";\nimport { \n  users, \n  clientOrganizations, \n  clientPocs, \n  projects, \n  experts, \n  vettingQuestions,\n  projectExperts,\n  callRecords,\n  expertInvitationLinks\n} from \"@shared/schema\";\nimport bcrypt from \"bcryptjs\";\n\nasync function seed() {\n  console.log(\"Seeding database...\");\n\n  const existingUsers = await db.select().from(users);\n  if (existingUsers.length > 0) {\n    console.log(\"Database already has data, skipping seed.\");\n    return;\n  }\n\n  const passwordHash = await bcrypt.hash(\"Test1234!\", 10);\n\n  const insertedUsers = await db.insert(users).values([\n    { email: \"admin@miraeconnext.com\", fullName: \"Admin User\", role: \"admin\", passwordHash },\n    { email: \"pm@miraeconnext.com\", fullName: \"Sarah Chen\", role: \"pm\", passwordHash },\n    { email: \"ra@miraeconnext.com\", fullName: \"Michael Lee\", role: \"ra\", passwordHash },\n    { email: \"finance@miraeconnext.com\", fullName: \"Emily Park\", role: \"finance\", passwordHash },\n  ]).returning();\n\n  console.log(`Inserted ${insertedUsers.length} users`);\n\n  const insertedOrgs = await db.insert(clientOrganizations).values([\n    { \n      name: \"McKinsey & Company\", \n      industry: \"Consulting\",\n      mainPmId: insertedUsers[1].id,\n      totalCuUsed: \"125.50\"\n    },\n    { \n      name: \"Boston Consulting Group\", \n      industry: \"Consulting\",\n      mainPmId: insertedUsers[1].id,\n      totalCuUsed: \"45.00\"\n    },\n    { \n      name: \"Goldman Sachs\", \n      industry: \"Finance\",\n      mainPmId: insertedUsers[1].id,\n      totalCuUsed: \"0.00\"\n    },\n    { \n      name: \"JPMorgan Chase\", \n      industry: \"Finance\",\n      mainPmId: insertedUsers[1].id,\n      totalCuUsed: \"200.00\"\n    },\n  ]).returning();\n\n  console.log(`Inserted ${insertedOrgs.length} client organizations`);\n\n  const insertedPocs = await db.insert(clientPocs).values([\n    { organizationId: insertedOrgs[0].id, name: \"Jennifer Kim\", email: \"jennifer.kim@mckinsey.com\", jobTitle: \"Senior Partner\", phone: \"+1 212 555 0101\" },\n    { organizationId: insertedOrgs[0].id, name: \"David Chen\", email: \"david.chen@mckinsey.com\", jobTitle: \"Associate Partner\", phone: \"+1 212 555 0102\" },\n    { organizationId: insertedOrgs[1].id, name: \"Michael Brown\", email: \"michael.brown@bcg.com\", jobTitle: \"Managing Director\", phone: \"+1 617 555 0201\" },\n    { organizationId: insertedOrgs[2].id, name: \"Sarah Williams\", email: \"sarah.williams@gs.com\", jobTitle: \"Vice President\", phone: \"+1 212 555 0301\" },\n    { organizationId: insertedOrgs[3].id, name: \"Robert Johnson\", email: \"robert.johnson@jpmorgan.com\", jobTitle: \"Executive Director\", phone: \"+1 212 555 0401\" },\n  ]).returning();\n\n  console.log(`Inserted ${insertedPocs.length} client POCs`);\n\n  const insertedProjects = await db.insert(projects).values([\n    {\n      name: \"Battery Technology Market Analysis\",\n      projectOverview: \"Comprehensive analysis of EV battery technology landscape and competitive dynamics\",\n      clientOrganizationId: insertedOrgs[0].id,\n      clientName: \"McKinsey & Company\",\n      clientPocName: \"Jennifer Kim\",\n      clientPocEmail: \"jennifer.kim@mckinsey.com\",\n      description: \"Need experts in lithium-ion battery manufacturing, solid-state battery development, and EV charging infrastructure\",\n      industry: \"Energy\",\n      status: \"sourcing\",\n      createdByPmId: insertedUsers[1].id,\n      assignedRaId: insertedUsers[2].id,\n      totalCuUsed: \"45.00\"\n    },\n    {\n      name: \"Healthcare AI Integration Study\",\n      projectOverview: \"Assessment of AI/ML adoption in hospital systems and diagnostic tools\",\n      clientOrganizationId: insertedOrgs[0].id,\n      clientName: \"McKinsey & Company\",\n      clientPocName: \"David Chen\",\n      clientPocEmail: \"david.chen@mckinsey.com\",\n      description: \"Seeking medical AI researchers, hospital CIOs, and health tech startup founders\",\n      industry: \"Healthcare\",\n      status: \"pending_client_review\",\n      createdByPmId: insertedUsers[1].id,\n      assignedRaId: insertedUsers[2].id,\n      totalCuUsed: \"80.50\"\n    },\n    {\n      name: \"Semiconductor Supply Chain Due Diligence\",\n      projectOverview: \"Supply chain risk assessment for chip manufacturing investment\",\n      clientOrganizationId: insertedOrgs[2].id,\n      clientName: \"Goldman Sachs\",\n      clientPocName: \"Sarah Williams\",\n      clientPocEmail: \"sarah.williams@gs.com\",\n      description: \"Need semiconductor engineers, supply chain executives, and geopolitical analysts\",\n      industry: \"Technology\",\n      status: \"new\",\n      createdByPmId: insertedUsers[1].id,\n      totalCuUsed: \"0.00\"\n    },\n    {\n      name: \"Fintech Payment Systems Analysis\",\n      projectOverview: \"Competitive landscape of digital payment platforms\",\n      clientOrganizationId: insertedOrgs[3].id,\n      clientName: \"JPMorgan Chase\",\n      clientPocName: \"Robert Johnson\",\n      clientPocEmail: \"robert.johnson@jpmorgan.com\",\n      description: \"Looking for payment infrastructure experts, fintech executives, and regulatory specialists\",\n      industry: \"Finance\",\n      status: \"client_selected\",\n      createdByPmId: insertedUsers[1].id,\n      assignedRaId: insertedUsers[2].id,\n      totalCuUsed: \"150.00\"\n    },\n    {\n      name: \"Renewable Energy Investment Thesis\",\n      projectOverview: \"Deep-dive into solar and wind energy market opportunities\",\n      clientOrganizationId: insertedOrgs[1].id,\n      clientName: \"Boston Consulting Group\",\n      clientPocName: \"Michael Brown\",\n      clientPocEmail: \"michael.brown@bcg.com\",\n      description: \"Seeking renewable energy developers, utility executives, and clean tech investors\",\n      industry: \"Energy\",\n      status: \"completed\",\n      createdByPmId: insertedUsers[1].id,\n      assignedRaId: insertedUsers[2].id,\n      totalCuUsed: \"45.00\"\n    },\n  ]).returning();\n\n  console.log(`Inserted ${insertedProjects.length} projects`);\n\n  const insertedExperts = await db.insert(experts).values([\n    {\n      name: \"Dr. James Chen\",\n      email: \"james.chen@email.com\",\n      phone: \"+1 415 555 1001\",\n      linkedinUrl: \"https://linkedin.com/in/jameschen\",\n      country: \"United States\",\n      timezone: \"America/Los_Angeles\",\n      expertise: \"Battery Technology\",\n      areasOfExpertise: [\"Lithium-ion batteries\", \"Solid-state batteries\", \"Energy storage systems\"],\n      industry: \"Energy\",\n      company: \"Tesla\",\n      jobTitle: \"Principal Battery Engineer\",\n      yearsOfExperience: 15,\n      hourlyRate: \"350.00\",\n      bio: \"Former Tesla battery team lead with 15+ years in EV battery development\",\n      status: \"available\",\n      termsAccepted: true,\n      lgpdAccepted: true\n    },\n    {\n      name: \"Dr. Sarah Kim\",\n      email: \"sarah.kim@email.com\",\n      phone: \"+1 650 555 1002\",\n      linkedinUrl: \"https://linkedin.com/in/sarahkim\",\n      country: \"United States\",\n      timezone: \"America/Los_Angeles\",\n      expertise: \"Medical AI\",\n      areasOfExpertise: [\"Diagnostic AI\", \"Medical imaging\", \"FDA regulatory\"],\n      industry: \"Healthcare\",\n      company: \"Google Health\",\n      jobTitle: \"Senior Research Scientist\",\n      yearsOfExperience: 12,\n      hourlyRate: \"400.00\",\n      bio: \"AI researcher specializing in medical diagnostics and FDA-cleared algorithms\",\n      status: \"available\",\n      termsAccepted: true,\n      lgpdAccepted: true\n    },\n    {\n      name: \"Michael Wong\",\n      email: \"michael.wong@email.com\",\n      phone: \"+1 408 555 1003\",\n      linkedinUrl: \"https://linkedin.com/in/michaelwong\",\n      country: \"United States\",\n      timezone: \"America/Los_Angeles\",\n      expertise: \"Semiconductor Manufacturing\",\n      areasOfExpertise: [\"Chip fabrication\", \"Supply chain\", \"ASML equipment\"],\n      industry: \"Technology\",\n      company: \"Intel\",\n      jobTitle: \"VP of Manufacturing\",\n      yearsOfExperience: 20,\n      hourlyRate: \"500.00\",\n      bio: \"20-year semiconductor veteran with deep expertise in chip manufacturing\",\n      status: \"available\",\n      termsAccepted: true,\n      lgpdAccepted: true\n    },\n    {\n      name: \"Emily Zhang\",\n      email: \"emily.zhang@email.com\",\n      phone: \"+1 212 555 1004\",\n      linkedinUrl: \"https://linkedin.com/in/emilyzhang\",\n      country: \"United States\",\n      timezone: \"America/New_York\",\n      expertise: \"Digital Payments\",\n      areasOfExpertise: [\"Payment infrastructure\", \"Fintech\", \"Regulatory compliance\"],\n      industry: \"Finance\",\n      company: \"Stripe\",\n      jobTitle: \"Director of Product\",\n      yearsOfExperience: 10,\n      hourlyRate: \"375.00\",\n      bio: \"Fintech executive with experience building payment systems at scale\",\n      status: \"available\",\n      termsAccepted: true,\n      lgpdAccepted: true\n    },\n    {\n      name: \"Dr. Robert Park\",\n      email: \"robert.park@email.com\",\n      phone: \"+1 713 555 1005\",\n      linkedinUrl: \"https://linkedin.com/in/robertpark\",\n      country: \"United States\",\n      timezone: \"America/Chicago\",\n      expertise: \"Renewable Energy\",\n      areasOfExpertise: [\"Solar PV\", \"Wind energy\", \"Grid integration\"],\n      industry: \"Energy\",\n      company: \"NextEra Energy\",\n      jobTitle: \"Chief Technology Officer\",\n      yearsOfExperience: 18,\n      hourlyRate: \"425.00\",\n      bio: \"CTO at largest renewable energy company with deep technical expertise\",\n      status: \"busy\",\n      termsAccepted: true,\n      lgpdAccepted: true\n    },\n    {\n      name: \"Lisa Johnson\",\n      email: \"lisa.johnson@email.com\",\n      phone: \"+1 617 555 1006\",\n      linkedinUrl: \"https://linkedin.com/in/lisajohnson\",\n      country: \"United States\",\n      timezone: \"America/New_York\",\n      expertise: \"Hospital Operations\",\n      areasOfExpertise: [\"Healthcare IT\", \"EHR systems\", \"Digital transformation\"],\n      industry: \"Healthcare\",\n      company: \"Mass General Hospital\",\n      jobTitle: \"Chief Information Officer\",\n      yearsOfExperience: 14,\n      hourlyRate: \"350.00\",\n      bio: \"Hospital CIO with experience implementing AI solutions in clinical settings\",\n      status: \"available\",\n      termsAccepted: true,\n      lgpdAccepted: true\n    },\n    {\n      name: \"David Lee\",\n      email: \"david.lee@email.com\",\n      phone: \"+886 2 555 1007\",\n      linkedinUrl: \"https://linkedin.com/in/davidlee-tw\",\n      country: \"Taiwan\",\n      timezone: \"Asia/Taipei\",\n      expertise: \"Chip Design\",\n      areasOfExpertise: [\"ASIC design\", \"TSMC processes\", \"Advanced packaging\"],\n      industry: \"Technology\",\n      company: \"TSMC\",\n      jobTitle: \"Senior Director\",\n      yearsOfExperience: 16,\n      hourlyRate: \"450.00\",\n      bio: \"Senior TSMC executive with expertise in advanced node manufacturing\",\n      status: \"available\",\n      termsAccepted: true,\n      lgpdAccepted: true\n    },\n    {\n      name: \"Anna Martinez\",\n      email: \"anna.martinez@email.com\",\n      phone: \"+1 305 555 1008\",\n      linkedinUrl: \"https://linkedin.com/in/annamartinez\",\n      country: \"United States\",\n      timezone: \"America/New_York\",\n      expertise: \"Payment Regulations\",\n      areasOfExpertise: [\"Banking regulations\", \"AML/KYC\", \"Cross-border payments\"],\n      industry: \"Finance\",\n      company: \"Federal Reserve\",\n      jobTitle: \"Former Senior Policy Advisor\",\n      yearsOfExperience: 15,\n      hourlyRate: \"400.00\",\n      bio: \"Former Fed policy advisor specializing in payment systems regulation\",\n      status: \"available\",\n      termsAccepted: true,\n      lgpdAccepted: true\n    },\n  ]).returning();\n\n  console.log(`Inserted ${insertedExperts.length} experts`);\n\n  const insertedVQ = await db.insert(vettingQuestions).values([\n    { projectId: insertedProjects[0].id, question: \"How many years of experience do you have with lithium-ion battery manufacturing?\", isRequired: true, orderIndex: 1 },\n    { projectId: insertedProjects[0].id, question: \"Have you worked on solid-state battery development?\", isRequired: true, orderIndex: 2 },\n    { projectId: insertedProjects[0].id, question: \"What is your familiarity with current EV charging infrastructure standards?\", isRequired: false, orderIndex: 3 },\n    { projectId: insertedProjects[1].id, question: \"Have you developed or deployed FDA-cleared AI/ML diagnostic tools?\", isRequired: true, orderIndex: 1 },\n    { projectId: insertedProjects[1].id, question: \"What hospital systems have you worked with to implement AI solutions?\", isRequired: true, orderIndex: 2 },\n    { projectId: insertedProjects[2].id, question: \"What is your experience with semiconductor supply chain management?\", isRequired: true, orderIndex: 1 },\n    { projectId: insertedProjects[2].id, question: \"Are you familiar with current US-China chip trade dynamics?\", isRequired: true, orderIndex: 2 },\n    { projectId: insertedProjects[3].id, question: \"What payment rails have you built or worked with?\", isRequired: true, orderIndex: 1 },\n    { projectId: insertedProjects[3].id, question: \"Do you have experience with cross-border payment regulations?\", isRequired: false, orderIndex: 2 },\n  ]).returning();\n\n  console.log(`Inserted ${insertedVQ.length} vetting questions`);\n\n  const insertedPE = await db.insert(projectExperts).values([\n    { projectId: insertedProjects[0].id, expertId: insertedExperts[0].id, status: \"accepted\", notes: \"Primary battery expert\", availabilityNote: \"Available next week\" },\n    { projectId: insertedProjects[0].id, expertId: insertedExperts[4].id, status: \"invited\", notes: \"Backup energy expert\" },\n    { projectId: insertedProjects[1].id, expertId: insertedExperts[1].id, status: \"client_selected\", notes: \"Top medical AI expert\", vqAnswers: [{ questionId: 1, answer: \"Yes, 3 FDA-cleared tools\" }, { questionId: 2, answer: \"Mass General, Cleveland Clinic\" }] },\n    { projectId: insertedProjects[1].id, expertId: insertedExperts[5].id, status: \"accepted\", notes: \"Hospital CIO perspective\", vqAnswers: [{ questionId: 1, answer: \"Implemented Epic AI modules\" }, { questionId: 2, answer: \"Mass General Hospital\" }] },\n    { projectId: insertedProjects[2].id, expertId: insertedExperts[2].id, status: \"assigned\", notes: \"Intel manufacturing expert\" },\n    { projectId: insertedProjects[2].id, expertId: insertedExperts[6].id, status: \"assigned\", notes: \"TSMC perspective\" },\n    { projectId: insertedProjects[3].id, expertId: insertedExperts[3].id, status: \"client_selected\", notes: \"Stripe payments expert\", vqAnswers: [{ questionId: 1, answer: \"ACH, Visa Direct, SWIFT\" }, { questionId: 2, answer: \"Yes, extensively\" }] },\n    { projectId: insertedProjects[3].id, expertId: insertedExperts[7].id, status: \"client_selected\", notes: \"Regulatory expert\", vqAnswers: [{ questionId: 1, answer: \"FedNow, CHIPS, ACH\" }, { questionId: 2, answer: \"Yes, 15 years\" }] },\n    { projectId: insertedProjects[4].id, expertId: insertedExperts[4].id, status: \"completed\", notes: \"Completed 3 calls\" },\n  ]).returning();\n\n  console.log(`Inserted ${insertedPE.length} project-expert assignments`);\n\n  const insertedCalls = await db.insert(callRecords).values([\n    { \n      projectExpertId: insertedPE[0].id, \n      projectId: insertedProjects[0].id, \n      expertId: insertedExperts[0].id, \n      callDate: new Date(\"2024-12-02T14:00:00Z\"), \n      durationMinutes: 60, \n      cuUsed: \"2.00\",\n      status: \"scheduled\",\n      zoomLink: \"https://zoom.us/j/123456789\"\n    },\n    { \n      projectExpertId: insertedPE[2].id, \n      projectId: insertedProjects[1].id, \n      expertId: insertedExperts[1].id, \n      callDate: new Date(\"2024-12-01T16:00:00Z\"), \n      durationMinutes: 45, \n      cuUsed: \"1.50\",\n      status: \"completed\",\n      notes: \"Excellent insights on FDA approval process\"\n    },\n    { \n      projectExpertId: insertedPE[3].id, \n      projectId: insertedProjects[1].id, \n      expertId: insertedExperts[5].id, \n      callDate: new Date(\"2024-12-03T10:00:00Z\"), \n      durationMinutes: 30, \n      cuUsed: \"1.00\",\n      status: \"scheduled\",\n      zoomLink: \"https://teams.microsoft.com/l/meetup/abc123\"\n    },\n    { \n      projectExpertId: insertedPE[6].id, \n      projectId: insertedProjects[3].id, \n      expertId: insertedExperts[3].id, \n      callDate: new Date(\"2024-11-28T15:00:00Z\"), \n      durationMinutes: 90, \n      cuUsed: \"3.00\",\n      status: \"completed\",\n      notes: \"Deep dive into payment infrastructure\"\n    },\n    { \n      projectExpertId: insertedPE[7].id, \n      projectId: insertedProjects[3].id, \n      expertId: insertedExperts[7].id, \n      callDate: new Date(\"2024-11-29T11:00:00Z\"), \n      durationMinutes: 60, \n      cuUsed: \"2.00\",\n      status: \"completed\",\n      notes: \"Regulatory landscape overview\"\n    },\n    { \n      projectExpertId: insertedPE[8].id, \n      projectId: insertedProjects[4].id, \n      expertId: insertedExperts[4].id, \n      callDate: new Date(\"2024-11-25T09:00:00Z\"), \n      durationMinutes: 45, \n      cuUsed: \"1.50\",\n      status: \"completed\",\n      notes: \"Final wrap-up call\"\n    },\n  ]).returning();\n\n  console.log(`Inserted ${insertedCalls.length} call records`);\n\n  const insertedLinks = await db.insert(expertInvitationLinks).values([\n    { token: \"abc123-battery-expert\", projectId: insertedProjects[0].id, recruitedBy: \"ra@mirae.com\", expiresAt: new Date(\"2025-01-01\") },\n    { token: \"def456-healthcare-ai\", projectId: insertedProjects[1].id, recruitedBy: \"ra@mirae.com\", expiresAt: new Date(\"2025-01-01\") },\n    { token: \"ghi789-general\", recruitedBy: \"pm@mirae.com\", expiresAt: new Date(\"2025-01-01\") },\n  ]).returning();\n\n  console.log(`Inserted ${insertedLinks.length} invitation links`);\n\n  const insertedMockProject = await db.insert(projects).values([\n    {\n      name: \"Global Digital Payments Benchmarking Study\",\n      projectOverview: \"Comparative benchmarking of digital wallets, BNPL, and merchant acquiring models across emerging markets (Brazil, India, Mexico, Indonesia)\",\n      clientOrganizationId: insertedOrgs[0].id,\n      clientName: \"Alpha Capital Partners\",\n      clientPocName: \"Jennifer Kim\",\n      clientPocEmail: \"jennifer.kim@mckinsey.com\",\n      description: \"Comparative benchmarking of digital wallets, BNPL, and merchant acquiring models across emerging markets. Mock project for end-to-end workflow testing including expert invitation, email delivery, and availability check.\",\n      industry: \"Finance\",\n      status: \"sourcing\",\n      createdByPmId: insertedUsers[1].id,\n      assignedRaId: insertedUsers[2].id,\n      totalCuUsed: \"0.00\"\n    }\n  ]).returning();\n\n  console.log(`Inserted ${insertedMockProject.length} mock projects`);\n\n  const insertedMockExperts = await db.insert(experts).values([\n    {\n      name: \"Mirae Kim\",\n      email: \"kimmirae0305@gmail.com\",\n      phone: \"+55 11 98765 4321\",\n      linkedinUrl: \"https://linkedin.com/in/mirae-kim\",\n      country: \"Brazil\",\n      timezone: \"America/Sao_Paulo\",\n      expertise: \"Digital Payments\",\n      areasOfExpertise: [\"Market entry\", \"Expert networks\", \"Latin America\", \"B2B sales\", \"Consulting operations\"],\n      industry: \"Fintech\",\n      company: \"Global Digital Bank\",\n      jobTitle: \"Growth and Strategy Consultant\",\n      yearsOfExperience: 9,\n      hourlyRate: \"250.00\",\n      bio: \"Growth consultant with experience in expert networks and Latin American market entry. 9+ years in fintech and digital payments.\",\n      status: \"available\",\n      termsAccepted: true,\n      lgpdAccepted: true,\n      workHistory: [\n        { company: \"Guidepoint\", jobTitle: \"Research Manager\", fromYear: 2021, toYear: 2025 },\n        { company: \"Benchlink\", jobTitle: \"Business Development Lead\", fromYear: 2025, toYear: 2025 }\n      ]\n    },\n    {\n      name: \"Carlos Eduardo Silva\",\n      email: \"carlos.silva@example.com\",\n      phone: \"+55 11 99876 5432\",\n      linkedinUrl: \"https://linkedin.com/in/carloseduardo\",\n      country: \"Brazil\",\n      timezone: \"America/Sao_Paulo\",\n      expertise: \"Digital Payments\",\n      areasOfExpertise: [\"Digital wallets\", \"Credit card\", \"BNPL\", \"Growth strategy\", \"Unit economics\"],\n      industry: \"Fintech\",\n      company: \"Nubank\",\n      jobTitle: \"Head of Digital Payments\",\n      yearsOfExperience: 14,\n      hourlyRate: \"300.00\",\n      bio: \"Brazil based digital payments leader with experience launching wallets and BNPL products across Latin America.\",\n      status: \"available\",\n      termsAccepted: true,\n      lgpdAccepted: true,\n      workHistory: [\n        { company: \"Nubank\", jobTitle: \"Head of Digital Payments\", fromYear: 2020, toYear: 2025 },\n        { company: \"Itau Unibanco\", jobTitle: \"Payments Product Manager\", fromYear: 2014, toYear: 2020 }\n      ]\n    },\n    {\n      name: \"Ana Luisa Rocha\",\n      email: \"ana.rocha@example.com\",\n      phone: \"+55 21 99876 5432\",\n      linkedinUrl: \"https://linkedin.com/in/analuisa\",\n      country: \"Brazil\",\n      timezone: \"America/Sao_Paulo\",\n      expertise: \"Payment Acquiring\",\n      areasOfExpertise: [\"Merchant acquiring\", \"QR payments\", \"Partnerships\", \"SME onboarding\", \"KYC\"],\n      industry: \"Fintech\",\n      company: \"PicPay\",\n      jobTitle: \"Senior Product Manager\",\n      yearsOfExperience: 11,\n      hourlyRate: \"280.00\",\n      bio: \"Product leader focused on merchant acquiring and QR based payments in Brazil.\",\n      status: \"available\",\n      termsAccepted: true,\n      lgpdAccepted: true,\n      workHistory: [\n        { company: \"PicPay\", jobTitle: \"Senior Product Manager\", fromYear: 2021, toYear: 2025 },\n        { company: \"StoneCo\", jobTitle: \"Product Manager\", fromYear: 2016, toYear: 2021 }\n      ]\n    },\n    {\n      name: \"Rohit Verma\",\n      email: \"rohit.verma@example.com\",\n      phone: \"+91 80 9876 5432\",\n      linkedinUrl: \"https://linkedin.com/in/rohitverma\",\n      country: \"India\",\n      timezone: \"Asia/Kolkata\",\n      expertise: \"Digital Payments\",\n      areasOfExpertise: [\"UPI\", \"Digital wallets\", \"Super app\", \"Product localization\", \"Partnerships\"],\n      industry: \"Fintech\",\n      company: \"Paytm\",\n      jobTitle: \"VP Product, Consumer Payments\",\n      yearsOfExperience: 13,\n      hourlyRate: \"275.00\",\n      bio: \"Leads consumer payments products including UPI and wallet solutions for a major Indian fintech.\",\n      status: \"available\",\n      termsAccepted: true,\n      lgpdAccepted: true,\n      workHistory: [\n        { company: \"Paytm\", jobTitle: \"VP Product, Consumer Payments\", fromYear: 2019, toYear: 2025 },\n        { company: \"HDFC Bank\", jobTitle: \"Digital Banking Product Lead\", fromYear: 2013, toYear: 2019 }\n      ]\n    },\n    {\n      name: \"Priya Nair\",\n      email: \"priya.nair@example.com\",\n      phone: \"+91 22 9876 5432\",\n      linkedinUrl: \"https://linkedin.com/in/priyanair\",\n      country: \"India\",\n      timezone: \"Asia/Kolkata\",\n      expertise: \"Payment Networks\",\n      areasOfExpertise: [\"Network partnerships\", \"Issuing\", \"Co branded cards\", \"Regulatory\", \"Risk\"],\n      industry: \"Finance\",\n      company: \"Global Card Network\",\n      jobTitle: \"Director Partnerships, South Asia\",\n      yearsOfExperience: 15,\n      hourlyRate: \"320.00\",\n      bio: \"Director responsible for payment network partnerships and co branded card launches across South Asia.\",\n      status: \"available\",\n      termsAccepted: true,\n      lgpdAccepted: true,\n      workHistory: [\n        { company: \"Global Card Network\", jobTitle: \"Director Partnerships, South Asia\", fromYear: 2018, toYear: 2025 },\n        { company: \"Axis Bank\", jobTitle: \"Senior Manager, Cards\", fromYear: 2010, toYear: 2018 }\n      ]\n    },\n    {\n      name: \"Mariana Torres\",\n      email: \"mariana.torres@example.com\",\n      phone: \"+52 55 9876 5432\",\n      linkedinUrl: \"https://linkedin.com/in/marianatorres\",\n      country: \"Mexico\",\n      timezone: \"America/Mexico_City\",\n      expertise: \"Digital Payments\",\n      areasOfExpertise: [\"Wallets\", \"BNPL\", \"Online checkout\", \"Risk models\", \"Growth marketing\"],\n      industry: \"Fintech\",\n      company: \"Mercado Pago\",\n      jobTitle: \"Head of Product, Wallet and BNPL\",\n      yearsOfExperience: 12,\n      hourlyRate: \"290.00\",\n      bio: \"Product lead for wallet and BNPL solutions across Mexico and LatAm markets.\",\n      status: \"available\",\n      termsAccepted: true,\n      lgpdAccepted: true,\n      workHistory: [\n        { company: \"Mercado Pago\", jobTitle: \"Head of Product, Wallet and BNPL\", fromYear: 2020, toYear: 2025 },\n        { company: \"BBVA Mexico\", jobTitle: \"Digital Product Manager\", fromYear: 2013, toYear: 2020 }\n      ]\n    },\n    {\n      name: \"Diego Hernandez\",\n      email: \"diego.hernandez@example.com\",\n      phone: \"+52 81 9876 5432\",\n      linkedinUrl: \"https://linkedin.com/in/diegohernandez\",\n      country: \"Mexico\",\n      timezone: \"America/Mexico_City\",\n      expertise: \"Banking & Payments\",\n      areasOfExpertise: [\"Agent network\", \"Cash in cash out\", \"Retail payments\", \"POS\", \"SME\"],\n      industry: \"Finance\",\n      company: \"Regional Bank\",\n      jobTitle: \"Digital Banking Manager\",\n      yearsOfExperience: 8,\n      hourlyRate: \"200.00\",\n      bio: \"Focus on digital banking for mass market and SME clients with experience in retail payment channels.\",\n      status: \"available\",\n      termsAccepted: true,\n      lgpdAccepted: true,\n      workHistory: [\n        { company: \"Regional Bank\", jobTitle: \"Digital Banking Manager\", fromYear: 2020, toYear: 2025 },\n        { company: \"Oxxo Pay\", jobTitle: \"Product Specialist\", fromYear: 2016, toYear: 2020 }\n      ]\n    },\n    {\n      name: \"Siti Aisyah\",\n      email: \"siti.aisyah@example.com\",\n      phone: \"+62 21 9876 5432\",\n      linkedinUrl: \"https://linkedin.com/in/sitiaisyah\",\n      country: \"Indonesia\",\n      timezone: \"Asia/Jakarta\",\n      expertise: \"Super App Payments\",\n      areasOfExpertise: [\"Super app payments\", \"Wallet integration\", \"QRIS\", \"Merchant ecosystem\", \"Product operations\"],\n      industry: \"Fintech\",\n      company: \"Gojek\",\n      jobTitle: \"Senior Product Lead, Payments\",\n      yearsOfExperience: 10,\n      hourlyRate: \"260.00\",\n      bio: \"Leads payments within a super app, with experience in merchant acceptance and QRIS rollout.\",\n      status: \"available\",\n      termsAccepted: true,\n      lgpdAccepted: true,\n      workHistory: [\n        { company: \"Gojek\", jobTitle: \"Senior Product Lead, Payments\", fromYear: 2019, toYear: 2025 },\n        { company: \"Local Fintech Startup\", jobTitle: \"Product Manager\", fromYear: 2015, toYear: 2019 }\n      ]\n    },\n    {\n      name: \"Johannes Mller\",\n      email: \"johannes.muller@example.com\",\n      phone: \"+49 30 9876 5432\",\n      linkedinUrl: \"https://linkedin.com/in/johannesmuller\",\n      country: \"Germany\",\n      timezone: \"Europe/Berlin\",\n      expertise: \"Neobanking\",\n      areasOfExpertise: [\"Europe\", \"PSD2\", \"Open banking\", \"Cards\"],\n      industry: \"Fintech\",\n      company: \"European Neo Bank\",\n      jobTitle: \"Product Manager\",\n      yearsOfExperience: 6,\n      hourlyRate: \"240.00\",\n      bio: \"European neobank product manager focused on open banking and PSD2 use cases.\",\n      status: \"available\",\n      termsAccepted: true,\n      lgpdAccepted: true,\n      workHistory: [\n        { company: \"European Neo Bank\", jobTitle: \"Product Manager\", fromYear: 2021, toYear: 2025 },\n        { company: \"Traditional Bank\", jobTitle: \"Business Analyst\", fromYear: 2018, toYear: 2021 }\n      ]\n    },\n    {\n      name: \"Laura Kim\",\n      email: \"laura.kim@example.com\",\n      phone: \"+1 415 555 9999\",\n      linkedinUrl: \"https://linkedin.com/in/laurakim\",\n      country: \"United States\",\n      timezone: \"America/Los_Angeles\",\n      expertise: \"Technology\",\n      areasOfExpertise: [\"Cloud\", \"SaaS\", \"Data platforms\"],\n      industry: \"Technology\",\n      company: \"Big Tech\",\n      jobTitle: \"Senior Program Manager\",\n      yearsOfExperience: 9,\n      hourlyRate: \"350.00\",\n      bio: \"Works on cloud and SaaS programs with fintech interest.\",\n      status: \"available\",\n      termsAccepted: true,\n      lgpdAccepted: true,\n      workHistory: [\n        { company: \"Big Tech\", jobTitle: \"Senior Program Manager\", fromYear: 2019, toYear: 2025 },\n        { company: \"Startup\", jobTitle: \"Operations Manager\", fromYear: 2014, toYear: 2019 }\n      ]\n    }\n  ]).returning();\n\n  console.log(`Inserted ${insertedMockExperts.length} mock experts`);\n\n  const insertedMockVQ = await db.insert(vettingQuestions).values([\n    { projectId: insertedMockProject[0].id, question: \"What is your experience with digital wallet growth and user acquisition?\", isRequired: true, orderIndex: 1 },\n    { projectId: insertedMockProject[0].id, question: \"What were the key drivers of BNPL adoption in your market?\", isRequired: true, orderIndex: 2 },\n    { projectId: insertedMockProject[0].id, question: \"How are merchant fees structured in your region?\", isRequired: false, orderIndex: 3 },\n    { projectId: insertedMockProject[0].id, question: \"What regulatory shifts have impacted payments in the last 3 years?\", isRequired: false, orderIndex: 4 },\n  ]).returning();\n\n  console.log(`Inserted ${insertedMockVQ.length} mock vetting questions`);\n\n  const mockMiraeExpertInProject = await db.insert(projectExperts).values([\n    { projectId: insertedMockProject[0].id, expertId: insertedMockExperts[0].id, status: \"invited\", notes: \"Mock expert for testing invitation workflow\" }\n  ]).returning();\n\n  console.log(`Linked Mirae Kim to mock project`);\n\n  console.log(\"Seeding completed successfully!\");\n}\n\nseed().catch(console.error);\n","path":null,"size_bytes":29118,"size_tokens":null},"client/src/pages/analytics.tsx":{"content":"import { useQuery } from \"@tanstack/react-query\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport {\n  BarChart,\n  Bar,\n  LineChart,\n  Line,\n  PieChart,\n  Pie,\n  Cell,\n  XAxis,\n  YAxis,\n  CartesianGrid,\n  Tooltip,\n  Legend,\n  ResponsiveContainer,\n} from \"recharts\";\nimport { TrendingUp, Users, Briefcase, DollarSign } from \"lucide-react\";\nimport type { Project, Expert, UsageRecord } from \"@shared/schema\";\n\nexport default function Analytics() {\n  const { data: projects, isLoading: projectsLoading } = useQuery<Project[]>({\n    queryKey: [\"/api/projects\"],\n  });\n  const { data: experts, isLoading: expertsLoading } = useQuery<Expert[]>({\n    queryKey: [\"/api/experts\"],\n  });\n  const { data: usageRecords, isLoading: usageLoading } = useQuery<UsageRecord[]>({\n    queryKey: [\"/api/usage\"],\n  });\n\n  const isLoading = projectsLoading || expertsLoading || usageLoading;\n\n  // Calculate metrics\n  const totalProjects = projects?.length || 0;\n  const totalExperts = experts?.length || 0;\n  const totalCallMinutes =\n    usageRecords?.reduce((sum, record) => sum + record.durationMinutes, 0) || 0;\n  const totalCreditsUsed =\n    usageRecords?.reduce((sum, record) => sum + Number(record.creditsUsed), 0) || 0;\n\n  // Project pipeline by status\n  const projectPipelineData = (projects || []).reduce(\n    (acc: Record<string, number>, project) => {\n      acc[project.status] = (acc[project.status] || 0) + 1;\n      return acc;\n    },\n    {}\n  );\n\n  const projectStatusChartData = Object.entries(projectPipelineData).map(\n    ([status, count]) => ({\n      name: status.charAt(0).toUpperCase() + status.slice(1),\n      value: count,\n      status,\n    })\n  );\n\n  // Expert utilization by industry\n  const expertByIndustry = (experts || []).reduce(\n    (acc: Record<string, number>, expert) => {\n      acc[expert.industry] = (acc[expert.industry] || 0) + 1;\n      return acc;\n    },\n    {}\n  );\n\n  const expertUtilizationData = Object.entries(expertByIndustry)\n    .map(([industry, count]) => ({\n      name: industry,\n      experts: count,\n    }))\n    .sort((a, b) => b.experts - a.experts)\n    .slice(0, 8);\n\n  // Revenue metrics by expert\n  const revenueByExpert = (usageRecords || []).reduce(\n    (acc: Record<string, { calls: number; revenue: number }>, record) => {\n      const expertId = record.expertId;\n      const expert = experts?.find((e) => e.id === expertId);\n      const name = expert?.name || `Expert ${expertId}`;\n\n      if (!acc[name]) {\n        acc[name] = { calls: 0, revenue: 0 };\n      }\n      acc[name].calls += 1;\n      acc[name].revenue += Number(record.creditsUsed);\n      return acc;\n    },\n    {}\n  );\n\n  const revenueData = Object.entries(revenueByExpert)\n    .map(([name, data]) => ({\n      name,\n      calls: data.calls,\n      revenue: data.revenue,\n    }))\n    .sort((a, b) => b.revenue - a.revenue)\n    .slice(0, 6);\n\n  // Call volume trend by day\n  const callVolumeByDay = (usageRecords || []).reduce(\n    (acc: Record<string, number>, record) => {\n      const date = new Date(record.callDate).toLocaleDateString(\"en-US\", {\n        month: \"short\",\n        day: \"numeric\",\n      });\n      acc[date] = (acc[date] || 0) + 1;\n      return acc;\n    },\n    {}\n  );\n\n  const callVolumeData = Object.entries(callVolumeByDay)\n    .sort((a, b) => new Date(a[0]).getTime() - new Date(b[0]).getTime())\n    .slice(-14)\n    .map(([date, count]) => ({\n      date,\n      calls: count,\n    }));\n\n  const COLORS = [\"#3b82f6\", \"#ef4444\", \"#8b5cf6\", \"#f59e0b\", \"#10b981\", \"#06b6d4\"];\n\n  const SkeletonCard = () => (\n    <Card>\n      <CardHeader>\n        <Skeleton className=\"h-5 w-20\" />\n      </CardHeader>\n      <CardContent>\n        <Skeleton className=\"h-64 w-full\" />\n      </CardContent>\n    </Card>\n  );\n\n  if (isLoading) {\n    return (\n      <div className=\"space-y-6 p-8\">\n        <div>\n          <h1 className=\"text-3xl font-semibold text-foreground\">Analytics</h1>\n          <p className=\"text-sm text-muted-foreground\">\n            View detailed metrics and performance insights.\n          </p>\n        </div>\n        <div className=\"grid gap-4 sm:grid-cols-2 lg:grid-cols-4\">\n          {Array.from({ length: 4 }).map((_, i) => (\n            <Card key={i}>\n              <CardHeader>\n                <Skeleton className=\"h-4 w-24\" />\n              </CardHeader>\n              <CardContent>\n                <Skeleton className=\"h-8 w-16\" />\n              </CardContent>\n            </Card>\n          ))}\n        </div>\n        <div className=\"grid gap-6 lg:grid-cols-2\">\n          {Array.from({ length: 4 }).map((_, i) => (\n            <SkeletonCard key={i} />\n          ))}\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"space-y-6 p-8\">\n      <div>\n        <h1 className=\"text-3xl font-semibold text-foreground\">Analytics</h1>\n        <p className=\"text-sm text-muted-foreground\">\n          View detailed metrics and performance insights.\n        </p>\n      </div>\n\n      <div className=\"grid gap-4 sm:grid-cols-2 lg:grid-cols-4\">\n        <Card>\n          <CardHeader className=\"flex flex-row items-center justify-between gap-2 space-y-0 pb-2\">\n            <CardTitle className=\"text-sm font-medium\">Active Projects</CardTitle>\n            <Briefcase className=\"h-4 w-4 text-muted-foreground\" />\n          </CardHeader>\n          <CardContent>\n            <div className=\"text-2xl font-bold\">{totalProjects}</div>\n            <p className=\"text-xs text-muted-foreground mt-1\">\n              {projects?.filter((p) => p.status !== \"completed\").length || 0} in progress\n            </p>\n          </CardContent>\n        </Card>\n\n        <Card>\n          <CardHeader className=\"flex flex-row items-center justify-between gap-2 space-y-0 pb-2\">\n            <CardTitle className=\"text-sm font-medium\">Expert Network</CardTitle>\n            <Users className=\"h-4 w-4 text-muted-foreground\" />\n          </CardHeader>\n          <CardContent>\n            <div className=\"text-2xl font-bold\">{totalExperts}</div>\n            <p className=\"text-xs text-muted-foreground mt-1\">\n              {experts?.filter((e) => e.status === \"available\").length || 0} available\n            </p>\n          </CardContent>\n        </Card>\n\n        <Card>\n          <CardHeader className=\"flex flex-row items-center justify-between gap-2 space-y-0 pb-2\">\n            <CardTitle className=\"text-sm font-medium\">Total Call Time</CardTitle>\n            <TrendingUp className=\"h-4 w-4 text-muted-foreground\" />\n          </CardHeader>\n          <CardContent>\n            <div className=\"text-2xl font-bold font-mono\">{totalCallMinutes}</div>\n            <p className=\"text-xs text-muted-foreground mt-1\">minutes</p>\n          </CardContent>\n        </Card>\n\n        <Card>\n          <CardHeader className=\"flex flex-row items-center justify-between gap-2 space-y-0 pb-2\">\n            <CardTitle className=\"text-sm font-medium\">Total Credits</CardTitle>\n            <DollarSign className=\"h-4 w-4 text-muted-foreground\" />\n          </CardHeader>\n          <CardContent>\n            <div className=\"text-2xl font-bold font-mono\">{totalCreditsUsed.toFixed(0)}</div>\n            <p className=\"text-xs text-muted-foreground mt-1\">consumed</p>\n          </CardContent>\n        </Card>\n      </div>\n\n      <div className=\"grid gap-6 lg:grid-cols-2\">\n        <Card>\n          <CardHeader>\n            <CardTitle className=\"text-lg\">Project Pipeline</CardTitle>\n          </CardHeader>\n          <CardContent>\n            {projectStatusChartData.length > 0 ? (\n              <ResponsiveContainer width=\"100%\" height={300}>\n                <PieChart>\n                  <Pie\n                    data={projectStatusChartData}\n                    cx=\"50%\"\n                    cy=\"50%\"\n                    labelLine={false}\n                    label={({ name, value }) => `${name}: ${value}`}\n                    outerRadius={80}\n                    fill=\"#8884d8\"\n                    dataKey=\"value\"\n                  >\n                    {projectStatusChartData.map((_, index) => (\n                      <Cell key={`cell-${index}`} fill={COLORS[index % COLORS.length]} />\n                    ))}\n                  </Pie>\n                  <Tooltip />\n                </PieChart>\n              </ResponsiveContainer>\n            ) : (\n              <div className=\"flex h-[300px] items-center justify-center text-muted-foreground\">\n                No projects yet\n              </div>\n            )}\n          </CardContent>\n        </Card>\n\n        <Card>\n          <CardHeader>\n            <CardTitle className=\"text-lg\">Expert Utilization by Industry</CardTitle>\n          </CardHeader>\n          <CardContent>\n            {expertUtilizationData.length > 0 ? (\n              <ResponsiveContainer width=\"100%\" height={300}>\n                <BarChart data={expertUtilizationData}>\n                  <CartesianGrid strokeDasharray=\"3 3\" />\n                  <XAxis dataKey=\"name\" angle={-45} textAnchor=\"end\" height={80} />\n                  <YAxis />\n                  <Tooltip />\n                  <Bar dataKey=\"experts\" fill=\"#3b82f6\" />\n                </BarChart>\n              </ResponsiveContainer>\n            ) : (\n              <div className=\"flex h-[300px] items-center justify-center text-muted-foreground\">\n                No experts yet\n              </div>\n            )}\n          </CardContent>\n        </Card>\n\n        <Card className=\"lg:col-span-2\">\n          <CardHeader>\n            <CardTitle className=\"text-lg\">Revenue by Expert</CardTitle>\n          </CardHeader>\n          <CardContent>\n            {revenueData.length > 0 ? (\n              <ResponsiveContainer width=\"100%\" height={300}>\n                <BarChart data={revenueData}>\n                  <CartesianGrid strokeDasharray=\"3 3\" />\n                  <XAxis dataKey=\"name\" angle={-45} textAnchor=\"end\" height={80} />\n                  <YAxis yAxisId=\"left\" />\n                  <YAxis yAxisId=\"right\" orientation=\"right\" />\n                  <Tooltip />\n                  <Legend />\n                  <Bar yAxisId=\"left\" dataKey=\"calls\" fill=\"#8b5cf6\" />\n                  <Bar yAxisId=\"right\" dataKey=\"revenue\" fill=\"#ef4444\" />\n                </BarChart>\n              </ResponsiveContainer>\n            ) : (\n              <div className=\"flex h-[300px] items-center justify-center text-muted-foreground\">\n                No usage records yet\n              </div>\n            )}\n          </CardContent>\n        </Card>\n\n        <Card className=\"lg:col-span-2\">\n          <CardHeader>\n            <CardTitle className=\"text-lg\">Call Volume Trend (Last 14 Days)</CardTitle>\n          </CardHeader>\n          <CardContent>\n            {callVolumeData.length > 0 ? (\n              <ResponsiveContainer width=\"100%\" height={300}>\n                <LineChart data={callVolumeData}>\n                  <CartesianGrid strokeDasharray=\"3 3\" />\n                  <XAxis dataKey=\"date\" />\n                  <YAxis />\n                  <Tooltip />\n                  <Line type=\"monotone\" dataKey=\"calls\" stroke=\"#3b82f6\" dot={{ r: 4 }} />\n                </LineChart>\n              </ResponsiveContainer>\n            ) : (\n              <div className=\"flex h-[300px] items-center justify-center text-muted-foreground\">\n                No usage records yet\n              </div>\n            )}\n          </CardContent>\n        </Card>\n      </div>\n    </div>\n  );\n}\n","path":null,"size_bytes":11430,"size_tokens":null},"client/src/components/ui/skeleton.tsx":{"content":"import { cn } from \"@/lib/utils\"\n\nfunction Skeleton({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) {\n  return (\n    <div\n      className={cn(\"animate-pulse rounded-md bg-muted\", className)}\n      {...props}\n    />\n  )\n}\n\nexport { Skeleton }\n","path":null,"size_bytes":261,"size_tokens":null},"client/src/components/ui/hover-card.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as HoverCardPrimitive from \"@radix-ui/react-hover-card\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst HoverCard = HoverCardPrimitive.Root\n\nconst HoverCardTrigger = HoverCardPrimitive.Trigger\n\nconst HoverCardContent = React.forwardRef<\n  React.ElementRef<typeof HoverCardPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof HoverCardPrimitive.Content>\n>(({ className, align = \"center\", sideOffset = 4, ...props }, ref) => (\n  <HoverCardPrimitive.Content\n    ref={ref}\n    align={align}\n    sideOffset={sideOffset}\n    className={cn(\n      \"z-50 w-64 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-hover-card-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nHoverCardContent.displayName = HoverCardPrimitive.Content.displayName\n\nexport { HoverCard, HoverCardTrigger, HoverCardContent }\n","path":null,"size_bytes":1251,"size_tokens":null},"client/src/components/ui/scroll-area.tsx":{"content":"import * as React from \"react\"\nimport * as ScrollAreaPrimitive from \"@radix-ui/react-scroll-area\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ScrollArea = React.forwardRef<\n  React.ElementRef<typeof ScrollAreaPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ScrollAreaPrimitive.Root>\n>(({ className, children, ...props }, ref) => (\n  <ScrollAreaPrimitive.Root\n    ref={ref}\n    className={cn(\"relative overflow-hidden\", className)}\n    {...props}\n  >\n    <ScrollAreaPrimitive.Viewport className=\"h-full w-full rounded-[inherit]\">\n      {children}\n    </ScrollAreaPrimitive.Viewport>\n    <ScrollBar />\n    <ScrollAreaPrimitive.Corner />\n  </ScrollAreaPrimitive.Root>\n))\nScrollArea.displayName = ScrollAreaPrimitive.Root.displayName\n\nconst ScrollBar = React.forwardRef<\n  React.ElementRef<typeof ScrollAreaPrimitive.ScrollAreaScrollbar>,\n  React.ComponentPropsWithoutRef<typeof ScrollAreaPrimitive.ScrollAreaScrollbar>\n>(({ className, orientation = \"vertical\", ...props }, ref) => (\n  <ScrollAreaPrimitive.ScrollAreaScrollbar\n    ref={ref}\n    orientation={orientation}\n    className={cn(\n      \"flex touch-none select-none transition-colors\",\n      orientation === \"vertical\" &&\n        \"h-full w-2.5 border-l border-l-transparent p-[1px]\",\n      orientation === \"horizontal\" &&\n        \"h-2.5 flex-col border-t border-t-transparent p-[1px]\",\n      className\n    )}\n    {...props}\n  >\n    <ScrollAreaPrimitive.ScrollAreaThumb className=\"relative flex-1 rounded-full bg-border\" />\n  </ScrollAreaPrimitive.ScrollAreaScrollbar>\n))\nScrollBar.displayName = ScrollAreaPrimitive.ScrollAreaScrollbar.displayName\n\nexport { ScrollArea, ScrollBar }\n","path":null,"size_bytes":1642,"size_tokens":null},"server/routes.ts":{"content":"import type { Express, Router } from \"express\";\nimport { createServer, type Server } from \"http\";\nimport { Router as ExpressRouter } from \"express\";\nimport { storage } from \"./storage\";\nimport { db } from \"./db\";\nimport {\n  insertProjectSchema,\n  insertExpertSchema,\n  insertVettingQuestionSchema,\n  insertProjectExpertSchema,\n  insertUsageRecordSchema,\n  insertUserSchema,\n  insertClientOrganizationSchema,\n  insertClientPocSchema,\n  insertCallRecordSchema,\n  insertExpertInvitationLinkSchema,\n  insertProjectAngleSchema,\n  calculateCU,\n  callRecords,\n  experts,\n  projects,\n  expertInvitationLinks,\n  projectExperts,\n  projectAngles,\n  users,\n} from \"@shared/schema\";\nimport { fromZodError } from \"zod-validation-error\";\nimport crypto from \"crypto\";\nimport { authMiddleware, loginHandler, getMeHandler, requireAdmin, requireRoles, hashPassword, comparePassword, type AuthRequest } from \"./auth\";\nimport { insertClientSchema } from \"@shared/schema\";\nimport { eq, and, gte, lt, sql, desc, inArray } from \"drizzle-orm\";\nimport { toZonedTime, fromZonedTime, format } from \"date-fns-tz\";\nimport { startOfMonth, addMonths } from \"date-fns\";\nimport { sendExpertInvitationEmail, verifySmtpConnection } from \"./email\";\nimport PDFDocument from \"pdfkit\";\n\nexport async function registerRoutes(\n  httpServer: Server,\n  app: Express\n): Promise<Server> {\n  // ==================== AUTH ROUTES (PUBLIC) ====================\n  app.post(\"/api/auth/login\", loginHandler);\n  app.get(\"/api/auth/me\", authMiddleware, getMeHandler);\n\n  // POST /api/auth/change-password - Change password on first login\n  app.post(\"/api/auth/change-password\", authMiddleware, async (req: AuthRequest, res) => {\n    try {\n      const { currentPassword, newPassword } = req.body;\n      \n      if (!currentPassword || !newPassword) {\n        return res.status(400).json({ error: \"Current and new passwords are required\" });\n      }\n\n      if (!req.user) {\n        return res.status(401).json({ error: \"Unauthorized\" });\n      }\n\n      // Get user from database\n      const user = await storage.getUser(req.user.id);\n      if (!user || !user.passwordHash) {\n        return res.status(404).json({ error: \"User not found\" });\n      }\n\n      // Verify current password\n      const isValid = await comparePassword(currentPassword, user.passwordHash);\n      if (!isValid) {\n        return res.status(400).json({ error: \"Current password is incorrect\" });\n      }\n\n      // Hash new password and update user\n      const hashedNewPassword = await hashPassword(newPassword);\n      await storage.updateUser(req.user.id, {\n        passwordHash: hashedNewPassword,\n        mustChangePassword: false,\n      });\n\n      res.json({ success: true });\n    } catch (error) {\n      console.error(\"Change password error:\", error);\n      res.status(500).json({ error: \"Failed to change password\" });\n    }\n  });\n\n  // Note: Some routes need to be public for expert registration\n  // Public routes: /api/auth/*, /api/register-expert/:token, /api/invitation-links/:token (GET only)\n  // ==================== USERS (PROTECTED) ====================\n  app.get(\"/api/users\", authMiddleware, async (req, res) => {\n    try {\n      const users = await storage.getUsers();\n      res.json(users);\n    } catch (error) {\n      res.status(500).json({ error: \"Failed to fetch users\" });\n    }\n  });\n\n  // Get RAs for assignment (users with role 'ra')\n  // IMPORTANT: Must be BEFORE /:id route to avoid route matching conflicts\n  app.get(\"/api/users/ras\", authMiddleware, async (req, res) => {\n    try {\n      console.log(\"[RA DEBUG] ===== START RAs ENDPOINT =====\");\n      const users = await storage.getUsers();\n      console.log(`[RA DEBUG] Total users fetched: ${users.length}`);\n      \n      // Log ALL active employees with full details\n      console.log(\"[RA DEBUG] All active employees:\", users.map(u => ({\n        id: u.id,\n        fullName: u.fullName,\n        email: u.email,\n        role: u.role,\n        isActive: u.isActive,\n        isRaRawCheck: u.role === \"ra\",\n        isResearchAssociateRawCheck: u.role === \"Research Associate\",\n        isActiveCheck: u.isActive === true,\n      })));\n      \n      console.log(`[RA DEBUG] Users by role:`, users.reduce((acc: any, u: any) => {\n        acc[u.role] = (acc[u.role] || 0) + 1;\n        return acc;\n      }, {}));\n      \n      // Apply filtering with detailed logging\n      const ras = users.filter(u => {\n        const matchesRole = u.role === \"ra\" || u.role === \"Research Associate\";\n        const isActive = u.isActive === true;\n        console.log(`[RA DEBUG] User ${u.fullName} (${u.email}): role=\"${u.role}\", matchesRole=${matchesRole}, isActive=${isActive}, passes=${matchesRole && isActive}`);\n        return matchesRole && isActive;\n      });\n      \n      console.log(`[RA DEBUG] Filtered RAs: ${ras.length} active RAs found`);\n      \n      const result = ras.map(ra => ({ \n        id: ra.id, \n        fullName: ra.fullName, \n        email: ra.email \n      }));\n      \n      console.log(`[RA DEBUG] Returning ${result.length} RAs:`, result);\n      console.log(\"[RA DEBUG] ===== END RAs ENDPOINT =====\");\n      res.json(result);\n    } catch (error) {\n      console.error(\"[RA DEBUG] Error fetching RAs:\", error);\n      res.status(500).json({ error: \"Failed to fetch RAs\" });\n    }\n  });\n\n  app.get(\"/api/users/:id\", authMiddleware, async (req, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      const user = await storage.getUser(id);\n      if (!user) {\n        return res.status(404).json({ error: \"User not found\" });\n      }\n      res.json(user);\n    } catch (error) {\n      res.status(500).json({ error: \"Failed to fetch user\" });\n    }\n  });\n\n  app.post(\"/api/users\", authMiddleware, async (req, res) => {\n    try {\n      const result = insertUserSchema.safeParse(req.body);\n      if (!result.success) {\n        return res.status(400).json({ error: fromZodError(result.error).message });\n      }\n      const user = await storage.createUser(result.data);\n      res.status(201).json(user);\n    } catch (error) {\n      res.status(500).json({ error: \"Failed to create user\" });\n    }\n  });\n\n  app.patch(\"/api/users/:id\", authMiddleware, async (req, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      const result = insertUserSchema.partial().safeParse(req.body);\n      if (!result.success) {\n        return res.status(400).json({ error: fromZodError(result.error).message });\n      }\n      const user = await storage.updateUser(id, result.data);\n      if (!user) {\n        return res.status(404).json({ error: \"User not found\" });\n      }\n      res.json(user);\n    } catch (error) {\n      res.status(500).json({ error: \"Failed to update user\" });\n    }\n  });\n\n  app.delete(\"/api/users/:id\", authMiddleware, async (req, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      const deleted = await storage.deleteUser(id);\n      if (!deleted) {\n        return res.status(404).json({ error: \"User not found\" });\n      }\n      res.status(204).send();\n    } catch (error) {\n      res.status(500).json({ error: \"Failed to delete user\" });\n    }\n  });\n\n  // ==================== EMPLOYEES (ADMIN ONLY) ====================\n  app.get(\"/api/employees\", authMiddleware, requireAdmin, async (req, res) => {\n    try {\n      const users = await storage.getUsers();\n      res.json(users);\n    } catch (error) {\n      res.status(500).json({ error: \"Failed to fetch employees\" });\n    }\n  });\n\n  app.post(\"/api/employees\", authMiddleware, requireAdmin, async (req: AuthRequest, res) => {\n    try {\n      const { fullName, localPart, role, tempPassword } = req.body;\n      \n      if (!fullName || !localPart || !role || !tempPassword) {\n        return res.status(400).json({ error: \"fullName, localPart, role, and tempPassword are required\" });\n      }\n      \n      if (![\"admin\", \"pm\", \"ra\", \"finance\"].includes(role)) {\n        return res.status(400).json({ error: \"Invalid role. Must be admin, pm, ra, or finance\" });\n      }\n      \n      const email = `${localPart.toLowerCase()}@miraeconnext.com`;\n      \n      // Check if email already exists\n      const existingUser = await storage.getUserByEmail(email);\n      if (existingUser) {\n        return res.status(400).json({ error: \"An employee with this email already exists\" });\n      }\n      \n      const passwordHash = await hashPassword(tempPassword);\n      \n      const user = await storage.createUser({\n        fullName,\n        email,\n        passwordHash,\n        role,\n        isActive: true,\n        mustChangePassword: true, // Force password change on first login\n      });\n      \n      // Remove passwordHash from response\n      const { passwordHash: _, ...safeUser } = user;\n      res.status(201).json(safeUser);\n    } catch (error) {\n      console.error(\"Create employee error:\", error);\n      res.status(500).json({ error: \"Failed to create employee\" });\n    }\n  });\n\n  app.put(\"/api/employees/:id\", authMiddleware, requireAdmin, async (req, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      const { fullName, role, isActive } = req.body;\n      \n      const updateData: any = {};\n      if (fullName !== undefined) updateData.fullName = fullName;\n      if (role !== undefined) {\n        if (![\"admin\", \"pm\", \"ra\", \"finance\"].includes(role)) {\n          return res.status(400).json({ error: \"Invalid role. Must be admin, pm, ra, or finance\" });\n        }\n        updateData.role = role;\n      }\n      if (isActive !== undefined) updateData.isActive = isActive;\n      \n      const user = await storage.updateUser(id, updateData);\n      if (!user) {\n        return res.status(404).json({ error: \"Employee not found\" });\n      }\n      \n      // Remove passwordHash from response\n      const { passwordHash: _, ...safeUser } = user;\n      res.json(safeUser);\n    } catch (error) {\n      res.status(500).json({ error: \"Failed to update employee\" });\n    }\n  });\n\n  app.post(\"/api/employees/:id/reset-password\", authMiddleware, requireAdmin, async (req, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      const { tempPassword } = req.body;\n      \n      if (!tempPassword) {\n        return res.status(400).json({ error: \"tempPassword is required\" });\n      }\n      \n      const passwordHash = await hashPassword(tempPassword);\n      const user = await storage.updateUser(id, { passwordHash });\n      \n      if (!user) {\n        return res.status(404).json({ error: \"Employee not found\" });\n      }\n      \n      res.json({ message: \"Password reset successfully\" });\n    } catch (error) {\n      res.status(500).json({ error: \"Failed to reset password\" });\n    }\n  });\n\n  // ==================== CLIENTS (CRM) ====================\n  // All roles can view clients\n  app.get(\"/api/clients\", authMiddleware, async (req, res) => {\n    try {\n      const { q, industry, status } = req.query;\n      const clients = await storage.searchClients({\n        query: q as string | undefined,\n        industry: industry as string | undefined,\n        status: status as string | undefined,\n      });\n      res.json(clients);\n    } catch (error) {\n      res.status(500).json({ error: \"Failed to fetch clients\" });\n    }\n  });\n\n  app.get(\"/api/clients/:id\", authMiddleware, async (req, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      const client = await storage.getClient(id);\n      if (!client) {\n        return res.status(404).json({ error: \"Client not found\" });\n      }\n      res.json(client);\n    } catch (error) {\n      res.status(500).json({ error: \"Failed to fetch client\" });\n    }\n  });\n\n  // Only admin and pm can create clients\n  app.post(\"/api/clients\", authMiddleware, requireRoles(\"admin\", \"pm\", \"ra\"), async (req, res) => {\n    try {\n      const result = insertClientSchema.safeParse(req.body);\n      if (!result.success) {\n        return res.status(400).json({ error: fromZodError(result.error).message });\n      }\n      const client = await storage.createClient(result.data);\n      res.status(201).json(client);\n    } catch (error) {\n      res.status(500).json({ error: \"Failed to create client\" });\n    }\n  });\n\n  // Only admin and pm can update clients\n  app.patch(\"/api/clients/:id\", authMiddleware, requireRoles(\"admin\", \"pm\", \"ra\"), async (req, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      const result = insertClientSchema.partial().safeParse(req.body);\n      if (!result.success) {\n        return res.status(400).json({ error: fromZodError(result.error).message });\n      }\n      const client = await storage.updateClient(id, result.data);\n      if (!client) {\n        return res.status(404).json({ error: \"Client not found\" });\n      }\n      res.json(client);\n    } catch (error) {\n      res.status(500).json({ error: \"Failed to update client\" });\n    }\n  });\n\n  // Only admin can delete clients\n  app.delete(\"/api/clients/:id\", authMiddleware, requireAdmin, async (req, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      const deleted = await storage.deleteClient(id);\n      if (!deleted) {\n        return res.status(404).json({ error: \"Client not found\" });\n      }\n      res.status(204).send();\n    } catch (error) {\n      res.status(500).json({ error: \"Failed to delete client\" });\n    }\n  });\n\n  // ==================== CLIENT ORGANIZATIONS ====================\n  app.get(\"/api/client-organizations\", authMiddleware, async (req, res) => {\n    try {\n      const organizations = await storage.getClientOrganizations();\n      res.json(organizations);\n    } catch (error) {\n      res.status(500).json({ error: \"Failed to fetch client organizations\" });\n    }\n  });\n\n  app.get(\"/api/client-organizations/:id\", authMiddleware, async (req, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      const org = await storage.getClientOrganization(id);\n      if (!org) {\n        return res.status(404).json({ error: \"Client organization not found\" });\n      }\n      res.json(org);\n    } catch (error) {\n      res.status(500).json({ error: \"Failed to fetch client organization\" });\n    }\n  });\n\n  app.get(\"/api/client-organizations/:id/projects\", authMiddleware, async (req, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      const projects = await storage.getProjectsByOrganization(id);\n      res.json(projects);\n    } catch (error) {\n      res.status(500).json({ error: \"Failed to fetch organization projects\" });\n    }\n  });\n\n  app.get(\"/api/client-organizations/:id/pocs\", authMiddleware, async (req, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      const pocs = await storage.getClientPocsByOrganization(id);\n      res.json(pocs);\n    } catch (error) {\n      res.status(500).json({ error: \"Failed to fetch organization POCs\" });\n    }\n  });\n\n  app.post(\"/api/client-organizations\", authMiddleware, async (req, res) => {\n    try {\n      const result = insertClientOrganizationSchema.safeParse(req.body);\n      if (!result.success) {\n        return res.status(400).json({ error: fromZodError(result.error).message });\n      }\n      const org = await storage.createClientOrganization(result.data);\n      res.status(201).json(org);\n    } catch (error) {\n      res.status(500).json({ error: \"Failed to create client organization\" });\n    }\n  });\n\n  app.patch(\"/api/client-organizations/:id\", authMiddleware, async (req, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      const result = insertClientOrganizationSchema.partial().safeParse(req.body);\n      if (!result.success) {\n        return res.status(400).json({ error: fromZodError(result.error).message });\n      }\n      const org = await storage.updateClientOrganization(id, result.data);\n      if (!org) {\n        return res.status(404).json({ error: \"Client organization not found\" });\n      }\n      res.json(org);\n    } catch (error) {\n      res.status(500).json({ error: \"Failed to update client organization\" });\n    }\n  });\n\n  app.delete(\"/api/client-organizations/:id\", authMiddleware, async (req, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      const deleted = await storage.deleteClientOrganization(id);\n      if (!deleted) {\n        return res.status(404).json({ error: \"Client organization not found\" });\n      }\n      res.status(204).send();\n    } catch (error) {\n      res.status(500).json({ error: \"Failed to delete client organization\" });\n    }\n  });\n\n  // ==================== CLIENT POCS ====================\n  app.get(\"/api/client-pocs\", authMiddleware, async (req, res) => {\n    try {\n      const organizationId = req.query.organizationId ? parseInt(req.query.organizationId as string) : null;\n      const pocs = organizationId\n        ? await storage.getClientPocsByOrganization(organizationId)\n        : await storage.getClientPocs();\n      res.json(pocs);\n    } catch (error) {\n      res.status(500).json({ error: \"Failed to fetch client POCs\" });\n    }\n  });\n\n  app.post(\"/api/client-pocs\", authMiddleware, async (req, res) => {\n    try {\n      const result = insertClientPocSchema.safeParse(req.body);\n      if (!result.success) {\n        return res.status(400).json({ error: fromZodError(result.error).message });\n      }\n      const poc = await storage.createClientPoc(result.data);\n      res.status(201).json(poc);\n    } catch (error) {\n      res.status(500).json({ error: \"Failed to create client POC\" });\n    }\n  });\n\n  app.patch(\"/api/client-pocs/:id\", authMiddleware, async (req, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      const result = insertClientPocSchema.partial().safeParse(req.body);\n      if (!result.success) {\n        return res.status(400).json({ error: fromZodError(result.error).message });\n      }\n      const poc = await storage.updateClientPoc(id, result.data);\n      if (!poc) {\n        return res.status(404).json({ error: \"Client POC not found\" });\n      }\n      res.json(poc);\n    } catch (error) {\n      res.status(500).json({ error: \"Failed to update client POC\" });\n    }\n  });\n\n  app.delete(\"/api/client-pocs/:id\", authMiddleware, async (req, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      const deleted = await storage.deleteClientPoc(id);\n      if (!deleted) {\n        return res.status(404).json({ error: \"Client POC not found\" });\n      }\n      res.status(204).send();\n    } catch (error) {\n      res.status(500).json({ error: \"Failed to delete client POC\" });\n    }\n  });\n\n  // ==================== PROJECTS ====================\n  app.get(\"/api/projects\", authMiddleware, async (req, res) => {\n    try {\n      const user = (req as any).user;\n      let projects = await storage.getProjects();\n      \n      // Filter by RA's assigned projects if user is RA\n      if (user?.role === \"ra\" || user?.role === \"Research Associate\") {\n        projects = projects.filter((p: any) => \n          p.assignedRaId === user.id || \n          (p.assignedRaIds && p.assignedRaIds.includes(user.id))\n        );\n      }\n      \n      res.json(projects);\n    } catch (error) {\n      res.status(500).json({ error: \"Failed to fetch projects\" });\n    }\n  });\n\n  // Helper function to check if RA has access to project\n  // Checks both legacy single RA field (assignedRaId) and new array field (assignedRaIds)\n  function raHasProjectAccess(project: any, userId: number): boolean {\n    // Check legacy single RA assignment\n    if (project.assignedRaId === userId) {\n      return true;\n    }\n    // Check new array-based assignment (only if array exists and has entries)\n    if (Array.isArray(project.assignedRaIds) && project.assignedRaIds.includes(userId)) {\n      return true;\n    }\n    return false;\n  }\n\n  app.get(\"/api/projects/:id\", authMiddleware, async (req, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      const user = (req as any).user;\n      const project = await storage.getProject(id);\n      \n      if (!project) {\n        return res.status(404).json({ error: \"Project not found\" });\n      }\n      \n      // Check RA access\n      if ((user?.role === \"ra\" || user?.role === \"Research Associate\") && !raHasProjectAccess(project, user.id)) {\n        return res.status(403).json({ error: \"Access denied: You are not assigned to this project\" });\n      }\n      \n      res.json(project);\n    } catch (error) {\n      res.status(500).json({ error: \"Failed to fetch project\" });\n    }\n  });\n\n  app.post(\"/api/projects\", authMiddleware, async (req, res) => {\n    try {\n      const result = insertProjectSchema.safeParse(req.body);\n      if (!result.success) {\n        return res.status(400).json({ error: fromZodError(result.error).message });\n      }\n      const project = await storage.createProject(result.data);\n      res.status(201).json(project);\n    } catch (error) {\n      res.status(500).json({ error: \"Failed to create project\" });\n    }\n  });\n\n  app.patch(\"/api/projects/:id\", authMiddleware, async (req, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      const result = insertProjectSchema.partial().safeParse(req.body);\n      if (!result.success) {\n        return res.status(400).json({ error: fromZodError(result.error).message });\n      }\n      const project = await storage.updateProject(id, result.data);\n      if (!project) {\n        return res.status(404).json({ error: \"Project not found\" });\n      }\n      res.json(project);\n    } catch (error) {\n      res.status(500).json({ error: \"Failed to update project\" });\n    }\n  });\n\n  app.delete(\"/api/projects/:id\", authMiddleware, async (req, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      const deleted = await storage.deleteProject(id);\n      if (!deleted) {\n        return res.status(404).json({ error: \"Project not found\" });\n      }\n      res.status(204).send();\n    } catch (error) {\n      res.status(500).json({ error: \"Failed to delete project\" });\n    }\n  });\n\n  // Get project detail with experts, activities, and vetting questions\n  app.get(\"/api/projects/:id/detail\", authMiddleware, async (req, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      const user = (req as any).user;\n      const project = await storage.getProject(id);\n      if (!project) {\n        return res.status(404).json({ error: \"Project not found\" });\n      }\n      \n      // Check RA access\n      if ((user?.role === \"ra\" || user?.role === \"Research Associate\") && !raHasProjectAccess(project, user.id)) {\n        return res.status(403).json({ error: \"Access denied: You are not assigned to this project\" });\n      }\n\n      // Fetch related data\n      const [projectExperts, vettingQuestions, activities, inviteLinks, angles] = await Promise.all([\n        storage.getProjectExpertsByProject(id),\n        storage.getVettingQuestionsByProject(id),\n        storage.getProjectActivities(id),\n        storage.getExpertInvitationLinksByProject(id),\n        storage.getProjectAngles(id),\n      ]);\n\n      // Enrich project experts with expert details\n      const enrichedExperts = await Promise.all(\n        projectExperts.map(async (pe) => {\n          const expert = await storage.getExpert(pe.expertId);\n          let sourcedByRa = null;\n          if (pe.sourcedByRaId) {\n            sourcedByRa = await storage.getUser(pe.sourcedByRaId);\n          }\n          return {\n            ...pe,\n            expert,\n            sourcedByRa: sourcedByRa ? { id: sourcedByRa.id, fullName: sourcedByRa.fullName } : null,\n          };\n        })\n      );\n\n      // Fetch assigned RAs details\n      let assignedRas: { id: number; fullName: string; email: string }[] = [];\n      if (project.assignedRaIds && project.assignedRaIds.length > 0) {\n        const raPromises = project.assignedRaIds.map(async (raId) => {\n          const ra = await storage.getUser(raId);\n          return ra ? { id: ra.id, fullName: ra.fullName, email: ra.email } : null;\n        });\n        assignedRas = (await Promise.all(raPromises)).filter(Boolean) as typeof assignedRas;\n      }\n\n      // Fetch PM details\n      let createdByPm = null;\n      if (project.createdByPmId) {\n        const pm = await storage.getUser(project.createdByPmId);\n        if (pm) {\n          createdByPm = { id: pm.id, fullName: pm.fullName, email: pm.email };\n        }\n      }\n\n      // Separate experts by source type\n      const internalExperts = enrichedExperts.filter(e => e.sourceType === \"internal_db\");\n      const raSourcedExperts = enrichedExperts.filter(e => e.sourceType === \"ra_external\");\n\n      // Get RA invite links (including quick invites)\n      const raInviteLinks = inviteLinks.filter(l => (l.inviteType === \"ra\" || l.inviteType === \"quick\") && l.isActive);\n\n      res.json({\n        ...project,\n        createdByPm,\n        assignedRas,\n        vettingQuestions,\n        internalExperts,\n        raSourcedExperts,\n        activities,\n        raInviteLinks,\n        angles,\n      });\n    } catch (error) {\n      console.error(\"Error fetching project detail:\", error);\n      res.status(500).json({ error: \"Failed to fetch project detail\" });\n    }\n  });\n\n  // Assign RAs to project\n  app.post(\"/api/projects/:id/assign-ras\", authMiddleware, async (req, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      const { raIds } = req.body;\n\n      if (!Array.isArray(raIds)) {\n        return res.status(400).json({ error: \"raIds must be an array\" });\n      }\n\n      const project = await storage.getProject(id);\n      if (!project) {\n        return res.status(404).json({ error: \"Project not found\" });\n      }\n\n      // Update project with assigned RAs\n      const updated = await storage.updateProject(id, {\n        assignedRaIds: raIds,\n        updatedAt: new Date(),\n      } as any);\n\n      // Log activity\n      const user = (req as any).user;\n      await storage.createProjectActivity({\n        projectId: id,\n        userId: user?.id,\n        activityType: \"ra_assigned\",\n        description: `Assigned ${raIds.length} RA(s) to project`,\n        metadata: { raIds } as Record<string, any>,\n      });\n\n      res.json(updated);\n    } catch (error) {\n      console.error(\"Error assigning RAs:\", error);\n      res.status(500).json({ error: \"Failed to assign RAs\" });\n    }\n  });\n\n  // Generate RA-specific invite link (always creates a NEW unique token)\n  app.post(\"/api/projects/:id/ra-invite-link\", authMiddleware, async (req, res) => {\n    try {\n      const projectId = parseInt(req.params.id);\n      const { raId, candidateName, candidateEmail } = req.body;\n\n      if (!raId) {\n        return res.status(400).json({ error: \"raId is required\" });\n      }\n\n      const project = await storage.getProject(projectId);\n      if (!project) {\n        return res.status(404).json({ error: \"Project not found\" });\n      }\n\n      const ra = await storage.getUser(raId);\n      if (!ra || (ra.role !== \"ra\" && ra.role !== \"Research Associate\")) {\n        return res.status(400).json({ error: \"Invalid RA\" });\n      }\n\n      // ALWAYS generate a NEW unique token for each invitation\n      const token = crypto.randomBytes(32).toString(\"hex\");\n      const link = await storage.createExpertInvitationLink({\n        token,\n        projectId,\n        raId,\n        inviteType: \"ra\",\n        candidateName: candidateName || null,\n        candidateEmail: candidateEmail || null,\n        status: \"pending\",\n        recruitedBy: ra.email,\n        isActive: true,\n        expiresAt: new Date(Date.now() + 90 * 24 * 60 * 60 * 1000), // 90 days\n      });\n\n      const baseUrl = process.env.APP_BASE_URL || \"http://localhost:5000\";\n      const inviteUrl = `${baseUrl}/invite/${projectId}/ra/${link.token}`;\n      res.json({ link, inviteUrl });\n    } catch (error) {\n      console.error(\"Error generating RA invite link:\", error);\n      res.status(500).json({ error: \"Failed to generate RA invite link\" });\n    }\n  });\n\n  // Register new expert from RA Sourcing tab (creates expert, attaches to project, generates invite)\n  app.post(\"/api/projects/:projectId/register-expert\", authMiddleware, async (req, res) => {\n    try {\n      const projectId = parseInt(req.params.projectId);\n      const user = (req as any).user;\n\n      const project = await storage.getProject(projectId);\n      if (!project) {\n        return res.status(404).json({ error: \"Project not found\" });\n      }\n\n      const {\n        email,\n        firstName,\n        lastName,\n        country,\n        region,\n        countryCode,\n        phoneNumber,\n        linkedinUrl,\n        city,\n        canConsultInEnglish,\n        timezone,\n        experiences,\n        biography,\n        workHistory,\n        hourlyRate,\n        currency,\n      } = req.body;\n\n      // Check if expert with email already exists\n      const existingExpert = await storage.getExpertByEmail(email);\n      if (existingExpert) {\n        return res.status(400).json({ error: \"An expert with this email already exists\" });\n      }\n\n      // Format phone number\n      const fullPhone = `${countryCode} ${phoneNumber}`.trim();\n\n      // Format experience for bio/company/job title\n      const currentExperience = experiences?.find((e: any) => e.isCurrent) || experiences?.[0];\n      const experienceText = experiences?.map((e: any) => {\n        const period = e.isCurrent \n          ? `${e.fromMonth}/${e.fromYear} - Present`\n          : `${e.fromMonth}/${e.fromYear} - ${e.toMonth}/${e.toYear}`;\n        return `${e.title} at ${e.company} (${period})`;\n      }).join(\"\\n\") || \"\";\n\n      // Get RA ID for sourcedByRaId\n      let sourcedByRaId: number | null = null;\n      if (user && (user.role === \"ra\" || user.role === \"Research Associate\")) {\n        sourcedByRaId = user.id;\n      }\n\n      // Create expert\n      const expertData = {\n        name: `${firstName} ${lastName}`.trim(),\n        email,\n        phone: fullPhone || null,\n        linkedinUrl: linkedinUrl || null,\n        country: country || null,\n        city: city || null,\n        region: region || null,\n        timezone: timezone || null,\n        company: currentExperience?.company || null,\n        jobTitle: currentExperience?.title || null,\n        expertise: currentExperience?.title || null,\n        industry: project.industry || null,\n        yearsOfExperience: 0,\n        hourlyRate: hourlyRate || null,\n        currency: currency || \"USD\",\n        bio: biography || null,\n        biography: biography || null,\n        workHistory: {\n          summary: workHistory,\n          experiences: experiences || [],\n        },\n        languages: canConsultInEnglish === \"yes\" ? [\"English\"] : [],\n        status: \"available\" as const,\n        sourcedByRaId,\n        sourcedAt: sourcedByRaId ? new Date() : undefined,\n        pastEmployers: experiences?.map((e: any) => e.company) || [],\n      };\n\n      const newExpert = await storage.createExpert(expertData);\n\n      // Attach expert to project\n      const projectExpert = await storage.createProjectExpert({\n        projectId,\n        expertId: newExpert.id,\n        status: \"assigned\",\n        sourceType: \"ra_sourced\",\n        sourcedByRaId,\n        pipelineStatus: \"ra_sourced\",\n      });\n\n      // Generate unique invite token\n      const token = crypto.randomBytes(32).toString(\"hex\");\n      const link = await storage.createExpertInvitationLink({\n        token,\n        projectId,\n        expertId: newExpert.id,\n        inviteType: \"existing\",\n        candidateName: newExpert.name,\n        candidateEmail: newExpert.email || null,\n        status: \"pending\",\n        recruitedBy: user?.email || \"system\",\n        raId: sourcedByRaId,\n        isActive: true,\n        expiresAt: new Date(Date.now() + 30 * 24 * 60 * 60 * 1000), // 30 days\n      });\n\n      // Update project expert with invitation info\n      await storage.updateProjectExpert(projectExpert.id, {\n        invitationStatus: \"invited\",\n        invitedAt: new Date(),\n        invitationToken: token,\n      });\n\n      // Log activity\n      await storage.createProjectActivity({\n        projectId,\n        userId: user?.id,\n        expertId: newExpert.id,\n        activityType: \"expert_registered\",\n        description: `Registered and invited expert ${newExpert.name} to project`,\n      });\n\n      const inviteUrl = `/expert/project-invite/${token}`;\n      \n      res.status(201).json({\n        expertId: newExpert.id,\n        projectExpertId: projectExpert.id,\n        inviteUrl,\n        token,\n        message: \"Expert registered and attached to project successfully\",\n      });\n    } catch (error) {\n      console.error(\"Error registering expert:\", error);\n      res.status(500).json({ error: \"Failed to register expert\" });\n    }\n  });\n\n  // PUBLIC: Fetch quick invite onboarding data by token\n  app.get(\"/api/quick-invite/:token\", async (req, res) => {\n    try {\n      const { token } = req.params;\n      \n      const link = await storage.getExpertInvitationLinkByToken(token);\n      if (!link || link.status !== \"pending_onboarding\" || !link.isActive) {\n        return res.status(404).json({ error: \"Invalid or expired invite link\" });\n      }\n\n      if (!link.projectId) {\n        return res.status(400).json({ error: \"Project not found\" });\n      }\n\n      const project = await storage.getProject(link.projectId);\n      if (!project) {\n        return res.status(404).json({ error: \"Project not found\" });\n      }\n\n      const vettingQuestions = await storage.getVettingQuestionsByProject(link.projectId);\n\n      res.json({\n        project: {\n          id: project.id,\n          name: project.name,\n          clientName: project.clientName,\n          industry: project.industry,\n          projectOverview: project.projectOverview,\n        },\n        vettingQuestions: vettingQuestions.map((q) => ({\n          id: q.id,\n          question: q.question,\n          isRequired: q.isRequired,\n        })),\n      });\n    } catch (error) {\n      console.error(\"Error fetching quick invite data:\", error);\n      res.status(500).json({ error: \"Failed to fetch invite data\" });\n    }\n  });\n\n  // PUBLIC: Submit quick invite onboarding form (Step 1)\n  app.post(\"/api/quick-invite/:token/onboard\", async (req, res) => {\n    try {\n      const { token } = req.params;\n      const { firstName, lastName, email, phone } = req.body;\n\n      const link = await storage.getExpertInvitationLinkByToken(token);\n      if (!link || link.status !== \"pending_onboarding\" || !link.isActive) {\n        return res.status(404).json({ error: \"Invalid or expired invite link\" });\n      }\n\n      if (!link.projectId) {\n        return res.status(400).json({ error: \"Project not found\" });\n      }\n\n      // Check if expert with email already exists\n      let expert = await storage.getExpertByEmail(email);\n      \n      if (!expert) {\n        // Create new expert with recruitment tracking\n        const project = await storage.getProject(link.projectId);\n        const industryValue = project?.industry || \"General\";\n        expert = await storage.createExpert({\n          name: `${firstName} ${lastName}`.trim(),\n          email,\n          phone: phone || null,\n          expertise: \"Professional\",\n          industry: industryValue,\n          yearsOfExperience: 0,\n          hourlyRate: \"0\",\n          status: \"available\",\n          sourcedByRaId: link.raId || undefined,\n          sourcedAt: link.raId ? new Date() : undefined,\n        });\n      } else if (link.raId && !expert.sourcedByRaId) {\n        // Update existing expert with RA tracking if they weren't recruited before\n        await storage.updateExpert(expert.id, {\n          sourcedByRaId: link.raId,\n          sourcedAt: new Date(),\n        });\n      }\n\n      // Update invitation link status to \"onboarded\" (waiting for decision)\n      await db.update(expertInvitationLinks)\n        .set({ status: \"onboarded\" })\n        .where(eq(expertInvitationLinks.token, token));\n\n      // Log activity\n      await storage.createProjectActivity({\n        projectId: link.projectId,\n        expertId: expert.id,\n        activityType: \"expert_onboarded\",\n        description: `Expert ${expert.name} completed onboarding via quick invite`,\n      });\n\n      res.json({\n        success: true,\n        expertId: expert.id,\n        message: \"Onboarding complete\",\n      });\n    } catch (error) {\n      console.error(\"Error during onboarding:\", error);\n      res.status(500).json({ error: \"Failed to save profile\" });\n    }\n  });\n\n  // PUBLIC: Fetch decision page data\n  app.get(\"/api/quick-invite/:token/decision\", async (req, res) => {\n    try {\n      const { token } = req.params;\n      \n      const link = await storage.getExpertInvitationLinkByToken(token);\n      if (!link || link.status !== \"onboarded\" || !link.isActive) {\n        return res.status(404).json({ error: \"Invalid or expired invite link\" });\n      }\n\n      if (!link.projectId) {\n        return res.status(400).json({ error: \"Project not found\" });\n      }\n\n      const project = await storage.getProject(link.projectId);\n      if (!project) {\n        return res.status(404).json({ error: \"Project not found\" });\n      }\n\n      const vettingQuestions = await storage.getVettingQuestionsByProject(link.projectId);\n\n      res.json({\n        project: {\n          id: project.id,\n          name: project.name,\n          clientName: project.clientName,\n          industry: project.industry,\n          projectOverview: project.projectOverview,\n        },\n        vettingQuestions: vettingQuestions.map((q) => ({\n          id: q.id,\n          question: q.question,\n          isRequired: q.isRequired,\n        })),\n      });\n    } catch (error) {\n      console.error(\"Error fetching decision data:\", error);\n      res.status(500).json({ error: \"Failed to fetch project details\" });\n    }\n  });\n\n  // PUBLIC: Submit decision (Accept/Decline)\n  app.post(\"/api/quick-invite/:token/decide\", async (req, res) => {\n    try {\n      const { token } = req.params;\n      const { decision, sampleAnswers } = req.body;\n\n      if (![\"accepted\", \"declined\"].includes(decision)) {\n        return res.status(400).json({ error: \"Invalid decision\" });\n      }\n\n      const link = await storage.getExpertInvitationLinkByToken(token);\n      if (!link || link.status !== \"onboarded\" || !link.isActive) {\n        return res.status(404).json({ error: \"This invitation has already been completed or is no longer valid\" });\n      }\n\n      if (!link.projectId) {\n        return res.status(400).json({ error: \"Project not found\" });\n      }\n\n      // Get expert by email from link candidate data\n      let expert = link.candidateEmail ? await storage.getExpertByEmail(link.candidateEmail) : null;\n      if (!expert) {\n        return res.status(404).json({ error: \"Expert not found\" });\n      }\n\n      // Create or update project expert with final status\n      const existingProjectExperts = await db.select()\n        .from(projectExperts)\n        .where(\n          and(\n            eq(projectExperts.projectId, link.projectId),\n            eq(projectExperts.expertId, expert.id)\n          )\n        )\n        .limit(1);\n      \n      let projectExpert = existingProjectExperts[0];\n\n      const finalStatus = decision === \"accepted\" ? \"interested\" : \"declined\";\n      const finalPipelineStatus = decision === \"accepted\" ? \"interested\" : \"declined\";\n\n      if (!projectExpert) {\n        projectExpert = await storage.createProjectExpert({\n          projectId: link.projectId,\n          expertId: expert.id,\n          status: finalStatus,\n          sourceType: \"quick_invite\",\n          sourcedByRaId: link.raId,\n          pipelineStatus: finalPipelineStatus,\n        });\n      } else {\n        await storage.updateProjectExpert(projectExpert.id, {\n          status: finalStatus,\n          pipelineStatus: finalPipelineStatus,\n        });\n      }\n\n      // Store sample answers if accepted\n      if (decision === \"accepted\" && sampleAnswers && Object.keys(sampleAnswers).length > 0) {\n        for (const [questionId, answer] of Object.entries(sampleAnswers)) {\n          if (answer && (answer as string).trim()) {\n            await storage.createProjectActivity({\n              projectId: link.projectId,\n              expertId: expert.id,\n              activityType: \"vq_answered\",\n              description: `Expert provided sample answer to question ${questionId}`,\n            });\n          }\n        }\n      }\n\n      // Update invitation link status\n      await db.update(expertInvitationLinks)\n        .set({ status: decision === \"accepted\" ? \"accepted\" : \"declined\" })\n        .where(eq(expertInvitationLinks.token, token));\n\n      // Log activity\n      await storage.createProjectActivity({\n        projectId: link.projectId,\n        expertId: expert.id,\n        activityType: decision === \"accepted\" ? \"expert_accepted\" : \"expert_declined\",\n        description: `Expert ${decision === \"accepted\" ? \"accepted\" : \"declined\"} invitation to project`,\n      });\n\n      res.json({\n        success: true,\n        decision,\n        message: decision === \"accepted\" ? \"Welcome to the project!\" : \"Decision noted\",\n      });\n    } catch (error) {\n      console.error(\"Error submitting decision:\", error);\n      res.status(500).json({ error: \"Failed to submit decision\" });\n    }\n  });\n\n  // Quick invite - generate invite link with minimal info (just name + one contact method)\n  app.post(\"/api/projects/:projectId/quick-invite\", authMiddleware, async (req, res) => {\n    try {\n      const projectId = parseInt(req.params.projectId);\n      const user = (req as any).user;\n      const { candidateName, linkedinUrl, email, phoneNumber } = req.body;\n\n      const project = await storage.getProject(projectId);\n      if (!project) {\n        return res.status(404).json({ error: \"Project not found\" });\n      }\n\n      if (!candidateName) {\n        return res.status(400).json({ error: \"Candidate name is required\" });\n      }\n\n      // Determine candidate contact (prefer email, then phone, then linkedin)\n      const candidateContact = email || phoneNumber || linkedinUrl || null;\n\n      // Generate unique invite token\n      const token = crypto.randomBytes(32).toString(\"hex\");\n      const link = await storage.createExpertInvitationLink({\n        token,\n        projectId,\n        inviteType: \"quick\",\n        candidateName,\n        candidateEmail: email || null,\n        status: \"pending_onboarding\",\n        recruitedBy: user?.email || \"system\",\n        raId: user?.role === \"ra\" || user?.role === \"Research Associate\" ? user.id : null,\n        isActive: true,\n        expiresAt: new Date(Date.now() + 90 * 24 * 60 * 60 * 1000), // 90 days\n      });\n\n      // Log activity\n      await storage.createProjectActivity({\n        projectId,\n        userId: user?.id,\n        activityType: \"quick_invite_created\",\n        description: `Generated quick invite link for ${candidateName} (Contact: ${candidateContact})`,\n      });\n\n      const inviteUrl = `/invite/onboarding/${token}`;\n      res.status(201).json({\n        link,\n        inviteUrl,\n        token,\n        message: \"Quick invite link generated successfully\",\n      });\n    } catch (error) {\n      console.error(\"Error generating quick invite:\", error);\n      res.status(500).json({ error: \"Failed to generate quick invite link\" });\n    }\n  });\n\n  // Generate existing expert project invite link (always creates a NEW unique token)\n  app.post(\"/api/projects/:projectId/experts/:expertId/invite-link\", authMiddleware, async (req, res) => {\n    try {\n      const projectId = parseInt(req.params.projectId);\n      const expertId = parseInt(req.params.expertId);\n      const { angleIds } = req.body; // Optional: specific angles to invite for\n\n      const project = await storage.getProject(projectId);\n      if (!project) {\n        return res.status(404).json({ error: \"Project not found\" });\n      }\n\n      const expert = await storage.getExpert(expertId);\n      if (!expert) {\n        return res.status(404).json({ error: \"Expert not found\" });\n      }\n\n      // ALWAYS generate a NEW unique token for each invitation\n      const token = crypto.randomBytes(32).toString(\"hex\");\n      const user = (req as any).user;\n      const link = await storage.createExpertInvitationLink({\n        token,\n        projectId,\n        expertId,\n        angleIds: angleIds || null,\n        inviteType: \"existing\",\n        candidateName: expert.name,\n        candidateEmail: expert.email || null,\n        status: \"pending\",\n        recruitedBy: user?.email || \"system\",\n        isActive: true,\n        expiresAt: new Date(Date.now() + 30 * 24 * 60 * 60 * 1000), // 30 days\n      });\n\n      // Update project expert status with angle IDs\n      const projectExperts = await storage.getProjectExpertsByProject(projectId);\n      const pe = projectExperts.find(p => p.expertId === expertId);\n      if (pe) {\n        await storage.updateProjectExpert(pe.id, {\n          invitationStatus: \"invited\",\n          invitedAt: new Date(),\n          invitationToken: token,\n          angleIds: angleIds || pe.angleIds,\n        });\n      }\n\n      // Log activity\n      await storage.createProjectActivity({\n        projectId,\n        userId: user?.id,\n        expertId,\n        activityType: \"expert_invited\",\n        description: `Invited expert ${expert.name} to project`,\n      });\n\n      const baseUrl = process.env.APP_BASE_URL || \"http://localhost:5000\";\n      const inviteUrl = `${baseUrl}/expert/project-invite/${link.token}`;\n      res.json({ link, inviteUrl });\n    } catch (error) {\n      console.error(\"Error generating expert invite link:\", error);\n      res.status(500).json({ error: \"Failed to generate invite link\" });\n    }\n  });\n\n  // Get project activities\n  app.get(\"/api/projects/:id/activities\", authMiddleware, async (req, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      const activities = await storage.getProjectActivities(id);\n      res.json(activities);\n    } catch (error) {\n      res.status(500).json({ error: \"Failed to fetch activities\" });\n    }\n  });\n\n  // Add project activity/note\n  app.post(\"/api/projects/:id/activities\", authMiddleware, async (req, res) => {\n    try {\n      const projectId = parseInt(req.params.id);\n      const { activityType, description, metadata } = req.body;\n      const user = (req as any).user;\n\n      const activity = await storage.createProjectActivity({\n        projectId,\n        userId: user?.id,\n        activityType: activityType || \"note_added\",\n        description,\n        metadata,\n      });\n\n      res.status(201).json(activity);\n    } catch (error) {\n      res.status(500).json({ error: \"Failed to add activity\" });\n    }\n  });\n\n  // ==================== EXPERTS ====================\n  app.get(\"/api/experts\", authMiddleware, async (req, res) => {\n    try {\n      const query = req.query.search as string;\n      const experts = query\n        ? await storage.searchExperts(query)\n        : await storage.getExperts();\n      res.json(experts);\n    } catch (error) {\n      res.status(500).json({ error: \"Failed to fetch experts\" });\n    }\n  });\n\n  // Advanced expert search with filters\n  app.get(\"/api/experts/search\", authMiddleware, async (req, res) => {\n    try {\n      const params = {\n        query: req.query.q as string | undefined,\n        country: req.query.country as string | undefined,\n        currentEmployer: req.query.currentEmployer as string | undefined,\n        pastEmployers: req.query.pastEmployers as string | undefined,\n        minRate: req.query.minRate ? parseFloat(req.query.minRate as string) : undefined,\n        maxRate: req.query.maxRate ? parseFloat(req.query.maxRate as string) : undefined,\n        minYearsExperience: req.query.minYearsExperience ? parseInt(req.query.minYearsExperience as string) : undefined,\n        maxYearsExperience: req.query.maxYearsExperience ? parseInt(req.query.maxYearsExperience as string) : undefined,\n        jobTitle: req.query.jobTitle as string | undefined,\n        industry: req.query.industry as string | undefined,\n        language: req.query.language as string | undefined,\n        hasPriorProjects: req.query.hasPriorProjects === 'true',\n        minAcceptanceRate: req.query.minAcceptanceRate ? parseInt(req.query.minAcceptanceRate as string) : undefined,\n        minHoursWorked: req.query.minHoursWorked ? parseFloat(req.query.minHoursWorked as string) : undefined,\n        availableOnly: req.query.availableOnly === 'true',\n        excludeProjectId: req.query.excludeProjectId ? parseInt(req.query.excludeProjectId as string) : undefined,\n      };\n      const experts = await storage.searchExpertsAdvanced(params);\n      res.json(experts);\n    } catch (error) {\n      console.error(\"Expert search error:\", error);\n      res.status(500).json({ error: \"Failed to search experts\" });\n    }\n  });\n\n  app.get(\"/api/experts/:id\", authMiddleware, async (req, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      const expert = await storage.getExpert(id);\n      if (!expert) {\n        return res.status(404).json({ error: \"Expert not found\" });\n      }\n      res.json(expert);\n    } catch (error) {\n      res.status(500).json({ error: \"Failed to fetch expert\" });\n    }\n  });\n\n  app.get(\"/api/experts/:id/consultations\", authMiddleware, async (req, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      const callRecords = await storage.getCallRecordsByExpert(id);\n      res.json(callRecords);\n    } catch (error) {\n      res.status(500).json({ error: \"Failed to fetch expert consultations\" });\n    }\n  });\n\n  app.get(\"/api/experts/:id/assignments\", authMiddleware, async (req, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      const assignments = await storage.getProjectExpertsByExpert(id);\n      res.json(assignments);\n    } catch (error) {\n      res.status(500).json({ error: \"Failed to fetch expert assignments\" });\n    }\n  });\n\n  app.post(\"/api/experts\", authMiddleware, async (req, res) => {\n    try {\n      const result = insertExpertSchema.safeParse(req.body);\n      if (!result.success) {\n        return res.status(400).json({ error: fromZodError(result.error).message });\n      }\n      const expert = await storage.createExpert(result.data);\n      res.status(201).json(expert);\n    } catch (error) {\n      res.status(500).json({ error: \"Failed to create expert\" });\n    }\n  });\n\n  app.patch(\"/api/experts/:id\", authMiddleware, async (req, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      const result = insertExpertSchema.partial().safeParse(req.body);\n      if (!result.success) {\n        return res.status(400).json({ error: fromZodError(result.error).message });\n      }\n      const expert = await storage.updateExpert(id, result.data);\n      if (!expert) {\n        return res.status(404).json({ error: \"Expert not found\" });\n      }\n      res.json(expert);\n    } catch (error) {\n      res.status(500).json({ error: \"Failed to update expert\" });\n    }\n  });\n\n  app.delete(\"/api/experts/:id\", authMiddleware, async (req, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      const deleted = await storage.deleteExpert(id);\n      if (!deleted) {\n        return res.status(404).json({ error: \"Expert not found\" });\n      }\n      res.status(204).send();\n    } catch (error) {\n      res.status(500).json({ error: \"Failed to delete expert\" });\n    }\n  });\n\n  // ==================== PROJECT ANGLES ====================\n  app.get(\"/api/projects/:projectId/angles\", authMiddleware, async (req, res) => {\n    try {\n      const projectId = parseInt(req.params.projectId);\n      const angles = await storage.getProjectAngles(projectId);\n      res.json(angles);\n    } catch (error) {\n      res.status(500).json({ error: \"Failed to fetch project angles\" });\n    }\n  });\n\n  app.get(\"/api/angles/:id\", authMiddleware, async (req, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      const angle = await storage.getProjectAngle(id);\n      if (!angle) {\n        return res.status(404).json({ error: \"Angle not found\" });\n      }\n      res.json(angle);\n    } catch (error) {\n      res.status(500).json({ error: \"Failed to fetch angle\" });\n    }\n  });\n\n  app.post(\"/api/projects/:projectId/angles\", authMiddleware, async (req, res) => {\n    try {\n      const projectId = parseInt(req.params.projectId);\n      const result = insertProjectAngleSchema.safeParse({\n        ...req.body,\n        projectId,\n      });\n      if (!result.success) {\n        return res.status(400).json({ error: fromZodError(result.error).message });\n      }\n      const angle = await storage.createProjectAngle(result.data);\n      res.status(201).json(angle);\n    } catch (error) {\n      res.status(500).json({ error: \"Failed to create angle\" });\n    }\n  });\n\n  app.patch(\"/api/angles/:id\", authMiddleware, async (req, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      const result = insertProjectAngleSchema.partial().safeParse(req.body);\n      if (!result.success) {\n        return res.status(400).json({ error: fromZodError(result.error).message });\n      }\n      const angle = await storage.updateProjectAngle(id, result.data);\n      if (!angle) {\n        return res.status(404).json({ error: \"Angle not found\" });\n      }\n      res.json(angle);\n    } catch (error) {\n      res.status(500).json({ error: \"Failed to update angle\" });\n    }\n  });\n\n  app.delete(\"/api/angles/:id\", authMiddleware, async (req, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      // Also delete VQs for this angle\n      await storage.deleteVettingQuestionsByAngle(id);\n      const deleted = await storage.deleteProjectAngle(id);\n      if (!deleted) {\n        return res.status(404).json({ error: \"Angle not found\" });\n      }\n      res.status(204).send();\n    } catch (error) {\n      res.status(500).json({ error: \"Failed to delete angle\" });\n    }\n  });\n\n  app.post(\"/api/projects/:projectId/angles/reorder\", authMiddleware, async (req, res) => {\n    try {\n      const projectId = parseInt(req.params.projectId);\n      const { angleIds } = req.body;\n      if (!Array.isArray(angleIds)) {\n        return res.status(400).json({ error: \"angleIds must be an array\" });\n      }\n      const angles = await storage.reorderProjectAngles(projectId, angleIds);\n      res.json(angles);\n    } catch (error) {\n      res.status(500).json({ error: \"Failed to reorder angles\" });\n    }\n  });\n\n  // Get VQs by angle\n  app.get(\"/api/angles/:angleId/vetting-questions\", authMiddleware, async (req, res) => {\n    try {\n      const angleId = parseInt(req.params.angleId);\n      const questions = await storage.getVettingQuestionsByAngle(angleId);\n      res.json(questions);\n    } catch (error) {\n      res.status(500).json({ error: \"Failed to fetch vetting questions for angle\" });\n    }\n  });\n\n  // ==================== VETTING QUESTIONS ====================\n  app.get(\"/api/vetting-questions\", authMiddleware, async (req, res) => {\n    try {\n      const projectId = req.query.projectId ? parseInt(req.query.projectId as string) : null;\n      const angleId = req.query.angleId ? parseInt(req.query.angleId as string) : null;\n      \n      let questions;\n      if (angleId) {\n        questions = await storage.getVettingQuestionsByAngle(angleId);\n      } else if (projectId) {\n        questions = await storage.getVettingQuestionsByProject(projectId);\n      } else {\n        questions = await storage.getVettingQuestions();\n      }\n      res.json(questions);\n    } catch (error) {\n      res.status(500).json({ error: \"Failed to fetch vetting questions\" });\n    }\n  });\n\n  app.post(\"/api/vetting-questions\", authMiddleware, async (req, res) => {\n    try {\n      const result = insertVettingQuestionSchema.safeParse(req.body);\n      if (!result.success) {\n        return res.status(400).json({ error: fromZodError(result.error).message });\n      }\n      const question = await storage.createVettingQuestion(result.data);\n      res.status(201).json(question);\n    } catch (error) {\n      res.status(500).json({ error: \"Failed to create vetting question\" });\n    }\n  });\n\n  app.patch(\"/api/vetting-questions/:id\", authMiddleware, async (req, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      const result = insertVettingQuestionSchema.partial().safeParse(req.body);\n      if (!result.success) {\n        return res.status(400).json({ error: fromZodError(result.error).message });\n      }\n      const question = await storage.updateVettingQuestion(id, result.data);\n      if (!question) {\n        return res.status(404).json({ error: \"Vetting question not found\" });\n      }\n      res.json(question);\n    } catch (error) {\n      res.status(500).json({ error: \"Failed to update vetting question\" });\n    }\n  });\n\n  app.delete(\"/api/vetting-questions/:id\", authMiddleware, async (req, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      const deleted = await storage.deleteVettingQuestion(id);\n      if (!deleted) {\n        return res.status(404).json({ error: \"Vetting question not found\" });\n      }\n      res.status(204).send();\n    } catch (error) {\n      res.status(500).json({ error: \"Failed to delete vetting question\" });\n    }\n  });\n\n  // ==================== PROJECT EXPERTS ====================\n  app.get(\"/api/project-experts\", authMiddleware, async (req, res) => {\n    try {\n      const projectId = req.query.projectId ? parseInt(req.query.projectId as string) : null;\n      const assignments = projectId\n        ? await storage.getProjectExpertsByProject(projectId)\n        : await storage.getProjectExperts();\n      res.json(assignments);\n    } catch (error) {\n      res.status(500).json({ error: \"Failed to fetch project experts\" });\n    }\n  });\n\n  app.get(\"/api/project-experts/:id\", authMiddleware, async (req, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      const assignment = await storage.getProjectExpert(id);\n      if (!assignment) {\n        return res.status(404).json({ error: \"Assignment not found\" });\n      }\n      res.json(assignment);\n    } catch (error) {\n      res.status(500).json({ error: \"Failed to fetch assignment\" });\n    }\n  });\n\n  app.post(\"/api/project-experts\", authMiddleware, async (req, res) => {\n    try {\n      const result = insertProjectExpertSchema.safeParse(req.body);\n      if (!result.success) {\n        return res.status(400).json({ error: fromZodError(result.error).message });\n      }\n      const assignment = await storage.createProjectExpert(result.data);\n      res.status(201).json(assignment);\n    } catch (error) {\n      res.status(500).json({ error: \"Failed to assign expert to project\" });\n    }\n  });\n\n  app.patch(\"/api/project-experts/:id\", authMiddleware, async (req, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      const result = insertProjectExpertSchema.partial().safeParse(req.body);\n      if (!result.success) {\n        return res.status(400).json({ error: fromZodError(result.error).message });\n      }\n      const assignment = await storage.updateProjectExpert(id, result.data);\n      if (!assignment) {\n        return res.status(404).json({ error: \"Assignment not found\" });\n      }\n      res.json(assignment);\n    } catch (error) {\n      res.status(500).json({ error: \"Failed to update assignment\" });\n    }\n  });\n\n  // Send invitation to expert (always creates a NEW unique token)\n  app.post(\"/api/project-experts/:id/invite\", authMiddleware, async (req, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      \n      // Get assignment, expert, and project data\n      const assignment = await storage.getProjectExpert(id);\n      if (!assignment) {\n        return res.status(404).json({ error: \"Assignment not found\" });\n      }\n      \n      const expert = await storage.getExpert(assignment.expertId);\n      if (!expert) {\n        return res.status(404).json({ error: \"Expert not found\" });\n      }\n      \n      const project = await storage.getProject(assignment.projectId);\n      if (!project) {\n        return res.status(404).json({ error: \"Project not found\" });\n      }\n      \n      // Get vetting questions for this project\n      const vqs = await storage.getVettingQuestionsByProject(assignment.projectId);\n      \n      // ALWAYS create a NEW unique token for each invitation\n      const token = crypto.randomBytes(32).toString(\"hex\");\n      const user = (req as any).user;\n      const link = await storage.createExpertInvitationLink({\n        token,\n        projectId: assignment.projectId,\n        expertId: assignment.expertId,\n        angleIds: assignment.angleIds,\n        inviteType: \"existing\",\n        candidateName: expert.name,\n        candidateEmail: expert.email || null,\n        status: \"pending\",\n        recruitedBy: user?.email || \"system\",\n        isActive: true,\n        expiresAt: new Date(Date.now() + 30 * 24 * 60 * 60 * 1000), // 30 days\n      });\n      \n      const baseUrl = process.env.APP_BASE_URL || \"http://localhost:5000\";\n      const invitationUrl = `${baseUrl}/expert/project-invite/${link.token}`;\n      \n      // Send email\n      await sendExpertInvitationEmail({\n        expertName: expert.name,\n        expertEmail: expert.email,\n        projectName: project.name,\n        clientName: project.clientName,\n        industry: project.industry,\n        invitationUrl,\n        vettingQuestionsCount: vqs.length,\n      });\n      \n      // Update status to invited\n      const updatedAssignment = await storage.updateProjectExpert(id, {\n        status: \"invited\",\n        invitationStatus: \"invited\",\n        invitedAt: new Date(),\n        invitationToken: link.token,\n      });\n      \n      res.json(updatedAssignment);\n    } catch (error) {\n      console.error(\"Failed to send invitation:\", error);\n      res.status(500).json({ error: \"Failed to send invitation\" });\n    }\n  });\n\n  // Expert accepts invitation\n  app.post(\"/api/project-experts/:id/accept\", authMiddleware, async (req, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      const { vqAnswers, availabilityNote } = req.body;\n      const assignment = await storage.updateProjectExpert(id, {\n        status: \"accepted\",\n        respondedAt: new Date(),\n        vqAnswers,\n        availabilityNote,\n      });\n      if (!assignment) {\n        return res.status(404).json({ error: \"Assignment not found\" });\n      }\n      res.json(assignment);\n    } catch (error) {\n      res.status(500).json({ error: \"Failed to accept invitation\" });\n    }\n  });\n\n  // Expert declines invitation\n  app.post(\"/api/project-experts/:id/decline\", authMiddleware, async (req, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      const assignment = await storage.updateProjectExpert(id, {\n        status: \"declined\",\n        respondedAt: new Date(),\n      });\n      if (!assignment) {\n        return res.status(404).json({ error: \"Assignment not found\" });\n      }\n      res.json(assignment);\n    } catch (error) {\n      res.status(500).json({ error: \"Failed to decline invitation\" });\n    }\n  });\n\n  // Client selects expert\n  app.post(\"/api/project-experts/:id/select\", authMiddleware, async (req, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      const assignment = await storage.updateProjectExpert(id, {\n        status: \"client_selected\",\n      });\n      if (!assignment) {\n        return res.status(404).json({ error: \"Assignment not found\" });\n      }\n      res.json(assignment);\n    } catch (error) {\n      res.status(500).json({ error: \"Failed to select expert\" });\n    }\n  });\n\n  app.delete(\"/api/project-experts/:id\", authMiddleware, async (req, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      const deleted = await storage.deleteProjectExpert(id);\n      if (!deleted) {\n        return res.status(404).json({ error: \"Assignment not found\" });\n      }\n      res.status(204).send();\n    } catch (error) {\n      res.status(500).json({ error: \"Failed to remove expert from project\" });\n    }\n  });\n\n  // Bulk attach experts to project\n  app.post(\"/api/projects/:projectId/experts/bulk\", authMiddleware, async (req, res) => {\n    try {\n      const projectId = parseInt(req.params.projectId);\n      const { expertIds } = req.body;\n      \n      if (!Array.isArray(expertIds) || expertIds.length === 0) {\n        return res.status(400).json({ error: \"expertIds must be a non-empty array\" });\n      }\n      \n      // Check if project exists\n      const project = await storage.getProject(projectId);\n      if (!project) {\n        return res.status(404).json({ error: \"Project not found\" });\n      }\n      \n      // Get existing assignments to avoid duplicates\n      const existingAssignments = await storage.getProjectExpertsByProject(projectId);\n      const existingExpertIds = new Set(existingAssignments.map(a => a.expertId));\n      \n      // Filter out already assigned experts\n      const newExpertIds = expertIds.filter((id: number) => !existingExpertIds.has(id));\n      \n      if (newExpertIds.length === 0) {\n        return res.status(200).json({ \n          message: \"All experts are already assigned to this project\",\n          assignments: [] \n        });\n      }\n      \n      const assignments = await storage.createProjectExpertsBulk(\n        newExpertIds.map((expertId: number) => ({\n          projectId,\n          expertId,\n          status: \"assigned\",\n          sourceType: \"internal_db\",\n        }))\n      );\n      \n      res.status(201).json({ \n        message: `${assignments.length} experts attached to project`,\n        assignments \n      });\n    } catch (error) {\n      console.error(\"Bulk attach error:\", error);\n      res.status(500).json({ error: \"Failed to attach experts to project\" });\n    }\n  });\n\n  // Send bulk invitations with angle selection\n  app.post(\"/api/projects/:projectId/invitations/bulk-send\", authMiddleware, async (req, res) => {\n    try {\n      const projectId = parseInt(req.params.projectId);\n      const { projectExpertIds, angleIds, channel } = req.body; // angleIds: array of angle IDs to assign (OPTIONAL)\n      \n      console.log(\"[API] Bulk-send endpoint triggered from Project Experts view\");\n      console.log(\"[API] Request params - projectId:\", projectId, \"experts count:\", projectExpertIds?.length, \"angleIds:\", angleIds, \"channel:\", channel);\n      \n      if (!Array.isArray(projectExpertIds) || projectExpertIds.length === 0) {\n        return res.status(400).json({ error: \"projectExpertIds must be a non-empty array\" });\n      }\n      \n      // Angles are OPTIONAL - allow empty arrays\n      if (angleIds && !Array.isArray(angleIds)) {\n        return res.status(400).json({ error: \"angleIds must be an array\" });\n      }\n      \n      if (!angleIds || angleIds.length === 0) {\n        console.log(\"[INVITES] Creating invitations with no angles for project\", projectId);\n      }\n      \n      const project = await storage.getProject(projectId);\n      if (!project) {\n        return res.status(404).json({ error: \"Project not found\" });\n      }\n      \n      // Get vetting questions for the project\n      const vettingQuestions = await storage.getVettingQuestionsByProject(projectId);\n      \n      const results = [];\n      \n      // Process each expert directly (don't use internal fetch)\n      for (const peId of projectExpertIds) {\n        try {\n          const pe = await storage.getProjectExpert(peId);\n          if (!pe || pe.projectId !== projectId) continue;\n          \n          const expert = await storage.getExpert(pe.expertId);\n          if (!expert) continue;\n          \n          console.log(`[EMAIL] Sending project invitation to ${expert.email} for project ${projectId}`);\n          \n          // Determine angles to use: use provided angleIds if given and non-empty, otherwise use existing\n          const finalAngleIds = angleIds && angleIds.length > 0 ? angleIds : pe.angleIds;\n          \n          // ALWAYS create a NEW unique token for each invitation\n          const token = crypto.randomBytes(32).toString(\"hex\");\n          const link = await storage.createExpertInvitationLink({\n            token,\n            projectId,\n            expertId: expert.id,\n            angleIds: finalAngleIds,\n            inviteType: \"existing\",\n            candidateName: expert.name,\n            candidateEmail: expert.email || null,\n            status: \"pending\",\n            recruitedBy: \"system\",\n            isActive: true,\n            expiresAt: new Date(Date.now() + 30 * 24 * 60 * 60 * 1000), // 30 days\n          });\n          \n          // Generate invitation URL\n          const baseUrl = process.env.APP_BASE_URL || \"http://localhost:5000\";\n          const invitationUrl = `${baseUrl}/expert/project-invite/${link.token}`;\n          \n          // Send email invitation\n          let emailSent = false;\n          if (channel === 'email' || channel === 'both' || !channel) {\n            try {\n              console.log(`[EMAIL] Calling sendExpertInvitationEmail for ${expert.email}`);\n              emailSent = await sendExpertInvitationEmail({\n                expertName: expert.name,\n                expertEmail: expert.email,\n                projectName: project.name,\n                clientName: project.clientName || \"Client\",\n                industry: project.industry || undefined,\n                invitationUrl,\n                vettingQuestionsCount: vettingQuestions.length,\n              });\n              console.log(`[EMAIL] Email ${emailSent ? 'SENT' : 'FAILED'} to ${expert.email}`);\n            } catch (emailError) {\n              console.error(`[EMAIL] Error sending to ${expert.email}:`, emailError);\n            }\n          }\n          \n          // Update status to invited ONLY AFTER EMAIL IS SENT\n          // Include angleIds update if provided and non-empty\n          const updateData: any = {\n            status: \"invited\",\n            invitationStatus: \"invited\",\n            invitedAt: new Date(),\n            invitationToken: link.token,\n          };\n          \n          // Only add angleIds to update if we have values to set\n          if (angleIds && angleIds.length > 0) {\n            updateData.angleIds = angleIds;\n          }\n          \n          await storage.updateProjectExpert(peId, updateData);\n          \n          results.push({\n            expertId: expert.id,\n            expertName: expert.name,\n            email: expert.email,\n            invitationUrl,\n            status: emailSent ? \"sent\" : \"failed\",\n            emailSent,\n          });\n        } catch (expertError) {\n          console.error(`[INVITES] Error processing expert ${peId}:`, expertError);\n          // Continue processing other experts even if one fails\n        }\n      }\n      \n      const successCount = results.filter(r => r.emailSent).length;\n      const failedCount = results.filter(r => !r.emailSent).length;\n      \n      console.log(`[API] Bulk-send complete: ${successCount} sent, ${failedCount} failed`);\n      \n      // Return 200 with proper summary (success if at least one was sent)\n      res.status(200).json({\n        message: `Invitations: ${successCount} sent, ${failedCount} failed`,\n        channel: channel || 'email',\n        results,\n        summary: {\n          total: results.length,\n          sent: successCount,\n          failed: failedCount,\n        }\n      });\n    } catch (error) {\n      console.error(\"[INVITES] Bulk send invitations error:\", error);\n      const errorMessage = error instanceof Error ? error.message : \"Failed to send bulk invitations\";\n      res.status(500).json({ \n        success: false,\n        error: \"Failed to send bulk invitations\",\n        details: errorMessage,\n        message: errorMessage\n      });\n    }\n  });\n\n  // Send bulk invitations to experts\n  app.post(\"/api/projects/:projectId/invitations/send\", authMiddleware, async (req, res) => {\n    try {\n      const projectId = parseInt(req.params.projectId);\n      const { projectExpertIds, channel } = req.body; // channel: 'email' | 'whatsapp' | 'both'\n      \n      console.log(\"[Bulk Invite] Starting bulk invitation send from Project Existing Experts tab\");\n      \n      if (!Array.isArray(projectExpertIds) || projectExpertIds.length === 0) {\n        return res.status(400).json({ error: \"projectExpertIds must be a non-empty array\" });\n      }\n      \n      // Get project details\n      const project = await storage.getProject(projectId);\n      if (!project) {\n        return res.status(404).json({ error: \"Project not found\" });\n      }\n      \n      // Get vetting questions for the project\n      const vettingQuestions = await storage.getVettingQuestionsByProject(projectId);\n      \n      const results = [];\n      \n      for (const peId of projectExpertIds) {\n        const pe = await storage.getProjectExpert(peId);\n        if (!pe || pe.projectId !== projectId) continue;\n        \n        const expert = await storage.getExpert(pe.expertId);\n        if (!expert) continue;\n        \n        console.log(`[Bulk Invite] Processing expert: ${expert.name} (${expert.email})`);\n        \n        // ALWAYS create a NEW unique token for each invitation\n        const token = crypto.randomBytes(32).toString(\"hex\");\n        const link = await storage.createExpertInvitationLink({\n          token,\n          projectId,\n          expertId: expert.id,\n          angleIds: pe.angleIds,\n          inviteType: \"existing\",\n          candidateName: expert.name,\n          candidateEmail: expert.email || null,\n          status: \"pending\",\n          recruitedBy: \"system\",\n          isActive: true,\n          expiresAt: new Date(Date.now() + 30 * 24 * 60 * 60 * 1000), // 30 days\n        });\n        console.log(`[Bulk Invite] Created new invitation token for ${expert.email}`);\n        \n        // Update project-expert with token and status\n        const updatedPe = await storage.updateProjectExpert(peId, {\n          status: \"invited\",\n          invitationStatus: \"invited\",\n          invitedAt: new Date(),\n          invitationToken: link.token,\n        });\n        \n        // Generate invitation URL\n        const baseUrl = process.env.APP_BASE_URL || \"http://localhost:5000\";\n        const invitationUrl = `${baseUrl}/expert/project-invite/${link.token}`;\n        \n        // Send email invitation\n        let emailSent = false;\n        if (channel === 'email' || channel === 'both' || !channel) {\n          try {\n            console.log(`[Bulk Invite] Sending email to ${expert.email}...`);\n            emailSent = await sendExpertInvitationEmail({\n              expertName: expert.name,\n              expertEmail: expert.email,\n              projectName: project.name,\n              clientName: project.clientName || \"Client\",\n              industry: project.industry || undefined,\n              invitationUrl,\n              vettingQuestionsCount: vettingQuestions.length,\n            });\n            console.log(`[Bulk Invite] Email ${emailSent ? 'SENT' : 'FAILED'} to ${expert.name} (${expert.email})`);\n          } catch (emailError) {\n            console.error(`[Bulk Invite] Email error for ${expert.email}:`, emailError);\n          }\n        }\n        \n        // Log WhatsApp info (manual follow-up for now)\n        if (channel === 'whatsapp' || channel === 'both') {\n          console.log(`[Bulk Invite] [WhatsApp] Manual follow-up needed for ${expert.name} (${expert.phone || expert.whatsapp || 'no phone'})`);\n          console.log(`[Bulk Invite]   Invitation URL: ${invitationUrl}`);\n        }\n        \n        results.push({\n          expertId: expert.id,\n          expertName: expert.name,\n          email: expert.email,\n          invitationUrl,\n          status: emailSent ? \"sent\" : \"failed\",\n          emailSent,\n        });\n      }\n      \n      const successCount = results.filter(r => r.emailSent).length;\n      const failedCount = results.filter(r => !r.emailSent).length;\n      \n      console.log(`[Bulk Invite] Complete: ${successCount} sent, ${failedCount} failed`);\n      \n      res.json({\n        message: `Invitations: ${successCount} sent, ${failedCount} failed`,\n        channel: channel || 'email',\n        results,\n        summary: {\n          total: results.length,\n          sent: successCount,\n          failed: failedCount,\n        }\n      });\n    } catch (error) {\n      console.error(\"[Bulk Invite] Send invitations error:\", error);\n      res.status(500).json({ error: \"Failed to send invitations\" });\n    }\n  });\n\n  // ==================== EXPERT INVITATION (PUBLIC) ====================\n  // Get invitation details by token (for expert to view project and questions)\n  app.get(\"/api/expert-invite/:token\", async (req, res) => {\n    try {\n      const token = req.params.token;\n      const pe = await storage.getProjectExpertByToken(token);\n      \n      if (!pe) {\n        return res.status(404).json({ error: \"Invitation not found\" });\n      }\n      \n      // Check if already responded\n      if (pe.status === \"accepted\" || pe.status === \"declined\") {\n        return res.status(400).json({ \n          error: \"This invitation has already been responded to\",\n          status: pe.status\n        });\n      }\n      \n      // Get project details\n      const project = await storage.getProject(pe.projectId);\n      if (!project) {\n        return res.status(404).json({ error: \"Project not found\" });\n      }\n      \n      // Get expert details\n      const expert = await storage.getExpert(pe.expertId);\n      if (!expert) {\n        return res.status(404).json({ error: \"Expert not found\" });\n      }\n      \n      // Get vetting questions\n      const vettingQuestions = await storage.getVettingQuestionsByProject(pe.projectId);\n      \n      res.json({\n        projectExpertId: pe.id,\n        project: {\n          id: project.id,\n          name: project.name,\n          clientName: project.clientName,\n          industry: project.industry,\n          projectOverview: project.projectOverview,\n          description: project.description,\n        },\n        expert: {\n          id: expert.id,\n          name: expert.name,\n          email: expert.email,\n        },\n        vettingQuestions: vettingQuestions.map(q => ({\n          id: q.id,\n          question: q.question,\n          orderIndex: q.orderIndex,\n          isRequired: q.isRequired,\n        })),\n        invitedAt: pe.invitedAt,\n      });\n    } catch (error) {\n      console.error(\"Get invitation error:\", error);\n      res.status(500).json({ error: \"Failed to fetch invitation details\" });\n    }\n  });\n\n  // Accept invitation with VQ answers\n  app.post(\"/api/expert-invite/:token/accept\", async (req, res) => {\n    try {\n      const token = req.params.token;\n      const { vqAnswers, availabilityNote } = req.body;\n      \n      const pe = await storage.getProjectExpertByToken(token);\n      \n      if (!pe) {\n        return res.status(404).json({ error: \"Invitation not found\" });\n      }\n      \n      if (pe.status === \"accepted\" || pe.status === \"declined\") {\n        return res.status(400).json({ \n          error: \"This invitation has already been responded to\",\n          status: pe.status\n        });\n      }\n      \n      // Update project-expert with answers and status\n      const updated = await storage.updateProjectExpert(pe.id, {\n        status: \"accepted\",\n        respondedAt: new Date(),\n        vqAnswers,\n        availabilityNote,\n      });\n      \n      res.json({\n        message: \"Thank you, your response has been recorded.\",\n        status: \"accepted\",\n      });\n    } catch (error) {\n      console.error(\"Accept invitation error:\", error);\n      res.status(500).json({ error: \"Failed to accept invitation\" });\n    }\n  });\n\n  // Decline invitation\n  app.post(\"/api/expert-invite/:token/decline\", async (req, res) => {\n    try {\n      const token = req.params.token;\n      const { reason } = req.body;\n      \n      const pe = await storage.getProjectExpertByToken(token);\n      \n      if (!pe) {\n        return res.status(404).json({ error: \"Invitation not found\" });\n      }\n      \n      if (pe.status === \"accepted\" || pe.status === \"declined\") {\n        return res.status(400).json({ \n          error: \"This invitation has already been responded to\",\n          status: pe.status\n        });\n      }\n      \n      // Update project-expert with declined status\n      const updated = await storage.updateProjectExpert(pe.id, {\n        status: \"declined\",\n        respondedAt: new Date(),\n        notes: reason || null,\n      });\n      \n      res.json({\n        message: \"Thank you, your response has been recorded.\",\n        status: \"declined\",\n      });\n    } catch (error) {\n      console.error(\"Decline invitation error:\", error);\n      res.status(500).json({ error: \"Failed to decline invitation\" });\n    }\n  });\n\n  // ==================== CALL RECORDS ====================\n  app.get(\"/api/call-records\", authMiddleware, async (req, res) => {\n    try {\n      const projectId = req.query.projectId ? parseInt(req.query.projectId as string) : null;\n      const expertId = req.query.expertId ? parseInt(req.query.expertId as string) : null;\n      const user = (req as any).user;\n      \n      let records;\n      if (projectId) {\n        records = await storage.getCallRecordsByProject(projectId);\n      } else if (expertId) {\n        records = await storage.getCallRecordsByExpert(expertId);\n      } else {\n        records = await storage.getCallRecords();\n      }\n      \n      // Filter by RA's assigned projects if user is RA\n      if (user?.role === \"ra\" || user?.role === \"Research Associate\") {\n        const allProjects = await storage.getProjects();\n        const raProjectIds = new Set(\n          allProjects\n            .filter((p: any) => p.assignedRaId === user.id || (p.assignedRaIds && p.assignedRaIds.includes(user.id)))\n            .map((p: any) => p.id)\n        );\n        records = records.filter((r: any) => raProjectIds.has(r.projectId));\n      }\n      \n      res.json(records);\n    } catch (error) {\n      res.status(500).json({ error: \"Failed to fetch call records\" });\n    }\n  });\n\n  app.get(\"/api/call-records/:id\", authMiddleware, async (req, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      const record = await storage.getCallRecord(id);\n      if (!record) {\n        return res.status(404).json({ error: \"Call record not found\" });\n      }\n      res.json(record);\n    } catch (error) {\n      res.status(500).json({ error: \"Failed to fetch call record\" });\n    }\n  });\n\n  app.post(\"/api/call-records\", authMiddleware, async (req, res) => {\n    try {\n      const result = insertCallRecordSchema.safeParse(req.body);\n      if (!result.success) {\n        return res.status(400).json({ error: fromZodError(result.error).message });\n      }\n      const record = await storage.createCallRecord(result.data);\n      res.status(201).json(record);\n    } catch (error) {\n      res.status(500).json({ error: \"Failed to create call record\" });\n    }\n  });\n\n  app.patch(\"/api/call-records/:id\", authMiddleware, async (req, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      const result = insertCallRecordSchema.partial().safeParse(req.body);\n      if (!result.success) {\n        return res.status(400).json({ error: fromZodError(result.error).message });\n      }\n      const record = await storage.updateCallRecord(id, result.data);\n      if (!record) {\n        return res.status(404).json({ error: \"Call record not found\" });\n      }\n      res.json(record);\n    } catch (error) {\n      res.status(500).json({ error: \"Failed to update call record\" });\n    }\n  });\n\n  // Schedule consultation\n  app.post(\"/api/call-records/:id/schedule\", authMiddleware, async (req, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      const { scheduledStartTime, scheduledEndTime, zoomLink } = req.body;\n      const record = await storage.updateCallRecord(id, {\n        status: \"scheduled\",\n        scheduledStartTime: new Date(scheduledStartTime),\n        scheduledEndTime: new Date(scheduledEndTime),\n        zoomLink,\n      });\n      if (!record) {\n        return res.status(404).json({ error: \"Call record not found\" });\n      }\n      res.json(record);\n    } catch (error) {\n      res.status(500).json({ error: \"Failed to schedule consultation\" });\n    }\n  });\n\n  // Complete consultation\n  app.post(\"/api/call-records/:id/complete\", authMiddleware, async (req: AuthRequest, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      const { actualDurationMinutes, recordingUrl, notes } = req.body;\n      \n      const cuUsed = calculateCU(actualDurationMinutes || 0);\n      const record = await storage.updateCallRecord(id, {\n        status: \"completed\",\n        actualDurationMinutes,\n        durationMinutes: actualDurationMinutes,\n        recordingUrl,\n        notes,\n        completedAt: new Date(),\n      });\n      if (!record) {\n        return res.status(404).json({ error: \"Call record not found\" });\n      }\n      res.json(record);\n    } catch (error) {\n      res.status(500).json({ error: \"Failed to complete consultation\" });\n    }\n  });\n\n  // Cancel consultation\n  app.post(\"/api/call-records/:id/cancel\", authMiddleware, async (req, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      const { reason } = req.body;\n      const record = await storage.updateCallRecord(id, {\n        status: \"cancelled\",\n        notes: reason,\n      });\n      if (!record) {\n        return res.status(404).json({ error: \"Call record not found\" });\n      }\n      res.json(record);\n    } catch (error) {\n      res.status(500).json({ error: \"Failed to cancel consultation\" });\n    }\n  });\n\n  app.delete(\"/api/call-records/:id\", authMiddleware, async (req, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      const deleted = await storage.deleteCallRecord(id);\n      if (!deleted) {\n        return res.status(404).json({ error: \"Call record not found\" });\n      }\n      res.status(204).send();\n    } catch (error) {\n      res.status(500).json({ error: \"Failed to delete call record\" });\n    }\n  });\n\n  // ==================== EXPERT INVITATION LINKS ====================\n  // List all invites (with optional filters)\n  app.get(\"/api/invitation-links\", authMiddleware, async (req, res) => {\n    try {\n      const links = await storage.getExpertInvitationLinks();\n      res.json(links);\n    } catch (error) {\n      res.status(500).json({ error: \"Failed to fetch invitation links\" });\n    }\n  });\n\n  // List invites by project (with role-based access control)\n  app.get(\"/api/projects/:projectId/invites\", authMiddleware, async (req, res) => {\n    try {\n      const projectId = parseInt(req.params.projectId);\n      const user = (req as any).user;\n      \n      // RAs can only see invites for projects they're assigned to\n      if (user.role === \"ra\" || user.role === \"Research Associate\") {\n        const project = await storage.getProject(projectId);\n        if (!project) {\n          return res.status(404).json({ error: \"Project not found\" });\n        }\n        const hasAccess = raHasProjectAccess(project, user.id);\n        if (!hasAccess) {\n          return res.status(403).json({ error: \"Access denied - not assigned to this project\" });\n        }\n      }\n      \n      const links = await storage.getExpertInvitationLinksByProject(projectId);\n      res.json(links);\n    } catch (error) {\n      res.status(500).json({ error: \"Failed to fetch project invites\" });\n    }\n  });\n\n  // List invites by RA (with role-based access control)\n  app.get(\"/api/ras/:raId/invites\", authMiddleware, async (req, res) => {\n    try {\n      const raId = parseInt(req.params.raId);\n      const user = (req as any).user;\n      \n      // RAs can only see their own invites\n      if ((user.role === \"ra\" || user.role === \"Research Associate\") && user.id !== raId) {\n        return res.status(403).json({ error: \"Access denied - can only view your own invites\" });\n      }\n      \n      const links = await storage.getExpertInvitationLinksByRa(raId);\n      res.json(links);\n    } catch (error) {\n      res.status(500).json({ error: \"Failed to fetch RA invites\" });\n    }\n  });\n\n  app.get(\"/api/invitation-links/:token\", async (req, res) => {\n    try {\n      const token = req.params.token;\n      const link = await storage.getExpertInvitationLinkByToken(token);\n      if (!link) {\n        return res.status(404).json({ error: \"Invitation link not found\" });\n      }\n      if (link.usedAt) {\n        return res.status(400).json({ error: \"Invitation link already used\" });\n      }\n      if (link.expiresAt && new Date(link.expiresAt) < new Date()) {\n        return res.status(400).json({ error: \"Invitation link expired\" });\n      }\n      res.json(link);\n    } catch (error) {\n      res.status(500).json({ error: \"Failed to fetch invitation link\" });\n    }\n  });\n\n  app.post(\"/api/invitation-links\", authMiddleware, async (req, res) => {\n    try {\n      const token = crypto.randomBytes(32).toString(\"hex\");\n      const result = insertExpertInvitationLinkSchema.safeParse({\n        ...req.body,\n        token,\n      });\n      if (!result.success) {\n        return res.status(400).json({ error: fromZodError(result.error).message });\n      }\n      const link = await storage.createExpertInvitationLink(result.data);\n      res.status(201).json(link);\n    } catch (error) {\n      res.status(500).json({ error: \"Failed to create invitation link\" });\n    }\n  });\n\n  // Register expert via invitation link\n  app.post(\"/api/register-expert/:token\", async (req, res) => {\n    try {\n      const token = req.params.token;\n      const link = await storage.getExpertInvitationLinkByToken(token);\n      \n      if (!link) {\n        return res.status(404).json({ error: \"Invitation link not found\" });\n      }\n      if (link.usedAt) {\n        return res.status(400).json({ error: \"Invitation link already used\" });\n      }\n      if (link.expiresAt && new Date(link.expiresAt) < new Date()) {\n        return res.status(400).json({ error: \"Invitation link expired\" });\n      }\n\n      const expertData = {\n        ...req.body,\n        recruitedBy: link.recruitedBy,\n      };\n\n      const result = insertExpertSchema.safeParse(expertData);\n      if (!result.success) {\n        return res.status(400).json({ error: fromZodError(result.error).message });\n      }\n\n      const expert = await storage.createExpert(result.data);\n      await storage.markInvitationLinkUsed(token);\n\n      // If link is for a specific project, auto-assign expert\n      if (link.projectId) {\n        await storage.createProjectExpert({\n          projectId: link.projectId,\n          expertId: expert.id,\n          status: \"assigned\",\n        });\n      }\n\n      res.status(201).json(expert);\n    } catch (error) {\n      res.status(500).json({ error: \"Failed to register expert\" });\n    }\n  });\n\n  // ==================== EXPERT ONBOARDING (NEW FLOW) ====================\n  // GET /api/invite/:projectId/:inviteType/:token - Validate invitation and get project/vetting questions\n  app.get(\"/api/invite/:projectId/:inviteType/:token\", async (req, res) => {\n    try {\n      const { projectId, inviteType, token } = req.params;\n      const projectIdNum = parseInt(projectId);\n      \n      // Validate the invitation link\n      const link = await storage.getExpertInvitationLinkByToken(token);\n      \n      if (!link) {\n        return res.status(404).json({ error: \"Invitation link not found\" });\n      }\n      if (link.usedAt) {\n        return res.status(400).json({ error: \"Invitation link already used\" });\n      }\n      if (link.expiresAt && new Date(link.expiresAt) < new Date()) {\n        return res.status(400).json({ error: \"Invitation link expired\" });\n      }\n      \n      // Verify project ID matches\n      if (link.projectId !== projectIdNum) {\n        return res.status(400).json({ error: \"Invalid invitation link for this project\" });\n      }\n      \n      // Get project details\n      const project = await storage.getProject(projectIdNum);\n      if (!project) {\n        return res.status(404).json({ error: \"Project not found\" });\n      }\n      \n      // Get vetting questions\n      const vettingQuestions = await storage.getVettingQuestionsByProject(projectIdNum);\n      \n      // Get RA information if recruited by specific RA\n      let recruitedByRaId: number | null = null;\n      if (link.recruitedBy) {\n        const raUser = await storage.getUserByEmail(link.recruitedBy);\n        if (raUser && (raUser.role === \"ra\" || raUser.role === \"Research Associate\")) {\n          recruitedByRaId = raUser.id;\n        }\n      }\n      \n      res.json({\n        project: {\n          id: project.id,\n          name: project.name,\n          clientName: project.clientName,\n          industry: project.industry,\n          projectOverview: project.projectOverview,\n          description: project.description,\n        },\n        vettingQuestions: vettingQuestions.map(q => ({\n          id: q.id,\n          question: q.question,\n          orderIndex: q.orderIndex,\n          isRequired: q.isRequired,\n        })),\n        recruitedBy: link.recruitedBy,\n        recruitedByRaId,\n      });\n    } catch (error) {\n      console.error(\"Get invitation error:\", error);\n      res.status(500).json({ error: \"Failed to fetch invitation details\" });\n    }\n  });\n\n  // POST /api/invite/:projectId/:inviteType/:token/submit - Submit expert registration\n  app.post(\"/api/invite/:projectId/:inviteType/:token/submit\", async (req, res) => {\n    try {\n      const { projectId, inviteType, token } = req.params;\n      const projectIdNum = parseInt(projectId);\n      \n      // Validate the invitation link again\n      const link = await storage.getExpertInvitationLinkByToken(token);\n      \n      if (!link) {\n        return res.status(404).json({ error: \"Invitation link not found\" });\n      }\n      if (link.usedAt) {\n        return res.status(400).json({ error: \"Invitation link already used\" });\n      }\n      if (link.expiresAt && new Date(link.expiresAt) < new Date()) {\n        return res.status(400).json({ error: \"Invitation link expired\" });\n      }\n      if (link.projectId !== projectIdNum) {\n        return res.status(400).json({ error: \"Invalid invitation link for this project\" });\n      }\n      \n      const {\n        email,\n        password,\n        firstName,\n        lastName,\n        country,\n        region,\n        countryCode,\n        phoneNumber,\n        linkedinUrl,\n        city,\n        canConsultInEnglish,\n        timezone,\n        experiences,\n        biography,\n        workHistory,\n        hourlyRate,\n        currency,\n        vqAnswers,\n      } = req.body;\n      \n      // Check if expert with email already exists\n      const existingExpert = await storage.getExpertByEmail(email);\n      if (existingExpert) {\n        return res.status(400).json({ error: \"An expert with this email already exists\" });\n      }\n      \n      // Hash password for expert login (future use)\n      const passwordHash = await hashPassword(password);\n      \n      // Get RA ID for sourcedByRaId\n      let sourcedByRaId: number | null = null;\n      if (link.recruitedBy) {\n        const raUser = await storage.getUserByEmail(link.recruitedBy);\n        if (raUser && (raUser.role === \"ra\" || raUser.role === \"Research Associate\")) {\n          sourcedByRaId = raUser.id;\n        }\n      }\n      \n      // Format phone number\n      const fullPhone = `${countryCode} ${phoneNumber}`.trim();\n      \n      // Format experience for bio/company/job title\n      const currentExperience = experiences.find((e: any) => e.isCurrent) || experiences[0];\n      const experienceText = experiences.map((e: any) => {\n        const period = e.isCurrent \n          ? `${e.fromMonth}/${e.fromYear} - Present`\n          : `${e.fromMonth}/${e.fromYear} - ${e.toMonth}/${e.toYear}`;\n        return `${e.title} at ${e.company} (${period})`;\n      }).join(\"\\n\");\n      \n      // Calculate years of experience from earliest date\n      const earliestYear = Math.min(...experiences.map((e: any) => parseInt(e.fromYear)));\n      const currentYear = new Date().getFullYear();\n      const yearsOfExperience = currentYear - earliestYear;\n      \n      // Create expert record with hashed password\n      const expertData = {\n        name: `${firstName} ${lastName}`,\n        email,\n        passwordHash,\n        phone: fullPhone,\n        linkedinUrl: linkedinUrl || null,\n        country,\n        timezone,\n        whatsapp: fullPhone,\n        expertise: currentExperience?.title || \"Expert\",\n        areasOfExpertise: [canConsultInEnglish === \"yes\" ? \"English consultations available\" : \"\"],\n        industry: \"Consulting\",\n        company: currentExperience?.company || \"\",\n        jobTitle: currentExperience?.title || \"\",\n        yearsOfExperience,\n        hourlyRate: hourlyRate,\n        bio: `${biography}\\n\\nWork History:\\n${workHistory}\\n\\nExperience:\\n${experienceText}`,\n        status: \"available\" as const,\n        recruitedBy: link.recruitedBy,\n        sourcedByRaId,\n        sourcedAt: new Date(),\n        termsAccepted: true,\n        lgpdAccepted: true,\n        billingInfo: `Currency: ${currency}, Region: ${region || \"\"}, City: ${city || \"\"}`,\n      };\n      \n      const result = insertExpertSchema.safeParse(expertData);\n      if (!result.success) {\n        return res.status(400).json({ error: fromZodError(result.error).message });\n      }\n      \n      const expert = await storage.createExpert(result.data);\n      \n      // Mark invitation link as used\n      await storage.markInvitationLinkUsed(token);\n      \n      // Get project for vetting question mapping\n      const project = await storage.getProject(projectIdNum);\n      const vettingQuestions = await storage.getVettingQuestionsByProject(projectIdNum);\n      \n      // Format VQ answers for storage\n      const formattedVqAnswers = vqAnswers.map((answer: { questionId: number; answer: string }) => {\n        const question = vettingQuestions.find(q => q.id === answer.questionId);\n        return {\n          questionId: answer.questionId,\n          questionText: question?.question || \"\",\n          answerText: answer.answer,\n        };\n      });\n      \n      // Create project-expert assignment with status \"interested\"\n      const invitationToken = crypto.randomBytes(32).toString(\"hex\");\n      await storage.createProjectExpert({\n        projectId: projectIdNum,\n        expertId: expert.id,\n        status: \"accepted\",\n        invitedAt: new Date(),\n        respondedAt: new Date(),\n        invitationToken,\n        vqAnswers: formattedVqAnswers,\n        notes: `Self-registered via invitation link. Invite type: ${inviteType}`,\n      });\n      \n      res.status(201).json({ \n        success: true, \n        expertId: expert.id,\n        message: \"Expert registered successfully\" \n      });\n    } catch (error) {\n      console.error(\"Expert registration error:\", error);\n      res.status(500).json({ error: \"Failed to register expert\" });\n    }\n  });\n\n  // ==================== EXISTING EXPERT PROJECT INVITE (Accept/Decline) ====================\n  // GET /api/expert/project-invite/:token - Get project invite details for existing expert\n  app.get(\"/api/expert/project-invite/:token\", async (req, res) => {\n    try {\n      const { token } = req.params;\n      \n      // Find the invitation link\n      const link = await storage.getExpertInvitationLinkByToken(token);\n      \n      if (!link) {\n        return res.status(404).json({ error: \"Invitation link not found\" });\n      }\n      if (link.inviteType !== \"existing\") {\n        return res.status(400).json({ error: \"Invalid invite type\" });\n      }\n      if (!link.isActive) {\n        return res.status(400).json({ error: \"Invitation link is no longer active\" });\n      }\n      if (link.expiresAt && new Date(link.expiresAt) < new Date()) {\n        return res.status(400).json({ error: \"Invitation link has expired\" });\n      }\n      if (!link.projectId || !link.expertId) {\n        return res.status(400).json({ error: \"Invalid invitation link\" });\n      }\n      \n      // Get project details\n      const project = await storage.getProject(link.projectId);\n      if (!project) {\n        return res.status(404).json({ error: \"Project not found\" });\n      }\n      \n      // Get expert details\n      const expert = await storage.getExpert(link.expertId);\n      if (!expert) {\n        return res.status(404).json({ error: \"Expert not found\" });\n      }\n      \n      // Get vetting questions\n      const allVettingQuestions = await storage.getVettingQuestionsByProject(link.projectId);\n      \n      // Get project angles for context\n      const angles = await storage.getProjectAngles(link.projectId);\n      \n      // Filter VQs based on angleIds if specified in the link\n      let vettingQuestions = allVettingQuestions;\n      let relevantAngles: typeof angles = [];\n      \n      if (link.angleIds && link.angleIds.length > 0) {\n        // Include VQs that belong to the specified angles or have no angle (general)\n        vettingQuestions = allVettingQuestions.filter(q => \n          q.angleId === null || link.angleIds!.includes(q.angleId)\n        );\n        // Only include relevant angles\n        relevantAngles = angles.filter(a => link.angleIds!.includes(a.id));\n      } else {\n        // No angle filter - include all VQs\n        relevantAngles = angles;\n      }\n      \n      // Get project-expert assignment\n      const projectExperts = await storage.getProjectExpertsByProject(link.projectId);\n      const assignment = projectExperts.find(pe => pe.expertId === link.expertId);\n      \n      // Update invitation status to \"opened\" if not already responded\n      if (assignment && assignment.invitationStatus !== \"accepted\" && assignment.invitationStatus !== \"declined\") {\n        await storage.updateProjectExpert(assignment.id, {\n          invitationStatus: \"opened\",\n          openedAt: new Date(),\n          lastActivityAt: new Date(),\n        });\n        \n        // Log activity\n        await storage.createProjectActivity({\n          projectId: link.projectId,\n          expertId: link.expertId,\n          activityType: \"expert_opened\",\n          description: `Expert ${expert.name} opened the project invitation`,\n        });\n      }\n      \n      res.json({\n        project: {\n          id: project.id,\n          name: project.name,\n          clientName: project.clientName,\n          clientCompany: project.clientCompany,\n          industry: project.industry,\n          region: project.region,\n          projectOverview: project.projectOverview,\n          description: project.description,\n        },\n        expert: {\n          id: expert.id,\n          name: expert.name,\n          email: expert.email,\n        },\n        angles: relevantAngles.map(a => ({\n          id: a.id,\n          title: a.title,\n          description: a.description,\n        })),\n        vettingQuestions: vettingQuestions.map(q => ({\n          id: q.id,\n          question: q.question,\n          orderIndex: q.orderIndex,\n          isRequired: q.isRequired,\n          angleId: q.angleId,\n          questionType: q.questionType,\n        })),\n        currentStatus: assignment?.invitationStatus || \"not_invited\",\n        hasResponded: assignment?.invitationStatus === \"accepted\" || assignment?.invitationStatus === \"declined\",\n      });\n    } catch (error) {\n      console.error(\"Get project invite error:\", error);\n      res.status(500).json({ error: \"Failed to fetch project invite details\" });\n    }\n  });\n\n  // POST /api/expert/project-invite/:token/respond - Expert responds to project invite (Accept/Decline)\n  app.post(\"/api/expert/project-invite/:token/respond\", async (req, res) => {\n    try {\n      const { token } = req.params;\n      const { response, vqAnswers, availabilityNote } = req.body;\n      \n      if (!response || (response !== \"accept\" && response !== \"decline\")) {\n        return res.status(400).json({ error: \"Response must be 'accept' or 'decline'\" });\n      }\n      \n      // Find the invitation link\n      const link = await storage.getExpertInvitationLinkByToken(token);\n      \n      if (!link) {\n        return res.status(404).json({ error: \"Invitation link not found\" });\n      }\n      if (link.inviteType !== \"existing\") {\n        return res.status(400).json({ error: \"Invalid invite type\" });\n      }\n      if (!link.isActive) {\n        return res.status(400).json({ error: \"Invitation link is no longer active\" });\n      }\n      if (link.expiresAt && new Date(link.expiresAt) < new Date()) {\n        return res.status(400).json({ error: \"Invitation link has expired\" });\n      }\n      if (!link.projectId || !link.expertId) {\n        return res.status(400).json({ error: \"Invalid invitation link\" });\n      }\n      \n      // Get project and expert\n      const project = await storage.getProject(link.projectId);\n      const expert = await storage.getExpert(link.expertId);\n      \n      if (!project || !expert) {\n        return res.status(404).json({ error: \"Project or expert not found\" });\n      }\n      \n      // Get vetting questions for formatting answers\n      const vettingQuestions = await storage.getVettingQuestionsByProject(link.projectId);\n      \n      // Format VQ answers\n      const formattedVqAnswers = vqAnswers?.map((answer: { questionId: number; answer: string }) => {\n        const question = vettingQuestions.find(q => q.id === answer.questionId);\n        return {\n          questionId: answer.questionId,\n          questionText: question?.question || \"\",\n          answerText: answer.answer,\n        };\n      }) || [];\n      \n      // Get or create project-expert assignment\n      const projectExperts = await storage.getProjectExpertsByProject(link.projectId);\n      let assignment = projectExperts.find(pe => pe.expertId === link.expertId);\n      \n      const newStatus = response === \"accept\" ? \"accepted\" : \"declined\";\n      const newPipelineStatus = response === \"accept\" ? \"accepted\" : \"declined\";\n      \n      if (assignment) {\n        // Update existing assignment\n        await storage.updateProjectExpert(assignment.id, {\n          status: newStatus,\n          invitationStatus: newStatus,\n          pipelineStatus: newPipelineStatus,\n          respondedAt: new Date(),\n          lastActivityAt: new Date(),\n          vqAnswers: formattedVqAnswers.length > 0 ? formattedVqAnswers : assignment.vqAnswers,\n          availabilityNote: availabilityNote || assignment.availabilityNote,\n        });\n      } else {\n        // Create new assignment (shouldn't happen normally, but just in case)\n        await storage.createProjectExpert({\n          projectId: link.projectId,\n          expertId: link.expertId,\n          status: newStatus,\n          invitationStatus: newStatus,\n          pipelineStatus: newPipelineStatus,\n          sourceType: \"internal_db\",\n          invitedAt: link.createdAt,\n          respondedAt: new Date(),\n          invitationToken: token,\n          vqAnswers: formattedVqAnswers,\n          availabilityNote,\n        });\n      }\n      \n      // Mark invitation link as used and update status in a single coordinated update\n      const inviteStatus = response === \"accept\" ? \"accepted\" : \"declined\";\n      await storage.updateExpertInvitationLink(link.id, { \n        isActive: false,\n        usedAt: new Date(),\n        status: inviteStatus,\n      } as any);\n      \n      // Log activity\n      await storage.createProjectActivity({\n        projectId: link.projectId,\n        expertId: link.expertId,\n        activityType: response === \"accept\" ? \"expert_accepted\" : \"expert_declined\",\n        description: `Expert ${expert.name} ${response === \"accept\" ? \"accepted\" : \"declined\"} the project invitation`,\n        metadata: { response, hasVqAnswers: formattedVqAnswers.length > 0 } as Record<string, any>,\n      });\n      \n      res.json({ \n        success: true, \n        response,\n        message: response === \"accept\" \n          ? \"Thank you for accepting! The team will be in touch soon.\" \n          : \"Thank you for your response. We appreciate your time.\",\n      });\n    } catch (error) {\n      console.error(\"Project invite response error:\", error);\n      res.status(500).json({ error: \"Failed to submit response\" });\n    }\n  });\n\n  // ==================== USAGE RECORDS (LEGACY) ====================\n  app.get(\"/api/usage\", authMiddleware, async (req, res) => {\n    try {\n      const records = await storage.getUsageRecords();\n      res.json(records);\n    } catch (error) {\n      res.status(500).json({ error: \"Failed to fetch usage records\" });\n    }\n  });\n\n  app.post(\"/api/usage\", authMiddleware, async (req, res) => {\n    try {\n      const result = insertUsageRecordSchema.safeParse(req.body);\n      if (!result.success) {\n        return res.status(400).json({ error: fromZodError(result.error).message });\n      }\n      const record = await storage.createUsageRecord(result.data);\n      res.status(201).json(record);\n    } catch (error) {\n      res.status(500).json({ error: \"Failed to create usage record\" });\n    }\n  });\n\n  app.delete(\"/api/usage/:id\", authMiddleware, async (req, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      const deleted = await storage.deleteUsageRecord(id);\n      if (!deleted) {\n        return res.status(404).json({ error: \"Usage record not found\" });\n      }\n      res.status(204).send();\n    } catch (error) {\n      res.status(500).json({ error: \"Failed to delete usage record\" });\n    }\n  });\n\n  // ==================== CU CALCULATION UTILITY ====================\n  app.get(\"/api/calculate-cu\", (req, res) => {\n    try {\n      const minutes = parseInt(req.query.minutes as string) || 0;\n      const cu = calculateCU(minutes);\n      res.json({ minutes, cu });\n    } catch (error) {\n      res.status(500).json({ error: \"Failed to calculate CU\" });\n    }\n  });\n\n  // ==================== KPI & INCENTIVE DASHBOARD ====================\n  /**\n   * GET /api/kpi/my-monthly\n   * \n   * Returns monthly KPI data and incentive calculations for the authenticated user.\n   * All date filtering is done in America/Sao_Paulo timezone.\n   * \n   * Incentive Rules:\n   * - RA: R$250 per completed call (expert must be sourced by RA and call within 60 days of sourcing). Cap: R$2,500/month.\n   * - PM: R$70 per CU (Credit Unit = 1 hour). No cap.\n   * - Admin/Finance: See global totals for all calls.\n   */\n  app.get(\"/api/kpi/my-monthly\", authMiddleware, async (req: AuthRequest, res) => {\n    try {\n      const user = req.user;\n      if (!user) {\n        return res.status(401).json({ error: \"Unauthorized\" });\n      }\n\n      // Get current month boundaries in Brazil timezone (America/Sao_Paulo)\n      // Using date-fns-tz for proper DST handling\n      const BRAZIL_TZ = \"America/Sao_Paulo\";\n      const now = new Date();\n      \n      // Convert current UTC time to Brazil timezone\n      const brazilNow = toZonedTime(now, BRAZIL_TZ);\n      \n      const year = brazilNow.getFullYear();\n      const month = brazilNow.getMonth(); // 0-indexed\n      \n      // Get month boundaries in Brazil timezone\n      const monthStartInBrazil = startOfMonth(brazilNow);\n      const nextMonthStartInBrazil = addMonths(monthStartInBrazil, 1);\n      \n      // Convert back to UTC for database queries (DST-safe)\n      // Use start of next month as exclusive upper bound\n      const monthStartUTC = fromZonedTime(monthStartInBrazil, BRAZIL_TZ);\n      const monthEndUTC = fromZonedTime(nextMonthStartInBrazil, BRAZIL_TZ);\n\n      // Base query: get all completed call records for this month with joins\n      const baseQuery = await db\n        .select({\n          id: callRecords.id,\n          projectId: callRecords.projectId,\n          expertId: callRecords.expertId,\n          pmId: callRecords.pmId,\n          raId: callRecords.raId,\n          durationMinutes: callRecords.durationMinutes,\n          cuUsed: callRecords.cuUsed,\n          completedAt: callRecords.completedAt,\n          callDate: callRecords.callDate,\n          status: callRecords.status,\n          projectName: projects.name,\n          clientName: projects.clientName,\n          cuRatePerCU: projects.cuRatePerCU,\n          expertName: experts.name,\n          expertSourcedByRaId: experts.sourcedByRaId,\n          expertSourcedAt: experts.sourcedAt,\n        })\n        .from(callRecords)\n        .innerJoin(projects, eq(callRecords.projectId, projects.id))\n        .innerJoin(experts, eq(callRecords.expertId, experts.id))\n        .where(\n          and(\n            eq(callRecords.status, \"completed\"),\n            sql`${callRecords.completedAt} IS NOT NULL`,\n            gte(callRecords.completedAt, monthStartUTC),\n            lt(callRecords.completedAt, monthEndUTC)\n          )\n        );\n\n      let filteredCalls: typeof baseQuery = [];\n      let totals = {\n        totalCalls: 0,\n        totalCU: 0,\n        incentive: 0,\n      };\n\n      const role = user.role;\n      const userId = user.id;\n\n      if (role === \"ra\" || role === \"Research Associate\") {\n        // RA: Only calls where expert was sourced by this RA AND call completed within 60 days of sourcing\n        filteredCalls = baseQuery.filter((call) => {\n          if (call.expertSourcedByRaId !== userId) return false;\n          if (!call.expertSourcedAt || !call.completedAt) return false;\n          \n          const sourcedAt = new Date(call.expertSourcedAt);\n          const completedAt = new Date(call.completedAt);\n          const daysDiff = (completedAt.getTime() - sourcedAt.getTime()) / (1000 * 60 * 60 * 24);\n          \n          return daysDiff <= 60;\n        });\n\n        totals.totalCalls = filteredCalls.length;\n        totals.totalCU = filteredCalls.reduce((sum, call) => sum + parseFloat(call.cuUsed || \"0\"), 0);\n        const rawIncentive = totals.totalCalls * 250;\n        totals.incentive = Math.min(rawIncentive, 2500); // Cap at R$2,500\n\n      } else if (role === \"pm\") {\n        // PM: Calls where pmId = current user\n        filteredCalls = baseQuery.filter((call) => call.pmId === userId);\n\n        totals.totalCalls = filteredCalls.length;\n        totals.totalCU = filteredCalls.reduce((sum, call) => sum + parseFloat(call.cuUsed || \"0\"), 0);\n        totals.incentive = Math.round(totals.totalCU * 70 * 100) / 100; // R$70 per CU, no cap\n\n      } else if (role === \"admin\" || role === \"finance\") {\n        // Admin/Finance: See all calls (global totals) with company revenue\n        filteredCalls = baseQuery;\n\n        totals.totalCalls = filteredCalls.length;\n        totals.totalCU = filteredCalls.reduce((sum, call) => sum + parseFloat(call.cuUsed || \"0\"), 0);\n        // Admin/Finance do not have incentive calculations\n        totals.incentive = 0;\n      }\n\n      // Calculate company revenue for admin/finance\n      let totalCompanyRevenueUSD = 0;\n      \n      // Format calls for response\n      const calls = filteredCalls.map((call) => {\n        const callDate = call.completedAt || call.callDate;\n        // Convert to Brazil timezone for display using date-fns-tz\n        const brazilTime = toZonedTime(new Date(callDate), BRAZIL_TZ);\n        \n        const cuUsed = parseFloat(call.cuUsed || \"0\");\n        const cuRate = parseFloat(call.cuRatePerCU || \"1150\");\n        const revenueUSD = cuUsed * cuRate;\n        \n        // Only add to company total if admin/finance role\n        if (role === \"admin\" || role === \"finance\") {\n          totalCompanyRevenueUSD += revenueUSD;\n        }\n        \n        return {\n          id: call.id,\n          interviewDate: format(brazilTime, \"yyyy-MM-dd'T'HH:mm:ssXXX\", { timeZone: BRAZIL_TZ }),\n          expertName: call.expertName,\n          projectName: call.projectName,\n          clientName: call.clientName,\n          cuUsed: cuUsed,\n          cuRatePerCU: cuRate,\n          revenueUSD: Math.round(revenueUSD * 100) / 100,\n        };\n      });\n\n      // Round totals\n      totals.totalCU = Math.round(totals.totalCU * 100) / 100;\n      totalCompanyRevenueUSD = Math.round(totalCompanyRevenueUSD * 100) / 100;\n\n      // Add company revenue to response for admin/finance\n      const responseData: any = {\n        role,\n        period: {\n          month: month + 1, // 1-indexed for display\n          year,\n          timezone: \"America/Sao_Paulo\",\n        },\n        totals,\n        calls,\n      };\n      \n      if (role === \"admin\" || role === \"finance\") {\n        responseData.companyTotals = {\n          totalCompanyCU: totals.totalCU,\n          totalCompanyCalls: totals.totalCalls,\n          totalCompanyRevenueUSD: totalCompanyRevenueUSD,\n        };\n      }\n\n      res.json(responseData);\n    } catch (error) {\n      console.error(\"KPI endpoint error:\", error);\n      res.status(500).json({ error: \"Failed to fetch KPI data\" });\n    }\n  });\n\n  /**\n   * GET /api/employees/:id/overview\n   * \n   * Returns detailed employee overview including KPIs and accounts.\n   * Only accessible by admin and finance roles.\n   */\n  app.get(\"/api/employees/:id/overview\", authMiddleware, requireRoles(\"admin\", \"finance\"), async (req: AuthRequest, res) => {\n    try {\n      const employeeId = parseInt(req.params.id);\n      \n      // Get employee basic info\n      const employee = await storage.getUser(employeeId);\n      if (!employee) {\n        return res.status(404).json({ error: \"Employee not found\" });\n      }\n\n      // Get current month boundaries in Brazil timezone\n      const BRAZIL_TZ = \"America/Sao_Paulo\";\n      const now = new Date();\n      const brazilNow = toZonedTime(now, BRAZIL_TZ);\n      const year = brazilNow.getFullYear();\n      const month = brazilNow.getMonth();\n      const monthStartInBrazil = startOfMonth(brazilNow);\n      const nextMonthStartInBrazil = addMonths(monthStartInBrazil, 1);\n      const monthStartUTC = fromZonedTime(monthStartInBrazil, BRAZIL_TZ);\n      const monthEndUTC = fromZonedTime(nextMonthStartInBrazil, BRAZIL_TZ);\n\n      // Get all completed calls this month with full details\n      const allCalls = await db\n        .select({\n          id: callRecords.id,\n          projectId: callRecords.projectId,\n          expertId: callRecords.expertId,\n          pmId: callRecords.pmId,\n          raId: callRecords.raId,\n          durationMinutes: callRecords.durationMinutes,\n          cuUsed: callRecords.cuUsed,\n          completedAt: callRecords.completedAt,\n          callDate: callRecords.callDate,\n          status: callRecords.status,\n          projectName: projects.name,\n          clientName: projects.clientName,\n          clientOrganizationId: projects.clientOrganizationId,\n          cuRatePerCU: projects.cuRatePerCU,\n          projectPmId: projects.createdByPmId,\n          expertName: experts.name,\n          expertSourcedByRaId: experts.sourcedByRaId,\n          expertSourcedAt: experts.sourcedAt,\n        })\n        .from(callRecords)\n        .innerJoin(projects, eq(callRecords.projectId, projects.id))\n        .innerJoin(experts, eq(callRecords.expertId, experts.id))\n        .where(\n          and(\n            eq(callRecords.status, \"completed\"),\n            sql`${callRecords.completedAt} IS NOT NULL`,\n            gte(callRecords.completedAt, monthStartUTC),\n            lt(callRecords.completedAt, monthEndUTC)\n          )\n        );\n\n      // Filter calls based on employee role\n      let filteredCalls: typeof allCalls = [];\n      let kpi = {\n        totalCU: 0,\n        completedCalls: 0,\n        incentive: 0,\n      };\n      \n      const role = employee.role;\n\n      if (role === \"ra\" || role === \"Research Associate\") {\n        // RA: Calls where expert was sourced by this RA AND within 60 days\n        filteredCalls = allCalls.filter((call) => {\n          if (call.expertSourcedByRaId !== employeeId) return false;\n          if (!call.expertSourcedAt || !call.completedAt) return false;\n          \n          const sourcedAt = new Date(call.expertSourcedAt);\n          const completedAt = new Date(call.completedAt);\n          const daysDiff = (completedAt.getTime() - sourcedAt.getTime()) / (1000 * 60 * 60 * 24);\n          \n          return daysDiff <= 60;\n        });\n\n        kpi.completedCalls = filteredCalls.length;\n        kpi.totalCU = filteredCalls.reduce((sum, call) => sum + parseFloat(call.cuUsed || \"0\"), 0);\n        const rawIncentive = kpi.completedCalls * 250;\n        kpi.incentive = Math.min(rawIncentive, 2500); // Cap at R$2,500\n\n      } else if (role === \"pm\") {\n        // PM: Calls where pmId = this employee\n        filteredCalls = allCalls.filter((call) => call.pmId === employeeId);\n\n        kpi.completedCalls = filteredCalls.length;\n        kpi.totalCU = filteredCalls.reduce((sum, call) => sum + parseFloat(call.cuUsed || \"0\"), 0);\n        kpi.incentive = Math.round(kpi.totalCU * 70 * 100) / 100; // R$70 per CU\n\n      } else if (role === \"admin\" || role === \"finance\") {\n        // Admin/Finance: No personal calls, no incentive\n        filteredCalls = [];\n        kpi.completedCalls = 0;\n        kpi.totalCU = 0;\n        kpi.incentive = 0;\n      }\n\n      // Round totalCU\n      kpi.totalCU = Math.round(kpi.totalCU * 100) / 100;\n\n      // Build accounts list - only for PM employees\n      let accounts: any[] = [];\n      \n      if (role === \"pm\") {\n        const accountsMap = new Map<string, {\n          clientId: number | null;\n          clientName: string;\n          totalCUThisMonth: number;\n          completedCallsThisMonth: number;\n          revenueThisMonthUSD: number;\n          lastActivityAt: Date | null;\n        }>();\n\n        // Process calls to build accounts\n        for (const call of filteredCalls) {\n          const clientKey = call.clientName;\n          const cuUsed = parseFloat(call.cuUsed || \"0\");\n          const cuRate = parseFloat(call.cuRatePerCU || \"1150\");\n          const revenueUSD = cuUsed * cuRate;\n          const completedAt = call.completedAt ? new Date(call.completedAt) : null;\n\n          if (!accountsMap.has(clientKey)) {\n            accountsMap.set(clientKey, {\n              clientId: call.clientOrganizationId,\n              clientName: call.clientName,\n              totalCUThisMonth: 0,\n              completedCallsThisMonth: 0,\n              revenueThisMonthUSD: 0,\n              lastActivityAt: null,\n            });\n          }\n\n          const account = accountsMap.get(clientKey)!;\n          account.totalCUThisMonth += cuUsed;\n          account.completedCallsThisMonth += 1;\n          account.revenueThisMonthUSD += revenueUSD;\n          \n          if (completedAt && (!account.lastActivityAt || completedAt > account.lastActivityAt)) {\n            account.lastActivityAt = completedAt;\n          }\n        }\n\n        // Convert accounts map to array and format\n        accounts = Array.from(accountsMap.values()).map((account) => ({\n          clientId: account.clientId,\n          clientName: account.clientName,\n          totalCUThisMonth: Math.round(account.totalCUThisMonth * 100) / 100,\n          completedCallsThisMonth: account.completedCallsThisMonth,\n          revenueThisMonthUSD: Math.round(account.revenueThisMonthUSD * 100) / 100,\n          contractedCU: null, // No contractedCU field exists yet\n          usageRate: null, // Cannot calculate without contractedCU\n          lastActivityAt: account.lastActivityAt \n            ? format(toZonedTime(account.lastActivityAt, BRAZIL_TZ), \"yyyy-MM-dd'T'HH:mm:ssXXX\", { timeZone: BRAZIL_TZ })\n            : null,\n        }));\n\n        // Sort accounts by revenue descending\n        accounts.sort((a, b) => b.revenueThisMonthUSD - a.revenueThisMonthUSD);\n      }\n\n      res.json({\n        employee: {\n          id: employee.id,\n          fullName: employee.fullName,\n          email: employee.email,\n          role: employee.role,\n          status: employee.isActive ? \"active\" : \"inactive\",\n          joinedAt: employee.createdAt,\n        },\n        kpi: {\n          period: {\n            month: month + 1,\n            year,\n            timezone: \"America/Sao_Paulo\",\n          },\n          totalCU: kpi.totalCU,\n          completedCalls: kpi.completedCalls,\n          incentive: kpi.incentive,\n        },\n        accounts,\n      });\n    } catch (error) {\n      console.error(\"Employee overview error:\", error);\n      res.status(500).json({ error: \"Failed to fetch employee overview\" });\n    }\n  });\n\n  // ==================== RA INCENTIVE ENDPOINTS ====================\n  \n  // GET /api/ra-incentives - Get all RAs incentive summary\n  app.get(\"/api/ra-incentives\", authMiddleware, async (req, res) => {\n    try {\n      const user = (req as any).user;\n      \n      // Admin, PM, and finance can view all RA incentives\n      if (![\"admin\", \"pm\", \"finance\"].includes(user.role)) {\n        return res.status(403).json({ error: \"Access denied\" });\n      }\n\n      const { fromDate, toDate } = req.query;\n      \n      const periodFromDate = fromDate ? new Date(fromDate as string) : undefined;\n      const periodToDate = toDate ? new Date(toDate as string) : undefined;\n\n      const summaries = await storage.getAllRaIncentiveSummary(periodFromDate, periodToDate);\n      \n      res.json({\n        period: {\n          fromDate: periodFromDate?.toISOString() || null,\n          toDate: periodToDate?.toISOString() || null,\n        },\n        incentivePerCallBRL: 250,\n        eligibilityWindowDays: 60,\n        summaries,\n      });\n    } catch (error) {\n      console.error(\"Error fetching RA incentives:\", error);\n      res.status(500).json({ error: \"Failed to fetch RA incentives\" });\n    }\n  });\n\n  // GET /api/ra-incentives/:raId - Get detailed incentive info for specific RA\n  app.get(\"/api/ra-incentives/:raId\", authMiddleware, async (req, res) => {\n    try {\n      const user = (req as any).user;\n      const raId = parseInt(req.params.raId);\n\n      // RAs can only view their own incentives, admin/pm/finance can view all\n      if (user.role === \"ra\" && user.id !== raId) {\n        return res.status(403).json({ error: \"Access denied\" });\n      }\n      \n      if (![\"admin\", \"pm\", \"finance\", \"ra\"].includes(user.role)) {\n        return res.status(403).json({ error: \"Access denied\" });\n      }\n\n      const { fromDate, toDate } = req.query;\n      \n      const periodFromDate = fromDate ? new Date(fromDate as string) : undefined;\n      const periodToDate = toDate ? new Date(toDate as string) : undefined;\n\n      const incentiveData = await storage.calculateRaIncentives(raId, periodFromDate, periodToDate);\n      \n      res.json({\n        period: {\n          fromDate: periodFromDate?.toISOString() || null,\n          toDate: periodToDate?.toISOString() || null,\n        },\n        incentivePerCallBRL: 250,\n        eligibilityWindowDays: 60,\n        ...incentiveData,\n      });\n    } catch (error) {\n      console.error(\"Error fetching RA incentive details:\", error);\n      res.status(500).json({ error: \"Failed to fetch RA incentive details\" });\n    }\n  });\n\n  // GET /api/experts-with-recruiter - Get experts with their recruiter info\n  app.get(\"/api/experts-with-recruiter\", authMiddleware, async (req, res) => {\n    try {\n      // Get all experts with recruiter info via a join\n      const expertsWithRecruiter = await db\n        .select({\n          id: experts.id,\n          name: experts.name,\n          email: experts.email,\n          phone: experts.phone,\n          expertise: experts.expertise,\n          industry: experts.industry,\n          company: experts.company,\n          jobTitle: experts.jobTitle,\n          yearsOfExperience: experts.yearsOfExperience,\n          hourlyRate: experts.hourlyRate,\n          status: experts.status,\n          createdAt: experts.createdAt,\n          sourcedByRaId: experts.sourcedByRaId,\n          sourcedAt: experts.sourcedAt,\n          recruiterName: users.fullName,\n          recruiterEmail: users.email,\n        })\n        .from(experts)\n        .leftJoin(users, eq(experts.sourcedByRaId, users.id))\n        .orderBy(desc(experts.createdAt));\n\n      res.json(expertsWithRecruiter);\n    } catch (error) {\n      console.error(\"Error fetching experts with recruiter:\", error);\n      res.status(500).json({ error: \"Failed to fetch experts\" });\n    }\n  });\n\n  // =====================================================\n  // SHORTLIST EXPORT ENDPOINT\n  // Export experts with pipelineStatus = \"interested\" as CSV\n  // Location: server/routes.ts - GET /api/projects/:projectId/export-shortlist\n  // =====================================================\n  app.get(\"/api/projects/:projectId/export-shortlist\", authMiddleware, async (req, res) => {\n    try {\n      const user = (req as any).user;\n      const projectId = parseInt(req.params.projectId);\n      \n      if (isNaN(projectId)) {\n        return res.status(400).json({ error: \"Invalid project ID\" });\n      }\n\n      // Authorization: admin and PM can export any project, RA only assigned projects\n      if (![\"admin\", \"pm\"].includes(user.role)) {\n        if (user.role === \"ra\") {\n          // Check if RA is assigned to this project\n          const project = await storage.getProject(projectId);\n          const isAssigned = project?.assignedRaIds?.includes(user.id);\n          if (!isAssigned) {\n            return res.status(403).json({ error: \"Access denied - not assigned to this project\" });\n          }\n        } else {\n          return res.status(403).json({ error: \"Access denied\" });\n        }\n      }\n\n      // Fetch all project experts with pipelineStatus = \"interested\" (shortlisted experts)\n      const shortlistedExperts = await db\n        .select({\n          projectExpertId: projectExperts.id,\n          expertId: projectExperts.expertId,\n          angleIds: projectExperts.angleIds,\n          pipelineStatus: projectExperts.pipelineStatus,\n          respondedAt: projectExperts.respondedAt,\n          lastActivityAt: projectExperts.lastActivityAt,\n          assignedAt: projectExperts.assignedAt,\n          sourcedByRaId: projectExperts.sourcedByRaId,\n          expertName: experts.name,\n          expertEmail: experts.email,\n          expertJobTitle: experts.jobTitle,\n          expertSourcedByRaId: experts.sourcedByRaId,\n          expertSourcedAt: experts.sourcedAt,\n        })\n        .from(projectExperts)\n        .innerJoin(experts, eq(projectExperts.expertId, experts.id))\n        .where(\n          and(\n            eq(projectExperts.projectId, projectId),\n            eq(projectExperts.pipelineStatus, \"interested\")\n          )\n        )\n        .orderBy(experts.name);\n\n      if (shortlistedExperts.length === 0) {\n        return res.status(404).json({ error: \"No shortlisted experts to export\" });\n      }\n\n      // Fetch angles for the project to map IDs to names\n      const angles = await db\n        .select()\n        .from(projectAngles)\n        .where(eq(projectAngles.projectId, projectId));\n      \n      const angleMap = new Map(angles.map(a => [a.id, a.title]));\n\n      // Fetch RA names for recruiting info\n      const raIdSet = new Set(\n        shortlistedExperts\n          .map(e => e.expertSourcedByRaId || e.sourcedByRaId)\n          .filter((id): id is number => id !== null)\n      );\n      const raIds = Array.from(raIdSet);\n      \n      let raMap = new Map<number, string>();\n      if (raIds.length > 0) {\n        const ras = await db\n          .select({ id: users.id, fullName: users.fullName })\n          .from(users)\n          .where(inArray(users.id, raIds));\n        raMap = new Map(ras.map(r => [r.id, r.fullName]));\n      }\n\n      // Helper function to escape CSV fields\n      const escapeCSV = (value: string | null | undefined): string => {\n        if (value === null || value === undefined) return \"\";\n        const str = String(value);\n        // If contains comma, quote, or newline, wrap in quotes and escape internal quotes\n        if (str.includes(\",\") || str.includes('\"') || str.includes(\"\\n\")) {\n          return `\"${str.replace(/\"/g, '\"\"')}\"`;\n        }\n        return str;\n      };\n\n      // CSV headers\n      const headers = [\n        \"Expert Name\",\n        \"Email\",\n        \"Title / Position\",\n        \"Angles\",\n        \"Status\",\n        \"Last Activity / Onboarding Date\",\n        \"Recruited By\",\n        \"Recruited At\",\n        \"Expert ID\"\n      ];\n\n      // Build CSV rows\n      const rows = shortlistedExperts.map(expert => {\n        // Get angle names from IDs\n        const angleNames = expert.angleIds\n          ? expert.angleIds.map(id => angleMap.get(id) || `Angle ${id}`).join(\"; \")\n          : \"\";\n        \n        // Determine last activity date\n        const lastActivityDate = expert.lastActivityAt || expert.respondedAt || expert.assignedAt;\n        const formattedDate = lastActivityDate \n          ? new Date(lastActivityDate).toISOString().split(\"T\")[0]\n          : \"\";\n\n        // Get recruiter info (prefer expert-level, fallback to project-expert level)\n        const recruiterId = expert.expertSourcedByRaId || expert.sourcedByRaId;\n        const recruiterName = recruiterId ? raMap.get(recruiterId) || \"\" : \"\";\n        \n        const recruitedAt = expert.expertSourcedAt \n          ? new Date(expert.expertSourcedAt).toISOString().split(\"T\")[0]\n          : \"\";\n\n        return [\n          escapeCSV(expert.expertName),\n          escapeCSV(expert.expertEmail),\n          escapeCSV(expert.expertJobTitle),\n          escapeCSV(angleNames),\n          \"Interested\", // Status is always \"Interested\" for shortlisted\n          escapeCSV(formattedDate),\n          escapeCSV(recruiterName),\n          escapeCSV(recruitedAt),\n          String(expert.expertId)\n        ].join(\",\");\n      });\n\n      // Combine headers and rows\n      const csvContent = [headers.join(\",\"), ...rows].join(\"\\n\");\n\n      // Set response headers for CSV download\n      res.setHeader(\"Content-Type\", \"text/csv; charset=utf-8\");\n      res.setHeader(\n        \"Content-Disposition\", \n        `attachment; filename=\"shortlist_project_${projectId}.csv\"`\n      );\n      res.send(csvContent);\n\n    } catch (error) {\n      console.error(\"Error exporting shortlist:\", error);\n      res.status(500).json({ error: \"Failed to export shortlist\" });\n    }\n  });\n\n  // =====================================================\n  // CLIENT SHORTLIST ENDPOINTS\n  // Feature: Client-facing shortlist of accepted experts with employment history, VQ answers, and availability\n  // Accepted status values: \"interested\", \"shortlisted\", \"accepted\" (excludes \"declined\", \"completed\")\n  // Location: server/routes.ts\n  // =====================================================\n\n  // GET /api/projects/:projectId/client-shortlist\n  // Returns accepted experts with full profile, employment history, VQ answers, and availability\n  app.get(\"/api/projects/:projectId/client-shortlist\", authMiddleware, async (req, res) => {\n    try {\n      const user = (req as any).user;\n      const projectId = parseInt(req.params.projectId);\n\n      if (isNaN(projectId)) {\n        return res.status(400).json({ error: \"Invalid project ID\" });\n      }\n\n      // Authorization: admin and PM can access any project, RA only assigned projects\n      if (![\"admin\", \"pm\"].includes(user.role)) {\n        if (user.role === \"ra\") {\n          const project = await storage.getProject(projectId);\n          const isAssigned = project?.assignedRaIds?.includes(user.id);\n          if (!isAssigned) {\n            return res.status(403).json({ error: \"Access denied - not assigned to this project\" });\n          }\n        } else {\n          return res.status(403).json({ error: \"Access denied\" });\n        }\n      }\n\n      // Get project details including vetting questions\n      const project = await storage.getProject(projectId);\n      if (!project) {\n        return res.status(404).json({ error: \"Project not found\" });\n      }\n\n      // Get project angles\n      const projectAnglesList = await storage.getProjectAngles(projectId);\n      const angleMap = new Map(projectAnglesList.map(a => [a.id, a.title]));\n\n      // Get vetting questions for this project\n      const vettingQuestionsList = await storage.getVettingQuestionsByProject(projectId);\n\n      // Accepted status values (experts who accepted the consultation)\n      const acceptedStatuses = [\"interested\", \"shortlisted\", \"accepted\", \"scheduled\"];\n\n      // Fetch accepted experts with full details\n      const acceptedExperts = await db\n        .select({\n          projectExpertId: projectExperts.id,\n          expertId: projectExperts.expertId,\n          pipelineStatus: projectExperts.pipelineStatus,\n          angleIds: projectExperts.angleIds,\n          vqAnswers: projectExperts.vqAnswers,\n          availabilityNote: projectExperts.availabilityNote,\n          availabilitySlots: projectExperts.availabilitySlots,\n          respondedAt: projectExperts.respondedAt,\n          // Expert details\n          expertName: experts.name,\n          expertEmail: experts.email,\n          expertJobTitle: experts.jobTitle,\n          expertCompany: experts.company,\n          expertCountry: experts.country,\n          expertCity: experts.city,\n          expertTimezone: experts.timezone,\n          expertYearsOfExperience: experts.yearsOfExperience,\n          expertIndustry: experts.industry,\n          expertExpertise: experts.expertise,\n          expertWorkHistory: experts.workHistory,\n          expertBiography: experts.biography,\n        })\n        .from(projectExperts)\n        .innerJoin(experts, eq(projectExperts.expertId, experts.id))\n        .where(\n          and(\n            eq(projectExperts.projectId, projectId),\n            inArray(projectExperts.pipelineStatus, acceptedStatuses)\n          )\n        )\n        .orderBy(desc(projectExperts.respondedAt));\n\n      // Format the response data\n      const clientShortlist = acceptedExperts.map(expert => {\n        // Get angle names\n        const angleNames = expert.angleIds\n          ? expert.angleIds.map(id => angleMap.get(id) || `Angle ${id}`)\n          : [];\n\n        // Format employment history (most recent first)\n        const workHistory = (expert.expertWorkHistory as Array<{ company: string; jobTitle: string; fromYear: number; toYear: number }>) || [];\n        const sortedWorkHistory = [...workHistory].sort((a, b) => (b.toYear || 9999) - (a.toYear || 9999));\n\n        // Format VQ answers - map question IDs to full questions\n        const vqAnswersFormatted = vettingQuestionsList.map(vq => {\n          const answer = expert.vqAnswers?.find(a => a.questionId === vq.id);\n          return {\n            questionId: vq.id,\n            questionText: vq.question,\n            answerText: answer?.answerText || null,\n            angleName: vq.angleId ? angleMap.get(vq.angleId) : null,\n          };\n        });\n\n        // Format availability slots\n        const availabilitySlots = (expert.availabilitySlots as Array<{ date: string; startTime: string; endTime: string; timezone: string }>) || [];\n\n        return {\n          projectExpertId: expert.projectExpertId,\n          expertId: expert.expertId,\n          pipelineStatus: expert.pipelineStatus,\n          angles: angleNames,\n          respondedAt: expert.respondedAt,\n          // Basic profile\n          profile: {\n            name: expert.expertName,\n            email: expert.expertEmail,\n            jobTitle: expert.expertJobTitle,\n            company: expert.expertCompany,\n            location: [expert.expertCity, expert.expertCountry].filter(Boolean).join(\", \") || null,\n            timezone: expert.expertTimezone,\n            yearsOfExperience: expert.expertYearsOfExperience,\n            industry: expert.expertIndustry,\n            expertise: expert.expertExpertise,\n            biography: expert.expertBiography,\n          },\n          // Employment history\n          employmentHistory: sortedWorkHistory.slice(0, 5), // Show up to 5 most recent roles\n          // VQ answers\n          vettingAnswers: vqAnswersFormatted,\n          // Availability\n          availability: {\n            note: expert.availabilityNote,\n            slots: availabilitySlots,\n          },\n        };\n      });\n\n      res.json({\n        projectId,\n        projectTitle: project.title,\n        totalExperts: clientShortlist.length,\n        experts: clientShortlist,\n      });\n\n    } catch (error) {\n      console.error(\"Error fetching client shortlist:\", error);\n      res.status(500).json({ error: \"Failed to fetch client shortlist\" });\n    }\n  });\n\n  // GET /api/projects/:projectId/client-shortlist-export\n  // Generates PDF export of client shortlist\n  app.get(\"/api/projects/:projectId/client-shortlist-export\", authMiddleware, async (req, res) => {\n    try {\n      const user = (req as any).user;\n      const projectId = parseInt(req.params.projectId);\n\n      if (isNaN(projectId)) {\n        return res.status(400).json({ error: \"Invalid project ID\" });\n      }\n\n      // Authorization: admin and PM can access any project, RA only assigned projects\n      if (![\"admin\", \"pm\"].includes(user.role)) {\n        if (user.role === \"ra\") {\n          const project = await storage.getProject(projectId);\n          const isAssigned = project?.assignedRaIds?.includes(user.id);\n          if (!isAssigned) {\n            return res.status(403).json({ error: \"Access denied - not assigned to this project\" });\n          }\n        } else {\n          return res.status(403).json({ error: \"Access denied\" });\n        }\n      }\n\n      // Get project details\n      const project = await storage.getProject(projectId);\n      if (!project) {\n        return res.status(404).json({ error: \"Project not found\" });\n      }\n\n      // Get project angles\n      const projectAnglesList = await storage.getProjectAngles(projectId);\n      const angleMap = new Map(projectAnglesList.map(a => [a.id, a.title]));\n\n      // Get vetting questions for this project\n      const vettingQuestionsList = await storage.getVettingQuestionsByProject(projectId);\n\n      // Accepted status values\n      const acceptedStatuses = [\"interested\", \"shortlisted\", \"accepted\", \"scheduled\"];\n\n      // Fetch accepted experts\n      const acceptedExperts = await db\n        .select({\n          projectExpertId: projectExperts.id,\n          expertId: projectExperts.expertId,\n          pipelineStatus: projectExperts.pipelineStatus,\n          angleIds: projectExperts.angleIds,\n          vqAnswers: projectExperts.vqAnswers,\n          availabilityNote: projectExperts.availabilityNote,\n          availabilitySlots: projectExperts.availabilitySlots,\n          expertName: experts.name,\n          expertEmail: experts.email,\n          expertJobTitle: experts.jobTitle,\n          expertCompany: experts.company,\n          expertCountry: experts.country,\n          expertCity: experts.city,\n          expertTimezone: experts.timezone,\n          expertYearsOfExperience: experts.yearsOfExperience,\n          expertIndustry: experts.industry,\n          expertWorkHistory: experts.workHistory,\n        })\n        .from(projectExperts)\n        .innerJoin(experts, eq(projectExperts.expertId, experts.id))\n        .where(\n          and(\n            eq(projectExperts.projectId, projectId),\n            inArray(projectExperts.pipelineStatus, acceptedStatuses)\n          )\n        )\n        .orderBy(desc(projectExperts.respondedAt));\n\n      if (acceptedExperts.length === 0) {\n        return res.status(404).json({ error: \"No accepted experts to export\" });\n      }\n\n      // Generate PDF using PDFKit\n      const doc = new PDFDocument({ \n        size: \"A4\",\n        margins: { top: 50, bottom: 50, left: 50, right: 50 }\n      });\n\n      // Set response headers for PDF download\n      res.setHeader(\"Content-Type\", \"application/pdf\");\n      res.setHeader(\n        \"Content-Disposition\",\n        `attachment; filename=\"client_shortlist_project_${projectId}.pdf\"`\n      );\n\n      // Pipe PDF to response\n      doc.pipe(res);\n\n      // Title page\n      doc.fontSize(24).font(\"Helvetica-Bold\").text(\"Client Shortlist\", { align: \"center\" });\n      doc.moveDown(0.5);\n      doc.fontSize(16).font(\"Helvetica\").text(project.title, { align: \"center\" });\n      doc.moveDown(0.5);\n      doc.fontSize(12).fillColor(\"#666666\").text(`Generated: ${new Date().toLocaleDateString()}`, { align: \"center\" });\n      doc.fillColor(\"#000000\");\n      doc.moveDown(0.5);\n      doc.fontSize(12).text(`Total Experts: ${acceptedExperts.length}`, { align: \"center\" });\n      doc.moveDown(2);\n\n      // Add each expert\n      acceptedExperts.forEach((expert, index) => {\n        // Add new page for each expert after the first\n        if (index > 0) {\n          doc.addPage();\n        }\n\n        // Expert header\n        doc.fontSize(18).font(\"Helvetica-Bold\").fillColor(\"#1a1a1a\");\n        doc.text(expert.expertName || \"Unknown Expert\");\n        doc.moveDown(0.3);\n        \n        // Title and company\n        if (expert.expertJobTitle || expert.expertCompany) {\n          doc.fontSize(12).font(\"Helvetica\").fillColor(\"#333333\");\n          const titleCompany = [expert.expertJobTitle, expert.expertCompany].filter(Boolean).join(\" at \");\n          doc.text(titleCompany);\n        }\n\n        // Location and experience\n        const location = [expert.expertCity, expert.expertCountry].filter(Boolean).join(\", \");\n        if (location || expert.expertYearsOfExperience) {\n          doc.fontSize(11).fillColor(\"#666666\");\n          const details = [];\n          if (location) details.push(location);\n          if (expert.expertYearsOfExperience) details.push(`${expert.expertYearsOfExperience} years experience`);\n          if (expert.expertTimezone) details.push(expert.expertTimezone);\n          doc.text(details.join(\" | \"));\n        }\n\n        // Angles\n        if (expert.angleIds && expert.angleIds.length > 0) {\n          const angleNames = expert.angleIds.map(id => angleMap.get(id) || `Angle ${id}`).join(\", \");\n          doc.fontSize(10).fillColor(\"#0066cc\").text(`Angles: ${angleNames}`);\n        }\n\n        doc.moveDown(1);\n        doc.fillColor(\"#000000\");\n\n        // Section 1: Employment History\n        doc.fontSize(14).font(\"Helvetica-Bold\").text(\"Employment History\");\n        doc.moveDown(0.3);\n\n        const workHistory = (expert.expertWorkHistory as Array<{ company: string; jobTitle: string; fromYear: number; toYear: number }>) || [];\n        const sortedHistory = [...workHistory].sort((a, b) => (b.toYear || 9999) - (a.toYear || 9999));\n\n        if (sortedHistory.length > 0) {\n          doc.fontSize(11).font(\"Helvetica\");\n          sortedHistory.slice(0, 5).forEach((job, i) => {\n            const years = job.toYear \n              ? `${job.fromYear} - ${job.toYear}`\n              : `${job.fromYear} - Present`;\n            doc.fillColor(\"#333333\").text(`${job.jobTitle}`, { continued: true });\n            doc.fillColor(\"#666666\").text(` at ${job.company} (${years})`);\n          });\n        } else {\n          doc.fontSize(11).font(\"Helvetica-Oblique\").fillColor(\"#999999\").text(\"No employment history available\");\n        }\n\n        doc.moveDown(1);\n        doc.fillColor(\"#000000\");\n\n        // Section 2: Vetting Questions & Answers\n        doc.fontSize(14).font(\"Helvetica-Bold\").text(\"Vetting Questions & Answers\");\n        doc.moveDown(0.3);\n\n        if (vettingQuestionsList.length > 0) {\n          doc.fontSize(11).font(\"Helvetica\");\n          vettingQuestionsList.forEach((vq, i) => {\n            const answer = expert.vqAnswers?.find((a: any) => a.questionId === vq.id);\n            const angleName = vq.angleId ? angleMap.get(vq.angleId) : null;\n            \n            // Question\n            doc.font(\"Helvetica-Bold\").fillColor(\"#333333\");\n            const questionPrefix = angleName ? `[${angleName}] ` : \"\";\n            doc.text(`Q${i + 1}: ${questionPrefix}${vq.question}`);\n            \n            // Answer\n            doc.font(\"Helvetica\").fillColor(\"#444444\");\n            const answerText = answer?.answerText || \"No answer provided\";\n            doc.text(`A${i + 1}: ${answerText}`);\n            doc.moveDown(0.5);\n          });\n        } else {\n          doc.fontSize(11).font(\"Helvetica-Oblique\").fillColor(\"#999999\").text(\"No vetting questions for this project\");\n        }\n\n        doc.moveDown(0.5);\n        doc.fillColor(\"#000000\");\n\n        // Section 3: Availability\n        doc.fontSize(14).font(\"Helvetica-Bold\").text(\"Availability\");\n        doc.moveDown(0.3);\n\n        const availabilitySlots = (expert.availabilitySlots as Array<{ date: string; startTime: string; endTime: string; timezone: string }>) || [];\n\n        if (availabilitySlots.length > 0) {\n          doc.fontSize(11).font(\"Helvetica\");\n          availabilitySlots.forEach(slot => {\n            doc.fillColor(\"#333333\").text(`${slot.date}, ${slot.startTime} - ${slot.endTime} (${slot.timezone})`);\n          });\n        } else if (expert.availabilityNote) {\n          doc.fontSize(11).font(\"Helvetica\").fillColor(\"#333333\").text(expert.availabilityNote);\n        } else {\n          doc.fontSize(11).font(\"Helvetica-Oblique\").fillColor(\"#999999\").text(\"No availability submitted yet\");\n        }\n\n        // Add horizontal line separator if not last expert\n        if (index < acceptedExperts.length - 1) {\n          doc.moveDown(2);\n        }\n      });\n\n      // Finalize PDF\n      doc.end();\n\n    } catch (error) {\n      console.error(\"Error exporting client shortlist:\", error);\n      res.status(500).json({ error: \"Failed to export client shortlist\" });\n    }\n  });\n\n  return httpServer;\n}\n","path":null,"size_bytes":148124,"size_tokens":null},"client/src/components/ui/card.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Card = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\n      \"shadcn-card rounded-xl border bg-card border-card-border text-card-foreground shadow-sm\",\n      className\n    )}\n    {...props}\n  />\n));\nCard.displayName = \"Card\"\n\nconst CardHeader = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"flex flex-col space-y-1.5 p-6\", className)}\n    {...props}\n  />\n));\nCardHeader.displayName = \"CardHeader\"\n\nconst CardTitle = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\n      \"text-2xl font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nCardTitle.displayName = \"CardTitle\"\n\nconst CardDescription = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n));\nCardDescription.displayName = \"CardDescription\"\n\nconst CardContent = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div ref={ref} className={cn(\"p-6 pt-0\", className)} {...props} />\n))\nCardContent.displayName = \"CardContent\"\n\nconst CardFooter = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"flex items-center p-6 pt-0\", className)}\n    {...props}\n  />\n))\nCardFooter.displayName = \"CardFooter\"\nexport {\n  Card,\n  CardHeader,\n  CardFooter,\n  CardTitle,\n  CardDescription,\n  CardContent,\n}\n","path":null,"size_bytes":1904,"size_tokens":null},"server/index.ts":{"content":"import express, { type Request, Response, NextFunction } from \"express\";\nimport { registerRoutes } from \"./routes\";\nimport { serveStatic } from \"./static\";\nimport { createServer } from \"http\";\n\nconst app = express();\nconst httpServer = createServer(app);\n\ndeclare module \"http\" {\n  interface IncomingMessage {\n    rawBody: unknown;\n  }\n}\n\napp.use(\n  express.json({\n    verify: (req, _res, buf) => {\n      req.rawBody = buf;\n    },\n  }),\n);\n\napp.use(express.urlencoded({ extended: false }));\n\nexport function log(message: string, source = \"express\") {\n  const formattedTime = new Date().toLocaleTimeString(\"en-US\", {\n    hour: \"numeric\",\n    minute: \"2-digit\",\n    second: \"2-digit\",\n    hour12: true,\n  });\n\n  console.log(`${formattedTime} [${source}] ${message}`);\n}\n\napp.use((req, res, next) => {\n  const start = Date.now();\n  const path = req.path;\n  let capturedJsonResponse: Record<string, any> | undefined = undefined;\n\n  const originalResJson = res.json;\n  res.json = function (bodyJson, ...args) {\n    capturedJsonResponse = bodyJson;\n    return originalResJson.apply(res, [bodyJson, ...args]);\n  };\n\n  res.on(\"finish\", () => {\n    const duration = Date.now() - start;\n    if (path.startsWith(\"/api\")) {\n      let logLine = `${req.method} ${path} ${res.statusCode} in ${duration}ms`;\n      if (capturedJsonResponse) {\n        logLine += ` :: ${JSON.stringify(capturedJsonResponse)}`;\n      }\n\n      log(logLine);\n    }\n  });\n\n  next();\n});\n\n(async () => {\n  await registerRoutes(httpServer, app);\n\n  app.use((err: any, _req: Request, res: Response, _next: NextFunction) => {\n    const status = err.status || err.statusCode || 500;\n    const message = err.message || \"Internal Server Error\";\n\n    res.status(status).json({ message });\n    throw err;\n  });\n\n  // importantly only setup vite in development and after\n  // setting up all the other routes so the catch-all route\n  // doesn't interfere with the other routes\n  if (process.env.NODE_ENV === \"production\") {\n    serveStatic(app);\n  } else {\n    const { setupVite } = await import(\"./vite\");\n    await setupVite(httpServer, app);\n  }\n\n  // ALWAYS serve the app on the port specified in the environment variable PORT\n  // Other ports are firewalled. Default to 5000 if not specified.\n  // this serves both the API and the client.\n  // It is the only port that is not firewalled.\n  const port = parseInt(process.env.PORT || \"5000\", 10);\n  httpServer.listen(\n    {\n      port,\n      host: \"0.0.0.0\",\n      reusePort: true,\n    },\n    () => {\n      log(`serving on port ${port}`);\n    },\n  );\n})();\n","path":null,"size_bytes":2560,"size_tokens":null},"replit.md":{"content":"# Mirae Connext Expert Network Platform\n\n## Overview\n\nMirae Connext is a B2B SaaS platform designed to streamline expert network services. Its core purpose is to empower organizations to efficiently manage project requests, expert profiles, vetting processes, assignments, and usage tracking. The platform aims to provide a professional, modern interface for optimized expert network operations, with a vision to become a leading solution in the expert network industry.\n\n## User Preferences\n\nPreferred communication style: Simple, everyday language.\n\n## System Architecture\n\n### Frontend\n\nThe frontend is built with React 18 and TypeScript, using Vite for development and Wouter for routing. It leverages shadcn/ui and Radix UI for accessible components, styled with Tailwind CSS and a custom theme system supporting light/dark modes (inspired by Linear and Notion). State management utilizes TanStack Query for server state and React Hook Form with Zod for form handling.\n\n### Backend\n\nThe backend is an Express.js application providing a RESTful API. It handles CRUD operations for core entities such as Projects, Experts, Vetting Questions, and Usage Records, with Zod for schema validation and robust error handling.\n\n### Data Storage\n\nPostgreSQL (Neon serverless) is used as the database, managed with Drizzle ORM for type-safe queries and schema migrations. The data model includes entities like Projects, Experts, Project Angles, Vetting Questions, and Call Records, designed to support comprehensive project management, expert profiling, and KPI calculations (e.g., `cuRatePerCU`, `sourcedByRaId`). A key feature is the \"Angles System\" which organizes vetting questions and expert associations by research angle. KPI and incentive calculations are integrated, providing metrics for RAs, PMs, and administrative/finance roles.\n\n### Core Features\n\n- **Force Password Change**: New users are required to change temporary passwords upon first login.\n- **Multi-language Expert Onboarding**: Experts are invited via project-specific links to a multi-language form to provide personal, professional, and vetting details.\n- **Enhanced Project Management**: A tabbed project detail page (`/projects/:id`) includes sections for Overview, Angles & Vetting Questions (with CRUD for organization), Existing Experts (for managing internal experts, invitations, and bulk operations), RA Sourcing (for assigning RAs and tracking experts), and Activity logs.\n- **Existing Expert Project Invite Flow**: Experts can accept/decline invitations, submit vetting answers, and provide availability notes via a public link without logging in.\n- **Expert Search Modal**: An advanced search feature within the project detail page allows filtering experts by numerous criteria including keywords, employer history, location, experience, and availability, with computed metrics like `priorProjectCount` and `acceptanceRate`. New expert fields like `city`, `pastEmployers`, `availableNow`, and `totalHoursWorked` enhance filtering capabilities.\n- **Token-Based Expert Invite Flow**: A frictionless process where experts can respond to project invitations via a public, time-limited tokenized link.\n- **Quick Invite Generator**: Lightweight invite flow in the RA-Sourced Experts Pipeline allowing RAs to quickly generate unique invite links by entering only candidate name + one contact method (LinkedIn, Email, or Phone).\n- **In-Project Expert Registration**: RAs can register new experts directly from the RA Sourcing tab via the \"Register Expert\" modal with full profile form, multi-language support, and unique token generation.\n- **RA Scoped Views**: RAs have restricted views, seeing only projects and consultations they are assigned to, with limited UI actions and financial data visibility.\n- **Unique Invite Tokens & History**: Each invitation generates a new unique token for better tracking. A centralized `/invites` page allows Admin, PM, and RA roles to view and manage invitation links with filtering and statistics.\n- **RA Incentive Tracking**: Comprehensive RA recruitment incentive system tracking experts sourced by RAs. Includes `sourcedByRaId` and `sourcedAt` timestamps on experts, incentive calculation (R$250 per completed call within 60 days of recruitment), and dedicated RA Performance dashboard (`/ra-performance`) accessible to Admin, PM, and Finance roles.\n- **Recruiter Info Display**: Experts list shows \"Recruited By\" and \"Recruited At\" columns. Expert profile modal displays recruitment details section when applicable.\n- **Shortlist Export**: CSV export functionality for \"Interested\" experts in Internal Experts Pipeline. Endpoint `GET /api/projects/:projectId/export-shortlist` generates CSV with expert details including name, email, position, angles, status, activity dates, recruiter info, and expert ID. Role-based authorization allows Admin, PM, and assigned RAs to export.\n- **Client Shortlist**: Dedicated page (`/projects/:id/client-shortlist`) displaying accepted experts (pipeline status: interested/shortlisted/accepted/scheduled) with beautiful HTML card-style profiles. Each card includes expert name, status badge, angle tags, work history table, bio, vetting Q&A, and availability. Features \"Copy Profile to Clipboard\" button for individual experts and \"Copy All Profiles\" for bulk copying - generates email-friendly inline HTML that preserves formatting when pasted into Gmail or Outlook. PDF export also available via `GET /api/projects/:id/client-shortlist-export`. All dynamic content is HTML-escaped for security. Authorization restricts access to Admin, PM, and assigned RAs.\n\n## External Dependencies\n\n- **UI Libraries**: @radix-ui/*, lucide-react, date-fns, date-fns-tz, embla-carousel-react, cmdk.\n- **Database & Backend**: @neondatabase/serverless, drizzle-orm, drizzle-kit, ws.\n- **Development Tools**: @replit/vite-plugin-*, tsx.\n- **Form & Validation**: react-hook-form, @hookform/resolvers, zod, drizzle-zod.\n- **Session Management**: express-session, connect-pg-simple (infrastructure present).","path":null,"size_bytes":6038,"size_tokens":null},"script/build.ts":{"content":"import { build as esbuild } from \"esbuild\";\nimport { build as viteBuild } from \"vite\";\nimport { rm, readFile } from \"fs/promises\";\n\n// server deps to bundle to reduce openat(2) syscalls\n// which helps cold start times\nconst allowlist = [\n  \"@google/generative-ai\",\n  \"@neondatabase/serverless\",\n  \"axios\",\n  \"connect-pg-simple\",\n  \"cors\",\n  \"date-fns\",\n  \"drizzle-orm\",\n  \"drizzle-zod\",\n  \"express\",\n  \"express-rate-limit\",\n  \"express-session\",\n  \"jsonwebtoken\",\n  \"memorystore\",\n  \"multer\",\n  \"nanoid\",\n  \"nodemailer\",\n  \"openai\",\n  \"passport\",\n  \"passport-local\",\n  \"stripe\",\n  \"uuid\",\n  \"ws\",\n  \"xlsx\",\n  \"zod\",\n  \"zod-validation-error\",\n];\n\nasync function buildAll() {\n  await rm(\"dist\", { recursive: true, force: true });\n\n  console.log(\"building client...\");\n  await viteBuild();\n\n  console.log(\"building server...\");\n  const pkg = JSON.parse(await readFile(\"package.json\", \"utf-8\"));\n  const allDeps = [\n    ...Object.keys(pkg.dependencies || {}),\n    ...Object.keys(pkg.devDependencies || {}),\n  ];\n  const externals = allDeps.filter((dep) => !allowlist.includes(dep));\n\n  await esbuild({\n    entryPoints: [\"server/index.ts\"],\n    platform: \"node\",\n    bundle: true,\n    format: \"cjs\",\n    outfile: \"dist/index.cjs\",\n    define: {\n      \"process.env.NODE_ENV\": '\"production\"',\n    },\n    minify: true,\n    external: externals,\n    logLevel: \"info\",\n  });\n}\n\nbuildAll().catch((err) => {\n  console.error(err);\n  process.exit(1);\n});\n","path":null,"size_bytes":1439,"size_tokens":null},"client/src/components/ui/radio-group.tsx":{"content":"import * as React from \"react\"\nimport * as RadioGroupPrimitive from \"@radix-ui/react-radio-group\"\nimport { Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst RadioGroup = React.forwardRef<\n  React.ElementRef<typeof RadioGroupPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof RadioGroupPrimitive.Root>\n>(({ className, ...props }, ref) => {\n  return (\n    <RadioGroupPrimitive.Root\n      className={cn(\"grid gap-2\", className)}\n      {...props}\n      ref={ref}\n    />\n  )\n})\nRadioGroup.displayName = RadioGroupPrimitive.Root.displayName\n\nconst RadioGroupItem = React.forwardRef<\n  React.ElementRef<typeof RadioGroupPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof RadioGroupPrimitive.Item>\n>(({ className, ...props }, ref) => {\n  return (\n    <RadioGroupPrimitive.Item\n      ref={ref}\n      className={cn(\n        \"aspect-square h-4 w-4 rounded-full border border-primary text-primary ring-offset-background focus:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50\",\n        className\n      )}\n      {...props}\n    >\n      <RadioGroupPrimitive.Indicator className=\"flex items-center justify-center\">\n        <Circle className=\"h-2.5 w-2.5 fill-current text-current\" />\n      </RadioGroupPrimitive.Indicator>\n    </RadioGroupPrimitive.Item>\n  )\n})\nRadioGroupItem.displayName = RadioGroupPrimitive.Item.displayName\n\nexport { RadioGroup, RadioGroupItem }\n","path":null,"size_bytes":1467,"size_tokens":null},"tailwind.config.ts":{"content":"import type { Config } from \"tailwindcss\";\n\nexport default {\n  darkMode: [\"class\"],\n  content: [\"./client/index.html\", \"./client/src/**/*.{js,jsx,ts,tsx}\"],\n  theme: {\n    extend: {\n      borderRadius: {\n        lg: \".5625rem\", /* 9px */\n        md: \".375rem\", /* 6px */\n        sm: \".1875rem\", /* 3px */\n      },\n      colors: {\n        // Flat / base colors (regular buttons)\n        background: \"hsl(var(--background) / <alpha-value>)\",\n        foreground: \"hsl(var(--foreground) / <alpha-value>)\",\n        border: \"hsl(var(--border) / <alpha-value>)\",\n        input: \"hsl(var(--input) / <alpha-value>)\",\n        card: {\n          DEFAULT: \"hsl(var(--card) / <alpha-value>)\",\n          foreground: \"hsl(var(--card-foreground) / <alpha-value>)\",\n          border: \"hsl(var(--card-border) / <alpha-value>)\",\n        },\n        popover: {\n          DEFAULT: \"hsl(var(--popover) / <alpha-value>)\",\n          foreground: \"hsl(var(--popover-foreground) / <alpha-value>)\",\n          border: \"hsl(var(--popover-border) / <alpha-value>)\",\n        },\n        primary: {\n          DEFAULT: \"hsl(var(--primary) / <alpha-value>)\",\n          foreground: \"hsl(var(--primary-foreground) / <alpha-value>)\",\n          border: \"var(--primary-border)\",\n        },\n        secondary: {\n          DEFAULT: \"hsl(var(--secondary) / <alpha-value>)\",\n          foreground: \"hsl(var(--secondary-foreground) / <alpha-value>)\",\n          border: \"var(--secondary-border)\",\n        },\n        muted: {\n          DEFAULT: \"hsl(var(--muted) / <alpha-value>)\",\n          foreground: \"hsl(var(--muted-foreground) / <alpha-value>)\",\n          border: \"var(--muted-border)\",\n        },\n        accent: {\n          DEFAULT: \"hsl(var(--accent) / <alpha-value>)\",\n          foreground: \"hsl(var(--accent-foreground) / <alpha-value>)\",\n          border: \"var(--accent-border)\",\n        },\n        destructive: {\n          DEFAULT: \"hsl(var(--destructive) / <alpha-value>)\",\n          foreground: \"hsl(var(--destructive-foreground) / <alpha-value>)\",\n          border: \"var(--destructive-border)\",\n        },\n        ring: \"hsl(var(--ring) / <alpha-value>)\",\n        chart: {\n          \"1\": \"hsl(var(--chart-1) / <alpha-value>)\",\n          \"2\": \"hsl(var(--chart-2) / <alpha-value>)\",\n          \"3\": \"hsl(var(--chart-3) / <alpha-value>)\",\n          \"4\": \"hsl(var(--chart-4) / <alpha-value>)\",\n          \"5\": \"hsl(var(--chart-5) / <alpha-value>)\",\n        },\n        sidebar: {\n          ring: \"hsl(var(--sidebar-ring) / <alpha-value>)\",\n          DEFAULT: \"hsl(var(--sidebar) / <alpha-value>)\",\n          foreground: \"hsl(var(--sidebar-foreground) / <alpha-value>)\",\n          border: \"hsl(var(--sidebar-border) / <alpha-value>)\",\n        },\n        \"sidebar-primary\": {\n          DEFAULT: \"hsl(var(--sidebar-primary) / <alpha-value>)\",\n          foreground: \"hsl(var(--sidebar-primary-foreground) / <alpha-value>)\",\n          border: \"var(--sidebar-primary-border)\",\n        },\n        \"sidebar-accent\": {\n          DEFAULT: \"hsl(var(--sidebar-accent) / <alpha-value>)\",\n          foreground: \"hsl(var(--sidebar-accent-foreground) / <alpha-value>)\",\n          border: \"var(--sidebar-accent-border)\"\n        },\n        status: {\n          online: \"rgb(34 197 94)\",\n          away: \"rgb(245 158 11)\",\n          busy: \"rgb(239 68 68)\",\n          offline: \"rgb(156 163 175)\",\n        },\n      },\n      fontFamily: {\n        sans: [\"var(--font-sans)\"],\n        serif: [\"var(--font-serif)\"],\n        mono: [\"var(--font-mono)\"],\n      },\n      keyframes: {\n        \"accordion-down\": {\n          from: { height: \"0\" },\n          to: { height: \"var(--radix-accordion-content-height)\" },\n        },\n        \"accordion-up\": {\n          from: { height: \"var(--radix-accordion-content-height)\" },\n          to: { height: \"0\" },\n        },\n      },\n      animation: {\n        \"accordion-down\": \"accordion-down 0.2s ease-out\",\n        \"accordion-up\": \"accordion-up 0.2s ease-out\",\n      },\n    },\n  },\n  plugins: [require(\"tailwindcss-animate\"), require(\"@tailwindcss/typography\")],\n} satisfies Config;\n","path":null,"size_bytes":4050,"size_tokens":null},"client/src/components/ui/carousel.tsx":{"content":"import * as React from \"react\"\nimport useEmblaCarousel, {\n  type UseEmblaCarouselType,\n} from \"embla-carousel-react\"\nimport { ArrowLeft, ArrowRight } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Button } from \"@/components/ui/button\"\n\ntype CarouselApi = UseEmblaCarouselType[1]\ntype UseCarouselParameters = Parameters<typeof useEmblaCarousel>\ntype CarouselOptions = UseCarouselParameters[0]\ntype CarouselPlugin = UseCarouselParameters[1]\n\ntype CarouselProps = {\n  opts?: CarouselOptions\n  plugins?: CarouselPlugin\n  orientation?: \"horizontal\" | \"vertical\"\n  setApi?: (api: CarouselApi) => void\n}\n\ntype CarouselContextProps = {\n  carouselRef: ReturnType<typeof useEmblaCarousel>[0]\n  api: ReturnType<typeof useEmblaCarousel>[1]\n  scrollPrev: () => void\n  scrollNext: () => void\n  canScrollPrev: boolean\n  canScrollNext: boolean\n} & CarouselProps\n\nconst CarouselContext = React.createContext<CarouselContextProps | null>(null)\n\nfunction useCarousel() {\n  const context = React.useContext(CarouselContext)\n\n  if (!context) {\n    throw new Error(\"useCarousel must be used within a <Carousel />\")\n  }\n\n  return context\n}\n\nconst Carousel = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement> & CarouselProps\n>(\n  (\n    {\n      orientation = \"horizontal\",\n      opts,\n      setApi,\n      plugins,\n      className,\n      children,\n      ...props\n    },\n    ref\n  ) => {\n    const [carouselRef, api] = useEmblaCarousel(\n      {\n        ...opts,\n        axis: orientation === \"horizontal\" ? \"x\" : \"y\",\n      },\n      plugins\n    )\n    const [canScrollPrev, setCanScrollPrev] = React.useState(false)\n    const [canScrollNext, setCanScrollNext] = React.useState(false)\n\n    const onSelect = React.useCallback((api: CarouselApi) => {\n      if (!api) {\n        return\n      }\n\n      setCanScrollPrev(api.canScrollPrev())\n      setCanScrollNext(api.canScrollNext())\n    }, [])\n\n    const scrollPrev = React.useCallback(() => {\n      api?.scrollPrev()\n    }, [api])\n\n    const scrollNext = React.useCallback(() => {\n      api?.scrollNext()\n    }, [api])\n\n    const handleKeyDown = React.useCallback(\n      (event: React.KeyboardEvent<HTMLDivElement>) => {\n        if (event.key === \"ArrowLeft\") {\n          event.preventDefault()\n          scrollPrev()\n        } else if (event.key === \"ArrowRight\") {\n          event.preventDefault()\n          scrollNext()\n        }\n      },\n      [scrollPrev, scrollNext]\n    )\n\n    React.useEffect(() => {\n      if (!api || !setApi) {\n        return\n      }\n\n      setApi(api)\n    }, [api, setApi])\n\n    React.useEffect(() => {\n      if (!api) {\n        return\n      }\n\n      onSelect(api)\n      api.on(\"reInit\", onSelect)\n      api.on(\"select\", onSelect)\n\n      return () => {\n        api?.off(\"select\", onSelect)\n      }\n    }, [api, onSelect])\n\n    return (\n      <CarouselContext.Provider\n        value={{\n          carouselRef,\n          api: api,\n          opts,\n          orientation:\n            orientation || (opts?.axis === \"y\" ? \"vertical\" : \"horizontal\"),\n          scrollPrev,\n          scrollNext,\n          canScrollPrev,\n          canScrollNext,\n        }}\n      >\n        <div\n          ref={ref}\n          onKeyDownCapture={handleKeyDown}\n          className={cn(\"relative\", className)}\n          role=\"region\"\n          aria-roledescription=\"carousel\"\n          {...props}\n        >\n          {children}\n        </div>\n      </CarouselContext.Provider>\n    )\n  }\n)\nCarousel.displayName = \"Carousel\"\n\nconst CarouselContent = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const { carouselRef, orientation } = useCarousel()\n\n  return (\n    <div ref={carouselRef} className=\"overflow-hidden\">\n      <div\n        ref={ref}\n        className={cn(\n          \"flex\",\n          orientation === \"horizontal\" ? \"-ml-4\" : \"-mt-4 flex-col\",\n          className\n        )}\n        {...props}\n      />\n    </div>\n  )\n})\nCarouselContent.displayName = \"CarouselContent\"\n\nconst CarouselItem = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const { orientation } = useCarousel()\n\n  return (\n    <div\n      ref={ref}\n      role=\"group\"\n      aria-roledescription=\"slide\"\n      className={cn(\n        \"min-w-0 shrink-0 grow-0 basis-full\",\n        orientation === \"horizontal\" ? \"pl-4\" : \"pt-4\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nCarouselItem.displayName = \"CarouselItem\"\n\nconst CarouselPrevious = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<typeof Button>\n>(({ className, variant = \"outline\", size = \"icon\", ...props }, ref) => {\n  const { orientation, scrollPrev, canScrollPrev } = useCarousel()\n\n  return (\n    <Button\n      ref={ref}\n      variant={variant}\n      size={size}\n      className={cn(\n        \"absolute  h-8 w-8 rounded-full\",\n        orientation === \"horizontal\"\n          ? \"-left-12 top-1/2 -translate-y-1/2\"\n          : \"-top-12 left-1/2 -translate-x-1/2 rotate-90\",\n        className\n      )}\n      disabled={!canScrollPrev}\n      onClick={scrollPrev}\n      {...props}\n    >\n      <ArrowLeft className=\"h-4 w-4\" />\n      <span className=\"sr-only\">Previous slide</span>\n    </Button>\n  )\n})\nCarouselPrevious.displayName = \"CarouselPrevious\"\n\nconst CarouselNext = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<typeof Button>\n>(({ className, variant = \"outline\", size = \"icon\", ...props }, ref) => {\n  const { orientation, scrollNext, canScrollNext } = useCarousel()\n\n  return (\n    <Button\n      ref={ref}\n      variant={variant}\n      size={size}\n      className={cn(\n        \"absolute h-8 w-8 rounded-full\",\n        orientation === \"horizontal\"\n          ? \"-right-12 top-1/2 -translate-y-1/2\"\n          : \"-bottom-12 left-1/2 -translate-x-1/2 rotate-90\",\n        className\n      )}\n      disabled={!canScrollNext}\n      onClick={scrollNext}\n      {...props}\n    >\n      <ArrowRight className=\"h-4 w-4\" />\n      <span className=\"sr-only\">Next slide</span>\n    </Button>\n  )\n})\nCarouselNext.displayName = \"CarouselNext\"\n\nexport {\n  type CarouselApi,\n  Carousel,\n  CarouselContent,\n  CarouselItem,\n  CarouselPrevious,\n  CarouselNext,\n}\n","path":null,"size_bytes":6210,"size_tokens":null},"client/src/components/ui/progress.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as ProgressPrimitive from \"@radix-ui/react-progress\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Progress = React.forwardRef<\n  React.ElementRef<typeof ProgressPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ProgressPrimitive.Root>\n>(({ className, value, ...props }, ref) => (\n  <ProgressPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative h-4 w-full overflow-hidden rounded-full bg-secondary\",\n      className\n    )}\n    {...props}\n  >\n    <ProgressPrimitive.Indicator\n      className=\"h-full w-full flex-1 bg-primary transition-all\"\n      style={{ transform: `translateX(-${100 - (value || 0)}%)` }}\n    />\n  </ProgressPrimitive.Root>\n))\nProgress.displayName = ProgressPrimitive.Root.displayName\n\nexport { Progress }\n","path":null,"size_bytes":791,"size_tokens":null},"server/storage.ts":{"content":"import {\n  projects,\n  experts,\n  vettingQuestions,\n  projectExperts,\n  usageRecords,\n  users,\n  clients,\n  clientOrganizations,\n  clientPocs,\n  callRecords,\n  expertInvitationLinks,\n  projectActivities,\n  projectAngles,\n  type Project,\n  type InsertProject,\n  type Expert,\n  type InsertExpert,\n  type VettingQuestion,\n  type InsertVettingQuestion,\n  type ProjectExpert,\n  type InsertProjectExpert,\n  type UsageRecord,\n  type InsertUsageRecord,\n  type User,\n  type InsertUser,\n  type Client,\n  type InsertClient,\n  type ClientOrganization,\n  type InsertClientOrganization,\n  type ClientPoc,\n  type InsertClientPoc,\n  type CallRecord,\n  type InsertCallRecord,\n  type ExpertInvitationLink,\n  type InsertExpertInvitationLink,\n  type ProjectActivity,\n  type InsertProjectActivity,\n  type ProjectAngle,\n  type InsertProjectAngle,\n  calculateCU,\n} from \"@shared/schema\";\nimport { db } from \"./db\";\nimport { eq, desc, ilike, or, and, sql, gte, lte } from \"drizzle-orm\";\n\nexport interface IStorage {\n  // Users (Employees)\n  getUsers(): Promise<User[]>;\n  getUser(id: number): Promise<User | undefined>;\n  getUserByEmail(email: string): Promise<User | undefined>;\n  createUser(user: InsertUser): Promise<User>;\n  updateUser(id: number, user: Partial<InsertUser>): Promise<User | undefined>;\n  deleteUser(id: number): Promise<boolean>;\n\n  // Clients (CRM)\n  getClients(): Promise<Client[]>;\n  getClient(id: number): Promise<Client | undefined>;\n  searchClients(params: { query?: string; industry?: string; status?: string }): Promise<Client[]>;\n  createClient(client: InsertClient): Promise<Client>;\n  updateClient(id: number, client: Partial<InsertClient>): Promise<Client | undefined>;\n  deleteClient(id: number): Promise<boolean>;\n\n  // Client Organizations\n  getClientOrganizations(): Promise<ClientOrganization[]>;\n  getClientOrganization(id: number): Promise<ClientOrganization | undefined>;\n  createClientOrganization(org: InsertClientOrganization): Promise<ClientOrganization>;\n  updateClientOrganization(id: number, org: Partial<InsertClientOrganization>): Promise<ClientOrganization | undefined>;\n  deleteClientOrganization(id: number): Promise<boolean>;\n\n  // Client POCs\n  getClientPocs(): Promise<ClientPoc[]>;\n  getClientPocsByOrganization(organizationId: number): Promise<ClientPoc[]>;\n  createClientPoc(poc: InsertClientPoc): Promise<ClientPoc>;\n  updateClientPoc(id: number, poc: Partial<InsertClientPoc>): Promise<ClientPoc | undefined>;\n  deleteClientPoc(id: number): Promise<boolean>;\n\n  // Projects\n  getProjects(): Promise<Project[]>;\n  getProject(id: number): Promise<Project | undefined>;\n  getProjectsByOrganization(organizationId: number): Promise<Project[]>;\n  getProjectsByPm(pmId: number): Promise<Project[]>;\n  getProjectsByAssignedRa(raId: number): Promise<Project[]>;\n  createProject(project: InsertProject): Promise<Project>;\n  updateProject(id: number, project: Partial<InsertProject>): Promise<Project | undefined>;\n  deleteProject(id: number): Promise<boolean>;\n\n  // Experts\n  getExperts(): Promise<Expert[]>;\n  getExpert(id: number): Promise<Expert | undefined>;\n  getExpertByEmail(email: string): Promise<Expert | undefined>;\n  searchExperts(query: string): Promise<Expert[]>;\n  searchExpertsAdvanced(params: {\n    query?: string;\n    country?: string;\n    currentEmployer?: string;\n    pastEmployers?: string;\n    minRate?: number;\n    maxRate?: number;\n    minYearsExperience?: number;\n    maxYearsExperience?: number;\n    jobTitle?: string;\n    industry?: string;\n    language?: string;\n    hasPriorProjects?: boolean;\n    minAcceptanceRate?: number;\n    minHoursWorked?: number;\n    availableOnly?: boolean;\n    excludeProjectId?: number;\n  }): Promise<(Expert & { priorProjectCount?: number; acceptanceRate?: number })[]>;\n  createExpert(expert: InsertExpert): Promise<Expert>;\n  updateExpert(id: number, expert: Partial<InsertExpert>): Promise<Expert | undefined>;\n  deleteExpert(id: number): Promise<boolean>;\n\n  // Project Angles\n  getProjectAngles(projectId: number): Promise<ProjectAngle[]>;\n  getProjectAngle(id: number): Promise<ProjectAngle | undefined>;\n  createProjectAngle(angle: InsertProjectAngle): Promise<ProjectAngle>;\n  updateProjectAngle(id: number, angle: Partial<InsertProjectAngle>): Promise<ProjectAngle | undefined>;\n  deleteProjectAngle(id: number): Promise<boolean>;\n  reorderProjectAngles(projectId: number, angleIds: number[]): Promise<ProjectAngle[]>;\n\n  // Vetting Questions\n  getVettingQuestions(): Promise<VettingQuestion[]>;\n  getVettingQuestionsByProject(projectId: number): Promise<VettingQuestion[]>;\n  getVettingQuestionsByAngle(angleId: number): Promise<VettingQuestion[]>;\n  createVettingQuestion(question: InsertVettingQuestion): Promise<VettingQuestion>;\n  updateVettingQuestion(id: number, question: Partial<InsertVettingQuestion>): Promise<VettingQuestion | undefined>;\n  deleteVettingQuestion(id: number): Promise<boolean>;\n  deleteVettingQuestionsByAngle(angleId: number): Promise<boolean>;\n\n  // Project Experts\n  getProjectExperts(): Promise<ProjectExpert[]>;\n  getProjectExpert(id: number): Promise<ProjectExpert | undefined>;\n  getProjectExpertByToken(token: string): Promise<ProjectExpert | undefined>;\n  getProjectExpertsByProject(projectId: number): Promise<ProjectExpert[]>;\n  getProjectExpertsByExpert(expertId: number): Promise<ProjectExpert[]>;\n  createProjectExpert(assignment: InsertProjectExpert): Promise<ProjectExpert>;\n  createProjectExpertsBulk(assignments: InsertProjectExpert[]): Promise<ProjectExpert[]>;\n  updateProjectExpert(id: number, assignment: Partial<InsertProjectExpert>): Promise<ProjectExpert | undefined>;\n  deleteProjectExpert(id: number): Promise<boolean>;\n\n  // Call Records\n  getCallRecords(): Promise<CallRecord[]>;\n  getCallRecord(id: number): Promise<CallRecord | undefined>;\n  getCallRecordsByProject(projectId: number): Promise<CallRecord[]>;\n  getCallRecordsByExpert(expertId: number): Promise<CallRecord[]>;\n  createCallRecord(record: InsertCallRecord): Promise<CallRecord>;\n  updateCallRecord(id: number, record: Partial<InsertCallRecord>): Promise<CallRecord | undefined>;\n  deleteCallRecord(id: number): Promise<boolean>;\n\n  // Expert Invitation Links\n  getExpertInvitationLinks(): Promise<ExpertInvitationLink[]>;\n  getExpertInvitationLinkByToken(token: string): Promise<ExpertInvitationLink | undefined>;\n  getExpertInvitationLinkByProjectAndRa(projectId: number, raId: number): Promise<ExpertInvitationLink | undefined>;\n  getExpertInvitationLinkByProjectAndExpert(projectId: number, expertId: number): Promise<ExpertInvitationLink | undefined>;\n  getExpertInvitationLinksByProject(projectId: number): Promise<ExpertInvitationLink[]>;\n  getExpertInvitationLinksByRa(raId: number): Promise<ExpertInvitationLink[]>;\n  createExpertInvitationLink(link: InsertExpertInvitationLink): Promise<ExpertInvitationLink>;\n  updateExpertInvitationLink(id: number, link: Partial<InsertExpertInvitationLink>): Promise<ExpertInvitationLink | undefined>;\n  markInvitationLinkUsed(token: string): Promise<ExpertInvitationLink | undefined>;\n  updateInvitationLinkStatus(token: string, status: string): Promise<ExpertInvitationLink | undefined>;\n\n  // Project Activities\n  getProjectActivities(projectId: number): Promise<ProjectActivity[]>;\n  createProjectActivity(activity: InsertProjectActivity): Promise<ProjectActivity>;\n\n  // Usage Records (legacy)\n  getUsageRecords(): Promise<UsageRecord[]>;\n  createUsageRecord(record: InsertUsageRecord): Promise<UsageRecord>;\n  deleteUsageRecord(id: number): Promise<boolean>;\n}\n\nexport class DatabaseStorage implements IStorage {\n  // Users\n  async getUsers(): Promise<User[]> {\n    return db.select().from(users).orderBy(users.fullName);\n  }\n\n  async getUser(id: number): Promise<User | undefined> {\n    const [user] = await db.select().from(users).where(eq(users.id, id));\n    return user || undefined;\n  }\n\n  async getUserByEmail(email: string): Promise<User | undefined> {\n    const [user] = await db.select().from(users).where(eq(users.email, email));\n    return user || undefined;\n  }\n\n  async createUser(user: InsertUser): Promise<User> {\n    const [newUser] = await db.insert(users).values(user).returning();\n    return newUser;\n  }\n\n  async updateUser(id: number, user: Partial<InsertUser>): Promise<User | undefined> {\n    const [updated] = await db.update(users).set(user).where(eq(users.id, id)).returning();\n    return updated || undefined;\n  }\n\n  async deleteUser(id: number): Promise<boolean> {\n    const result = await db.delete(users).where(eq(users.id, id)).returning();\n    return result.length > 0;\n  }\n\n  // Clients (CRM)\n  async getClients(): Promise<Client[]> {\n    return db.select().from(clients).orderBy(desc(clients.createdAt));\n  }\n\n  async getClient(id: number): Promise<Client | undefined> {\n    const [client] = await db.select().from(clients).where(eq(clients.id, id));\n    return client || undefined;\n  }\n\n  async searchClients(params: { query?: string; industry?: string; status?: string }): Promise<Client[]> {\n    const conditions = [];\n    \n    if (params.query) {\n      const searchPattern = `%${params.query}%`;\n      conditions.push(\n        or(\n          ilike(clients.clientName, searchPattern),\n          ilike(clients.mainContactName, searchPattern),\n          ilike(clients.mainContactEmail, searchPattern),\n          ilike(clients.country, searchPattern)\n        )\n      );\n    }\n    \n    if (params.industry) {\n      conditions.push(ilike(clients.industry, `%${params.industry}%`));\n    }\n    \n    if (params.status) {\n      conditions.push(eq(clients.status, params.status));\n    }\n    \n    if (conditions.length === 0) {\n      return db.select().from(clients).orderBy(desc(clients.createdAt));\n    }\n    \n    return db.select().from(clients).where(and(...conditions)).orderBy(desc(clients.createdAt));\n  }\n\n  async createClient(client: InsertClient): Promise<Client> {\n    const [newClient] = await db.insert(clients).values(client).returning();\n    return newClient;\n  }\n\n  async updateClient(id: number, client: Partial<InsertClient>): Promise<Client | undefined> {\n    const [updated] = await db.update(clients).set(client).where(eq(clients.id, id)).returning();\n    return updated || undefined;\n  }\n\n  async deleteClient(id: number): Promise<boolean> {\n    const result = await db.delete(clients).where(eq(clients.id, id)).returning();\n    return result.length > 0;\n  }\n\n  // Client Organizations\n  async getClientOrganizations(): Promise<ClientOrganization[]> {\n    return db.select().from(clientOrganizations).orderBy(clientOrganizations.name);\n  }\n\n  async getClientOrganization(id: number): Promise<ClientOrganization | undefined> {\n    const [org] = await db.select().from(clientOrganizations).where(eq(clientOrganizations.id, id));\n    return org || undefined;\n  }\n\n  async createClientOrganization(org: InsertClientOrganization): Promise<ClientOrganization> {\n    const [newOrg] = await db.insert(clientOrganizations).values(org).returning();\n    return newOrg;\n  }\n\n  async updateClientOrganization(id: number, org: Partial<InsertClientOrganization>): Promise<ClientOrganization | undefined> {\n    const [updated] = await db.update(clientOrganizations).set(org).where(eq(clientOrganizations.id, id)).returning();\n    return updated || undefined;\n  }\n\n  async deleteClientOrganization(id: number): Promise<boolean> {\n    const result = await db.delete(clientOrganizations).where(eq(clientOrganizations.id, id)).returning();\n    return result.length > 0;\n  }\n\n  // Client POCs\n  async getClientPocs(): Promise<ClientPoc[]> {\n    return db.select().from(clientPocs).orderBy(clientPocs.name);\n  }\n\n  async getClientPocsByOrganization(organizationId: number): Promise<ClientPoc[]> {\n    return db.select().from(clientPocs).where(eq(clientPocs.organizationId, organizationId));\n  }\n\n  async createClientPoc(poc: InsertClientPoc): Promise<ClientPoc> {\n    const [newPoc] = await db.insert(clientPocs).values(poc).returning();\n    return newPoc;\n  }\n\n  async updateClientPoc(id: number, poc: Partial<InsertClientPoc>): Promise<ClientPoc | undefined> {\n    const [updated] = await db.update(clientPocs).set(poc).where(eq(clientPocs.id, id)).returning();\n    return updated || undefined;\n  }\n\n  async deleteClientPoc(id: number): Promise<boolean> {\n    const result = await db.delete(clientPocs).where(eq(clientPocs.id, id)).returning();\n    return result.length > 0;\n  }\n\n  // Projects\n  async getProjects(): Promise<Project[]> {\n    return db.select().from(projects).orderBy(desc(projects.createdAt));\n  }\n\n  async getProject(id: number): Promise<Project | undefined> {\n    const [project] = await db.select().from(projects).where(eq(projects.id, id));\n    return project || undefined;\n  }\n\n  async getProjectsByOrganization(organizationId: number): Promise<Project[]> {\n    return db.select().from(projects).where(eq(projects.clientOrganizationId, organizationId)).orderBy(desc(projects.createdAt));\n  }\n\n  async getProjectsByPm(pmId: number): Promise<Project[]> {\n    return db.select().from(projects).where(eq(projects.createdByPmId, pmId)).orderBy(desc(projects.createdAt));\n  }\n\n  async getProjectsByAssignedRa(raId: number): Promise<Project[]> {\n    return db\n      .select()\n      .from(projects)\n      .where(\n        or(\n          eq(projects.assignedRaId, raId),\n          sql`${raId} = ANY(${projects.assignedRaIds})`\n        )\n      )\n      .orderBy(desc(projects.createdAt));\n  }\n\n  async createProject(project: InsertProject): Promise<Project> {\n    const [newProject] = await db.insert(projects).values(project).returning();\n    return newProject;\n  }\n\n  async updateProject(id: number, project: Partial<InsertProject>): Promise<Project | undefined> {\n    const [updated] = await db\n      .update(projects)\n      .set(project)\n      .where(eq(projects.id, id))\n      .returning();\n    return updated || undefined;\n  }\n\n  async deleteProject(id: number): Promise<boolean> {\n    const result = await db.delete(projects).where(eq(projects.id, id)).returning();\n    return result.length > 0;\n  }\n\n  // Experts\n  async getExperts(): Promise<Expert[]> {\n    return db.select().from(experts).orderBy(desc(experts.createdAt));\n  }\n\n  async getExpert(id: number): Promise<Expert | undefined> {\n    const [expert] = await db.select().from(experts).where(eq(experts.id, id));\n    return expert || undefined;\n  }\n\n  async getExpertByEmail(email: string): Promise<Expert | undefined> {\n    const [expert] = await db.select().from(experts).where(eq(experts.email, email));\n    return expert || undefined;\n  }\n\n  async searchExperts(query: string): Promise<Expert[]> {\n    const searchPattern = `%${query}%`;\n    return db\n      .select()\n      .from(experts)\n      .where(\n        or(\n          ilike(experts.name, searchPattern),\n          ilike(experts.expertise, searchPattern),\n          ilike(experts.industry, searchPattern),\n          ilike(experts.company, searchPattern),\n          ilike(experts.jobTitle, searchPattern),\n          ilike(experts.bio, searchPattern)\n        )\n      )\n      .orderBy(experts.name);\n  }\n\n  async searchExpertsAdvanced(params: {\n    query?: string;\n    country?: string;\n    currentEmployer?: string;\n    pastEmployers?: string;\n    minRate?: number;\n    maxRate?: number;\n    minYearsExperience?: number;\n    maxYearsExperience?: number;\n    jobTitle?: string;\n    industry?: string;\n    language?: string;\n    hasPriorProjects?: boolean;\n    minAcceptanceRate?: number;\n    minHoursWorked?: number;\n    availableOnly?: boolean;\n    excludeProjectId?: number;\n  }): Promise<(Expert & { priorProjectCount?: number; acceptanceRate?: number })[]> {\n    const conditions = [];\n    \n    // 1) Domain Expertise / Skills (Keywords) - search across name, title, skills, bio\n    if (params.query) {\n      const keywords = params.query.split(/[,\\s]+/).filter(k => k.trim());\n      if (keywords.length > 0) {\n        const keywordConditions = keywords.map(keyword => {\n          const searchPattern = `%${keyword.trim()}%`;\n          return or(\n            ilike(experts.name, searchPattern),\n            ilike(experts.expertise, searchPattern),\n            sql`array_to_string(${experts.areasOfExpertise}, ',') ILIKE ${searchPattern}`,\n            ilike(experts.industry, searchPattern),\n            ilike(experts.company, searchPattern),\n            ilike(experts.jobTitle, searchPattern),\n            ilike(experts.bio, searchPattern)\n          );\n        });\n        // All keywords must match (AND logic within keywords)\n        keywordConditions.forEach(cond => conditions.push(cond));\n      }\n    }\n    \n    // 2) Industry / Sector - match if expert.industry contains at least one of provided industries\n    if (params.industry) {\n      const industries = params.industry.split(',').map(i => i.trim().toLowerCase()).filter(i => i);\n      if (industries.length > 0) {\n        const industryConditions = industries.map(ind => \n          ilike(experts.industry, `%${ind}%`)\n        );\n        conditions.push(or(...industryConditions));\n      }\n    }\n    \n    // 3) Current Employer - partial, case-insensitive match\n    if (params.currentEmployer) {\n      const employerPattern = `%${params.currentEmployer.trim()}%`;\n      conditions.push(ilike(experts.company, employerPattern));\n    }\n    \n    // 4) Past Employers - match if any provided name appears in pastEmployers array\n    if (params.pastEmployers) {\n      const pastEmps = params.pastEmployers.split(',').map(e => e.trim().toLowerCase()).filter(e => e);\n      if (pastEmps.length > 0) {\n        const pastEmpConditions = pastEmps.map(emp =>\n          sql`array_to_string(${experts.pastEmployers}, ',') ILIKE ${'%' + emp + '%'}`\n        );\n        conditions.push(or(...pastEmpConditions));\n      }\n    }\n    \n    // 5) Role / Seniority (Job Title) - partial, case-insensitive match\n    if (params.jobTitle) {\n      const titlePattern = `%${params.jobTitle}%`;\n      conditions.push(ilike(experts.jobTitle, titlePattern));\n    }\n    \n    // 6) Geography / Location - match country, city, or timezone\n    if (params.country) {\n      const locations = params.country.split(',').map(l => l.trim().toLowerCase()).filter(l => l);\n      if (locations.length > 0) {\n        const locationConditions = locations.map(loc => {\n          const locPattern = `%${loc}%`;\n          return or(\n            ilike(experts.country, locPattern),\n            ilike(experts.city, locPattern),\n            ilike(experts.timezone, locPattern)\n          );\n        });\n        conditions.push(or(...locationConditions));\n      }\n    }\n    \n    // 7) Experience Level - min/max years\n    if (params.minYearsExperience !== undefined) {\n      conditions.push(sql`${experts.yearsOfExperience} >= ${params.minYearsExperience}`);\n    }\n    if (params.maxYearsExperience !== undefined) {\n      conditions.push(sql`${experts.yearsOfExperience} <= ${params.maxYearsExperience}`);\n    }\n    \n    // 8) Language - match if languages array contains at least one of provided languages\n    if (params.language) {\n      const langs = params.language.split(',').map(l => l.trim().toLowerCase()).filter(l => l);\n      if (langs.length > 0) {\n        const langConditions = langs.map(lang =>\n          sql`array_to_string(${experts.languages}, ',') ILIKE ${'%' + lang + '%'}`\n        );\n        conditions.push(or(...langConditions));\n      }\n    }\n    \n    // Rate filters (kept for backwards compatibility)\n    if (params.minRate !== undefined) {\n      conditions.push(sql`CAST(${experts.hourlyRate} AS DECIMAL) >= ${params.minRate}`);\n    }\n    if (params.maxRate !== undefined) {\n      conditions.push(sql`CAST(${experts.hourlyRate} AS DECIMAL) <= ${params.maxRate}`);\n    }\n    \n    // Get base experts\n    let baseExperts: Expert[];\n    if (conditions.length === 0) {\n      baseExperts = await db.select().from(experts).orderBy(experts.name);\n    } else {\n      baseExperts = await db\n        .select()\n        .from(experts)\n        .where(and(...conditions))\n        .orderBy(experts.name);\n    }\n\n    // Compute metrics for each expert (prior projects + acceptance rate)\n    const expertsWithMetrics = await Promise.all(\n      baseExperts.map(async (expert) => {\n        const projectAssignments = await db\n          .select()\n          .from(projectExperts)\n          .where(eq(projectExperts.expertId, expert.id));\n\n        // Filter out current project if excludeProjectId is set\n        const relevantAssignments = params.excludeProjectId\n          ? projectAssignments.filter(pa => pa.projectId !== params.excludeProjectId)\n          : projectAssignments;\n\n        const priorProjectCount = relevantAssignments.length;\n\n        // Calculate acceptance rate: accepted / (accepted + declined)\n        const invitedCount = relevantAssignments.filter(\n          pa => pa.invitationStatus === 'accepted' || pa.invitationStatus === 'declined'\n        ).length;\n        const acceptedCount = relevantAssignments.filter(\n          pa => pa.invitationStatus === 'accepted'\n        ).length;\n        const acceptanceRate = invitedCount > 0 ? Math.round((acceptedCount / invitedCount) * 100) : null;\n\n        return {\n          ...expert,\n          priorProjectCount,\n          acceptanceRate: acceptanceRate ?? undefined,\n        };\n      })\n    );\n\n    // Apply post-fetch filters\n    let filtered = expertsWithMetrics;\n\n    // 9) Availability - filter by availableNow or nextAvailableDate within 7 days\n    if (params.availableOnly) {\n      const sevenDaysFromNow = new Date();\n      sevenDaysFromNow.setDate(sevenDaysFromNow.getDate() + 7);\n      \n      filtered = filtered.filter(e => {\n        if (e.availableNow === true) return true;\n        if (e.nextAvailableDate && new Date(e.nextAvailableDate) <= sevenDaysFromNow) return true;\n        // Also check status for backwards compatibility\n        return e.status === 'available';\n      });\n    }\n\n    // 10a) Past Engagements - minimum hours worked\n    if (params.minHoursWorked !== undefined) {\n      filtered = filtered.filter(e => {\n        const hours = e.totalHoursWorked ? parseFloat(e.totalHoursWorked) : 0;\n        return hours >= params.minHoursWorked!;\n      });\n    }\n\n    // 10b) Past Engagements - only show experts with prior project involvement\n    if (params.hasPriorProjects) {\n      filtered = filtered.filter(e => (e.priorProjectCount ?? 0) > 0);\n    }\n\n    if (params.minAcceptanceRate !== undefined) {\n      filtered = filtered.filter(\n        e => e.acceptanceRate !== undefined && e.acceptanceRate >= params.minAcceptanceRate!\n      );\n    }\n\n    return filtered;\n  }\n\n  async createExpert(expert: InsertExpert): Promise<Expert> {\n    const [newExpert] = await db.insert(experts).values(expert).returning();\n    return newExpert;\n  }\n\n  async updateExpert(id: number, expert: Partial<InsertExpert>): Promise<Expert | undefined> {\n    const [updated] = await db\n      .update(experts)\n      .set(expert)\n      .where(eq(experts.id, id))\n      .returning();\n    return updated || undefined;\n  }\n\n  async deleteExpert(id: number): Promise<boolean> {\n    const result = await db.delete(experts).where(eq(experts.id, id)).returning();\n    return result.length > 0;\n  }\n\n  // Project Angles\n  async getProjectAngles(projectId: number): Promise<ProjectAngle[]> {\n    return db\n      .select()\n      .from(projectAngles)\n      .where(eq(projectAngles.projectId, projectId))\n      .orderBy(projectAngles.orderIndex);\n  }\n\n  async getProjectAngle(id: number): Promise<ProjectAngle | undefined> {\n    const [angle] = await db.select().from(projectAngles).where(eq(projectAngles.id, id));\n    return angle || undefined;\n  }\n\n  async createProjectAngle(angle: InsertProjectAngle): Promise<ProjectAngle> {\n    const [newAngle] = await db.insert(projectAngles).values(angle).returning();\n    return newAngle;\n  }\n\n  async updateProjectAngle(id: number, angle: Partial<InsertProjectAngle>): Promise<ProjectAngle | undefined> {\n    const [updated] = await db\n      .update(projectAngles)\n      .set({ ...angle, updatedAt: new Date() })\n      .where(eq(projectAngles.id, id))\n      .returning();\n    return updated || undefined;\n  }\n\n  async deleteProjectAngle(id: number): Promise<boolean> {\n    const result = await db.delete(projectAngles).where(eq(projectAngles.id, id)).returning();\n    return result.length > 0;\n  }\n\n  async reorderProjectAngles(projectId: number, angleIds: number[]): Promise<ProjectAngle[]> {\n    const updates = angleIds.map((id, index) =>\n      db.update(projectAngles)\n        .set({ orderIndex: index, updatedAt: new Date() })\n        .where(and(eq(projectAngles.id, id), eq(projectAngles.projectId, projectId)))\n        .returning()\n    );\n    const results = await Promise.all(updates);\n    return results.flat();\n  }\n\n  // Vetting Questions\n  async getVettingQuestions(): Promise<VettingQuestion[]> {\n    return db.select().from(vettingQuestions).orderBy(vettingQuestions.orderIndex);\n  }\n\n  async getVettingQuestionsByProject(projectId: number): Promise<VettingQuestion[]> {\n    return db\n      .select()\n      .from(vettingQuestions)\n      .where(eq(vettingQuestions.projectId, projectId))\n      .orderBy(vettingQuestions.orderIndex);\n  }\n\n  async getVettingQuestionsByAngle(angleId: number): Promise<VettingQuestion[]> {\n    return db\n      .select()\n      .from(vettingQuestions)\n      .where(eq(vettingQuestions.angleId, angleId))\n      .orderBy(vettingQuestions.orderIndex);\n  }\n\n  async createVettingQuestion(question: InsertVettingQuestion): Promise<VettingQuestion> {\n    const [newQuestion] = await db.insert(vettingQuestions).values(question).returning();\n    return newQuestion;\n  }\n\n  async updateVettingQuestion(\n    id: number,\n    question: Partial<InsertVettingQuestion>\n  ): Promise<VettingQuestion | undefined> {\n    const [updated] = await db\n      .update(vettingQuestions)\n      .set(question)\n      .where(eq(vettingQuestions.id, id))\n      .returning();\n    return updated || undefined;\n  }\n\n  async deleteVettingQuestion(id: number): Promise<boolean> {\n    const result = await db.delete(vettingQuestions).where(eq(vettingQuestions.id, id)).returning();\n    return result.length > 0;\n  }\n\n  async deleteVettingQuestionsByAngle(angleId: number): Promise<boolean> {\n    const result = await db.delete(vettingQuestions).where(eq(vettingQuestions.angleId, angleId)).returning();\n    return result.length >= 0;\n  }\n\n  // Project Experts\n  async getProjectExperts(): Promise<ProjectExpert[]> {\n    return db.select().from(projectExperts).orderBy(desc(projectExperts.assignedAt));\n  }\n\n  async getProjectExpert(id: number): Promise<ProjectExpert | undefined> {\n    const [pe] = await db.select().from(projectExperts).where(eq(projectExperts.id, id));\n    return pe || undefined;\n  }\n\n  async getProjectExpertByToken(token: string): Promise<ProjectExpert | undefined> {\n    const [pe] = await db.select().from(projectExperts).where(eq(projectExperts.invitationToken, token));\n    return pe || undefined;\n  }\n\n  async getProjectExpertsByProject(projectId: number): Promise<ProjectExpert[]> {\n    return db\n      .select()\n      .from(projectExperts)\n      .where(eq(projectExperts.projectId, projectId));\n  }\n\n  async getProjectExpertsByExpert(expertId: number): Promise<ProjectExpert[]> {\n    return db\n      .select()\n      .from(projectExperts)\n      .where(eq(projectExperts.expertId, expertId));\n  }\n\n  async createProjectExpert(assignment: InsertProjectExpert): Promise<ProjectExpert> {\n    const [newAssignment] = await db.insert(projectExperts).values(assignment as any).returning();\n    return newAssignment;\n  }\n\n  async createProjectExpertsBulk(assignments: InsertProjectExpert[]): Promise<ProjectExpert[]> {\n    if (assignments.length === 0) return [];\n    return db.insert(projectExperts).values(assignments as any[]).returning();\n  }\n\n  async updateProjectExpert(id: number, assignment: Partial<InsertProjectExpert>): Promise<ProjectExpert | undefined> {\n    const [updated] = await db\n      .update(projectExperts)\n      .set(assignment as any)\n      .where(eq(projectExperts.id, id))\n      .returning();\n    return updated || undefined;\n  }\n\n  async deleteProjectExpert(id: number): Promise<boolean> {\n    const result = await db.delete(projectExperts).where(eq(projectExperts.id, id)).returning();\n    return result.length > 0;\n  }\n\n  // Call Records\n  async getCallRecords(): Promise<CallRecord[]> {\n    return db.select().from(callRecords).orderBy(desc(callRecords.callDate));\n  }\n\n  async getCallRecord(id: number): Promise<CallRecord | undefined> {\n    const [record] = await db.select().from(callRecords).where(eq(callRecords.id, id));\n    return record || undefined;\n  }\n\n  async getCallRecordsByProject(projectId: number): Promise<CallRecord[]> {\n    return db\n      .select()\n      .from(callRecords)\n      .where(eq(callRecords.projectId, projectId))\n      .orderBy(desc(callRecords.callDate));\n  }\n\n  async getCallRecordsByExpert(expertId: number): Promise<CallRecord[]> {\n    return db\n      .select()\n      .from(callRecords)\n      .where(eq(callRecords.expertId, expertId))\n      .orderBy(desc(callRecords.callDate));\n  }\n\n  async createCallRecord(record: InsertCallRecord): Promise<CallRecord> {\n    const cuUsed = calculateCU(record.durationMinutes);\n    const [newRecord] = await db.insert(callRecords).values({\n      ...record,\n      cuUsed: cuUsed.toString(),\n    }).returning();\n    \n    // Update project total CU\n    await db.update(projects).set({\n      totalCuUsed: sql`COALESCE(${projects.totalCuUsed}, 0) + ${cuUsed}`,\n    }).where(eq(projects.id, record.projectId));\n    \n    return newRecord;\n  }\n\n  async updateCallRecord(id: number, record: Partial<InsertCallRecord>): Promise<CallRecord | undefined> {\n    const existing = await this.getCallRecord(id);\n    if (!existing) return undefined;\n    \n    let updateData: any = { ...record };\n    if (record.durationMinutes !== undefined) {\n      updateData.cuUsed = calculateCU(record.durationMinutes).toString();\n    }\n    \n    const [updated] = await db\n      .update(callRecords)\n      .set(updateData)\n      .where(eq(callRecords.id, id))\n      .returning();\n    return updated || undefined;\n  }\n\n  async deleteCallRecord(id: number): Promise<boolean> {\n    const result = await db.delete(callRecords).where(eq(callRecords.id, id)).returning();\n    return result.length > 0;\n  }\n\n  // Expert Invitation Links\n  async getExpertInvitationLinks(): Promise<ExpertInvitationLink[]> {\n    return db.select().from(expertInvitationLinks).orderBy(desc(expertInvitationLinks.createdAt));\n  }\n\n  async getExpertInvitationLinkByToken(token: string): Promise<ExpertInvitationLink | undefined> {\n    const [link] = await db.select().from(expertInvitationLinks).where(eq(expertInvitationLinks.token, token));\n    return link || undefined;\n  }\n\n  async createExpertInvitationLink(link: InsertExpertInvitationLink): Promise<ExpertInvitationLink> {\n    const [newLink] = await db.insert(expertInvitationLinks).values(link).returning();\n    return newLink;\n  }\n\n  async getExpertInvitationLinkByProjectAndRa(projectId: number, raId: number): Promise<ExpertInvitationLink | undefined> {\n    const [link] = await db\n      .select()\n      .from(expertInvitationLinks)\n      .where(\n        and(\n          eq(expertInvitationLinks.projectId, projectId),\n          eq(expertInvitationLinks.raId, raId),\n          eq(expertInvitationLinks.inviteType, \"ra\"),\n          eq(expertInvitationLinks.isActive, true)\n        )\n      );\n    return link || undefined;\n  }\n\n  async getExpertInvitationLinkByProjectAndExpert(projectId: number, expertId: number): Promise<ExpertInvitationLink | undefined> {\n    const [link] = await db\n      .select()\n      .from(expertInvitationLinks)\n      .where(\n        and(\n          eq(expertInvitationLinks.projectId, projectId),\n          eq(expertInvitationLinks.expertId, expertId),\n          eq(expertInvitationLinks.inviteType, \"existing\"),\n          eq(expertInvitationLinks.isActive, true)\n        )\n      );\n    return link || undefined;\n  }\n\n  async getExpertInvitationLinksByProject(projectId: number): Promise<ExpertInvitationLink[]> {\n    return db\n      .select()\n      .from(expertInvitationLinks)\n      .where(eq(expertInvitationLinks.projectId, projectId))\n      .orderBy(desc(expertInvitationLinks.createdAt));\n  }\n\n  async getExpertInvitationLinksByRa(raId: number): Promise<ExpertInvitationLink[]> {\n    return db\n      .select()\n      .from(expertInvitationLinks)\n      .where(eq(expertInvitationLinks.raId, raId))\n      .orderBy(desc(expertInvitationLinks.createdAt));\n  }\n\n  async updateExpertInvitationLink(id: number, link: Partial<InsertExpertInvitationLink>): Promise<ExpertInvitationLink | undefined> {\n    const [updated] = await db\n      .update(expertInvitationLinks)\n      .set({ ...link, updatedAt: new Date() } as any)\n      .where(eq(expertInvitationLinks.id, id))\n      .returning();\n    return updated || undefined;\n  }\n\n  async markInvitationLinkUsed(token: string): Promise<ExpertInvitationLink | undefined> {\n    const [updated] = await db\n      .update(expertInvitationLinks)\n      .set({ usedAt: new Date(), isActive: false })\n      .where(eq(expertInvitationLinks.token, token))\n      .returning();\n    return updated || undefined;\n  }\n\n  async updateInvitationLinkStatus(token: string, status: string): Promise<ExpertInvitationLink | undefined> {\n    const [updated] = await db\n      .update(expertInvitationLinks)\n      .set({ status, updatedAt: new Date() } as any)\n      .where(eq(expertInvitationLinks.token, token))\n      .returning();\n    return updated || undefined;\n  }\n\n  // Project Activities\n  async getProjectActivities(projectId: number): Promise<ProjectActivity[]> {\n    return db\n      .select()\n      .from(projectActivities)\n      .where(eq(projectActivities.projectId, projectId))\n      .orderBy(desc(projectActivities.createdAt));\n  }\n\n  async createProjectActivity(activity: InsertProjectActivity): Promise<ProjectActivity> {\n    const [newActivity] = await db.insert(projectActivities).values(activity).returning();\n    return newActivity;\n  }\n\n  // Usage Records (legacy)\n  async getUsageRecords(): Promise<UsageRecord[]> {\n    return db.select().from(usageRecords).orderBy(desc(usageRecords.callDate));\n  }\n\n  async createUsageRecord(record: InsertUsageRecord): Promise<UsageRecord> {\n    const [newRecord] = await db.insert(usageRecords).values(record).returning();\n    return newRecord;\n  }\n\n  async deleteUsageRecord(id: number): Promise<boolean> {\n    const result = await db.delete(usageRecords).where(eq(usageRecords.id, id)).returning();\n    return result.length > 0;\n  }\n\n  // RA Incentive Calculations\n  // Get experts recruited by a specific RA\n  async getExpertsByRecruiterId(raId: number): Promise<Expert[]> {\n    return db\n      .select()\n      .from(experts)\n      .where(eq(experts.sourcedByRaId, raId))\n      .orderBy(desc(experts.sourcedAt));\n  }\n\n  // Get completed calls for an expert within a date range\n  async getCompletedCallsForExpert(\n    expertId: number,\n    fromDate: Date,\n    toDate: Date\n  ): Promise<CallRecord[]> {\n    return db\n      .select()\n      .from(callRecords)\n      .where(\n        and(\n          eq(callRecords.expertId, expertId),\n          eq(callRecords.status, \"completed\"),\n          gte(callRecords.completedAt, fromDate),\n          lte(callRecords.completedAt, toDate)\n        )\n      );\n  }\n\n  // Calculate RA incentives for a specific period\n  // Business rule: R$250 per completed call for RA-sourced experts within 60 days of recruitment\n  async calculateRaIncentives(\n    raId: number,\n    periodFromDate?: Date,\n    periodToDate?: Date\n  ): Promise<{\n    raId: number;\n    raName: string;\n    raEmail: string;\n    totalRecruitedExperts: number;\n    expertsWithCompletedCalls: number;\n    totalEligibleCalls: number;\n    totalIncentiveBRL: number;\n    eligibleExperts: Array<{\n      expertId: number;\n      expertName: string;\n      recruitedAt: Date | null;\n      eligibleCalls: number;\n      incentiveBRL: number;\n    }>;\n  }> {\n    const INCENTIVE_PER_CALL_BRL = 250;\n    const ELIGIBILITY_DAYS = 60;\n\n    // Get RA info\n    const [ra] = await db.select().from(users).where(eq(users.id, raId));\n    if (!ra) {\n      throw new Error(\"RA not found\");\n    }\n\n    // Get all experts recruited by this RA\n    const recruitedExperts = await this.getExpertsByRecruiterId(raId);\n\n    let totalEligibleCalls = 0;\n    let expertsWithCompletedCalls = 0;\n    const eligibleExperts: Array<{\n      expertId: number;\n      expertName: string;\n      recruitedAt: Date | null;\n      eligibleCalls: number;\n      incentiveBRL: number;\n    }> = [];\n\n    for (const expert of recruitedExperts) {\n      if (!expert.sourcedAt) continue;\n\n      const recruitedAt = new Date(expert.sourcedAt);\n      const eligibilityEndDate = new Date(recruitedAt);\n      eligibilityEndDate.setDate(eligibilityEndDate.getDate() + ELIGIBILITY_DAYS);\n\n      // Get completed calls within the 60-day eligibility window\n      // Also filter by the period if provided\n      let callsFromDate = recruitedAt;\n      let callsToDate = eligibilityEndDate;\n\n      if (periodFromDate && periodFromDate > callsFromDate) {\n        callsFromDate = periodFromDate;\n      }\n      if (periodToDate && periodToDate < callsToDate) {\n        callsToDate = periodToDate;\n      }\n\n      // Skip if the period doesn't overlap with eligibility window\n      if (callsFromDate >= callsToDate) continue;\n\n      const completedCalls = await this.getCompletedCallsForExpert(\n        expert.id,\n        callsFromDate,\n        callsToDate\n      );\n\n      if (completedCalls.length > 0) {\n        expertsWithCompletedCalls++;\n        totalEligibleCalls += completedCalls.length;\n        const incentiveBRL = completedCalls.length * INCENTIVE_PER_CALL_BRL;\n\n        eligibleExperts.push({\n          expertId: expert.id,\n          expertName: expert.name,\n          recruitedAt: expert.sourcedAt,\n          eligibleCalls: completedCalls.length,\n          incentiveBRL,\n        });\n      }\n    }\n\n    return {\n      raId,\n      raName: ra.fullName,\n      raEmail: ra.email,\n      totalRecruitedExperts: recruitedExperts.length,\n      expertsWithCompletedCalls,\n      totalEligibleCalls,\n      totalIncentiveBRL: totalEligibleCalls * INCENTIVE_PER_CALL_BRL,\n      eligibleExperts,\n    };\n  }\n\n  // Get all RAs with their incentive summary\n  async getAllRaIncentiveSummary(\n    periodFromDate?: Date,\n    periodToDate?: Date\n  ): Promise<Array<{\n    raId: number;\n    raName: string;\n    raEmail: string;\n    totalRecruitedExperts: number;\n    expertsWithCompletedCalls: number;\n    totalEligibleCalls: number;\n    totalIncentiveBRL: number;\n  }>> {\n    // Get all RAs\n    const ras = await db\n      .select()\n      .from(users)\n      .where(eq(users.role, \"ra\"));\n\n    const summaries = [];\n\n    for (const ra of ras) {\n      const incentiveData = await this.calculateRaIncentives(\n        ra.id,\n        periodFromDate,\n        periodToDate\n      );\n      summaries.push({\n        raId: incentiveData.raId,\n        raName: incentiveData.raName,\n        raEmail: incentiveData.raEmail,\n        totalRecruitedExperts: incentiveData.totalRecruitedExperts,\n        expertsWithCompletedCalls: incentiveData.expertsWithCompletedCalls,\n        totalEligibleCalls: incentiveData.totalEligibleCalls,\n        totalIncentiveBRL: incentiveData.totalIncentiveBRL,\n      });\n    }\n\n    return summaries.sort((a, b) => b.totalIncentiveBRL - a.totalIncentiveBRL);\n  }\n}\n\nexport const storage = new DatabaseStorage();\n","path":null,"size_bytes":39422,"size_tokens":null},"server/auth.ts":{"content":"import type { Request, Response, NextFunction } from \"express\";\nimport bcrypt from \"bcryptjs\";\nimport jwt from \"jsonwebtoken\";\nimport { storage } from \"./storage\";\n\nif (!process.env.SESSION_SECRET) {\n  throw new Error(\"SESSION_SECRET environment variable is required for authentication\");\n}\n\nconst JWT_SECRET: string = process.env.SESSION_SECRET;\n\nexport interface AuthUser {\n  id: number;\n  fullName: string;\n  email: string;\n  role: string;\n  mustChangePassword?: boolean;\n}\n\nexport interface AuthRequest extends Request {\n  user?: AuthUser;\n}\n\nexport async function hashPassword(password: string): Promise<string> {\n  return bcrypt.hash(password, 10);\n}\n\nexport async function comparePassword(password: string, hash: string): Promise<boolean> {\n  return bcrypt.compare(password, hash);\n}\n\nexport function generateToken(user: AuthUser): string {\n  return jwt.sign(\n    { id: user.id, fullName: user.fullName, email: user.email, role: user.role },\n    JWT_SECRET,\n    { expiresIn: \"7d\" }\n  );\n}\n\nexport function verifyToken(token: string): AuthUser | null {\n  try {\n    return jwt.verify(token, JWT_SECRET) as AuthUser;\n  } catch {\n    return null;\n  }\n}\n\nexport function authMiddleware(req: AuthRequest, res: Response, next: NextFunction) {\n  const authHeader = req.headers.authorization;\n  \n  if (!authHeader || !authHeader.startsWith(\"Bearer \")) {\n    return res.status(401).json({ error: \"Unauthorized - No token provided\" });\n  }\n  \n  const token = authHeader.split(\" \")[1];\n  const user = verifyToken(token);\n  \n  if (!user) {\n    return res.status(401).json({ error: \"Unauthorized - Invalid token\" });\n  }\n  \n  req.user = user;\n  next();\n}\n\nexport function requireRoles(...allowedRoles: string[]) {\n  return (req: AuthRequest, res: Response, next: NextFunction) => {\n    if (!req.user) {\n      return res.status(401).json({ error: \"Unauthorized\" });\n    }\n    \n    if (!allowedRoles.includes(req.user.role)) {\n      return res.status(403).json({ error: \"Forbidden - Insufficient permissions\" });\n    }\n    \n    next();\n  };\n}\n\nexport function requireAdmin(req: AuthRequest, res: Response, next: NextFunction) {\n  if (!req.user) {\n    return res.status(401).json({ error: \"Unauthorized\" });\n  }\n  \n  if (req.user.role !== \"admin\") {\n    return res.status(403).json({ error: \"Forbidden - Admin access required\" });\n  }\n  \n  next();\n}\n\nexport async function loginHandler(req: Request, res: Response) {\n  try {\n    const { email, password } = req.body;\n    \n    if (!email || !password) {\n      return res.status(400).json({ error: \"Email and password are required\" });\n    }\n    \n    const user = await storage.getUserByEmail(email);\n    \n    if (!user || !user.passwordHash) {\n      return res.status(401).json({ error: \"Invalid email or password\" });\n    }\n    \n    const isValid = await comparePassword(password, user.passwordHash);\n    \n    if (!isValid) {\n      return res.status(401).json({ error: \"Invalid email or password\" });\n    }\n    \n    const authUser: AuthUser = {\n      id: user.id,\n      fullName: user.fullName,\n      email: user.email,\n      role: user.role,\n      mustChangePassword: user.mustChangePassword || false,\n    };\n    \n    const token = generateToken(authUser);\n    \n    res.json({ token, user: authUser });\n  } catch (error) {\n    console.error(\"Login error:\", error);\n    res.status(500).json({ error: \"Login failed\" });\n  }\n}\n\nexport async function getMeHandler(req: AuthRequest, res: Response) {\n  if (!req.user) {\n    return res.status(401).json({ error: \"Unauthorized\" });\n  }\n  res.json(req.user);\n}\n","path":null,"size_bytes":3543,"size_tokens":null},"client/src/components/ui/toggle-group.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as ToggleGroupPrimitive from \"@radix-ui/react-toggle-group\"\nimport { type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\nimport { toggleVariants } from \"@/components/ui/toggle\"\n\nconst ToggleGroupContext = React.createContext<\n  VariantProps<typeof toggleVariants>\n>({\n  size: \"default\",\n  variant: \"default\",\n})\n\nconst ToggleGroup = React.forwardRef<\n  React.ElementRef<typeof ToggleGroupPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ToggleGroupPrimitive.Root> &\n    VariantProps<typeof toggleVariants>\n>(({ className, variant, size, children, ...props }, ref) => (\n  <ToggleGroupPrimitive.Root\n    ref={ref}\n    className={cn(\"flex items-center justify-center gap-1\", className)}\n    {...props}\n  >\n    <ToggleGroupContext.Provider value={{ variant, size }}>\n      {children}\n    </ToggleGroupContext.Provider>\n  </ToggleGroupPrimitive.Root>\n))\n\nToggleGroup.displayName = ToggleGroupPrimitive.Root.displayName\n\nconst ToggleGroupItem = React.forwardRef<\n  React.ElementRef<typeof ToggleGroupPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof ToggleGroupPrimitive.Item> &\n    VariantProps<typeof toggleVariants>\n>(({ className, children, variant, size, ...props }, ref) => {\n  const context = React.useContext(ToggleGroupContext)\n\n  return (\n    <ToggleGroupPrimitive.Item\n      ref={ref}\n      className={cn(\n        toggleVariants({\n          variant: context.variant || variant,\n          size: context.size || size,\n        }),\n        className\n      )}\n      {...props}\n    >\n      {children}\n    </ToggleGroupPrimitive.Item>\n  )\n})\n\nToggleGroupItem.displayName = ToggleGroupPrimitive.Item.displayName\n\nexport { ToggleGroup, ToggleGroupItem }\n","path":null,"size_bytes":1753,"size_tokens":null},"client/src/components/ui/menubar.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as MenubarPrimitive from \"@radix-ui/react-menubar\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nfunction MenubarMenu({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Menu>) {\n  return <MenubarPrimitive.Menu {...props} />\n}\n\nfunction MenubarGroup({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Group>) {\n  return <MenubarPrimitive.Group {...props} />\n}\n\nfunction MenubarPortal({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Portal>) {\n  return <MenubarPrimitive.Portal {...props} />\n}\n\nfunction MenubarRadioGroup({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.RadioGroup>) {\n  return <MenubarPrimitive.RadioGroup {...props} />\n}\n\nfunction MenubarSub({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Sub>) {\n  return <MenubarPrimitive.Sub data-slot=\"menubar-sub\" {...props} />\n}\n\nconst Menubar = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"flex h-10 items-center space-x-1 rounded-md border bg-background p-1\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubar.displayName = MenubarPrimitive.Root.displayName\n\nconst MenubarTrigger = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Trigger>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-3 py-1.5 text-sm font-medium outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarTrigger.displayName = MenubarPrimitive.Trigger.displayName\n\nconst MenubarSubTrigger = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <MenubarPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto h-4 w-4\" />\n  </MenubarPrimitive.SubTrigger>\n))\nMenubarSubTrigger.displayName = MenubarPrimitive.SubTrigger.displayName\n\nconst MenubarSubContent = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-menubar-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarSubContent.displayName = MenubarPrimitive.SubContent.displayName\n\nconst MenubarContent = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Content>\n>(\n  (\n    { className, align = \"start\", alignOffset = -4, sideOffset = 8, ...props },\n    ref\n  ) => (\n    <MenubarPrimitive.Portal>\n      <MenubarPrimitive.Content\n        ref={ref}\n        align={align}\n        alignOffset={alignOffset}\n        sideOffset={sideOffset}\n        className={cn(\n          \"z-50 min-w-[12rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-menubar-content-transform-origin]\",\n          className\n        )}\n        {...props}\n      />\n    </MenubarPrimitive.Portal>\n  )\n)\nMenubarContent.displayName = MenubarPrimitive.Content.displayName\n\nconst MenubarItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <MenubarPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarItem.displayName = MenubarPrimitive.Item.displayName\n\nconst MenubarCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <MenubarPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <MenubarPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </MenubarPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </MenubarPrimitive.CheckboxItem>\n))\nMenubarCheckboxItem.displayName = MenubarPrimitive.CheckboxItem.displayName\n\nconst MenubarRadioItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <MenubarPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <MenubarPrimitive.ItemIndicator>\n        <Circle className=\"h-2 w-2 fill-current\" />\n      </MenubarPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </MenubarPrimitive.RadioItem>\n))\nMenubarRadioItem.displayName = MenubarPrimitive.RadioItem.displayName\n\nconst MenubarLabel = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <MenubarPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarLabel.displayName = MenubarPrimitive.Label.displayName\n\nconst MenubarSeparator = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nMenubarSeparator.displayName = MenubarPrimitive.Separator.displayName\n\nconst MenubarShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nMenubarShortcut.displayname = \"MenubarShortcut\"\n\nexport {\n  Menubar,\n  MenubarMenu,\n  MenubarTrigger,\n  MenubarContent,\n  MenubarItem,\n  MenubarSeparator,\n  MenubarLabel,\n  MenubarCheckboxItem,\n  MenubarRadioGroup,\n  MenubarRadioItem,\n  MenubarPortal,\n  MenubarSubContent,\n  MenubarSubTrigger,\n  MenubarGroup,\n  MenubarSub,\n  MenubarShortcut,\n}\n","path":null,"size_bytes":8605,"size_tokens":null},"vite.config.ts":{"content":"import { defineConfig } from \"vite\";\nimport react from \"@vitejs/plugin-react\";\nimport path from \"path\";\nimport runtimeErrorOverlay from \"@replit/vite-plugin-runtime-error-modal\";\n\nexport default defineConfig({\n  plugins: [\n    react(),\n    runtimeErrorOverlay(),\n    ...(process.env.NODE_ENV !== \"production\" &&\n    process.env.REPL_ID !== undefined\n      ? [\n          await import(\"@replit/vite-plugin-cartographer\").then((m) =>\n            m.cartographer(),\n          ),\n          await import(\"@replit/vite-plugin-dev-banner\").then((m) =>\n            m.devBanner(),\n          ),\n        ]\n      : []),\n  ],\n  resolve: {\n    alias: {\n      \"@\": path.resolve(import.meta.dirname, \"client\", \"src\"),\n      \"@shared\": path.resolve(import.meta.dirname, \"shared\"),\n      \"@assets\": path.resolve(import.meta.dirname, \"attached_assets\"),\n    },\n  },\n  root: path.resolve(import.meta.dirname, \"client\"),\n  build: {\n    outDir: path.resolve(import.meta.dirname, \"dist/public\"),\n    emptyOutDir: true,\n  },\n  server: {\n    fs: {\n      strict: true,\n      deny: [\"**/.*\"],\n    },\n  },\n});\n","path":null,"size_bytes":1080,"size_tokens":null},"client/src/components/ui/calendar.tsx":{"content":"import * as React from \"react\"\nimport { ChevronLeft, ChevronRight } from \"lucide-react\"\nimport { DayPicker } from \"react-day-picker\"\n\nimport { cn } from \"@/lib/utils\"\nimport { buttonVariants } from \"@/components/ui/button\"\n\nexport type CalendarProps = React.ComponentProps<typeof DayPicker>\n\nfunction Calendar({\n  className,\n  classNames,\n  showOutsideDays = true,\n  ...props\n}: CalendarProps) {\n  return (\n    <DayPicker\n      showOutsideDays={showOutsideDays}\n      className={cn(\"p-3\", className)}\n      classNames={{\n        months: \"flex flex-col sm:flex-row space-y-4 sm:space-x-4 sm:space-y-0\",\n        month: \"space-y-4\",\n        caption: \"flex justify-center pt-1 relative items-center\",\n        caption_label: \"text-sm font-medium\",\n        nav: \"space-x-1 flex items-center\",\n        nav_button: cn(\n          buttonVariants({ variant: \"outline\" }),\n          \"h-7 w-7 bg-transparent p-0 opacity-50 hover:opacity-100\"\n        ),\n        nav_button_previous: \"absolute left-1\",\n        nav_button_next: \"absolute right-1\",\n        table: \"w-full border-collapse space-y-1\",\n        head_row: \"flex\",\n        head_cell:\n          \"text-muted-foreground rounded-md w-9 font-normal text-[0.8rem]\",\n        row: \"flex w-full mt-2\",\n        cell: \"h-9 w-9 text-center text-sm p-0 relative [&:has([aria-selected].day-range-end)]:rounded-r-md [&:has([aria-selected].day-outside)]:bg-accent/50 [&:has([aria-selected])]:bg-accent first:[&:has([aria-selected])]:rounded-l-md last:[&:has([aria-selected])]:rounded-r-md focus-within:relative focus-within:z-20\",\n        day: cn(\n          buttonVariants({ variant: \"ghost\" }),\n          \"h-9 w-9 p-0 font-normal aria-selected:opacity-100\"\n        ),\n        day_range_end: \"day-range-end\",\n        day_selected:\n          \"bg-primary text-primary-foreground hover:bg-primary hover:text-primary-foreground focus:bg-primary focus:text-primary-foreground\",\n        day_today: \"bg-accent text-accent-foreground\",\n        day_outside:\n          \"day-outside text-muted-foreground aria-selected:bg-accent/50 aria-selected:text-muted-foreground\",\n        day_disabled: \"text-muted-foreground opacity-50\",\n        day_range_middle:\n          \"aria-selected:bg-accent aria-selected:text-accent-foreground\",\n        day_hidden: \"invisible\",\n        ...classNames,\n      }}\n      components={{\n        IconLeft: ({ className, ...props }) => (\n          <ChevronLeft className={cn(\"h-4 w-4\", className)} {...props} />\n        ),\n        IconRight: ({ className, ...props }) => (\n          <ChevronRight className={cn(\"h-4 w-4\", className)} {...props} />\n        ),\n      }}\n      {...props}\n    />\n  )\n}\nCalendar.displayName = \"Calendar\"\n\nexport { Calendar }\n","path":null,"size_bytes":2695,"size_tokens":null},"client/src/pages/expert-register.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { useForm } from \"react-hook-form\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport { z } from \"zod\";\nimport { CheckCircle, AlertCircle, Loader2, User, Building, Globe } from \"lucide-react\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Checkbox } from \"@/components/ui/checkbox\";\nimport {\n  Form,\n  FormControl,\n  FormDescription,\n  FormField,\n  FormItem,\n  FormLabel,\n  FormMessage,\n} from \"@/components/ui/form\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport type { ExpertInvitationLink, InsertExpert } from \"@shared/schema\";\n\ninterface ExpertRegisterProps {\n  token: string;\n}\n\nconst expertFormSchema = z.object({\n  name: z.string().min(1, \"Full name is required\"),\n  email: z.string().email(\"Valid email is required\"),\n  phone: z.string().optional(),\n  linkedinUrl: z.string().url(\"Valid LinkedIn URL required\").optional().or(z.literal(\"\")),\n  country: z.string().min(1, \"Country is required\"),\n  timezone: z.string().optional(),\n  whatsapp: z.string().optional(),\n  expertise: z.string().min(1, \"Primary expertise is required\"),\n  areasOfExpertise: z.string().optional(),\n  industry: z.string().min(1, \"Industry is required\"),\n  company: z.string().min(1, \"Company is required\"),\n  jobTitle: z.string().min(1, \"Job title is required\"),\n  yearsOfExperience: z.number().min(0, \"Years must be 0 or greater\"),\n  hourlyRate: z.string().min(1, \"Hourly rate is required\"),\n  bio: z.string().min(50, \"Bio must be at least 50 characters\"),\n  termsAccepted: z.boolean().refine((v) => v === true, \"You must accept the terms\"),\n  lgpdAccepted: z.boolean().refine((v) => v === true, \"You must accept the LGPD consent\"),\n});\n\ntype ExpertFormData = z.infer<typeof expertFormSchema>;\n\nconst industries = [\n  \"Technology\",\n  \"Healthcare\",\n  \"Finance\",\n  \"Manufacturing\",\n  \"Energy\",\n  \"Retail\",\n  \"Consulting\",\n  \"Legal\",\n  \"Real Estate\",\n  \"Education\",\n  \"Pharmaceuticals\",\n  \"Telecommunications\",\n  \"Automotive\",\n  \"Aerospace\",\n  \"Agriculture\",\n  \"Other\",\n];\n\nconst timezones = [\n  \"UTC-12:00\",\n  \"UTC-11:00\",\n  \"UTC-10:00\",\n  \"UTC-09:00\",\n  \"UTC-08:00 (PST)\",\n  \"UTC-07:00 (MST)\",\n  \"UTC-06:00 (CST)\",\n  \"UTC-05:00 (EST)\",\n  \"UTC-04:00\",\n  \"UTC-03:00 (BRT)\",\n  \"UTC-02:00\",\n  \"UTC-01:00\",\n  \"UTC+00:00 (GMT)\",\n  \"UTC+01:00 (CET)\",\n  \"UTC+02:00\",\n  \"UTC+03:00\",\n  \"UTC+04:00\",\n  \"UTC+05:00\",\n  \"UTC+05:30 (IST)\",\n  \"UTC+06:00\",\n  \"UTC+07:00\",\n  \"UTC+08:00 (CST)\",\n  \"UTC+09:00 (JST)\",\n  \"UTC+10:00\",\n  \"UTC+11:00\",\n  \"UTC+12:00\",\n];\n\nexport default function ExpertRegister({ token }: ExpertRegisterProps) {\n  const { toast } = useToast();\n  const [isSubmitted, setIsSubmitted] = useState(false);\n\n  const { data: invitationLink, isLoading, error } = useQuery<ExpertInvitationLink>({\n    queryKey: [\"/api/invitation-links\", token],\n    queryFn: async () => {\n      const response = await fetch(`/api/invitation-links/${token}`);\n      if (!response.ok) {\n        const errorData = await response.json();\n        throw new Error(errorData.error || \"Invalid invitation link\");\n      }\n      return response.json();\n    },\n  });\n\n  const form = useForm<ExpertFormData>({\n    resolver: zodResolver(expertFormSchema),\n    defaultValues: {\n      name: \"\",\n      email: \"\",\n      phone: \"\",\n      linkedinUrl: \"\",\n      country: \"\",\n      timezone: \"\",\n      whatsapp: \"\",\n      expertise: \"\",\n      areasOfExpertise: \"\",\n      industry: \"\",\n      company: \"\",\n      jobTitle: \"\",\n      yearsOfExperience: 0,\n      hourlyRate: \"\",\n      bio: \"\",\n      termsAccepted: false,\n      lgpdAccepted: false,\n    },\n  });\n\n  const registerMutation = useMutation({\n    mutationFn: (data: InsertExpert) => apiRequest(\"POST\", `/api/register-expert/${token}`, data),\n    onSuccess: () => {\n      setIsSubmitted(true);\n      toast({ title: \"Registration successful! Welcome to Mirae Connext.\" });\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"Registration failed\",\n        description: error.message || \"Please try again.\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const onSubmit = (data: ExpertFormData) => {\n    const expertData: InsertExpert = {\n      ...data,\n      phone: data.phone || null,\n      linkedinUrl: data.linkedinUrl || null,\n      timezone: data.timezone || null,\n      whatsapp: data.whatsapp || null,\n      areasOfExpertise: data.areasOfExpertise ? data.areasOfExpertise.split(\",\").map(s => s.trim()).filter(Boolean) : null,\n      status: \"available\",\n    };\n    registerMutation.mutate(expertData);\n  };\n\n  if (isLoading) {\n    return (\n      <div className=\"flex min-h-screen items-center justify-center bg-background p-4\">\n        <Card className=\"w-full max-w-lg\">\n          <CardContent className=\"flex flex-col items-center gap-4 py-12\">\n            <Loader2 className=\"h-8 w-8 animate-spin text-primary\" />\n            <p className=\"text-muted-foreground\">Verifying invitation link...</p>\n          </CardContent>\n        </Card>\n      </div>\n    );\n  }\n\n  if (error || !invitationLink) {\n    return (\n      <div className=\"flex min-h-screen items-center justify-center bg-background p-4\">\n        <Card className=\"w-full max-w-lg\">\n          <CardContent className=\"flex flex-col items-center gap-4 py-12 text-center\">\n            <div className=\"flex h-16 w-16 items-center justify-center rounded-full bg-destructive/10\">\n              <AlertCircle className=\"h-8 w-8 text-destructive\" />\n            </div>\n            <div>\n              <h2 className=\"text-xl font-semibold\">Invalid Invitation</h2>\n              <p className=\"mt-2 text-muted-foreground\">\n                {(error as Error)?.message || \"This invitation link is invalid, expired, or has already been used.\"}\n              </p>\n            </div>\n            <p className=\"text-sm text-muted-foreground\">\n              Please contact Mirae Connext for a new invitation link.\n            </p>\n          </CardContent>\n        </Card>\n      </div>\n    );\n  }\n\n  if (isSubmitted) {\n    return (\n      <div className=\"flex min-h-screen items-center justify-center bg-background p-4\">\n        <Card className=\"w-full max-w-lg\">\n          <CardContent className=\"flex flex-col items-center gap-4 py-12 text-center\">\n            <div className=\"flex h-16 w-16 items-center justify-center rounded-full bg-green-500/10\">\n              <CheckCircle className=\"h-8 w-8 text-green-500\" />\n            </div>\n            <div>\n              <h2 className=\"text-xl font-semibold\">Registration Complete!</h2>\n              <p className=\"mt-2 text-muted-foreground\">\n                Thank you for registering with Mirae Connext. Our team will review your profile\n                and contact you soon with opportunities that match your expertise.\n              </p>\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"min-h-screen bg-background p-4 py-8\">\n      <div className=\"mx-auto max-w-2xl\">\n        <div className=\"mb-8 text-center\">\n          <div className=\"mx-auto mb-4 flex h-12 w-12 items-center justify-center rounded-lg bg-primary\">\n            <span className=\"text-lg font-bold text-primary-foreground\">M</span>\n          </div>\n          <h1 className=\"text-2xl font-bold\">Join Mirae Connext</h1>\n          <p className=\"mt-2 text-muted-foreground\">\n            Complete your expert profile to start receiving consultation opportunities.\n          </p>\n        </div>\n\n        <Card>\n          <CardHeader>\n            <CardTitle>Expert Registration</CardTitle>\n            <CardDescription>\n              Please fill in all required fields accurately. This information will be shared with\n              potential clients seeking expert consultations.\n            </CardDescription>\n          </CardHeader>\n          <CardContent>\n            <Form {...form}>\n              <form onSubmit={form.handleSubmit(onSubmit)} className=\"space-y-6\">\n                <div className=\"space-y-4\">\n                  <div className=\"flex items-center gap-2 border-b pb-2\">\n                    <User className=\"h-4 w-4 text-muted-foreground\" />\n                    <span className=\"font-medium\">Personal Information</span>\n                  </div>\n                  \n                  <div className=\"grid gap-4 sm:grid-cols-2\">\n                    <FormField\n                      control={form.control}\n                      name=\"name\"\n                      render={({ field }) => (\n                        <FormItem>\n                          <FormLabel>Full Name *</FormLabel>\n                          <FormControl>\n                            <Input placeholder=\"John Doe\" {...field} data-testid=\"input-expert-name\" />\n                          </FormControl>\n                          <FormMessage />\n                        </FormItem>\n                      )}\n                    />\n                    <FormField\n                      control={form.control}\n                      name=\"email\"\n                      render={({ field }) => (\n                        <FormItem>\n                          <FormLabel>Email *</FormLabel>\n                          <FormControl>\n                            <Input type=\"email\" placeholder=\"john@example.com\" {...field} data-testid=\"input-expert-email\" />\n                          </FormControl>\n                          <FormMessage />\n                        </FormItem>\n                      )}\n                    />\n                  </div>\n\n                  <div className=\"grid gap-4 sm:grid-cols-2\">\n                    <FormField\n                      control={form.control}\n                      name=\"phone\"\n                      render={({ field }) => (\n                        <FormItem>\n                          <FormLabel>Phone</FormLabel>\n                          <FormControl>\n                            <Input placeholder=\"+1 555 123 4567\" {...field} data-testid=\"input-expert-phone\" />\n                          </FormControl>\n                          <FormMessage />\n                        </FormItem>\n                      )}\n                    />\n                    <FormField\n                      control={form.control}\n                      name=\"whatsapp\"\n                      render={({ field }) => (\n                        <FormItem>\n                          <FormLabel>WhatsApp</FormLabel>\n                          <FormControl>\n                            <Input placeholder=\"+1 555 123 4567\" {...field} data-testid=\"input-expert-whatsapp\" />\n                          </FormControl>\n                          <FormMessage />\n                        </FormItem>\n                      )}\n                    />\n                  </div>\n\n                  <FormField\n                    control={form.control}\n                    name=\"linkedinUrl\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>LinkedIn Profile</FormLabel>\n                        <FormControl>\n                          <Input placeholder=\"https://linkedin.com/in/yourprofile\" {...field} data-testid=\"input-expert-linkedin\" />\n                        </FormControl>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n                </div>\n\n                <div className=\"space-y-4\">\n                  <div className=\"flex items-center gap-2 border-b pb-2\">\n                    <Globe className=\"h-4 w-4 text-muted-foreground\" />\n                    <span className=\"font-medium\">Location</span>\n                  </div>\n                  \n                  <div className=\"grid gap-4 sm:grid-cols-2\">\n                    <FormField\n                      control={form.control}\n                      name=\"country\"\n                      render={({ field }) => (\n                        <FormItem>\n                          <FormLabel>Country *</FormLabel>\n                          <FormControl>\n                            <Input placeholder=\"United States\" {...field} data-testid=\"input-expert-country\" />\n                          </FormControl>\n                          <FormMessage />\n                        </FormItem>\n                      )}\n                    />\n                    <FormField\n                      control={form.control}\n                      name=\"timezone\"\n                      render={({ field }) => (\n                        <FormItem>\n                          <FormLabel>Timezone</FormLabel>\n                          <Select onValueChange={field.onChange} value={field.value}>\n                            <FormControl>\n                              <SelectTrigger data-testid=\"select-expert-timezone\">\n                                <SelectValue placeholder=\"Select timezone\" />\n                              </SelectTrigger>\n                            </FormControl>\n                            <SelectContent>\n                              {timezones.map((tz) => (\n                                <SelectItem key={tz} value={tz}>\n                                  {tz}\n                                </SelectItem>\n                              ))}\n                            </SelectContent>\n                          </Select>\n                          <FormMessage />\n                        </FormItem>\n                      )}\n                    />\n                  </div>\n                </div>\n\n                <div className=\"space-y-4\">\n                  <div className=\"flex items-center gap-2 border-b pb-2\">\n                    <Building className=\"h-4 w-4 text-muted-foreground\" />\n                    <span className=\"font-medium\">Professional Information</span>\n                  </div>\n                  \n                  <div className=\"grid gap-4 sm:grid-cols-2\">\n                    <FormField\n                      control={form.control}\n                      name=\"company\"\n                      render={({ field }) => (\n                        <FormItem>\n                          <FormLabel>Company *</FormLabel>\n                          <FormControl>\n                            <Input placeholder=\"Acme Corp\" {...field} data-testid=\"input-expert-company\" />\n                          </FormControl>\n                          <FormMessage />\n                        </FormItem>\n                      )}\n                    />\n                    <FormField\n                      control={form.control}\n                      name=\"jobTitle\"\n                      render={({ field }) => (\n                        <FormItem>\n                          <FormLabel>Job Title *</FormLabel>\n                          <FormControl>\n                            <Input placeholder=\"Senior Director\" {...field} data-testid=\"input-expert-job-title\" />\n                          </FormControl>\n                          <FormMessage />\n                        </FormItem>\n                      )}\n                    />\n                  </div>\n\n                  <div className=\"grid gap-4 sm:grid-cols-2\">\n                    <FormField\n                      control={form.control}\n                      name=\"industry\"\n                      render={({ field }) => (\n                        <FormItem>\n                          <FormLabel>Industry *</FormLabel>\n                          <Select onValueChange={field.onChange} value={field.value}>\n                            <FormControl>\n                              <SelectTrigger data-testid=\"select-expert-industry\">\n                                <SelectValue placeholder=\"Select industry\" />\n                              </SelectTrigger>\n                            </FormControl>\n                            <SelectContent>\n                              {industries.map((industry) => (\n                                <SelectItem key={industry} value={industry}>\n                                  {industry}\n                                </SelectItem>\n                              ))}\n                            </SelectContent>\n                          </Select>\n                          <FormMessage />\n                        </FormItem>\n                      )}\n                    />\n                    <FormField\n                      control={form.control}\n                      name=\"yearsOfExperience\"\n                      render={({ field }) => (\n                        <FormItem>\n                          <FormLabel>Years of Experience *</FormLabel>\n                          <FormControl>\n                            <Input\n                              type=\"number\"\n                              min={0}\n                              {...field}\n                              onChange={(e) => field.onChange(parseInt(e.target.value) || 0)}\n                              data-testid=\"input-expert-experience\"\n                            />\n                          </FormControl>\n                          <FormMessage />\n                        </FormItem>\n                      )}\n                    />\n                  </div>\n\n                  <FormField\n                    control={form.control}\n                    name=\"expertise\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>Primary Expertise *</FormLabel>\n                        <FormControl>\n                          <Input placeholder=\"e.g., Machine Learning, Supply Chain\" {...field} data-testid=\"input-expert-expertise\" />\n                        </FormControl>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n\n                  <FormField\n                    control={form.control}\n                    name=\"areasOfExpertise\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>Additional Areas of Expertise</FormLabel>\n                        <FormControl>\n                          <Textarea\n                            placeholder=\"List other areas where you can provide expert consultation...\"\n                            className=\"resize-none\"\n                            rows={2}\n                            {...field}\n                            data-testid=\"input-expert-areas\"\n                          />\n                        </FormControl>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n\n                  <FormField\n                    control={form.control}\n                    name=\"hourlyRate\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>Hourly Rate (USD) *</FormLabel>\n                        <FormControl>\n                          <Input placeholder=\"250.00\" {...field} data-testid=\"input-expert-rate\" />\n                        </FormControl>\n                        <FormDescription>\n                          Your standard consulting rate per hour in USD.\n                        </FormDescription>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n\n                  <FormField\n                    control={form.control}\n                    name=\"bio\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>Professional Bio *</FormLabel>\n                        <FormControl>\n                          <Textarea\n                            placeholder=\"Describe your professional background, key achievements, and areas of expertise...\"\n                            className=\"resize-none\"\n                            rows={4}\n                            {...field}\n                            data-testid=\"input-expert-bio\"\n                          />\n                        </FormControl>\n                        <FormDescription>\n                          Minimum 50 characters. This will be shared with potential clients.\n                        </FormDescription>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n                </div>\n\n                <div className=\"space-y-4 rounded-lg border bg-muted/30 p-4\">\n                  <FormField\n                    control={form.control}\n                    name=\"termsAccepted\"\n                    render={({ field }) => (\n                      <FormItem className=\"flex flex-row items-start space-x-3 space-y-0\">\n                        <FormControl>\n                          <Checkbox\n                            checked={field.value}\n                            onCheckedChange={field.onChange}\n                            data-testid=\"checkbox-terms\"\n                          />\n                        </FormControl>\n                        <div className=\"space-y-1 leading-none\">\n                          <FormLabel className=\"cursor-pointer\">\n                            I accept the Terms of Service *\n                          </FormLabel>\n                          <FormDescription>\n                            By checking this box, you agree to Mirae Connext's terms of service\n                            and expert network participation guidelines.\n                          </FormDescription>\n                          <FormMessage />\n                        </div>\n                      </FormItem>\n                    )}\n                  />\n\n                  <FormField\n                    control={form.control}\n                    name=\"lgpdAccepted\"\n                    render={({ field }) => (\n                      <FormItem className=\"flex flex-row items-start space-x-3 space-y-0\">\n                        <FormControl>\n                          <Checkbox\n                            checked={field.value}\n                            onCheckedChange={field.onChange}\n                            data-testid=\"checkbox-lgpd\"\n                          />\n                        </FormControl>\n                        <div className=\"space-y-1 leading-none\">\n                          <FormLabel className=\"cursor-pointer\">\n                            LGPD Data Processing Consent *\n                          </FormLabel>\n                          <FormDescription>\n                            I consent to the processing of my personal data in accordance with\n                            Brazil's General Data Protection Law (LGPD) for the purpose of\n                            expert network services.\n                          </FormDescription>\n                          <FormMessage />\n                        </div>\n                      </FormItem>\n                    )}\n                  />\n                </div>\n\n                <Button\n                  type=\"submit\"\n                  className=\"w-full\"\n                  disabled={registerMutation.isPending}\n                  data-testid=\"button-register\"\n                >\n                  {registerMutation.isPending ? (\n                    <>\n                      <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />\n                      Registering...\n                    </>\n                  ) : (\n                    \"Complete Registration\"\n                  )}\n                </Button>\n              </form>\n            </Form>\n          </CardContent>\n        </Card>\n      </div>\n    </div>\n  );\n}\n","path":null,"size_bytes":23779,"size_tokens":null},"client/src/components/ui/table.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Table = React.forwardRef<\n  HTMLTableElement,\n  React.HTMLAttributes<HTMLTableElement>\n>(({ className, ...props }, ref) => (\n  <div className=\"relative w-full overflow-auto\">\n    <table\n      ref={ref}\n      className={cn(\"w-full caption-bottom text-sm\", className)}\n      {...props}\n    />\n  </div>\n))\nTable.displayName = \"Table\"\n\nconst TableHeader = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <thead ref={ref} className={cn(\"[&_tr]:border-b\", className)} {...props} />\n))\nTableHeader.displayName = \"TableHeader\"\n\nconst TableBody = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <tbody\n    ref={ref}\n    className={cn(\"[&_tr:last-child]:border-0\", className)}\n    {...props}\n  />\n))\nTableBody.displayName = \"TableBody\"\n\nconst TableFooter = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <tfoot\n    ref={ref}\n    className={cn(\n      \"border-t bg-muted/50 font-medium [&>tr]:last:border-b-0\",\n      className\n    )}\n    {...props}\n  />\n))\nTableFooter.displayName = \"TableFooter\"\n\nconst TableRow = React.forwardRef<\n  HTMLTableRowElement,\n  React.HTMLAttributes<HTMLTableRowElement>\n>(({ className, ...props }, ref) => (\n  <tr\n    ref={ref}\n    className={cn(\n      \"border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted\",\n      className\n    )}\n    {...props}\n  />\n))\nTableRow.displayName = \"TableRow\"\n\nconst TableHead = React.forwardRef<\n  HTMLTableCellElement,\n  React.ThHTMLAttributes<HTMLTableCellElement>\n>(({ className, ...props }, ref) => (\n  <th\n    ref={ref}\n    className={cn(\n      \"h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0\",\n      className\n    )}\n    {...props}\n  />\n))\nTableHead.displayName = \"TableHead\"\n\nconst TableCell = React.forwardRef<\n  HTMLTableCellElement,\n  React.TdHTMLAttributes<HTMLTableCellElement>\n>(({ className, ...props }, ref) => (\n  <td\n    ref={ref}\n    className={cn(\"p-4 align-middle [&:has([role=checkbox])]:pr-0\", className)}\n    {...props}\n  />\n))\nTableCell.displayName = \"TableCell\"\n\nconst TableCaption = React.forwardRef<\n  HTMLTableCaptionElement,\n  React.HTMLAttributes<HTMLTableCaptionElement>\n>(({ className, ...props }, ref) => (\n  <caption\n    ref={ref}\n    className={cn(\"mt-4 text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nTableCaption.displayName = \"TableCaption\"\n\nexport {\n  Table,\n  TableHeader,\n  TableBody,\n  TableFooter,\n  TableHead,\n  TableRow,\n  TableCell,\n  TableCaption,\n}\n","path":null,"size_bytes":2765,"size_tokens":null},"client/src/components/ui/aspect-ratio.tsx":{"content":"import * as AspectRatioPrimitive from \"@radix-ui/react-aspect-ratio\"\n\nconst AspectRatio = AspectRatioPrimitive.Root\n\nexport { AspectRatio }\n","path":null,"size_bytes":140,"size_tokens":null},"postcss.config.js":{"content":"export default {\n  plugins: {\n    tailwindcss: {},\n    autoprefixer: {},\n  },\n}\n","path":null,"size_bytes":80,"size_tokens":null},"client/src/lib/utils.ts":{"content":"import { clsx, type ClassValue } from \"clsx\"\nimport { twMerge } from \"tailwind-merge\"\n\nexport function cn(...inputs: ClassValue[]) {\n  return twMerge(clsx(inputs))\n}\n","path":null,"size_bytes":166,"size_tokens":null},"client/src/components/ui/badge.tsx":{"content":"import * as React from \"react\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst badgeVariants = cva(\n  // Whitespace-nowrap: Badges should never wrap.\n  \"whitespace-nowrap inline-flex items-center rounded-md border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2\" +\n  \" hover-elevate \" ,\n  {\n    variants: {\n      variant: {\n        default:\n          \"border-transparent bg-primary text-primary-foreground shadow-xs\",\n        secondary: \"border-transparent bg-secondary text-secondary-foreground\",\n        destructive:\n          \"border-transparent bg-destructive text-destructive-foreground shadow-xs\",\n\n        outline: \" border [border-color:var(--badge-outline)] shadow-xs\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  },\n)\n\nexport interface BadgeProps\n  extends React.HTMLAttributes<HTMLDivElement>,\n    VariantProps<typeof badgeVariants> {}\n\nfunction Badge({ className, variant, ...props }: BadgeProps) {\n  return (\n    <div className={cn(badgeVariants({ variant }), className)} {...props} />\n  );\n}\n\nexport { Badge, badgeVariants }\n","path":null,"size_bytes":1202,"size_tokens":null},"client/src/lib/permissions.ts":{"content":"export type UserRole = \"admin\" | \"pm\" | \"ra\" | \"finance\";\n\nexport type PageKey = \n  | \"dashboard\"\n  | \"projects\"\n  | \"experts\"\n  | \"clients\"\n  | \"insight-hub\"\n  | \"consultations\"\n  | \"usage\"\n  | \"analytics\"\n  | \"employees\"\n  | \"invites\"\n  | \"ra-performance\"\n  | \"settings\";\n\n/**\n * Normalize role names from database to internal system roles.\n * Maps \"Research Associate\" to \"ra\" for backward compatibility.\n */\nexport function normalizeRole(dbRole: string | null | undefined): UserRole | undefined {\n  if (!dbRole) return undefined;\n  const normalized = dbRole.toLowerCase();\n  if (normalized === \"research associate\" || normalized === \"ra\") return \"ra\";\n  if (normalized === \"pm\" || normalized === \"project manager\") return \"pm\";\n  if (normalized === \"admin\" || normalized === \"administrator\") return \"admin\";\n  if (normalized === \"finance\") return \"finance\";\n  return undefined;\n}\n\nexport const ROLE_PERMISSIONS: Record<UserRole, PageKey[]> = {\n  admin: [\n    \"dashboard\",\n    \"projects\",\n    \"experts\",\n    \"clients\",\n    \"insight-hub\",\n    \"consultations\",\n    \"usage\",\n    \"analytics\",\n    \"employees\",\n    \"invites\",\n    \"ra-performance\",\n    \"settings\",\n  ],\n  pm: [\n    \"dashboard\",\n    \"projects\",\n    \"experts\",\n    \"clients\",\n    \"insight-hub\",\n    \"consultations\",\n    \"usage\",\n    \"invites\",\n    \"ra-performance\",\n  ],\n  ra: [\n    \"dashboard\",\n    \"projects\",\n    \"experts\",\n    \"clients\",\n    \"insight-hub\",\n    \"consultations\",\n    \"invites\",\n  ],\n  finance: [\n    \"dashboard\",\n    \"clients\",\n    \"usage\",\n    \"analytics\",\n    \"ra-performance\",\n  ],\n};\n\nexport const PAGE_TO_ROUTE: Record<PageKey, string> = {\n  dashboard: \"/\",\n  projects: \"/projects\",\n  experts: \"/experts\",\n  clients: \"/clients\",\n  \"insight-hub\": \"/insight-hub\",\n  consultations: \"/consultations\",\n  usage: \"/usage\",\n  analytics: \"/analytics\",\n  employees: \"/employees\",\n  invites: \"/invites\",\n  \"ra-performance\": \"/ra-performance\",\n  settings: \"/settings\",\n};\n\nexport const ROUTE_TO_PAGE: Record<string, PageKey> = {\n  \"/\": \"dashboard\",\n  \"/projects\": \"projects\",\n  \"/experts\": \"experts\",\n  \"/clients\": \"clients\",\n  \"/insight-hub\": \"insight-hub\",\n  \"/consultations\": \"consultations\",\n  \"/usage\": \"usage\",\n  \"/analytics\": \"analytics\",\n  \"/employees\": \"employees\",\n  \"/invites\": \"invites\",\n  \"/ra-performance\": \"ra-performance\",\n  \"/settings\": \"settings\",\n};\n\nexport function canAccessPage(role: string | undefined, page: PageKey): boolean {\n  if (!role) return false;\n  const normalized = normalizeRole(role);\n  if (!normalized) return false;\n  const permissions = ROLE_PERMISSIONS[normalized];\n  if (!permissions) return false;\n  return permissions.includes(page);\n}\n\nexport function canAccessRoute(role: string | undefined, route: string): boolean {\n  const basePath = route.split(\"/\").slice(0, 2).join(\"/\") || \"/\";\n  const page = ROUTE_TO_PAGE[basePath];\n  if (!page) return true;\n  return canAccessPage(role, page);\n}\n\nexport function getAllowedPages(role: string | undefined): PageKey[] {\n  if (!role) return [];\n  const normalized = normalizeRole(role);\n  if (!normalized) return [];\n  return ROLE_PERMISSIONS[normalized] || [];\n}\n","path":null,"size_bytes":3122,"size_tokens":null},"client/src/components/ui/select.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as SelectPrimitive from \"@radix-ui/react-select\"\nimport { Check, ChevronDown, ChevronUp } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Select = SelectPrimitive.Root\n\nconst SelectGroup = SelectPrimitive.Group\n\nconst SelectValue = SelectPrimitive.Value\n\nconst SelectTrigger = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <SelectPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"flex h-9 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background data-[placeholder]:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <SelectPrimitive.Icon asChild>\n      <ChevronDown className=\"h-4 w-4 opacity-50\" />\n    </SelectPrimitive.Icon>\n  </SelectPrimitive.Trigger>\n))\nSelectTrigger.displayName = SelectPrimitive.Trigger.displayName\n\nconst SelectScrollUpButton = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.ScrollUpButton>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.ScrollUpButton>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.ScrollUpButton\n    ref={ref}\n    className={cn(\n      \"flex cursor-default items-center justify-center py-1\",\n      className\n    )}\n    {...props}\n  >\n    <ChevronUp className=\"h-4 w-4\" />\n  </SelectPrimitive.ScrollUpButton>\n))\nSelectScrollUpButton.displayName = SelectPrimitive.ScrollUpButton.displayName\n\nconst SelectScrollDownButton = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.ScrollDownButton>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.ScrollDownButton>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.ScrollDownButton\n    ref={ref}\n    className={cn(\n      \"flex cursor-default items-center justify-center py-1\",\n      className\n    )}\n    {...props}\n  >\n    <ChevronDown className=\"h-4 w-4\" />\n  </SelectPrimitive.ScrollDownButton>\n))\nSelectScrollDownButton.displayName =\n  SelectPrimitive.ScrollDownButton.displayName\n\nconst SelectContent = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Content>\n>(({ className, children, position = \"popper\", ...props }, ref) => (\n  <SelectPrimitive.Portal>\n    <SelectPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"relative z-50 max-h-[--radix-select-content-available-height] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-select-content-transform-origin]\",\n        position === \"popper\" &&\n          \"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1\",\n        className\n      )}\n      position={position}\n      {...props}\n    >\n      <SelectScrollUpButton />\n      <SelectPrimitive.Viewport\n        className={cn(\n          \"p-1\",\n          position === \"popper\" &&\n            \"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]\"\n        )}\n      >\n        {children}\n      </SelectPrimitive.Viewport>\n      <SelectScrollDownButton />\n    </SelectPrimitive.Content>\n  </SelectPrimitive.Portal>\n))\nSelectContent.displayName = SelectPrimitive.Content.displayName\n\nconst SelectLabel = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Label>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.Label\n    ref={ref}\n    className={cn(\"py-1.5 pl-8 pr-2 text-sm font-semibold\", className)}\n    {...props}\n  />\n))\nSelectLabel.displayName = SelectPrimitive.Label.displayName\n\nconst SelectItem = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Item>\n>(({ className, children, ...props }, ref) => (\n  <SelectPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <SelectPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </SelectPrimitive.ItemIndicator>\n    </span>\n\n    <SelectPrimitive.ItemText>{children}</SelectPrimitive.ItemText>\n  </SelectPrimitive.Item>\n))\nSelectItem.displayName = SelectPrimitive.Item.displayName\n\nconst SelectSeparator = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nSelectSeparator.displayName = SelectPrimitive.Separator.displayName\n\nexport {\n  Select,\n  SelectGroup,\n  SelectValue,\n  SelectTrigger,\n  SelectContent,\n  SelectLabel,\n  SelectItem,\n  SelectSeparator,\n  SelectScrollUpButton,\n  SelectScrollDownButton,\n}\n","path":null,"size_bytes":5741,"size_tokens":null},"drizzle.config.ts":{"content":"import { defineConfig } from \"drizzle-kit\";\n\nif (!process.env.DATABASE_URL) {\n  throw new Error(\"DATABASE_URL, ensure the database is provisioned\");\n}\n\nexport default defineConfig({\n  out: \"./migrations\",\n  schema: \"./shared/schema.ts\",\n  dialect: \"postgresql\",\n  dbCredentials: {\n    url: process.env.DATABASE_URL,\n  },\n});\n","path":null,"size_bytes":325,"size_tokens":null},"client/src/pages/insight-hub.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { useForm } from \"react-hook-form\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport { z } from \"zod\";\nimport { Plus, Pencil, Trash2, FileQuestion } from \"lucide-react\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Checkbox } from \"@/components/ui/checkbox\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogDescription,\n  DialogFooter,\n  DialogHeader,\n  DialogTitle,\n} from \"@/components/ui/dialog\";\nimport {\n  Form,\n  FormControl,\n  FormField,\n  FormItem,\n  FormLabel,\n  FormMessage,\n} from \"@/components/ui/form\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport {\n  AlertDialog,\n  AlertDialogAction,\n  AlertDialogCancel,\n  AlertDialogContent,\n  AlertDialogDescription,\n  AlertDialogFooter,\n  AlertDialogHeader,\n  AlertDialogTitle,\n} from \"@/components/ui/alert-dialog\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { queryClient, apiRequest } from \"@/lib/queryClient\";\nimport { EmptyState } from \"@/components/empty-state\";\nimport type { Project, VettingQuestion, InsertVettingQuestion } from \"@shared/schema\";\n\nconst questionFormSchema = z.object({\n  projectId: z.coerce.number().min(1, \"Please select a project\"),\n  question: z.string().min(1, \"Question is required\"),\n  isRequired: z.boolean().default(true),\n});\n\ntype QuestionFormData = z.infer<typeof questionFormSchema>;\n\nexport default function InsightHub() {\n  const { toast } = useToast();\n  const [selectedProjectId, setSelectedProjectId] = useState<number | null>(null);\n  const [isDialogOpen, setIsDialogOpen] = useState(false);\n  const [editingQuestion, setEditingQuestion] = useState<VettingQuestion | null>(null);\n  const [deletingQuestion, setDeletingQuestion] = useState<VettingQuestion | null>(null);\n\n  const { data: projects, isLoading: projectsLoading } = useQuery<Project[]>({\n    queryKey: [\"/api/projects\"],\n  });\n\n  const { data: questions, isLoading: questionsLoading } = useQuery<VettingQuestion[]>({\n    queryKey: [\"/api/vetting-questions\"],\n  });\n\n  const form = useForm<QuestionFormData>({\n    resolver: zodResolver(questionFormSchema),\n    defaultValues: {\n      projectId: 0,\n      question: \"\",\n      isRequired: true,\n    },\n  });\n\n  const createMutation = useMutation({\n    mutationFn: (data: InsertVettingQuestion) =>\n      apiRequest(\"POST\", \"/api/vetting-questions\", data),\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/vetting-questions\"] });\n      setIsDialogOpen(false);\n      form.reset();\n      toast({ title: \"Question added successfully\" });\n    },\n    onError: () => {\n      toast({ title: \"Failed to add question\", variant: \"destructive\" });\n    },\n  });\n\n  const updateMutation = useMutation({\n    mutationFn: (data: InsertVettingQuestion & { id: number }) =>\n      apiRequest(\"PATCH\", `/api/vetting-questions/${data.id}`, data),\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/vetting-questions\"] });\n      setIsDialogOpen(false);\n      setEditingQuestion(null);\n      form.reset();\n      toast({ title: \"Question updated successfully\" });\n    },\n    onError: () => {\n      toast({ title: \"Failed to update question\", variant: \"destructive\" });\n    },\n  });\n\n  const deleteMutation = useMutation({\n    mutationFn: (id: number) => apiRequest(\"DELETE\", `/api/vetting-questions/${id}`),\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/vetting-questions\"] });\n      setDeletingQuestion(null);\n      toast({ title: \"Question deleted successfully\" });\n    },\n    onError: () => {\n      toast({ title: \"Failed to delete question\", variant: \"destructive\" });\n    },\n  });\n\n  const filteredQuestions = selectedProjectId\n    ? questions?.filter((q) => q.projectId === selectedProjectId)\n    : questions;\n\n  const getProjectName = (projectId: number) => {\n    return projects?.find((p) => p.id === projectId)?.name || \"Unknown Project\";\n  };\n\n  const handleOpenDialog = (question?: VettingQuestion) => {\n    if (question) {\n      setEditingQuestion(question);\n      form.reset({\n        projectId: question.projectId,\n        question: question.question,\n        isRequired: question.isRequired,\n      });\n    } else {\n      setEditingQuestion(null);\n      form.reset({\n        projectId: selectedProjectId || 0,\n        question: \"\",\n        isRequired: true,\n      });\n    }\n    setIsDialogOpen(true);\n  };\n\n  const onSubmit = (data: QuestionFormData) => {\n    const questionData: InsertVettingQuestion = {\n      ...data,\n      orderIndex: filteredQuestions?.length || 0,\n    };\n\n    if (editingQuestion) {\n      updateMutation.mutate({ ...questionData, id: editingQuestion.id });\n    } else {\n      createMutation.mutate(questionData);\n    }\n  };\n\n  const groupedQuestions = questions?.reduce(\n    (acc, q) => {\n      if (!acc[q.projectId]) {\n        acc[q.projectId] = [];\n      }\n      acc[q.projectId].push(q);\n      return acc;\n    },\n    {} as Record<number, VettingQuestion[]>\n  );\n\n  return (\n    <div className=\"space-y-6 p-8\">\n      <div className=\"flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between\">\n        <div>\n          <h1 className=\"text-3xl font-semibold text-foreground\">Insight Hub</h1>\n          <p className=\"text-sm text-muted-foreground\">\n            Create and manage screening insights for each project.\n          </p>\n        </div>\n        <Button\n          onClick={() => handleOpenDialog()}\n          className=\"gap-2\"\n          disabled={!projects?.length}\n          data-testid=\"button-add-question\"\n        >\n          <Plus className=\"h-4 w-4\" /> Add Question\n        </Button>\n      </div>\n\n      <div className=\"flex items-center gap-4\">\n        <Select\n          value={selectedProjectId?.toString() || \"all\"}\n          onValueChange={(val) => setSelectedProjectId(val === \"all\" ? null : Number(val))}\n        >\n          <SelectTrigger className=\"w-64\" data-testid=\"select-project-filter\">\n            <SelectValue placeholder=\"Filter by project\" />\n          </SelectTrigger>\n          <SelectContent>\n            <SelectItem value=\"all\">All Projects</SelectItem>\n            {projects?.map((project) => (\n              <SelectItem key={project.id} value={project.id.toString()}>\n                {project.name}\n              </SelectItem>\n            ))}\n          </SelectContent>\n        </Select>\n      </div>\n\n      {projectsLoading || questionsLoading ? (\n        <div className=\"space-y-4\">\n          {Array.from({ length: 3 }).map((_, i) => (\n            <Card key={i}>\n              <CardContent className=\"p-6\">\n                <Skeleton className=\"h-24 w-full\" />\n              </CardContent>\n            </Card>\n          ))}\n        </div>\n      ) : !projects?.length ? (\n        <EmptyState\n          icon={FileQuestion}\n          title=\"No projects available\"\n          description=\"Create a project first before adding screening questions.\"\n        />\n      ) : selectedProjectId ? (\n        <Card>\n          <CardHeader className=\"flex flex-row items-center justify-between gap-4 space-y-0 pb-4\">\n            <CardTitle className=\"text-base font-medium\">\n              {getProjectName(selectedProjectId)}\n            </CardTitle>\n            <Badge variant=\"secondary\" className=\"no-default-hover-elevate no-default-active-elevate\">\n              {filteredQuestions?.length || 0} questions\n            </Badge>\n          </CardHeader>\n          <CardContent>\n            {!filteredQuestions?.length ? (\n              <EmptyState\n                icon={FileQuestion}\n                title=\"No questions yet\"\n                description=\"Add screening questions for this project.\"\n                action={\n                  <Button onClick={() => handleOpenDialog()} className=\"gap-2\" data-testid=\"button-add-first-question\">\n                    <Plus className=\"h-4 w-4\" /> Add Question\n                  </Button>\n                }\n              />\n            ) : (\n              <div className=\"space-y-3\">\n                {filteredQuestions\n                  .sort((a, b) => a.orderIndex - b.orderIndex)\n                  .map((question, index) => (\n                    <div\n                      key={question.id}\n                      className=\"flex items-start gap-3 rounded-lg border border-border bg-card p-4\"\n                      data-testid={`question-item-${question.id}`}\n                    >\n                      <div className=\"flex h-6 w-6 shrink-0 items-center justify-center rounded-full bg-muted text-xs font-medium text-muted-foreground\">\n                        {index + 1}\n                      </div>\n                      <div className=\"flex-1 space-y-1\">\n                        <p className=\"font-medium text-foreground\">{question.question}</p>\n                        <div className=\"flex items-center gap-2\">\n                          {question.isRequired ? (\n                            <Badge\n                              variant=\"secondary\"\n                              className=\"bg-primary/10 text-primary no-default-hover-elevate no-default-active-elevate\"\n                            >\n                              Required\n                            </Badge>\n                          ) : (\n                            <Badge variant=\"secondary\" className=\"no-default-hover-elevate no-default-active-elevate\">\n                              Optional\n                            </Badge>\n                          )}\n                        </div>\n                      </div>\n                      <div className=\"flex gap-1\">\n                        <Button\n                          variant=\"ghost\"\n                          size=\"icon\"\n                          onClick={() => handleOpenDialog(question)}\n                          data-testid={`button-edit-question-${question.id}`}\n                        >\n                          <Pencil className=\"h-4 w-4\" />\n                        </Button>\n                        <Button\n                          variant=\"ghost\"\n                          size=\"icon\"\n                          onClick={() => setDeletingQuestion(question)}\n                          data-testid={`button-delete-question-${question.id}`}\n                        >\n                          <Trash2 className=\"h-4 w-4 text-destructive\" />\n                        </Button>\n                      </div>\n                    </div>\n                  ))}\n              </div>\n            )}\n          </CardContent>\n        </Card>\n      ) : (\n        <div className=\"space-y-4\">\n          {Object.entries(groupedQuestions || {}).length === 0 ? (\n            <EmptyState\n              icon={FileQuestion}\n              title=\"No screening questions yet\"\n              description=\"Add screening questions to any of your projects.\"\n              action={\n                <Button onClick={() => handleOpenDialog()} className=\"gap-2\" data-testid=\"button-add-first-question-all\">\n                  <Plus className=\"h-4 w-4\" /> Add Question\n                </Button>\n              }\n            />\n          ) : (\n            Object.entries(groupedQuestions || {}).map(([projectId, projectQuestions]) => (\n              <Card key={projectId}>\n                <CardHeader className=\"flex flex-row items-center justify-between gap-4 space-y-0 pb-4\">\n                  <CardTitle className=\"text-base font-medium\">\n                    {getProjectName(Number(projectId))}\n                  </CardTitle>\n                  <Badge variant=\"secondary\" className=\"no-default-hover-elevate no-default-active-elevate\">\n                    {projectQuestions.length} questions\n                  </Badge>\n                </CardHeader>\n                <CardContent>\n                  <div className=\"space-y-3\">\n                    {projectQuestions\n                      .sort((a, b) => a.orderIndex - b.orderIndex)\n                      .map((question, index) => (\n                        <div\n                          key={question.id}\n                          className=\"flex items-start gap-3 rounded-lg border border-border bg-background p-4\"\n                          data-testid={`question-item-${question.id}`}\n                        >\n                          <div className=\"flex h-6 w-6 shrink-0 items-center justify-center rounded-full bg-muted text-xs font-medium text-muted-foreground\">\n                            {index + 1}\n                          </div>\n                          <div className=\"flex-1 space-y-1\">\n                            <p className=\"font-medium text-foreground\">{question.question}</p>\n                            {question.isRequired && (\n                              <Badge\n                                variant=\"secondary\"\n                                className=\"bg-primary/10 text-primary no-default-hover-elevate no-default-active-elevate\"\n                              >\n                                Required\n                              </Badge>\n                            )}\n                          </div>\n                          <div className=\"flex gap-1\">\n                            <Button\n                              variant=\"ghost\"\n                              size=\"icon\"\n                              onClick={() => handleOpenDialog(question)}\n                              data-testid={`button-edit-question-${question.id}`}\n                            >\n                              <Pencil className=\"h-4 w-4\" />\n                            </Button>\n                            <Button\n                              variant=\"ghost\"\n                              size=\"icon\"\n                              onClick={() => setDeletingQuestion(question)}\n                              data-testid={`button-delete-question-${question.id}`}\n                            >\n                              <Trash2 className=\"h-4 w-4 text-destructive\" />\n                            </Button>\n                          </div>\n                        </div>\n                      ))}\n                  </div>\n                </CardContent>\n              </Card>\n            ))\n          )}\n        </div>\n      )}\n\n      <Dialog open={isDialogOpen} onOpenChange={setIsDialogOpen}>\n        <DialogContent className=\"max-w-lg\">\n          <DialogHeader>\n            <DialogTitle>\n              {editingQuestion ? \"Edit Question\" : \"Add Question\"}\n            </DialogTitle>\n            <DialogDescription>\n              {editingQuestion\n                ? \"Update the question details.\"\n                : \"Create a new screening question for the project.\"}\n            </DialogDescription>\n          </DialogHeader>\n          <Form {...form}>\n            <form onSubmit={form.handleSubmit(onSubmit)} className=\"space-y-4\">\n              <FormField\n                control={form.control}\n                name=\"projectId\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>Project *</FormLabel>\n                    <Select\n                      onValueChange={(val) => field.onChange(Number(val))}\n                      value={field.value?.toString() || \"\"}\n                    >\n                      <FormControl>\n                        <SelectTrigger data-testid=\"select-question-project\">\n                          <SelectValue placeholder=\"Select a project\" />\n                        </SelectTrigger>\n                      </FormControl>\n                      <SelectContent>\n                        {projects?.map((project) => (\n                          <SelectItem key={project.id} value={project.id.toString()}>\n                            {project.name}\n                          </SelectItem>\n                        ))}\n                      </SelectContent>\n                    </Select>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n\n              <FormField\n                control={form.control}\n                name=\"question\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>Question *</FormLabel>\n                    <FormControl>\n                      <Textarea\n                        placeholder=\"Enter your screening question...\"\n                        className=\"resize-none\"\n                        rows={3}\n                        {...field}\n                        data-testid=\"input-question-text\"\n                      />\n                    </FormControl>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n\n              <FormField\n                control={form.control}\n                name=\"isRequired\"\n                render={({ field }) => (\n                  <FormItem className=\"flex flex-row items-center gap-3 space-y-0\">\n                    <FormControl>\n                      <Checkbox\n                        checked={field.value}\n                        onCheckedChange={field.onChange}\n                        data-testid=\"checkbox-required\"\n                      />\n                    </FormControl>\n                    <FormLabel className=\"font-normal\">This question is required</FormLabel>\n                  </FormItem>\n                )}\n              />\n\n              <DialogFooter>\n                <Button\n                  type=\"button\"\n                  variant=\"outline\"\n                  onClick={() => setIsDialogOpen(false)}\n                  data-testid=\"button-cancel-question\"\n                >\n                  Cancel\n                </Button>\n                <Button\n                  type=\"submit\"\n                  disabled={createMutation.isPending || updateMutation.isPending}\n                  data-testid=\"button-save-question\"\n                >\n                  {createMutation.isPending || updateMutation.isPending\n                    ? \"Saving...\"\n                    : editingQuestion\n                      ? \"Update Question\"\n                      : \"Add Question\"}\n                </Button>\n              </DialogFooter>\n            </form>\n          </Form>\n        </DialogContent>\n      </Dialog>\n\n      <AlertDialog open={!!deletingQuestion} onOpenChange={() => setDeletingQuestion(null)}>\n        <AlertDialogContent>\n          <AlertDialogHeader>\n            <AlertDialogTitle>Delete Question</AlertDialogTitle>\n            <AlertDialogDescription>\n              Are you sure you want to delete this question? This action cannot be undone.\n            </AlertDialogDescription>\n          </AlertDialogHeader>\n          <AlertDialogFooter>\n            <AlertDialogCancel data-testid=\"button-cancel-delete-question\">Cancel</AlertDialogCancel>\n            <AlertDialogAction\n              onClick={() => deletingQuestion && deleteMutation.mutate(deletingQuestion.id)}\n              className=\"bg-destructive text-destructive-foreground hover:bg-destructive/90\"\n              data-testid=\"button-confirm-delete-question\"\n            >\n              {deleteMutation.isPending ? \"Deleting...\" : \"Delete\"}\n            </AlertDialogAction>\n          </AlertDialogFooter>\n        </AlertDialogContent>\n      </AlertDialog>\n    </div>\n  );\n}\n","path":null,"size_bytes":19488,"size_tokens":null},"client/src/components/status-badge.tsx":{"content":"import { Badge } from \"@/components/ui/badge\";\nimport { cn } from \"@/lib/utils\";\n\ninterface StatusBadgeProps {\n  status: string;\n  type?: \"project\" | \"expert\" | \"assignment\" | \"call\";\n}\n\nconst projectStatusStyles: Record<string, string> = {\n  new: \"bg-slate-100 text-slate-800 dark:bg-slate-900/30 dark:text-slate-400\",\n  sourcing: \"bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-400\",\n  pending_client_review: \"bg-amber-100 text-amber-800 dark:bg-amber-900/30 dark:text-amber-400\",\n  client_selected: \"bg-purple-100 text-purple-800 dark:bg-purple-900/30 dark:text-purple-400\",\n  scheduled: \"bg-cyan-100 text-cyan-800 dark:bg-cyan-900/30 dark:text-cyan-400\",\n  completed: \"bg-emerald-100 text-emerald-800 dark:bg-emerald-900/30 dark:text-emerald-400\",\n  cancelled: \"bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-400\",\n  pending: \"bg-amber-100 text-amber-800 dark:bg-amber-900/30 dark:text-amber-400\",\n  active: \"bg-emerald-100 text-emerald-800 dark:bg-emerald-900/30 dark:text-emerald-400\",\n  archived: \"bg-gray-100 text-gray-800 dark:bg-gray-900/30 dark:text-gray-400\",\n};\n\nconst expertStatusStyles: Record<string, string> = {\n  available: \"bg-emerald-100 text-emerald-800 dark:bg-emerald-900/30 dark:text-emerald-400\",\n  busy: \"bg-amber-100 text-amber-800 dark:bg-amber-900/30 dark:text-amber-400\",\n  inactive: \"bg-gray-100 text-gray-800 dark:bg-gray-900/30 dark:text-gray-400\",\n};\n\nconst assignmentStatusStyles: Record<string, string> = {\n  assigned: \"bg-slate-100 text-slate-800 dark:bg-slate-900/30 dark:text-slate-400\",\n  invited: \"bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-400\",\n  accepted: \"bg-emerald-100 text-emerald-800 dark:bg-emerald-900/30 dark:text-emerald-400\",\n  declined: \"bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-400\",\n  client_selected: \"bg-purple-100 text-purple-800 dark:bg-purple-900/30 dark:text-purple-400\",\n  scheduled: \"bg-cyan-100 text-cyan-800 dark:bg-cyan-900/30 dark:text-cyan-400\",\n  completed: \"bg-emerald-100 text-emerald-800 dark:bg-emerald-900/30 dark:text-emerald-400\",\n  confirmed: \"bg-emerald-100 text-emerald-800 dark:bg-emerald-900/30 dark:text-emerald-400\",\n  cancelled: \"bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-400\",\n};\n\nconst callStatusStyles: Record<string, string> = {\n  pending: \"bg-slate-100 text-slate-800 dark:bg-slate-900/30 dark:text-slate-400\",\n  scheduled: \"bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-400\",\n  completed: \"bg-emerald-100 text-emerald-800 dark:bg-emerald-900/30 dark:text-emerald-400\",\n  cancelled: \"bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-400\",\n  no_show: \"bg-amber-100 text-amber-800 dark:bg-amber-900/30 dark:text-amber-400\",\n};\n\nconst statusLabels: Record<string, string> = {\n  pending_client_review: \"Client Review\",\n  client_selected: \"Client Selected\",\n  no_show: \"No Show\",\n};\n\nexport function StatusBadge({ status, type = \"project\" }: StatusBadgeProps) {\n  const styles = \n    type === \"expert\" \n      ? expertStatusStyles \n      : type === \"assignment\" \n        ? assignmentStatusStyles \n        : type === \"call\"\n          ? callStatusStyles\n          : projectStatusStyles;\n\n  const statusStyle = styles[status.toLowerCase()] || projectStatusStyles.pending;\n  const label = statusLabels[status.toLowerCase()] || status.replace(/_/g, \" \");\n\n  return (\n    <Badge\n      variant=\"secondary\"\n      className={cn(\n        \"rounded-full px-2.5 py-0.5 text-xs font-medium capitalize no-default-hover-elevate no-default-active-elevate\",\n        statusStyle\n      )}\n      data-testid={`badge-status-${status.toLowerCase()}`}\n    >\n      {label}\n    </Badge>\n  );\n}\n","path":null,"size_bytes":3649,"size_tokens":null},"client/src/components/ui/button.tsx":{"content":"import * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst buttonVariants = cva(\n  \"inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\" +\n  \" hover-elevate active-elevate-2\",\n  {\n    variants: {\n      variant: {\n        default:\n          \"bg-primary text-primary-foreground border border-primary-border\",\n        destructive:\n          \"bg-destructive text-destructive-foreground border border-destructive-border\",\n        outline:\n          // Shows the background color of whatever card / sidebar / accent background it is inside of.\n          // Inherits the current text color.\n          \" border [border-color:var(--button-outline)]  shadow-xs active:shadow-none \",\n        secondary: \"border bg-secondary text-secondary-foreground border border-secondary-border \",\n        // Add a transparent border so that when someone toggles a border on later, it doesn't shift layout/size.\n        ghost: \"border border-transparent\",\n      },\n      // Heights are set as \"min\" heights, because sometimes Ai will place large amount of content\n      // inside buttons. With a min-height they will look appropriate with small amounts of content,\n      // but will expand to fit large amounts of content.\n      size: {\n        default: \"min-h-9 px-4 py-2\",\n        sm: \"min-h-8 rounded-md px-3 text-xs\",\n        lg: \"min-h-10 rounded-md px-8\",\n        icon: \"h-9 w-9\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  },\n)\n\nexport interface ButtonProps\n  extends React.ButtonHTMLAttributes<HTMLButtonElement>,\n    VariantProps<typeof buttonVariants> {\n  asChild?: boolean\n}\n\nconst Button = React.forwardRef<HTMLButtonElement, ButtonProps>(\n  ({ className, variant, size, asChild = false, ...props }, ref) => {\n    const Comp = asChild ? Slot : \"button\"\n    return (\n      <Comp\n        className={cn(buttonVariants({ variant, size, className }))}\n        ref={ref}\n        {...props}\n      />\n    )\n  },\n)\nButton.displayName = \"Button\"\n\nexport { Button, buttonVariants }\n","path":null,"size_bytes":2359,"size_tokens":null},"client/src/components/ui/context-menu.tsx":{"content":"import * as React from \"react\"\nimport * as ContextMenuPrimitive from \"@radix-ui/react-context-menu\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ContextMenu = ContextMenuPrimitive.Root\n\nconst ContextMenuTrigger = ContextMenuPrimitive.Trigger\n\nconst ContextMenuGroup = ContextMenuPrimitive.Group\n\nconst ContextMenuPortal = ContextMenuPrimitive.Portal\n\nconst ContextMenuSub = ContextMenuPrimitive.Sub\n\nconst ContextMenuRadioGroup = ContextMenuPrimitive.RadioGroup\n\nconst ContextMenuSubTrigger = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <ContextMenuPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto h-4 w-4\" />\n  </ContextMenuPrimitive.SubTrigger>\n))\nContextMenuSubTrigger.displayName = ContextMenuPrimitive.SubTrigger.displayName\n\nconst ContextMenuSubContent = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-context-menu-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuSubContent.displayName = ContextMenuPrimitive.SubContent.displayName\n\nconst ContextMenuContent = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.Portal>\n    <ContextMenuPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"z-50 max-h-[--radix-context-menu-content-available-height] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md animate-in fade-in-80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-context-menu-content-transform-origin]\",\n        className\n      )}\n      {...props}\n    />\n  </ContextMenuPrimitive.Portal>\n))\nContextMenuContent.displayName = ContextMenuPrimitive.Content.displayName\n\nconst ContextMenuItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <ContextMenuPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuItem.displayName = ContextMenuPrimitive.Item.displayName\n\nconst ContextMenuCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <ContextMenuPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <ContextMenuPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </ContextMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </ContextMenuPrimitive.CheckboxItem>\n))\nContextMenuCheckboxItem.displayName =\n  ContextMenuPrimitive.CheckboxItem.displayName\n\nconst ContextMenuRadioItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <ContextMenuPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <ContextMenuPrimitive.ItemIndicator>\n        <Circle className=\"h-2 w-2 fill-current\" />\n      </ContextMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </ContextMenuPrimitive.RadioItem>\n))\nContextMenuRadioItem.displayName = ContextMenuPrimitive.RadioItem.displayName\n\nconst ContextMenuLabel = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <ContextMenuPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold text-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuLabel.displayName = ContextMenuPrimitive.Label.displayName\n\nconst ContextMenuSeparator = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-border\", className)}\n    {...props}\n  />\n))\nContextMenuSeparator.displayName = ContextMenuPrimitive.Separator.displayName\n\nconst ContextMenuShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nContextMenuShortcut.displayName = \"ContextMenuShortcut\"\n\nexport {\n  ContextMenu,\n  ContextMenuTrigger,\n  ContextMenuContent,\n  ContextMenuItem,\n  ContextMenuCheckboxItem,\n  ContextMenuRadioItem,\n  ContextMenuLabel,\n  ContextMenuSeparator,\n  ContextMenuShortcut,\n  ContextMenuGroup,\n  ContextMenuPortal,\n  ContextMenuSub,\n  ContextMenuSubContent,\n  ContextMenuSubTrigger,\n  ContextMenuRadioGroup,\n}\n","path":null,"size_bytes":7428,"size_tokens":null},"client/src/pages/usage.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { useForm } from \"react-hook-form\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport { format } from \"date-fns\";\nimport { z } from \"zod\";\nimport { Plus, Clock, CreditCard, BarChart3, Download, Trash2 } from \"lucide-react\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Progress } from \"@/components/ui/progress\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogDescription,\n  DialogFooter,\n  DialogHeader,\n  DialogTitle,\n} from \"@/components/ui/dialog\";\nimport {\n  Form,\n  FormControl,\n  FormField,\n  FormItem,\n  FormLabel,\n  FormMessage,\n} from \"@/components/ui/form\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport {\n  Table,\n  TableBody,\n  TableCell,\n  TableHead,\n  TableHeader,\n  TableRow,\n} from \"@/components/ui/table\";\nimport {\n  AlertDialog,\n  AlertDialogAction,\n  AlertDialogCancel,\n  AlertDialogContent,\n  AlertDialogDescription,\n  AlertDialogFooter,\n  AlertDialogHeader,\n  AlertDialogTitle,\n} from \"@/components/ui/alert-dialog\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { queryClient, apiRequest } from \"@/lib/queryClient\";\nimport { MetricCard } from \"@/components/metric-card\";\nimport { EmptyState } from \"@/components/empty-state\";\nimport { DataTableSkeleton } from \"@/components/data-table-skeleton\";\nimport type { Project, Expert, UsageRecord, InsertUsageRecord } from \"@shared/schema\";\n\nconst usageFormSchema = z.object({\n  projectId: z.coerce.number().min(1, \"Please select a project\"),\n  expertId: z.coerce.number().min(1, \"Please select an expert\"),\n  callDate: z.string().min(1, \"Call date is required\"),\n  durationMinutes: z.coerce.number().min(1, \"Duration must be at least 1 minute\"),\n  creditsUsed: z.string().min(1, \"Credits used is required\"),\n  notes: z.string().optional(),\n});\n\ntype UsageFormData = z.infer<typeof usageFormSchema>;\n\nconst CREDIT_RATE = 0.5;\nconst MONTHLY_CREDIT_BUDGET = 1000;\n\nexport default function Usage() {\n  const { toast } = useToast();\n  const [isDialogOpen, setIsDialogOpen] = useState(false);\n  const [deletingRecord, setDeletingRecord] = useState<UsageRecord | null>(null);\n\n  const { data: projects, isLoading: projectsLoading } = useQuery<Project[]>({\n    queryKey: [\"/api/projects\"],\n  });\n\n  const { data: experts, isLoading: expertsLoading } = useQuery<Expert[]>({\n    queryKey: [\"/api/experts\"],\n  });\n\n  const { data: usageRecords, isLoading: usageLoading } = useQuery<UsageRecord[]>({\n    queryKey: [\"/api/usage\"],\n  });\n\n  const form = useForm<UsageFormData>({\n    resolver: zodResolver(usageFormSchema),\n    defaultValues: {\n      projectId: 0,\n      expertId: 0,\n      callDate: format(new Date(), \"yyyy-MM-dd\"),\n      durationMinutes: 30,\n      creditsUsed: \"15\",\n      notes: \"\",\n    },\n  });\n\n  const createMutation = useMutation({\n    mutationFn: (data: InsertUsageRecord) => apiRequest(\"POST\", \"/api/usage\", data),\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/usage\"] });\n      setIsDialogOpen(false);\n      form.reset();\n      toast({ title: \"Usage record added successfully\" });\n    },\n    onError: () => {\n      toast({ title: \"Failed to add usage record\", variant: \"destructive\" });\n    },\n  });\n\n  const deleteMutation = useMutation({\n    mutationFn: (id: number) => apiRequest(\"DELETE\", `/api/usage/${id}`),\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/usage\"] });\n      setDeletingRecord(null);\n      toast({ title: \"Usage record deleted\" });\n    },\n    onError: () => {\n      toast({ title: \"Failed to delete record\", variant: \"destructive\" });\n    },\n  });\n\n  const totalMinutes = usageRecords?.reduce((sum, r) => sum + r.durationMinutes, 0) || 0;\n  const totalCredits = usageRecords?.reduce((sum, r) => sum + Number(r.creditsUsed), 0) || 0;\n  const totalCalls = usageRecords?.length || 0;\n  const averageDuration = totalCalls > 0 ? Math.round(totalMinutes / totalCalls) : 0;\n  const creditUsagePercent = Math.min((totalCredits / MONTHLY_CREDIT_BUDGET) * 100, 100);\n\n  const getProjectName = (projectId: number) =>\n    projects?.find((p) => p.id === projectId)?.name || \"Unknown\";\n  const getExpertName = (expertId: number) =>\n    experts?.find((e) => e.id === expertId)?.name || \"Unknown\";\n\n  const handleDurationChange = (minutes: number) => {\n    form.setValue(\"durationMinutes\", minutes);\n    form.setValue(\"creditsUsed\", (minutes * CREDIT_RATE).toFixed(2));\n  };\n\n  const onSubmit = (data: UsageFormData) => {\n    const usageData: InsertUsageRecord = {\n      ...data,\n      callDate: new Date(data.callDate),\n      notes: data.notes || null,\n    };\n    createMutation.mutate(usageData);\n  };\n\n  const exportToCSV = () => {\n    if (!usageRecords?.length) return;\n\n    const headers = [\"Date\", \"Project\", \"Expert\", \"Duration (min)\", \"Credits Used\", \"Notes\"];\n    const rows = usageRecords.map((r) => [\n      format(new Date(r.callDate), \"yyyy-MM-dd\"),\n      getProjectName(r.projectId),\n      getExpertName(r.expertId),\n      r.durationMinutes,\n      r.creditsUsed,\n      r.notes || \"\",\n    ]);\n\n    const csvContent = [headers, ...rows].map((row) => row.join(\",\")).join(\"\\n\");\n    const blob = new Blob([csvContent], { type: \"text/csv\" });\n    const url = window.URL.createObjectURL(blob);\n    const a = document.createElement(\"a\");\n    a.href = url;\n    a.download = `usage-report-${format(new Date(), \"yyyy-MM-dd\")}.csv`;\n    a.click();\n    window.URL.revokeObjectURL(url);\n\n    toast({ title: \"Report exported successfully\" });\n  };\n\n  const isLoading = projectsLoading || expertsLoading || usageLoading;\n\n  return (\n    <div className=\"space-y-6 p-8\">\n      <div className=\"flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between\">\n        <div>\n          <h1 className=\"text-3xl font-semibold text-foreground\">Usage Tracker</h1>\n          <p className=\"text-sm text-muted-foreground\">\n            Track call durations and credit consumption.\n          </p>\n        </div>\n        <div className=\"flex gap-2\">\n          <Button\n            variant=\"outline\"\n            onClick={exportToCSV}\n            disabled={!usageRecords?.length}\n            className=\"gap-2\"\n            data-testid=\"button-export-usage\"\n          >\n            <Download className=\"h-4 w-4\" /> Export\n          </Button>\n          <Button\n            onClick={() => setIsDialogOpen(true)}\n            className=\"gap-2\"\n            disabled={!projects?.length || !experts?.length}\n            data-testid=\"button-log-usage\"\n          >\n            <Plus className=\"h-4 w-4\" /> Log Usage\n          </Button>\n        </div>\n      </div>\n\n      <div className=\"grid gap-4 sm:grid-cols-2 lg:grid-cols-4\">\n        <MetricCard\n          title=\"Total Calls\"\n          value={totalCalls}\n          subtitle=\"All time\"\n          icon={BarChart3}\n        />\n        <MetricCard\n          title=\"Total Minutes\"\n          value={totalMinutes.toLocaleString()}\n          subtitle={`~${Math.round(totalMinutes / 60)} hours`}\n          icon={Clock}\n        />\n        <MetricCard\n          title=\"Credits Used\"\n          value={totalCredits.toFixed(2)}\n          subtitle={`of ${MONTHLY_CREDIT_BUDGET} budget`}\n          icon={CreditCard}\n        />\n        <MetricCard\n          title=\"Avg. Duration\"\n          value={`${averageDuration} min`}\n          subtitle=\"Per call\"\n          icon={Clock}\n        />\n      </div>\n\n      <Card>\n        <CardHeader className=\"pb-4\">\n          <div className=\"flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between\">\n            <CardTitle className=\"text-base font-medium\">Credit Usage</CardTitle>\n            <span className=\"font-mono text-sm text-muted-foreground\">\n              {totalCredits.toFixed(2)} / {MONTHLY_CREDIT_BUDGET} CU\n            </span>\n          </div>\n        </CardHeader>\n        <CardContent>\n          <Progress value={creditUsagePercent} className=\"h-2\" />\n          <p className=\"mt-2 text-xs text-muted-foreground\">\n            {creditUsagePercent.toFixed(1)}% of monthly budget used\n          </p>\n        </CardContent>\n      </Card>\n\n      <Card>\n        <CardHeader className=\"flex flex-row items-center justify-between gap-4 space-y-0 pb-4\">\n          <CardTitle className=\"text-base font-medium\">Usage History</CardTitle>\n        </CardHeader>\n        <CardContent>\n          {isLoading ? (\n            <DataTableSkeleton columns={6} rows={5} />\n          ) : !usageRecords?.length ? (\n            <EmptyState\n              icon={BarChart3}\n              title=\"No usage records\"\n              description=\"Log your first call to start tracking usage.\"\n              action={\n                projects?.length && experts?.length ? (\n                  <Button onClick={() => setIsDialogOpen(true)} className=\"gap-2\" data-testid=\"button-log-first-usage\">\n                    <Plus className=\"h-4 w-4\" /> Log Usage\n                  </Button>\n                ) : undefined\n              }\n            />\n          ) : (\n            <div className=\"overflow-x-auto\">\n              <Table>\n                <TableHeader>\n                  <TableRow>\n                    <TableHead className=\"text-xs font-semibold uppercase\">Date</TableHead>\n                    <TableHead className=\"text-xs font-semibold uppercase\">Project</TableHead>\n                    <TableHead className=\"text-xs font-semibold uppercase\">Expert</TableHead>\n                    <TableHead className=\"text-right text-xs font-semibold uppercase\">\n                      Duration\n                    </TableHead>\n                    <TableHead className=\"text-right text-xs font-semibold uppercase\">\n                      Credits\n                    </TableHead>\n                    <TableHead className=\"text-right text-xs font-semibold uppercase\">\n                      Actions\n                    </TableHead>\n                  </TableRow>\n                </TableHeader>\n                <TableBody>\n                  {usageRecords\n                    .sort((a, b) => new Date(b.callDate).getTime() - new Date(a.callDate).getTime())\n                    .map((record) => (\n                      <TableRow key={record.id} data-testid={`row-usage-${record.id}`}>\n                        <TableCell className=\"font-mono text-sm\">\n                          {format(new Date(record.callDate), \"MMM dd, yyyy\")}\n                        </TableCell>\n                        <TableCell>{getProjectName(record.projectId)}</TableCell>\n                        <TableCell>{getExpertName(record.expertId)}</TableCell>\n                        <TableCell className=\"text-right font-mono\">\n                          {record.durationMinutes} min\n                        </TableCell>\n                        <TableCell className=\"text-right font-mono\">\n                          {Number(record.creditsUsed).toFixed(2)} CU\n                        </TableCell>\n                        <TableCell className=\"text-right\">\n                          <Button\n                            variant=\"ghost\"\n                            size=\"icon\"\n                            onClick={() => setDeletingRecord(record)}\n                            data-testid={`button-delete-usage-${record.id}`}\n                          >\n                            <Trash2 className=\"h-4 w-4 text-destructive\" />\n                          </Button>\n                        </TableCell>\n                      </TableRow>\n                    ))}\n                </TableBody>\n              </Table>\n            </div>\n          )}\n        </CardContent>\n      </Card>\n\n      <Dialog open={isDialogOpen} onOpenChange={setIsDialogOpen}>\n        <DialogContent className=\"max-w-lg\">\n          <DialogHeader>\n            <DialogTitle>Log Usage</DialogTitle>\n            <DialogDescription>Record a call session with an expert.</DialogDescription>\n          </DialogHeader>\n          <Form {...form}>\n            <form onSubmit={form.handleSubmit(onSubmit)} className=\"space-y-4\">\n              <FormField\n                control={form.control}\n                name=\"projectId\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>Project *</FormLabel>\n                    <Select\n                      onValueChange={(val) => field.onChange(Number(val))}\n                      value={field.value?.toString() || \"\"}\n                    >\n                      <FormControl>\n                        <SelectTrigger data-testid=\"select-usage-project\">\n                          <SelectValue placeholder=\"Select a project\" />\n                        </SelectTrigger>\n                      </FormControl>\n                      <SelectContent>\n                        {projects?.map((project) => (\n                          <SelectItem key={project.id} value={project.id.toString()}>\n                            {project.name}\n                          </SelectItem>\n                        ))}\n                      </SelectContent>\n                    </Select>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n\n              <FormField\n                control={form.control}\n                name=\"expertId\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>Expert *</FormLabel>\n                    <Select\n                      onValueChange={(val) => field.onChange(Number(val))}\n                      value={field.value?.toString() || \"\"}\n                    >\n                      <FormControl>\n                        <SelectTrigger data-testid=\"select-usage-expert\">\n                          <SelectValue placeholder=\"Select an expert\" />\n                        </SelectTrigger>\n                      </FormControl>\n                      <SelectContent>\n                        {experts?.map((expert) => (\n                          <SelectItem key={expert.id} value={expert.id.toString()}>\n                            {expert.name}\n                          </SelectItem>\n                        ))}\n                      </SelectContent>\n                    </Select>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n\n              <div className=\"grid gap-4 sm:grid-cols-2\">\n                <FormField\n                  control={form.control}\n                  name=\"callDate\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Call Date *</FormLabel>\n                      <FormControl>\n                        <Input type=\"date\" {...field} data-testid=\"input-call-date\" />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n                <FormField\n                  control={form.control}\n                  name=\"durationMinutes\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Duration (minutes) *</FormLabel>\n                      <FormControl>\n                        <Input\n                          type=\"number\"\n                          min={1}\n                          {...field}\n                          onChange={(e) => handleDurationChange(Number(e.target.value))}\n                          data-testid=\"input-duration\"\n                        />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n              </div>\n\n              <FormField\n                control={form.control}\n                name=\"creditsUsed\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>Credits Used *</FormLabel>\n                    <FormControl>\n                      <Input\n                        type=\"number\"\n                        step=\"0.01\"\n                        {...field}\n                        data-testid=\"input-credits\"\n                      />\n                    </FormControl>\n                    <p className=\"text-xs text-muted-foreground\">\n                      Auto-calculated at {CREDIT_RATE} CU per minute\n                    </p>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n\n              <FormField\n                control={form.control}\n                name=\"notes\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>Notes</FormLabel>\n                    <FormControl>\n                      <Textarea\n                        placeholder=\"Optional notes about the call...\"\n                        className=\"resize-none\"\n                        rows={2}\n                        {...field}\n                        data-testid=\"input-usage-notes\"\n                      />\n                    </FormControl>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n\n              <DialogFooter>\n                <Button\n                  type=\"button\"\n                  variant=\"outline\"\n                  onClick={() => setIsDialogOpen(false)}\n                  data-testid=\"button-cancel-usage\"\n                >\n                  Cancel\n                </Button>\n                <Button\n                  type=\"submit\"\n                  disabled={createMutation.isPending}\n                  data-testid=\"button-save-usage\"\n                >\n                  {createMutation.isPending ? \"Saving...\" : \"Log Usage\"}\n                </Button>\n              </DialogFooter>\n            </form>\n          </Form>\n        </DialogContent>\n      </Dialog>\n\n      <AlertDialog open={!!deletingRecord} onOpenChange={() => setDeletingRecord(null)}>\n        <AlertDialogContent>\n          <AlertDialogHeader>\n            <AlertDialogTitle>Delete Usage Record</AlertDialogTitle>\n            <AlertDialogDescription>\n              Are you sure you want to delete this usage record? This action cannot be undone.\n            </AlertDialogDescription>\n          </AlertDialogHeader>\n          <AlertDialogFooter>\n            <AlertDialogCancel data-testid=\"button-cancel-delete-usage\">Cancel</AlertDialogCancel>\n            <AlertDialogAction\n              onClick={() => deletingRecord && deleteMutation.mutate(deletingRecord.id)}\n              className=\"bg-destructive text-destructive-foreground hover:bg-destructive/90\"\n              data-testid=\"button-confirm-delete-usage\"\n            >\n              {deleteMutation.isPending ? \"Deleting...\" : \"Delete\"}\n            </AlertDialogAction>\n          </AlertDialogFooter>\n        </AlertDialogContent>\n      </AlertDialog>\n    </div>\n  );\n}\n","path":null,"size_bytes":18952,"size_tokens":null},"client/src/components/ui/command.tsx":{"content":"import * as React from \"react\"\nimport { type DialogProps } from \"@radix-ui/react-dialog\"\nimport { Command as CommandPrimitive } from \"cmdk\"\nimport { Search } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Dialog, DialogContent } from \"@/components/ui/dialog\"\n\nconst Command = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive\n    ref={ref}\n    className={cn(\n      \"flex h-full w-full flex-col overflow-hidden rounded-md bg-popover text-popover-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nCommand.displayName = CommandPrimitive.displayName\n\nconst CommandDialog = ({ children, ...props }: DialogProps) => {\n  return (\n    <Dialog {...props}>\n      <DialogContent className=\"overflow-hidden p-0 shadow-lg\">\n        <Command className=\"[&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground [&_[cmdk-group]:not([hidden])_~[cmdk-group]]:pt-0 [&_[cmdk-group]]:px-2 [&_[cmdk-input-wrapper]_svg]:h-5 [&_[cmdk-input-wrapper]_svg]:w-5 [&_[cmdk-input]]:h-12 [&_[cmdk-item]]:px-2 [&_[cmdk-item]]:py-3 [&_[cmdk-item]_svg]:h-5 [&_[cmdk-item]_svg]:w-5\">\n          {children}\n        </Command>\n      </DialogContent>\n    </Dialog>\n  )\n}\n\nconst CommandInput = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Input>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Input>\n>(({ className, ...props }, ref) => (\n  <div className=\"flex items-center border-b px-3\" cmdk-input-wrapper=\"\">\n    <Search className=\"mr-2 h-4 w-4 shrink-0 opacity-50\" />\n    <CommandPrimitive.Input\n      ref={ref}\n      className={cn(\n        \"flex h-11 w-full rounded-md bg-transparent py-3 text-sm outline-none placeholder:text-muted-foreground disabled:cursor-not-allowed disabled:opacity-50\",\n        className\n      )}\n      {...props}\n    />\n  </div>\n))\n\nCommandInput.displayName = CommandPrimitive.Input.displayName\n\nconst CommandList = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.List\n    ref={ref}\n    className={cn(\"max-h-[300px] overflow-y-auto overflow-x-hidden\", className)}\n    {...props}\n  />\n))\n\nCommandList.displayName = CommandPrimitive.List.displayName\n\nconst CommandEmpty = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Empty>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Empty>\n>((props, ref) => (\n  <CommandPrimitive.Empty\n    ref={ref}\n    className=\"py-6 text-center text-sm\"\n    {...props}\n  />\n))\n\nCommandEmpty.displayName = CommandPrimitive.Empty.displayName\n\nconst CommandGroup = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Group>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Group>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Group\n    ref={ref}\n    className={cn(\n      \"overflow-hidden p-1 text-foreground [&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:py-1.5 [&_[cmdk-group-heading]]:text-xs [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\n\nCommandGroup.displayName = CommandPrimitive.Group.displayName\n\nconst CommandSeparator = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 h-px bg-border\", className)}\n    {...props}\n  />\n))\nCommandSeparator.displayName = CommandPrimitive.Separator.displayName\n\nconst CommandItem = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Item>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default gap-2 select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none data-[disabled=true]:pointer-events-none data-[selected='true']:bg-accent data-[selected=true]:text-accent-foreground data-[disabled=true]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n      className\n    )}\n    {...props}\n  />\n))\n\nCommandItem.displayName = CommandPrimitive.Item.displayName\n\nconst CommandShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nCommandShortcut.displayName = \"CommandShortcut\"\n\nexport {\n  Command,\n  CommandDialog,\n  CommandInput,\n  CommandList,\n  CommandEmpty,\n  CommandGroup,\n  CommandItem,\n  CommandShortcut,\n  CommandSeparator,\n}\n","path":null,"size_bytes":4885,"size_tokens":null},"client/src/components/ui/navigation-menu.tsx":{"content":"import * as React from \"react\"\nimport * as NavigationMenuPrimitive from \"@radix-ui/react-navigation-menu\"\nimport { cva } from \"class-variance-authority\"\nimport { ChevronDown } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst NavigationMenu = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Root>\n>(({ className, children, ...props }, ref) => (\n  <NavigationMenuPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative z-10 flex max-w-max flex-1 items-center justify-center\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <NavigationMenuViewport />\n  </NavigationMenuPrimitive.Root>\n))\nNavigationMenu.displayName = NavigationMenuPrimitive.Root.displayName\n\nconst NavigationMenuList = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.List\n    ref={ref}\n    className={cn(\n      \"group flex flex-1 list-none items-center justify-center space-x-1\",\n      className\n    )}\n    {...props}\n  />\n))\nNavigationMenuList.displayName = NavigationMenuPrimitive.List.displayName\n\nconst NavigationMenuItem = NavigationMenuPrimitive.Item\n\nconst navigationMenuTriggerStyle = cva(\n  \"group inline-flex h-10 w-max items-center justify-center rounded-md bg-background px-4 py-2 text-sm font-medium transition-colors hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground focus:outline-none disabled:pointer-events-none disabled:opacity-50 data-[state=open]:text-accent-foreground data-[state=open]:bg-accent/50 data-[state=open]:hover:bg-accent data-[state=open]:focus:bg-accent\"\n)\n\nconst NavigationMenuTrigger = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <NavigationMenuPrimitive.Trigger\n    ref={ref}\n    className={cn(navigationMenuTriggerStyle(), \"group\", className)}\n    {...props}\n  >\n    {children}{\" \"}\n    <ChevronDown\n      className=\"relative top-[1px] ml-1 h-3 w-3 transition duration-200 group-data-[state=open]:rotate-180\"\n      aria-hidden=\"true\"\n    />\n  </NavigationMenuPrimitive.Trigger>\n))\nNavigationMenuTrigger.displayName = NavigationMenuPrimitive.Trigger.displayName\n\nconst NavigationMenuContent = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.Content\n    ref={ref}\n    className={cn(\n      \"left-0 top-0 w-full data-[motion^=from-]:animate-in data-[motion^=to-]:animate-out data-[motion^=from-]:fade-in data-[motion^=to-]:fade-out data-[motion=from-end]:slide-in-from-right-52 data-[motion=from-start]:slide-in-from-left-52 data-[motion=to-end]:slide-out-to-right-52 data-[motion=to-start]:slide-out-to-left-52 md:absolute md:w-auto \",\n      className\n    )}\n    {...props}\n  />\n))\nNavigationMenuContent.displayName = NavigationMenuPrimitive.Content.displayName\n\nconst NavigationMenuLink = NavigationMenuPrimitive.Link\n\nconst NavigationMenuViewport = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Viewport>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Viewport>\n>(({ className, ...props }, ref) => (\n  <div className={cn(\"absolute left-0 top-full flex justify-center\")}>\n    <NavigationMenuPrimitive.Viewport\n      className={cn(\n        \"origin-top-center relative mt-1.5 h-[var(--radix-navigation-menu-viewport-height)] w-full overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-90 md:w-[var(--radix-navigation-menu-viewport-width)]\",\n        className\n      )}\n      ref={ref}\n      {...props}\n    />\n  </div>\n))\nNavigationMenuViewport.displayName =\n  NavigationMenuPrimitive.Viewport.displayName\n\nconst NavigationMenuIndicator = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Indicator>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Indicator>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.Indicator\n    ref={ref}\n    className={cn(\n      \"top-full z-[1] flex h-1.5 items-end justify-center overflow-hidden data-[state=visible]:animate-in data-[state=hidden]:animate-out data-[state=hidden]:fade-out data-[state=visible]:fade-in\",\n      className\n    )}\n    {...props}\n  >\n    <div className=\"relative top-[60%] h-2 w-2 rotate-45 rounded-tl-sm bg-border shadow-md\" />\n  </NavigationMenuPrimitive.Indicator>\n))\nNavigationMenuIndicator.displayName =\n  NavigationMenuPrimitive.Indicator.displayName\n\nexport {\n  navigationMenuTriggerStyle,\n  NavigationMenu,\n  NavigationMenuList,\n  NavigationMenuItem,\n  NavigationMenuContent,\n  NavigationMenuTrigger,\n  NavigationMenuLink,\n  NavigationMenuIndicator,\n  NavigationMenuViewport,\n}\n","path":null,"size_bytes":5128,"size_tokens":null},"client/src/components/ui/toaster.tsx":{"content":"import { useToast } from \"@/hooks/use-toast\"\nimport {\n  Toast,\n  ToastClose,\n  ToastDescription,\n  ToastProvider,\n  ToastTitle,\n  ToastViewport,\n} from \"@/components/ui/toast\"\n\nexport function Toaster() {\n  const { toasts } = useToast()\n\n  return (\n    <ToastProvider>\n      {toasts.map(function ({ id, title, description, action, ...props }) {\n        return (\n          <Toast key={id} {...props}>\n            <div className=\"grid gap-1\">\n              {title && <ToastTitle>{title}</ToastTitle>}\n              {description && (\n                <ToastDescription>{description}</ToastDescription>\n              )}\n            </div>\n            {action}\n            <ToastClose />\n          </Toast>\n        )\n      })}\n      <ToastViewport />\n    </ToastProvider>\n  )\n}\n","path":null,"size_bytes":772,"size_tokens":null},"client/src/components/ui/avatar.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as AvatarPrimitive from \"@radix-ui/react-avatar\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Avatar = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Root\n    ref={ref}\n    className={cn(`\n      after:content-[''] after:block after:absolute after:inset-0 after:rounded-full after:pointer-events-none after:border after:border-black/10 dark:after:border-white/10\n      relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full`,\n      className\n    )}\n    {...props}\n  />\n))\nAvatar.displayName = AvatarPrimitive.Root.displayName\n\nconst AvatarImage = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Image>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Image>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Image\n    ref={ref}\n    className={cn(\"aspect-square h-full w-full\", className)}\n    {...props}\n  />\n))\nAvatarImage.displayName = AvatarPrimitive.Image.displayName\n\nconst AvatarFallback = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Fallback>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Fallback>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Fallback\n    ref={ref}\n    className={cn(\n      \"flex h-full w-full items-center justify-center rounded-full bg-muted\",\n      className\n    )}\n    {...props}\n  />\n))\nAvatarFallback.displayName = AvatarPrimitive.Fallback.displayName\n\nexport { Avatar, AvatarImage, AvatarFallback }\n","path":null,"size_bytes":1592,"size_tokens":null},"client/src/components/app-sidebar.tsx":{"content":"import { Link, useLocation } from \"wouter\";\nimport {\n  LayoutDashboard,\n  Briefcase,\n  Users,\n  FileQuestion,\n  UserPlus,\n  BarChart3,\n  TrendingUp,\n  Building2,\n  Phone,\n  LogOut,\n  UsersRound,\n  Settings,\n  Mail,\n  Award,\n} from \"lucide-react\";\nimport {\n  Sidebar,\n  SidebarContent,\n  SidebarGroup,\n  SidebarGroupContent,\n  SidebarGroupLabel,\n  SidebarHeader,\n  SidebarMenu,\n  SidebarMenuButton,\n  SidebarMenuItem,\n  SidebarFooter,\n} from \"@/components/ui/sidebar\";\nimport { Button } from \"@/components/ui/button\";\nimport { useAuth } from \"@/lib/auth\";\nimport { canAccessPage, type PageKey } from \"@/lib/permissions\";\nimport logoUrl from \"@assets/Logo_1764382033313.png\";\n\ninterface NavItem {\n  title: string;\n  url: string;\n  icon: any;\n  pageKey: PageKey;\n}\n\nconst mainNavItems: NavItem[] = [\n  {\n    title: \"Dashboard\",\n    url: \"/\",\n    icon: LayoutDashboard,\n    pageKey: \"dashboard\",\n  },\n  {\n    title: \"Projects\",\n    url: \"/projects\",\n    icon: Briefcase,\n    pageKey: \"projects\",\n  },\n  {\n    title: \"Experts\",\n    url: \"/experts\",\n    icon: Users,\n    pageKey: \"experts\",\n  },\n  {\n    title: \"Clients\",\n    url: \"/clients\",\n    icon: Building2,\n    pageKey: \"clients\",\n  },\n];\n\nconst managementItems: NavItem[] = [\n  {\n    title: \"Insight Hub\",\n    url: \"/insight-hub\",\n    icon: FileQuestion,\n    pageKey: \"insight-hub\",\n  },\n  {\n    title: \"Consultations\",\n    url: \"/consultations\",\n    icon: Phone,\n    pageKey: \"consultations\",\n  },\n  {\n    title: \"Invites\",\n    url: \"/invites\",\n    icon: Mail,\n    pageKey: \"invites\",\n  },\n  {\n    title: \"Usage Tracker\",\n    url: \"/usage\",\n    icon: BarChart3,\n    pageKey: \"usage\",\n  },\n  {\n    title: \"Analytics\",\n    url: \"/analytics\",\n    icon: TrendingUp,\n    pageKey: \"analytics\",\n  },\n];\n\nconst adminItems: NavItem[] = [\n  {\n    title: \"Employees\",\n    url: \"/employees\",\n    icon: UsersRound,\n    pageKey: \"employees\",\n  },\n  {\n    title: \"RA Performance\",\n    url: \"/ra-performance\",\n    icon: Award,\n    pageKey: \"ra-performance\",\n  },\n];\n\nexport function AppSidebar() {\n  const [location] = useLocation();\n  const { user, logout } = useAuth();\n\n  const getInitials = (name: string) => {\n    return name\n      .split(\" \")\n      .map((n) => n[0])\n      .join(\"\")\n      .toUpperCase()\n      .slice(0, 2);\n  };\n\n  const getRoleBadge = (role: string) => {\n    const roleLabels: Record<string, string> = {\n      admin: \"Admin\",\n      pm: \"Project Manager\",\n      ra: \"Research Associate\",\n      finance: \"Finance\",\n    };\n    return roleLabels[role] || role;\n  };\n\n  const filterItemsByRole = (items: NavItem[]): NavItem[] => {\n    if (!user) return [];\n    return items.filter(item => canAccessPage(user.role, item.pageKey));\n  };\n\n  const filteredMainItems = filterItemsByRole(mainNavItems);\n  const filteredManagementItems = filterItemsByRole(managementItems);\n  const filteredAdminItems = filterItemsByRole(adminItems);\n\n  return (\n    <Sidebar>\n      <SidebarHeader className=\"border-b border-sidebar-border px-6 py-4\">\n        <Link href=\"/\" className=\"flex items-center gap-3\">\n          <img src={logoUrl} alt=\"Mirae Connext\" className=\"h-8 w-8 object-contain\" />\n          <div className=\"flex flex-col\">\n            <span className=\"text-base font-semibold text-sidebar-foreground\">Mirae Connext</span>\n            <span className=\"text-xs text-muted-foreground\">Knowledge Gateway</span>\n          </div>\n        </Link>\n      </SidebarHeader>\n      <SidebarContent className=\"px-3 py-4\">\n        {filteredMainItems.length > 0 && (\n          <SidebarGroup>\n            <SidebarGroupLabel className=\"px-3 text-xs font-medium uppercase tracking-wide text-muted-foreground\">\n              Overview\n            </SidebarGroupLabel>\n            <SidebarGroupContent>\n              <SidebarMenu>\n                {filteredMainItems.map((item) => (\n                  <SidebarMenuItem key={item.title}>\n                    <SidebarMenuButton\n                      asChild\n                      isActive={location === item.url || (item.url !== \"/\" && location.startsWith(item.url))}\n                      className=\"gap-3\"\n                    >\n                      <Link href={item.url} data-testid={`link-nav-${item.title.toLowerCase()}`}>\n                        <item.icon className=\"h-4 w-4\" />\n                        <span>{item.title}</span>\n                      </Link>\n                    </SidebarMenuButton>\n                  </SidebarMenuItem>\n                ))}\n              </SidebarMenu>\n            </SidebarGroupContent>\n          </SidebarGroup>\n        )}\n        {filteredManagementItems.length > 0 && (\n          <SidebarGroup className=\"mt-4\">\n            <SidebarGroupLabel className=\"px-3 text-xs font-medium uppercase tracking-wide text-muted-foreground\">\n              Management\n            </SidebarGroupLabel>\n            <SidebarGroupContent>\n              <SidebarMenu>\n                {filteredManagementItems.map((item) => (\n                  <SidebarMenuItem key={item.title}>\n                    <SidebarMenuButton\n                      asChild\n                      isActive={location === item.url}\n                      className=\"gap-3\"\n                    >\n                      <Link href={item.url} data-testid={`link-nav-${item.title.toLowerCase().replace(' ', '-')}`}>\n                        <item.icon className=\"h-4 w-4\" />\n                        <span>{item.title}</span>\n                      </Link>\n                    </SidebarMenuButton>\n                  </SidebarMenuItem>\n                ))}\n              </SidebarMenu>\n            </SidebarGroupContent>\n          </SidebarGroup>\n        )}\n        {filteredAdminItems.length > 0 && (\n          <SidebarGroup className=\"mt-4\">\n            <SidebarGroupLabel className=\"px-3 text-xs font-medium uppercase tracking-wide text-muted-foreground\">\n              Admin\n            </SidebarGroupLabel>\n            <SidebarGroupContent>\n              <SidebarMenu>\n                {filteredAdminItems.map((item) => (\n                  <SidebarMenuItem key={item.title}>\n                    <SidebarMenuButton\n                      asChild\n                      isActive={location === item.url}\n                      className=\"gap-3\"\n                    >\n                      <Link href={item.url} data-testid={`link-nav-${item.title.toLowerCase()}`}>\n                        <item.icon className=\"h-4 w-4\" />\n                        <span>{item.title}</span>\n                      </Link>\n                    </SidebarMenuButton>\n                  </SidebarMenuItem>\n                ))}\n              </SidebarMenu>\n            </SidebarGroupContent>\n          </SidebarGroup>\n        )}\n      </SidebarContent>\n      <SidebarFooter className=\"border-t border-sidebar-border p-4\">\n        <div className=\"flex items-center justify-between gap-2\">\n          <div className=\"flex items-center gap-3 px-2\">\n            <div className=\"flex h-8 w-8 items-center justify-center rounded-full bg-muted\">\n              <span className=\"text-xs font-medium\" data-testid=\"text-user-initials\">\n                {user ? getInitials(user.fullName) : \"??\"}\n              </span>\n            </div>\n            <div className=\"flex flex-col\">\n              <span className=\"text-sm font-medium\" data-testid=\"text-user-name\">\n                {user?.fullName || \"Loading...\"}\n              </span>\n              <span className=\"text-xs text-muted-foreground\" data-testid=\"text-user-role\">\n                {user ? getRoleBadge(user.role) : \"\"}\n              </span>\n            </div>\n          </div>\n          <Button\n            variant=\"ghost\"\n            size=\"icon\"\n            onClick={logout}\n            title=\"Sign out\"\n            data-testid=\"button-logout\"\n          >\n            <LogOut className=\"h-4 w-4\" />\n          </Button>\n        </div>\n      </SidebarFooter>\n    </Sidebar>\n  );\n}\n","path":null,"size_bytes":7855,"size_tokens":null},"client/src/components/ui/checkbox.tsx":{"content":"import * as React from \"react\"\nimport * as CheckboxPrimitive from \"@radix-ui/react-checkbox\"\nimport { Check } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Checkbox = React.forwardRef<\n  React.ElementRef<typeof CheckboxPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof CheckboxPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <CheckboxPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground\",\n      className\n    )}\n    {...props}\n  >\n    <CheckboxPrimitive.Indicator\n      className={cn(\"flex items-center justify-center text-current\")}\n    >\n      <Check className=\"h-4 w-4\" />\n    </CheckboxPrimitive.Indicator>\n  </CheckboxPrimitive.Root>\n))\nCheckbox.displayName = CheckboxPrimitive.Root.displayName\n\nexport { Checkbox }\n","path":null,"size_bytes":1056,"size_tokens":null},"client/src/pages/dashboard.tsx":{"content":"import { useQuery } from \"@tanstack/react-query\";\nimport { Link } from \"wouter\";\nimport { Briefcase, ArrowRight, Plus, TrendingUp, Phone, DollarSign, AlertCircle } from \"lucide-react\";\nimport { Card, CardContent, CardHeader, CardTitle, CardDescription } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport {\n  Table,\n  TableBody,\n  TableCell,\n  TableHead,\n  TableHeader,\n  TableRow,\n} from \"@/components/ui/table\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport { StatusBadge } from \"@/components/status-badge\";\nimport { EmptyState } from \"@/components/empty-state\";\nimport { useAuth } from \"@/lib/auth\";\nimport type { Project } from \"@shared/schema\";\n\ninterface KPICall {\n  id: number;\n  interviewDate: string;\n  expertName: string;\n  projectName: string;\n  clientName?: string;\n  cuUsed: number;\n  cuRatePerCU?: number;\n  revenueUSD?: number;\n}\n\ninterface CompanyTotals {\n  totalCompanyCU: number;\n  totalCompanyCalls: number;\n  totalCompanyRevenueUSD: number;\n}\n\ninterface KPIResponse {\n  role: string;\n  period: {\n    month: number;\n    year: number;\n    timezone: string;\n  };\n  totals: {\n    totalCalls: number;\n    totalCU: number;\n    incentive: number;\n  };\n  companyTotals?: CompanyTotals;\n  calls: KPICall[];\n}\n\nfunction formatBrazilDate(isoString: string): string {\n  const date = new Date(isoString);\n  const day = date.getDate().toString().padStart(2, \"0\");\n  const month = (date.getMonth() + 1).toString().padStart(2, \"0\");\n  const year = date.getFullYear();\n  const hours = date.getHours().toString().padStart(2, \"0\");\n  const minutes = date.getMinutes().toString().padStart(2, \"0\");\n  return `${day}/${month}/${year} ${hours}:${minutes}`;\n}\n\nfunction formatCurrency(value: number): string {\n  return new Intl.NumberFormat(\"pt-BR\", {\n    style: \"currency\",\n    currency: \"BRL\",\n  }).format(value);\n}\n\nfunction formatUSD(value: number): string {\n  return new Intl.NumberFormat(\"en-US\", {\n    style: \"currency\",\n    currency: \"USD\",\n  }).format(value);\n}\n\nfunction getRoleLabel(role: string): string {\n  const labels: Record<string, string> = {\n    admin: \"Admin\",\n    pm: \"PM\",\n    ra: \"RA\",\n    finance: \"Finance\",\n  };\n  return labels[role] || role.toUpperCase();\n}\n\nfunction getKPISectionTitle(role: string): string {\n  if (role === \"admin\" || role === \"finance\") {\n    return \"Company CU Performance\";\n  }\n  return \"My CU Performance\";\n}\n\nfunction getMonthName(month: number): string {\n  const months = [\n    \"January\", \"February\", \"March\", \"April\", \"May\", \"June\",\n    \"July\", \"August\", \"September\", \"October\", \"November\", \"December\"\n  ];\n  return months[month - 1] || \"\";\n}\n\nfunction KPISection() {\n  const { user } = useAuth();\n  \n  const { data: kpiData, isLoading, error } = useQuery<KPIResponse>({\n    queryKey: [\"/api/kpi/my-monthly\"],\n  });\n\n  if (isLoading) {\n    return (\n      <div className=\"space-y-4\">\n        <div className=\"grid gap-4 md:grid-cols-3\">\n          {Array.from({ length: 3 }).map((_, i) => (\n            <Card key={i}>\n              <CardHeader className=\"pb-2\">\n                <Skeleton className=\"h-4 w-24\" />\n              </CardHeader>\n              <CardContent>\n                <Skeleton className=\"h-8 w-16\" />\n              </CardContent>\n            </Card>\n          ))}\n        </div>\n        <Card>\n          <CardHeader>\n            <Skeleton className=\"h-5 w-48\" />\n          </CardHeader>\n          <CardContent>\n            <div className=\"space-y-3\">\n              {Array.from({ length: 3 }).map((_, i) => (\n                <Skeleton key={i} className=\"h-10 w-full\" />\n              ))}\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n    );\n  }\n\n  if (error) {\n    return (\n      <Card className=\"border-destructive/50\">\n        <CardContent className=\"flex items-center gap-3 py-4\">\n          <AlertCircle className=\"h-5 w-5 text-destructive\" />\n          <p className=\"text-sm text-muted-foreground\">\n            Unable to load KPI data. Please try again later.\n          </p>\n        </CardContent>\n      </Card>\n    );\n  }\n\n  if (!kpiData) {\n    return null;\n  }\n\n  const periodLabel = `${getMonthName(kpiData.period.month)} ${kpiData.period.year}`;\n  const roleLabel = getRoleLabel(kpiData.role);\n  const sectionTitle = getKPISectionTitle(kpiData.role);\n\n  return (\n    <div className=\"space-y-4\">\n      <div className=\"flex flex-col gap-1\">\n        <h2 className=\"text-lg font-semibold text-foreground\">\n          {sectionTitle}  {roleLabel}\n        </h2>\n        <p className=\"text-sm text-muted-foreground\">\n          {periodLabel} (Brazil Time)\n        </p>\n      </div>\n\n      <div className=\"grid gap-4 md:grid-cols-3\">\n        <Card data-testid=\"card-kpi-total-cu\">\n          <CardHeader className=\"flex flex-row items-center justify-between gap-2 space-y-0 pb-2\">\n            <CardTitle className=\"text-sm font-medium text-muted-foreground\">\n              Total CU\n            </CardTitle>\n            <TrendingUp className=\"h-4 w-4 text-muted-foreground\" />\n          </CardHeader>\n          <CardContent>\n            <div className=\"text-2xl font-bold\" data-testid=\"text-total-cu\">\n              {(kpiData.companyTotals?.totalCompanyCU ?? kpiData.totals.totalCU).toFixed(2)}\n            </div>\n            <p className=\"text-xs text-muted-foreground\">\n              {kpiData.role === \"admin\" || kpiData.role === \"finance\" ? \"Company CU this month\" : \"Credit Units this month\"}\n            </p>\n          </CardContent>\n        </Card>\n\n        <Card data-testid=\"card-kpi-total-calls\">\n          <CardHeader className=\"flex flex-row items-center justify-between gap-2 space-y-0 pb-2\">\n            <CardTitle className=\"text-sm font-medium text-muted-foreground\">\n              Completed Calls\n            </CardTitle>\n            <Phone className=\"h-4 w-4 text-muted-foreground\" />\n          </CardHeader>\n          <CardContent>\n            <div className=\"text-2xl font-bold\" data-testid=\"text-total-calls\">\n              {kpiData.companyTotals?.totalCompanyCalls ?? kpiData.totals.totalCalls}\n            </div>\n            <p className=\"text-xs text-muted-foreground\">\n              Consultations completed\n            </p>\n          </CardContent>\n        </Card>\n\n        {(kpiData.role === \"admin\" || kpiData.role === \"finance\") ? (\n          <Card data-testid=\"card-kpi-revenue\">\n            <CardHeader className=\"flex flex-row items-center justify-between gap-2 space-y-0 pb-2\">\n              <CardTitle className=\"text-sm font-medium text-muted-foreground\">\n                Revenue\n              </CardTitle>\n              <DollarSign className=\"h-4 w-4 text-muted-foreground\" />\n            </CardHeader>\n            <CardContent>\n              <div className=\"text-2xl font-bold text-green-600 dark:text-green-500\" data-testid=\"text-revenue\">\n                {formatUSD(kpiData.companyTotals?.totalCompanyRevenueUSD ?? 0)}\n              </div>\n              <p className=\"text-xs text-muted-foreground\">\n                Total revenue this month\n              </p>\n            </CardContent>\n          </Card>\n        ) : (\n          <Card data-testid=\"card-kpi-incentive\">\n            <CardHeader className=\"flex flex-row items-center justify-between gap-2 space-y-0 pb-2\">\n              <CardTitle className=\"text-sm font-medium text-muted-foreground\">\n                Incentive\n              </CardTitle>\n              <DollarSign className=\"h-4 w-4 text-muted-foreground\" />\n            </CardHeader>\n            <CardContent>\n              <div className=\"text-2xl font-bold text-green-600 dark:text-green-500\" data-testid=\"text-incentive\">\n                {formatCurrency(kpiData.totals.incentive)}\n              </div>\n              <p className=\"text-xs text-muted-foreground\">\n                {kpiData.role === \"ra\" \n                  ? \"R$250/call (max R$2,500)\"\n                  : \"R$70 per CU\"\n                }\n              </p>\n            </CardContent>\n          </Card>\n        )}\n      </div>\n\n      <Card>\n        <CardHeader className=\"pb-4\">\n          <CardTitle className=\"text-base font-medium\">\n            Completed Calls This Month\n          </CardTitle>\n          <CardDescription>\n            {kpiData.calls.length === 0 \n              ? \"No completed calls yet this month.\"\n              : `${kpiData.calls.length} consultation${kpiData.calls.length !== 1 ? \"s\" : \"\"} completed`\n            }\n          </CardDescription>\n        </CardHeader>\n        {kpiData.calls.length > 0 && (\n          <CardContent>\n            <Table>\n              <TableHeader>\n                <TableRow>\n                  <TableHead className=\"text-xs font-semibold uppercase\">Interview Date</TableHead>\n                  {(kpiData.role === \"admin\" || kpiData.role === \"finance\") && (\n                    <TableHead className=\"text-xs font-semibold uppercase\">Client</TableHead>\n                  )}\n                  <TableHead className=\"text-xs font-semibold uppercase\">Expert</TableHead>\n                  <TableHead className=\"text-xs font-semibold uppercase\">Project</TableHead>\n                  <TableHead className=\"text-right text-xs font-semibold uppercase\">CU</TableHead>\n                  {(kpiData.role === \"admin\" || kpiData.role === \"finance\") && (\n                    <TableHead className=\"text-right text-xs font-semibold uppercase\">Revenue (USD)</TableHead>\n                  )}\n                </TableRow>\n              </TableHeader>\n              <TableBody>\n                {kpiData.calls.map((call) => (\n                  <TableRow key={call.id} data-testid={`row-kpi-call-${call.id}`}>\n                    <TableCell className=\"font-mono text-sm\">\n                      {formatBrazilDate(call.interviewDate)}\n                    </TableCell>\n                    {(kpiData.role === \"admin\" || kpiData.role === \"finance\") && (\n                      <TableCell className=\"text-muted-foreground\">{call.clientName}</TableCell>\n                    )}\n                    <TableCell>{call.expertName}</TableCell>\n                    <TableCell className=\"text-muted-foreground\">{call.projectName}</TableCell>\n                    <TableCell className=\"text-right font-medium\">\n                      {call.cuUsed.toFixed(2)}\n                    </TableCell>\n                    {(kpiData.role === \"admin\" || kpiData.role === \"finance\") && (\n                      <TableCell className=\"text-right font-medium\">\n                        {call.revenueUSD ? formatUSD(call.revenueUSD) : \"-\"}\n                      </TableCell>\n                    )}\n                  </TableRow>\n                ))}\n              </TableBody>\n            </Table>\n          </CardContent>\n        )}\n      </Card>\n    </div>\n  );\n}\n\nexport default function Dashboard() {\n  const { data: projects, isLoading: projectsLoading } = useQuery<Project[]>({\n    queryKey: [\"/api/projects\"],\n  });\n\n  const recentProjects = projects?.slice(0, 10) || [];\n\n  return (\n    <div className=\"space-y-8 p-8\">\n      <div className=\"flex flex-col gap-2\">\n        <h1 className=\"text-3xl font-semibold text-foreground\">Dashboard</h1>\n        <p className=\"text-sm text-muted-foreground\">\n          Welcome back! Here's an overview of your performance and recent projects.\n        </p>\n      </div>\n\n      <KPISection />\n\n      <Card>\n        <CardHeader className=\"flex flex-row items-center justify-between gap-4 space-y-0 pb-4\">\n          <CardTitle className=\"text-base font-medium\">Recent Projects</CardTitle>\n          <Link href=\"/projects\">\n            <Button variant=\"ghost\" size=\"sm\" className=\"gap-1\" data-testid=\"button-view-all-projects\">\n              View all <ArrowRight className=\"h-4 w-4\" />\n            </Button>\n          </Link>\n        </CardHeader>\n        <CardContent>\n          {projectsLoading ? (\n            <div className=\"space-y-3\">\n              {Array.from({ length: 5 }).map((_, i) => (\n                <Skeleton key={i} className=\"h-12 w-full\" />\n              ))}\n            </div>\n          ) : recentProjects.length === 0 ? (\n            <EmptyState\n              icon={Briefcase}\n              title=\"No projects yet\"\n              description=\"Create your first project to get started.\"\n              action={\n                <Link href=\"/projects\">\n                  <Button size=\"sm\" className=\"gap-1\" data-testid=\"button-create-first-project\">\n                    <Plus className=\"h-4 w-4\" /> Create Project\n                  </Button>\n                </Link>\n              }\n            />\n          ) : (\n            <Table>\n              <TableHeader>\n                <TableRow>\n                  <TableHead className=\"text-xs font-semibold uppercase\">Project</TableHead>\n                  <TableHead className=\"text-xs font-semibold uppercase\">Client</TableHead>\n                  <TableHead className=\"text-xs font-semibold uppercase\">Industry</TableHead>\n                  <TableHead className=\"text-xs font-semibold uppercase\">Status</TableHead>\n                </TableRow>\n              </TableHeader>\n              <TableBody>\n                {recentProjects.map((project) => (\n                  <TableRow key={project.id} data-testid={`row-project-${project.id}`}>\n                    <TableCell>\n                      <Link href={`/projects/${project.id}`} className=\"font-medium hover:underline\">\n                        {project.name}\n                      </Link>\n                    </TableCell>\n                    <TableCell className=\"text-muted-foreground\">{project.clientName}</TableCell>\n                    <TableCell className=\"text-muted-foreground\">{project.industry || \"-\"}</TableCell>\n                    <TableCell>\n                      <StatusBadge status={project.status} type=\"project\" />\n                    </TableCell>\n                  </TableRow>\n                ))}\n              </TableBody>\n            </Table>\n          )}\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","path":null,"size_bytes":13917,"size_tokens":null},"client/src/components/ui/dialog.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as DialogPrimitive from \"@radix-ui/react-dialog\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Dialog = DialogPrimitive.Root\n\nconst DialogTrigger = DialogPrimitive.Trigger\n\nconst DialogPortal = DialogPrimitive.Portal\n\nconst DialogClose = DialogPrimitive.Close\n\nconst DialogOverlay = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Overlay\n    ref={ref}\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n  />\n))\nDialogOverlay.displayName = DialogPrimitive.Overlay.displayName\n\nconst DialogContent = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <DialogPortal>\n    <DialogOverlay />\n    <DialogPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg\",\n        className\n      )}\n      {...props}\n    >\n      {children}\n      <DialogPrimitive.Close className=\"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground\">\n        <X className=\"h-4 w-4\" />\n        <span className=\"sr-only\">Close</span>\n      </DialogPrimitive.Close>\n    </DialogPrimitive.Content>\n  </DialogPortal>\n))\nDialogContent.displayName = DialogPrimitive.Content.displayName\n\nconst DialogHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-1.5 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nDialogHeader.displayName = \"DialogHeader\"\n\nconst DialogFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nDialogFooter.displayName = \"DialogFooter\"\n\nconst DialogTitle = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Title\n    ref={ref}\n    className={cn(\n      \"text-lg font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nDialogTitle.displayName = DialogPrimitive.Title.displayName\n\nconst DialogDescription = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nDialogDescription.displayName = DialogPrimitive.Description.displayName\n\nexport {\n  Dialog,\n  DialogPortal,\n  DialogOverlay,\n  DialogClose,\n  DialogTrigger,\n  DialogContent,\n  DialogHeader,\n  DialogFooter,\n  DialogTitle,\n  DialogDescription,\n}\n","path":null,"size_bytes":3848,"size_tokens":null},"client/src/components/ui/textarea.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Textarea = React.forwardRef<\n  HTMLTextAreaElement,\n  React.ComponentProps<\"textarea\">\n>(({ className, ...props }, ref) => {\n  return (\n    <textarea\n      className={cn(\n        \"flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm\",\n        className\n      )}\n      ref={ref}\n      {...props}\n    />\n  )\n})\nTextarea.displayName = \"Textarea\"\n\nexport { Textarea }\n","path":null,"size_bytes":689,"size_tokens":null},"client/src/pages/projects.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { useForm, useFieldArray } from \"react-hook-form\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport { format } from \"date-fns\";\nimport { z } from \"zod\";\nimport { Plus, Pencil, Trash2, Search, Briefcase, Filter, Eye, X, FolderKanban } from \"lucide-react\";\nimport { useLocation } from \"wouter\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { useAuth } from \"@/lib/auth\";\nimport { normalizeRole } from \"@/lib/permissions\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogDescription,\n  DialogFooter,\n  DialogHeader,\n  DialogTitle,\n} from \"@/components/ui/dialog\";\nimport {\n  Form,\n  FormControl,\n  FormField,\n  FormItem,\n  FormLabel,\n  FormMessage,\n} from \"@/components/ui/form\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport {\n  Table,\n  TableBody,\n  TableCell,\n  TableHead,\n  TableHeader,\n  TableRow,\n} from \"@/components/ui/table\";\nimport {\n  AlertDialog,\n  AlertDialogAction,\n  AlertDialogCancel,\n  AlertDialogContent,\n  AlertDialogDescription,\n  AlertDialogFooter,\n  AlertDialogHeader,\n  AlertDialogTitle,\n} from \"@/components/ui/alert-dialog\";\nimport { Separator } from \"@/components/ui/separator\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { queryClient, apiRequest } from \"@/lib/queryClient\";\nimport { StatusBadge } from \"@/components/status-badge\";\nimport { EmptyState } from \"@/components/empty-state\";\nimport { DataTableSkeleton } from \"@/components/data-table-skeleton\";\nimport type { Project, InsertProject, ClientOrganization, VettingQuestion } from \"@shared/schema\";\n\nconst vettingQuestionSchema = z.object({\n  question: z.string().min(1, \"Question is required\"),\n});\n\nconst projectFormSchema = z.object({\n  name: z.string().min(1, \"Project name is required\"),\n  projectOverview: z.string().optional(),\n  clientOrganizationId: z.number().optional(),\n  clientName: z.string().min(1, \"Client name is required\"),\n  clientPocName: z.string().optional(),\n  clientPocEmail: z.string().email().optional().or(z.literal(\"\")),\n  description: z.string().optional(),\n  industry: z.string().min(1, \"Industry is required\"),\n  status: z.string().default(\"new\"),\n  startDate: z.string().optional(),\n  endDate: z.string().optional(),\n  vettingQuestions: z.array(vettingQuestionSchema).optional(),\n});\n\ntype ProjectFormData = z.infer<typeof projectFormSchema>;\n\nconst industries = [\n  \"Technology\",\n  \"Healthcare\",\n  \"Finance\",\n  \"Manufacturing\",\n  \"Energy\",\n  \"Retail\",\n  \"Consulting\",\n  \"Legal\",\n  \"Real Estate\",\n  \"Education\",\n  \"Pharmaceuticals\",\n  \"Telecommunications\",\n  \"Automotive\",\n  \"Aerospace\",\n  \"Agriculture\",\n  \"Other\",\n];\n\nconst statuses = [\n  { value: \"new\", label: \"New\" },\n  { value: \"sourcing\", label: \"Sourcing\" },\n  { value: \"pending_client_review\", label: \"Client Review\" },\n  { value: \"client_selected\", label: \"Client Selected\" },\n  { value: \"scheduled\", label: \"Scheduled\" },\n  { value: \"completed\", label: \"Completed\" },\n  { value: \"cancelled\", label: \"Cancelled\" },\n];\n\nexport default function Projects() {\n  const { toast } = useToast();\n  const { user } = useAuth();\n  const [, setLocation] = useLocation();\n  const [searchQuery, setSearchQuery] = useState(\"\");\n  const [statusFilter, setStatusFilter] = useState<string>(\"all\");\n  const [isDialogOpen, setIsDialogOpen] = useState(false);\n  const [editingProject, setEditingProject] = useState<Project | null>(null);\n  const [deletingProject, setDeletingProject] = useState<Project | null>(null);\n  \n  // Check if user is RA (Research Associate)\n  const isRA = user && normalizeRole(user.role) === \"ra\";\n\n  const { data: projects, isLoading } = useQuery<Project[]>({\n    queryKey: [\"/api/projects\"],\n  });\n\n  const { data: clientOrganizations } = useQuery<ClientOrganization[]>({\n    queryKey: [\"/api/client-organizations\"],\n  });\n\n  const { data: existingVettingQuestions } = useQuery<VettingQuestion[]>({\n    queryKey: [\"/api/vetting-questions\", editingProject?.id],\n    enabled: !!editingProject,\n  });\n\n  const form = useForm<ProjectFormData>({\n    resolver: zodResolver(projectFormSchema),\n    defaultValues: {\n      name: \"\",\n      projectOverview: \"\",\n      clientName: \"\",\n      clientPocName: \"\",\n      clientPocEmail: \"\",\n      description: \"\",\n      industry: \"\",\n      status: \"new\",\n      startDate: \"\",\n      endDate: \"\",\n      vettingQuestions: [],\n    },\n  });\n\n  const { fields, append, remove } = useFieldArray({\n    control: form.control,\n    name: \"vettingQuestions\",\n  });\n\n  const createMutation = useMutation({\n    mutationFn: async (data: ProjectFormData) => {\n      const { vettingQuestions, ...projectData } = data;\n      const projectPayload: InsertProject = {\n        ...projectData,\n        projectOverview: projectData.projectOverview || null,\n        clientOrganizationId: projectData.clientOrganizationId || null,\n        clientPocName: projectData.clientPocName || null,\n        clientPocEmail: projectData.clientPocEmail || null,\n        description: projectData.description || null,\n        startDate: projectData.startDate ? new Date(projectData.startDate) : null,\n        endDate: projectData.endDate ? new Date(projectData.endDate) : null,\n      };\n      \n      const project = await apiRequest(\"POST\", \"/api/projects\", projectPayload);\n      const projectResult = await project.json();\n      \n      if (vettingQuestions && vettingQuestions.length > 0) {\n        for (let i = 0; i < vettingQuestions.length; i++) {\n          await apiRequest(\"POST\", \"/api/vetting-questions\", {\n            projectId: projectResult.id,\n            question: vettingQuestions[i].question,\n            orderIndex: i,\n            isRequired: true,\n          });\n        }\n      }\n      \n      return projectResult;\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/projects\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/vetting-questions\"] });\n      setIsDialogOpen(false);\n      form.reset();\n      toast({ title: \"Project created successfully\" });\n    },\n    onError: () => {\n      toast({ title: \"Failed to create project\", variant: \"destructive\" });\n    },\n  });\n\n  const updateMutation = useMutation({\n    mutationFn: async (data: ProjectFormData & { id: number }) => {\n      const { vettingQuestions, id, ...projectData } = data;\n      const projectPayload: Partial<InsertProject> = {\n        ...projectData,\n        projectOverview: projectData.projectOverview || null,\n        clientOrganizationId: projectData.clientOrganizationId || null,\n        clientPocName: projectData.clientPocName || null,\n        clientPocEmail: projectData.clientPocEmail || null,\n        description: projectData.description || null,\n        startDate: projectData.startDate ? new Date(projectData.startDate) : null,\n        endDate: projectData.endDate ? new Date(projectData.endDate) : null,\n      };\n      \n      await apiRequest(\"PATCH\", `/api/projects/${id}`, projectPayload);\n      \n      if (existingVettingQuestions) {\n        for (const q of existingVettingQuestions) {\n          await apiRequest(\"DELETE\", `/api/vetting-questions/${q.id}`);\n        }\n      }\n      \n      if (vettingQuestions && vettingQuestions.length > 0) {\n        for (let i = 0; i < vettingQuestions.length; i++) {\n          await apiRequest(\"POST\", \"/api/vetting-questions\", {\n            projectId: id,\n            question: vettingQuestions[i].question,\n            orderIndex: i,\n            isRequired: true,\n          });\n        }\n      }\n      \n      return { id };\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/projects\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/vetting-questions\"] });\n      setIsDialogOpen(false);\n      setEditingProject(null);\n      form.reset();\n      toast({ title: \"Project updated successfully\" });\n    },\n    onError: () => {\n      toast({ title: \"Failed to update project\", variant: \"destructive\" });\n    },\n  });\n\n  const deleteMutation = useMutation({\n    mutationFn: (id: number) => apiRequest(\"DELETE\", `/api/projects/${id}`),\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/projects\"] });\n      setDeletingProject(null);\n      toast({ title: \"Project deleted successfully\" });\n    },\n    onError: () => {\n      toast({ title: \"Failed to delete project\", variant: \"destructive\" });\n    },\n  });\n\n  const filteredProjects = projects?.filter((project) => {\n    const matchesSearch =\n      project.name.toLowerCase().includes(searchQuery.toLowerCase()) ||\n      project.clientName.toLowerCase().includes(searchQuery.toLowerCase());\n    const matchesStatus = statusFilter === \"all\" || project.status === statusFilter;\n    return matchesSearch && matchesStatus;\n  });\n\n  const handleOpenDialog = (project?: Project) => {\n    if (project) {\n      setEditingProject(project);\n      form.reset({\n        name: project.name,\n        projectOverview: project.projectOverview || \"\",\n        clientOrganizationId: project.clientOrganizationId || undefined,\n        clientName: project.clientName,\n        clientPocName: project.clientPocName || \"\",\n        clientPocEmail: project.clientPocEmail || \"\",\n        description: project.description || \"\",\n        industry: project.industry,\n        status: project.status,\n        startDate: project.startDate ? format(new Date(project.startDate), \"yyyy-MM-dd\") : \"\",\n        endDate: project.endDate ? format(new Date(project.endDate), \"yyyy-MM-dd\") : \"\",\n        vettingQuestions: [],\n      });\n    } else {\n      setEditingProject(null);\n      form.reset({\n        name: \"\",\n        projectOverview: \"\",\n        clientName: \"\",\n        clientPocName: \"\",\n        clientPocEmail: \"\",\n        description: \"\",\n        industry: \"\",\n        status: \"new\",\n        startDate: \"\",\n        endDate: \"\",\n        vettingQuestions: [],\n      });\n    }\n    setIsDialogOpen(true);\n  };\n\n  const loadExistingQuestions = () => {\n    if (existingVettingQuestions && existingVettingQuestions.length > 0) {\n      form.setValue('vettingQuestions', existingVettingQuestions.map(q => ({ question: q.question })));\n    }\n  };\n\n  const onSubmit = (data: ProjectFormData) => {\n    if (editingProject) {\n      updateMutation.mutate({ ...data, id: editingProject.id });\n    } else {\n      createMutation.mutate(data);\n    }\n  };\n\n  return (\n    <div className=\"space-y-6 p-8\">\n      <div className=\"flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between\">\n        <div>\n          <h1 className=\"text-3xl font-semibold text-foreground\">\n            {isRA ? \"My Projects\" : \"Projects\"}\n          </h1>\n          <p className=\"text-sm text-muted-foreground\">\n            {isRA \n              ? \"View and manage projects you're assigned to.\"\n              : \"Manage project requests and track their progress through the workflow.\"\n            }\n          </p>\n        </div>\n        {!isRA && (\n          <Button onClick={() => handleOpenDialog()} className=\"gap-2\" data-testid=\"button-add-project\">\n            <Plus className=\"h-4 w-4\" /> New Project\n          </Button>\n        )}\n      </div>\n\n      <div className=\"grid gap-4 sm:grid-cols-4\">\n        <Card>\n          <CardContent className=\"pt-6\">\n            <div className=\"text-2xl font-bold\">{projects?.filter(p => p.status === \"new\").length || 0}</div>\n            <p className=\"text-xs text-muted-foreground\">New Requests</p>\n          </CardContent>\n        </Card>\n        <Card>\n          <CardContent className=\"pt-6\">\n            <div className=\"text-2xl font-bold\">{projects?.filter(p => p.status === \"sourcing\").length || 0}</div>\n            <p className=\"text-xs text-muted-foreground\">Sourcing</p>\n          </CardContent>\n        </Card>\n        <Card>\n          <CardContent className=\"pt-6\">\n            <div className=\"text-2xl font-bold\">{projects?.filter(p => p.status === \"pending_client_review\").length || 0}</div>\n            <p className=\"text-xs text-muted-foreground\">Client Review</p>\n          </CardContent>\n        </Card>\n        <Card>\n          <CardContent className=\"pt-6\">\n            <div className=\"text-2xl font-bold\">{projects?.filter(p => p.status === \"completed\").length || 0}</div>\n            <p className=\"text-xs text-muted-foreground\">Completed</p>\n          </CardContent>\n        </Card>\n      </div>\n\n      <Card>\n        <CardHeader className=\"pb-4\">\n          <div className=\"flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between\">\n            <CardTitle className=\"text-base font-medium\">\n              {isRA ? \"My Assigned Projects\" : \"All Projects\"}\n            </CardTitle>\n            <div className=\"flex flex-col gap-3 sm:flex-row sm:items-center\">\n              <div className=\"relative\">\n                <Search className=\"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground\" />\n                <Input\n                  placeholder=\"Search projects...\"\n                  value={searchQuery}\n                  onChange={(e) => setSearchQuery(e.target.value)}\n                  className=\"w-full pl-9 sm:w-64\"\n                  data-testid=\"input-search-projects\"\n                />\n              </div>\n              <Select value={statusFilter} onValueChange={setStatusFilter}>\n                <SelectTrigger className=\"w-full sm:w-44\" data-testid=\"select-status-filter\">\n                  <Filter className=\"mr-2 h-4 w-4\" />\n                  <SelectValue placeholder=\"Filter by status\" />\n                </SelectTrigger>\n                <SelectContent>\n                  <SelectItem value=\"all\">All Statuses</SelectItem>\n                  {statuses.map((status) => (\n                    <SelectItem key={status.value} value={status.value}>\n                      {status.label}\n                    </SelectItem>\n                  ))}\n                </SelectContent>\n              </Select>\n            </div>\n          </div>\n        </CardHeader>\n        <CardContent>\n          {isLoading ? (\n            <DataTableSkeleton columns={isRA ? 6 : 7} rows={5} />\n          ) : filteredProjects?.length === 0 ? (\n            <EmptyState\n              icon={isRA ? FolderKanban : Briefcase}\n              title={isRA ? \"No projects assigned yet\" : \"No projects found\"}\n              description={\n                searchQuery || statusFilter !== \"all\"\n                  ? \"Try adjusting your filters.\"\n                  : isRA\n                    ? \"Once you're assigned to a project, it will appear here.\"\n                    : \"Create your first project to get started.\"\n              }\n              action={\n                !isRA && !searchQuery && statusFilter === \"all\" ? (\n                  <Button onClick={() => handleOpenDialog()} className=\"gap-2\" data-testid=\"button-create-empty-project\">\n                    <Plus className=\"h-4 w-4\" /> Create Project\n                  </Button>\n                ) : undefined\n              }\n            />\n          ) : (\n            <div className=\"overflow-x-auto\">\n              <Table>\n                <TableHeader>\n                  <TableRow>\n                    <TableHead className=\"text-xs font-semibold uppercase\">Project</TableHead>\n                    <TableHead className=\"text-xs font-semibold uppercase\">Client</TableHead>\n                    <TableHead className=\"text-xs font-semibold uppercase\">Industry</TableHead>\n                    <TableHead className=\"text-xs font-semibold uppercase\">Status</TableHead>\n                    {!isRA && <TableHead className=\"text-xs font-semibold uppercase\">CU Used</TableHead>}\n                    <TableHead className=\"text-xs font-semibold uppercase\">Created</TableHead>\n                    <TableHead className=\"text-right text-xs font-semibold uppercase\">Actions</TableHead>\n                  </TableRow>\n                </TableHeader>\n                <TableBody>\n                  {filteredProjects?.map((project) => (\n                    <TableRow key={project.id} className=\"hover-elevate cursor-pointer\" data-testid={`row-project-${project.id}`}>\n                      <TableCell onClick={() => setLocation(`/projects/${project.id}`)}>\n                        <div>\n                          <p className=\"font-medium\">{project.name}</p>\n                          {project.clientPocName && (\n                            <p className=\"text-xs text-muted-foreground\">POC: {project.clientPocName}</p>\n                          )}\n                        </div>\n                      </TableCell>\n                      <TableCell onClick={() => setLocation(`/projects/${project.id}`)} className=\"text-muted-foreground\">{project.clientName}</TableCell>\n                      <TableCell onClick={() => setLocation(`/projects/${project.id}`)} className=\"text-muted-foreground\">{project.industry}</TableCell>\n                      <TableCell onClick={() => setLocation(`/projects/${project.id}`)}>\n                        <StatusBadge status={project.status} type=\"project\" />\n                      </TableCell>\n                      {!isRA && (\n                        <TableCell onClick={() => setLocation(`/projects/${project.id}`)} className=\"font-mono text-sm\">\n                          {parseFloat(project.totalCuUsed || \"0\").toFixed(1)}\n                        </TableCell>\n                      )}\n                      <TableCell onClick={() => setLocation(`/projects/${project.id}`)} className=\"font-mono text-xs text-muted-foreground\">\n                        {format(new Date(project.createdAt), \"MMM dd, yyyy\")}\n                      </TableCell>\n                      <TableCell className=\"text-right\">\n                        <div className=\"flex justify-end gap-1\">\n                          <Button\n                            variant=\"ghost\"\n                            size=\"icon\"\n                            onClick={() => setLocation(`/projects/${project.id}`)}\n                            data-testid={`button-view-project-${project.id}`}\n                          >\n                            <Eye className=\"h-4 w-4\" />\n                          </Button>\n                          {!isRA && (\n                            <>\n                              <Button\n                                variant=\"ghost\"\n                                size=\"icon\"\n                                onClick={() => handleOpenDialog(project)}\n                                data-testid={`button-edit-project-${project.id}`}\n                              >\n                                <Pencil className=\"h-4 w-4\" />\n                              </Button>\n                              <Button\n                                variant=\"ghost\"\n                                size=\"icon\"\n                                onClick={() => setDeletingProject(project)}\n                                data-testid={`button-delete-project-${project.id}`}\n                              >\n                                <Trash2 className=\"h-4 w-4 text-destructive\" />\n                              </Button>\n                            </>\n                          )}\n                        </div>\n                      </TableCell>\n                    </TableRow>\n                  ))}\n                </TableBody>\n              </Table>\n            </div>\n          )}\n        </CardContent>\n      </Card>\n\n      <Dialog open={isDialogOpen} onOpenChange={(open) => {\n        setIsDialogOpen(open);\n        if (!open) {\n          setEditingProject(null);\n          form.reset();\n        }\n      }}>\n        <DialogContent className=\"max-w-2xl max-h-[90vh] overflow-y-auto\">\n          <DialogHeader>\n            <DialogTitle>{editingProject ? \"Edit Project\" : \"Create New Project\"}</DialogTitle>\n            <DialogDescription>\n              {editingProject\n                ? \"Update the project details below.\"\n                : \"Fill in the details to create a new project request.\"}\n            </DialogDescription>\n          </DialogHeader>\n          <Form {...form}>\n            <form onSubmit={form.handleSubmit(onSubmit)} className=\"space-y-4\">\n              <FormField\n                control={form.control}\n                name=\"name\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>Project Name *</FormLabel>\n                    <FormControl>\n                      <Input placeholder=\"Enter project name\" {...field} data-testid=\"input-project-name\" />\n                    </FormControl>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n\n              <div className=\"grid gap-4 sm:grid-cols-2\">\n                <FormField\n                  control={form.control}\n                  name=\"clientName\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Client Name *</FormLabel>\n                      <FormControl>\n                        <Input placeholder=\"Enter client name\" {...field} data-testid=\"input-client-name\" />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n                <FormField\n                  control={form.control}\n                  name=\"clientOrganizationId\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Link to Organization</FormLabel>\n                      <Select\n                        onValueChange={(v) => field.onChange(v ? parseInt(v) : undefined)}\n                        value={field.value?.toString() || \"\"}\n                      >\n                        <FormControl>\n                          <SelectTrigger data-testid=\"select-org\">\n                            <SelectValue placeholder=\"Select organization (optional)\" />\n                          </SelectTrigger>\n                        </FormControl>\n                        <SelectContent>\n                          {clientOrganizations?.map((org) => (\n                            <SelectItem key={org.id} value={org.id.toString()}>\n                              {org.name}\n                            </SelectItem>\n                          ))}\n                        </SelectContent>\n                      </Select>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n              </div>\n\n              <div className=\"grid gap-4 sm:grid-cols-2\">\n                <FormField\n                  control={form.control}\n                  name=\"clientPocName\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Client POC Name</FormLabel>\n                      <FormControl>\n                        <Input placeholder=\"Point of contact name\" {...field} data-testid=\"input-poc-name\" />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n                <FormField\n                  control={form.control}\n                  name=\"clientPocEmail\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Client POC Email</FormLabel>\n                      <FormControl>\n                        <Input type=\"email\" placeholder=\"poc@company.com\" {...field} data-testid=\"input-poc-email\" />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n              </div>\n\n              <div className=\"grid gap-4 sm:grid-cols-2\">\n                <FormField\n                  control={form.control}\n                  name=\"industry\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Industry *</FormLabel>\n                      <Select onValueChange={field.onChange} value={field.value}>\n                        <FormControl>\n                          <SelectTrigger data-testid=\"select-industry\">\n                            <SelectValue placeholder=\"Select industry\" />\n                          </SelectTrigger>\n                        </FormControl>\n                        <SelectContent>\n                          {industries.map((industry) => (\n                            <SelectItem key={industry} value={industry}>\n                              {industry}\n                            </SelectItem>\n                          ))}\n                        </SelectContent>\n                      </Select>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n                <FormField\n                  control={form.control}\n                  name=\"status\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Status</FormLabel>\n                      <Select onValueChange={field.onChange} value={field.value}>\n                        <FormControl>\n                          <SelectTrigger data-testid=\"select-status\">\n                            <SelectValue placeholder=\"Select status\" />\n                          </SelectTrigger>\n                        </FormControl>\n                        <SelectContent>\n                          {statuses.map((status) => (\n                            <SelectItem key={status.value} value={status.value}>\n                              {status.label}\n                            </SelectItem>\n                          ))}\n                        </SelectContent>\n                      </Select>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n              </div>\n\n              <FormField\n                control={form.control}\n                name=\"projectOverview\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>Project Overview</FormLabel>\n                    <FormControl>\n                      <Textarea\n                        placeholder=\"Brief overview of the project...\"\n                        className=\"resize-none\"\n                        rows={2}\n                        {...field}\n                        data-testid=\"input-project-overview\"\n                      />\n                    </FormControl>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n\n              <FormField\n                control={form.control}\n                name=\"description\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>Detailed Description</FormLabel>\n                    <FormControl>\n                      <Textarea\n                        placeholder=\"Enter detailed project description\"\n                        className=\"resize-none\"\n                        rows={3}\n                        {...field}\n                        data-testid=\"input-project-description\"\n                      />\n                    </FormControl>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n\n              <div className=\"grid gap-4 sm:grid-cols-2\">\n                <FormField\n                  control={form.control}\n                  name=\"startDate\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Start Date</FormLabel>\n                      <FormControl>\n                        <Input type=\"date\" {...field} data-testid=\"input-start-date\" />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n                <FormField\n                  control={form.control}\n                  name=\"endDate\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>End Date</FormLabel>\n                      <FormControl>\n                        <Input type=\"date\" {...field} data-testid=\"input-end-date\" />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n              </div>\n\n              <Separator className=\"my-4\" />\n\n              <div className=\"space-y-4\">\n                <div className=\"flex items-center justify-between\">\n                  <div>\n                    <h3 className=\"text-sm font-medium\">Vetting Questions</h3>\n                    <p className=\"text-xs text-muted-foreground\">\n                      Add screening questions for experts to answer\n                    </p>\n                  </div>\n                  <div className=\"flex gap-2\">\n                    {editingProject && existingVettingQuestions && existingVettingQuestions.length > 0 && fields.length === 0 && (\n                      <Button\n                        type=\"button\"\n                        variant=\"outline\"\n                        size=\"sm\"\n                        onClick={loadExistingQuestions}\n                        data-testid=\"button-load-questions\"\n                      >\n                        Load Existing ({existingVettingQuestions.length})\n                      </Button>\n                    )}\n                    <Button\n                      type=\"button\"\n                      variant=\"outline\"\n                      size=\"sm\"\n                      onClick={() => append({ question: \"\" })}\n                      data-testid=\"button-add-question\"\n                    >\n                      <Plus className=\"h-4 w-4 mr-1\" /> Add Question\n                    </Button>\n                  </div>\n                </div>\n\n                {fields.length === 0 ? (\n                  <div className=\"border border-dashed rounded-lg p-4 text-center text-sm text-muted-foreground\">\n                    No vetting questions added yet. Click \"Add Question\" to add screening questions.\n                  </div>\n                ) : (\n                  <div className=\"space-y-3\">\n                    {fields.map((field, index) => (\n                      <div key={field.id} className=\"flex gap-2 items-start\">\n                        <div className=\"flex-shrink-0 w-6 h-8 flex items-center justify-center text-xs text-muted-foreground font-mono\">\n                          {index + 1}.\n                        </div>\n                        <FormField\n                          control={form.control}\n                          name={`vettingQuestions.${index}.question`}\n                          render={({ field }) => (\n                            <FormItem className=\"flex-1\">\n                              <FormControl>\n                                <Textarea\n                                  placeholder=\"Enter your vetting question...\"\n                                  className=\"resize-none min-h-[60px]\"\n                                  {...field}\n                                  data-testid={`input-vetting-question-${index}`}\n                                />\n                              </FormControl>\n                              <FormMessage />\n                            </FormItem>\n                          )}\n                        />\n                        <Button\n                          type=\"button\"\n                          variant=\"ghost\"\n                          size=\"icon\"\n                          onClick={() => remove(index)}\n                          className=\"flex-shrink-0\"\n                          data-testid={`button-remove-question-${index}`}\n                        >\n                          <X className=\"h-4 w-4 text-destructive\" />\n                        </Button>\n                      </div>\n                    ))}\n                  </div>\n                )}\n              </div>\n\n              <DialogFooter>\n                <Button\n                  type=\"button\"\n                  variant=\"outline\"\n                  onClick={() => setIsDialogOpen(false)}\n                  data-testid=\"button-cancel\"\n                >\n                  Cancel\n                </Button>\n                <Button\n                  type=\"submit\"\n                  disabled={createMutation.isPending || updateMutation.isPending}\n                  data-testid=\"button-save-project\"\n                >\n                  {createMutation.isPending || updateMutation.isPending\n                    ? \"Saving...\"\n                    : editingProject\n                      ? \"Update Project\"\n                      : \"Create Project\"}\n                </Button>\n              </DialogFooter>\n            </form>\n          </Form>\n        </DialogContent>\n      </Dialog>\n\n      <AlertDialog open={!!deletingProject} onOpenChange={() => setDeletingProject(null)}>\n        <AlertDialogContent>\n          <AlertDialogHeader>\n            <AlertDialogTitle>Delete Project</AlertDialogTitle>\n            <AlertDialogDescription>\n              Are you sure you want to delete \"{deletingProject?.name}\"? This action cannot be\n              undone and will also remove all associated vetting questions, expert assignments, and call records.\n            </AlertDialogDescription>\n          </AlertDialogHeader>\n          <AlertDialogFooter>\n            <AlertDialogCancel data-testid=\"button-cancel-delete\">Cancel</AlertDialogCancel>\n            <AlertDialogAction\n              onClick={() => deletingProject && deleteMutation.mutate(deletingProject.id)}\n              className=\"bg-destructive text-destructive-foreground hover:bg-destructive/90\"\n              data-testid=\"button-confirm-delete\"\n            >\n              {deleteMutation.isPending ? \"Deleting...\" : \"Delete\"}\n            </AlertDialogAction>\n          </AlertDialogFooter>\n        </AlertDialogContent>\n      </AlertDialog>\n    </div>\n  );\n}\n","path":null,"size_bytes":33998,"size_tokens":null},"client/src/pages/not-found.tsx":{"content":"import { Card, CardContent } from \"@/components/ui/card\";\nimport { AlertCircle } from \"lucide-react\";\n\nexport default function NotFound() {\n  return (\n    <div className=\"min-h-screen w-full flex items-center justify-center bg-gray-50\">\n      <Card className=\"w-full max-w-md mx-4\">\n        <CardContent className=\"pt-6\">\n          <div className=\"flex mb-4 gap-2\">\n            <AlertCircle className=\"h-8 w-8 text-red-500\" />\n            <h1 className=\"text-2xl font-bold text-gray-900\">404 Page Not Found</h1>\n          </div>\n\n          <p className=\"mt-4 text-sm text-gray-600\">\n            Did you forget to add the page to the router?\n          </p>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","path":null,"size_bytes":711,"size_tokens":null},"client/src/components/ui/form.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as LabelPrimitive from \"@radix-ui/react-label\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport {\n  Controller,\n  FormProvider,\n  useFormContext,\n  type ControllerProps,\n  type FieldPath,\n  type FieldValues,\n} from \"react-hook-form\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Label } from \"@/components/ui/label\"\n\nconst Form = FormProvider\n\ntype FormFieldContextValue<\n  TFieldValues extends FieldValues = FieldValues,\n  TName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>\n> = {\n  name: TName\n}\n\nconst FormFieldContext = React.createContext<FormFieldContextValue>(\n  {} as FormFieldContextValue\n)\n\nconst FormField = <\n  TFieldValues extends FieldValues = FieldValues,\n  TName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>\n>({\n  ...props\n}: ControllerProps<TFieldValues, TName>) => {\n  return (\n    <FormFieldContext.Provider value={{ name: props.name }}>\n      <Controller {...props} />\n    </FormFieldContext.Provider>\n  )\n}\n\nconst useFormField = () => {\n  const fieldContext = React.useContext(FormFieldContext)\n  const itemContext = React.useContext(FormItemContext)\n  const { getFieldState, formState } = useFormContext()\n\n  const fieldState = getFieldState(fieldContext.name, formState)\n\n  if (!fieldContext) {\n    throw new Error(\"useFormField should be used within <FormField>\")\n  }\n\n  const { id } = itemContext\n\n  return {\n    id,\n    name: fieldContext.name,\n    formItemId: `${id}-form-item`,\n    formDescriptionId: `${id}-form-item-description`,\n    formMessageId: `${id}-form-item-message`,\n    ...fieldState,\n  }\n}\n\ntype FormItemContextValue = {\n  id: string\n}\n\nconst FormItemContext = React.createContext<FormItemContextValue>(\n  {} as FormItemContextValue\n)\n\nconst FormItem = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const id = React.useId()\n\n  return (\n    <FormItemContext.Provider value={{ id }}>\n      <div ref={ref} className={cn(\"space-y-2\", className)} {...props} />\n    </FormItemContext.Provider>\n  )\n})\nFormItem.displayName = \"FormItem\"\n\nconst FormLabel = React.forwardRef<\n  React.ElementRef<typeof LabelPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof LabelPrimitive.Root>\n>(({ className, ...props }, ref) => {\n  const { error, formItemId } = useFormField()\n\n  return (\n    <Label\n      ref={ref}\n      className={cn(error && \"text-destructive\", className)}\n      htmlFor={formItemId}\n      {...props}\n    />\n  )\n})\nFormLabel.displayName = \"FormLabel\"\n\nconst FormControl = React.forwardRef<\n  React.ElementRef<typeof Slot>,\n  React.ComponentPropsWithoutRef<typeof Slot>\n>(({ ...props }, ref) => {\n  const { error, formItemId, formDescriptionId, formMessageId } = useFormField()\n\n  return (\n    <Slot\n      ref={ref}\n      id={formItemId}\n      aria-describedby={\n        !error\n          ? `${formDescriptionId}`\n          : `${formDescriptionId} ${formMessageId}`\n      }\n      aria-invalid={!!error}\n      {...props}\n    />\n  )\n})\nFormControl.displayName = \"FormControl\"\n\nconst FormDescription = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, ...props }, ref) => {\n  const { formDescriptionId } = useFormField()\n\n  return (\n    <p\n      ref={ref}\n      id={formDescriptionId}\n      className={cn(\"text-sm text-muted-foreground\", className)}\n      {...props}\n    />\n  )\n})\nFormDescription.displayName = \"FormDescription\"\n\nconst FormMessage = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, children, ...props }, ref) => {\n  const { error, formMessageId } = useFormField()\n  const body = error ? String(error?.message ?? \"\") : children\n\n  if (!body) {\n    return null\n  }\n\n  return (\n    <p\n      ref={ref}\n      id={formMessageId}\n      className={cn(\"text-sm font-medium text-destructive\", className)}\n      {...props}\n    >\n      {body}\n    </p>\n  )\n})\nFormMessage.displayName = \"FormMessage\"\n\nexport {\n  useFormField,\n  Form,\n  FormItem,\n  FormLabel,\n  FormControl,\n  FormDescription,\n  FormMessage,\n  FormField,\n}\n","path":null,"size_bytes":4120,"size_tokens":null},"client/src/components/ui/collapsible.tsx":{"content":"\"use client\"\n\nimport * as CollapsiblePrimitive from \"@radix-ui/react-collapsible\"\n\nconst Collapsible = CollapsiblePrimitive.Root\n\nconst CollapsibleTrigger = CollapsiblePrimitive.CollapsibleTrigger\n\nconst CollapsibleContent = CollapsiblePrimitive.CollapsibleContent\n\nexport { Collapsible, CollapsibleTrigger, CollapsibleContent }\n","path":null,"size_bytes":329,"size_tokens":null},"client/src/components/ui/chart.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as RechartsPrimitive from \"recharts\"\n\nimport { cn } from \"@/lib/utils\"\n\n// Format: { THEME_NAME: CSS_SELECTOR }\nconst THEMES = { light: \"\", dark: \".dark\" } as const\n\nexport type ChartConfig = {\n  [k in string]: {\n    label?: React.ReactNode\n    icon?: React.ComponentType\n  } & (\n    | { color?: string; theme?: never }\n    | { color?: never; theme: Record<keyof typeof THEMES, string> }\n  )\n}\n\ntype ChartContextProps = {\n  config: ChartConfig\n}\n\nconst ChartContext = React.createContext<ChartContextProps | null>(null)\n\nfunction useChart() {\n  const context = React.useContext(ChartContext)\n\n  if (!context) {\n    throw new Error(\"useChart must be used within a <ChartContainer />\")\n  }\n\n  return context\n}\n\nconst ChartContainer = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> & {\n    config: ChartConfig\n    children: React.ComponentProps<\n      typeof RechartsPrimitive.ResponsiveContainer\n    >[\"children\"]\n  }\n>(({ id, className, children, config, ...props }, ref) => {\n  const uniqueId = React.useId()\n  const chartId = `chart-${id || uniqueId.replace(/:/g, \"\")}`\n\n  return (\n    <ChartContext.Provider value={{ config }}>\n      <div\n        data-chart={chartId}\n        ref={ref}\n        className={cn(\n          \"flex aspect-video justify-center text-xs [&_.recharts-cartesian-axis-tick_text]:fill-muted-foreground [&_.recharts-cartesian-grid_line[stroke='#ccc']]:stroke-border/50 [&_.recharts-curve.recharts-tooltip-cursor]:stroke-border [&_.recharts-dot[stroke='#fff']]:stroke-transparent [&_.recharts-layer]:outline-none [&_.recharts-polar-grid_[stroke='#ccc']]:stroke-border [&_.recharts-radial-bar-background-sector]:fill-muted [&_.recharts-rectangle.recharts-tooltip-cursor]:fill-muted [&_.recharts-reference-line_[stroke='#ccc']]:stroke-border [&_.recharts-sector[stroke='#fff']]:stroke-transparent [&_.recharts-sector]:outline-none [&_.recharts-surface]:outline-none\",\n          className\n        )}\n        {...props}\n      >\n        <ChartStyle id={chartId} config={config} />\n        <RechartsPrimitive.ResponsiveContainer>\n          {children}\n        </RechartsPrimitive.ResponsiveContainer>\n      </div>\n    </ChartContext.Provider>\n  )\n})\nChartContainer.displayName = \"Chart\"\n\nconst ChartStyle = ({ id, config }: { id: string; config: ChartConfig }) => {\n  const colorConfig = Object.entries(config).filter(\n    ([, config]) => config.theme || config.color\n  )\n\n  if (!colorConfig.length) {\n    return null\n  }\n\n  return (\n    <style\n      dangerouslySetInnerHTML={{\n        __html: Object.entries(THEMES)\n          .map(\n            ([theme, prefix]) => `\n${prefix} [data-chart=${id}] {\n${colorConfig\n  .map(([key, itemConfig]) => {\n    const color =\n      itemConfig.theme?.[theme as keyof typeof itemConfig.theme] ||\n      itemConfig.color\n    return color ? `  --color-${key}: ${color};` : null\n  })\n  .join(\"\\n\")}\n}\n`\n          )\n          .join(\"\\n\"),\n      }}\n    />\n  )\n}\n\nconst ChartTooltip = RechartsPrimitive.Tooltip\n\nconst ChartTooltipContent = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<typeof RechartsPrimitive.Tooltip> &\n    React.ComponentProps<\"div\"> & {\n      hideLabel?: boolean\n      hideIndicator?: boolean\n      indicator?: \"line\" | \"dot\" | \"dashed\"\n      nameKey?: string\n      labelKey?: string\n    }\n>(\n  (\n    {\n      active,\n      payload,\n      className,\n      indicator = \"dot\",\n      hideLabel = false,\n      hideIndicator = false,\n      label,\n      labelFormatter,\n      labelClassName,\n      formatter,\n      color,\n      nameKey,\n      labelKey,\n    },\n    ref\n  ) => {\n    const { config } = useChart()\n\n    const tooltipLabel = React.useMemo(() => {\n      if (hideLabel || !payload?.length) {\n        return null\n      }\n\n      const [item] = payload\n      const key = `${labelKey || item?.dataKey || item?.name || \"value\"}`\n      const itemConfig = getPayloadConfigFromPayload(config, item, key)\n      const value =\n        !labelKey && typeof label === \"string\"\n          ? config[label as keyof typeof config]?.label || label\n          : itemConfig?.label\n\n      if (labelFormatter) {\n        return (\n          <div className={cn(\"font-medium\", labelClassName)}>\n            {labelFormatter(value, payload)}\n          </div>\n        )\n      }\n\n      if (!value) {\n        return null\n      }\n\n      return <div className={cn(\"font-medium\", labelClassName)}>{value}</div>\n    }, [\n      label,\n      labelFormatter,\n      payload,\n      hideLabel,\n      labelClassName,\n      config,\n      labelKey,\n    ])\n\n    if (!active || !payload?.length) {\n      return null\n    }\n\n    const nestLabel = payload.length === 1 && indicator !== \"dot\"\n\n    return (\n      <div\n        ref={ref}\n        className={cn(\n          \"grid min-w-[8rem] items-start gap-1.5 rounded-lg border border-border/50 bg-background px-2.5 py-1.5 text-xs shadow-xl\",\n          className\n        )}\n      >\n        {!nestLabel ? tooltipLabel : null}\n        <div className=\"grid gap-1.5\">\n          {payload.map((item, index) => {\n            const key = `${nameKey || item.name || item.dataKey || \"value\"}`\n            const itemConfig = getPayloadConfigFromPayload(config, item, key)\n            const indicatorColor = color || item.payload.fill || item.color\n\n            return (\n              <div\n                key={item.dataKey}\n                className={cn(\n                  \"flex w-full flex-wrap items-stretch gap-2 [&>svg]:h-2.5 [&>svg]:w-2.5 [&>svg]:text-muted-foreground\",\n                  indicator === \"dot\" && \"items-center\"\n                )}\n              >\n                {formatter && item?.value !== undefined && item.name ? (\n                  formatter(item.value, item.name, item, index, item.payload)\n                ) : (\n                  <>\n                    {itemConfig?.icon ? (\n                      <itemConfig.icon />\n                    ) : (\n                      !hideIndicator && (\n                        <div\n                          className={cn(\n                            \"shrink-0 rounded-[2px] border-[--color-border] bg-[--color-bg]\",\n                            {\n                              \"h-2.5 w-2.5\": indicator === \"dot\",\n                              \"w-1\": indicator === \"line\",\n                              \"w-0 border-[1.5px] border-dashed bg-transparent\":\n                                indicator === \"dashed\",\n                              \"my-0.5\": nestLabel && indicator === \"dashed\",\n                            }\n                          )}\n                          style={\n                            {\n                              \"--color-bg\": indicatorColor,\n                              \"--color-border\": indicatorColor,\n                            } as React.CSSProperties\n                          }\n                        />\n                      )\n                    )}\n                    <div\n                      className={cn(\n                        \"flex flex-1 justify-between leading-none\",\n                        nestLabel ? \"items-end\" : \"items-center\"\n                      )}\n                    >\n                      <div className=\"grid gap-1.5\">\n                        {nestLabel ? tooltipLabel : null}\n                        <span className=\"text-muted-foreground\">\n                          {itemConfig?.label || item.name}\n                        </span>\n                      </div>\n                      {item.value && (\n                        <span className=\"font-mono font-medium tabular-nums text-foreground\">\n                          {item.value.toLocaleString()}\n                        </span>\n                      )}\n                    </div>\n                  </>\n                )}\n              </div>\n            )\n          })}\n        </div>\n      </div>\n    )\n  }\n)\nChartTooltipContent.displayName = \"ChartTooltip\"\n\nconst ChartLegend = RechartsPrimitive.Legend\n\nconst ChartLegendContent = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> &\n    Pick<RechartsPrimitive.LegendProps, \"payload\" | \"verticalAlign\"> & {\n      hideIcon?: boolean\n      nameKey?: string\n    }\n>(\n  (\n    { className, hideIcon = false, payload, verticalAlign = \"bottom\", nameKey },\n    ref\n  ) => {\n    const { config } = useChart()\n\n    if (!payload?.length) {\n      return null\n    }\n\n    return (\n      <div\n        ref={ref}\n        className={cn(\n          \"flex items-center justify-center gap-4\",\n          verticalAlign === \"top\" ? \"pb-3\" : \"pt-3\",\n          className\n        )}\n      >\n        {payload.map((item) => {\n          const key = `${nameKey || item.dataKey || \"value\"}`\n          const itemConfig = getPayloadConfigFromPayload(config, item, key)\n\n          return (\n            <div\n              key={item.value}\n              className={cn(\n                \"flex items-center gap-1.5 [&>svg]:h-3 [&>svg]:w-3 [&>svg]:text-muted-foreground\"\n              )}\n            >\n              {itemConfig?.icon && !hideIcon ? (\n                <itemConfig.icon />\n              ) : (\n                <div\n                  className=\"h-2 w-2 shrink-0 rounded-[2px]\"\n                  style={{\n                    backgroundColor: item.color,\n                  }}\n                />\n              )}\n              {itemConfig?.label}\n            </div>\n          )\n        })}\n      </div>\n    )\n  }\n)\nChartLegendContent.displayName = \"ChartLegend\"\n\n// Helper to extract item config from a payload.\nfunction getPayloadConfigFromPayload(\n  config: ChartConfig,\n  payload: unknown,\n  key: string\n) {\n  if (typeof payload !== \"object\" || payload === null) {\n    return undefined\n  }\n\n  const payloadPayload =\n    \"payload\" in payload &&\n    typeof payload.payload === \"object\" &&\n    payload.payload !== null\n      ? payload.payload\n      : undefined\n\n  let configLabelKey: string = key\n\n  if (\n    key in payload &&\n    typeof payload[key as keyof typeof payload] === \"string\"\n  ) {\n    configLabelKey = payload[key as keyof typeof payload] as string\n  } else if (\n    payloadPayload &&\n    key in payloadPayload &&\n    typeof payloadPayload[key as keyof typeof payloadPayload] === \"string\"\n  ) {\n    configLabelKey = payloadPayload[\n      key as keyof typeof payloadPayload\n    ] as string\n  }\n\n  return configLabelKey in config\n    ? config[configLabelKey]\n    : config[key as keyof typeof config]\n}\n\nexport {\n  ChartContainer,\n  ChartTooltip,\n  ChartTooltipContent,\n  ChartLegend,\n  ChartLegendContent,\n  ChartStyle,\n}\n","path":null,"size_bytes":10481,"size_tokens":null},"client/src/components/ui/toggle.tsx":{"content":"import * as React from \"react\"\nimport * as TogglePrimitive from \"@radix-ui/react-toggle\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst toggleVariants = cva(\n  \"inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors hover:bg-muted hover:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=on]:bg-accent data-[state=on]:text-accent-foreground [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0 gap-2\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-transparent\",\n        outline:\n          \"border border-input bg-transparent hover:bg-accent hover:text-accent-foreground\",\n      },\n      size: {\n        default: \"h-10 px-3 min-w-10\",\n        sm: \"h-9 px-2.5 min-w-9\",\n        lg: \"h-11 px-5 min-w-11\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  }\n)\n\nconst Toggle = React.forwardRef<\n  React.ElementRef<typeof TogglePrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof TogglePrimitive.Root> &\n    VariantProps<typeof toggleVariants>\n>(({ className, variant, size, ...props }, ref) => (\n  <TogglePrimitive.Root\n    ref={ref}\n    className={cn(toggleVariants({ variant, size, className }))}\n    {...props}\n  />\n))\n\nToggle.displayName = TogglePrimitive.Root.displayName\n\nexport { Toggle, toggleVariants }\n","path":null,"size_bytes":1527,"size_tokens":null},"client/src/lib/auth.tsx":{"content":"import { createContext, useContext, useState, useEffect, useCallback } from \"react\";\nimport { useLocation } from \"wouter\";\nimport { canAccessPage, type PageKey } from \"./permissions\";\n\ninterface AuthUser {\n  id: number;\n  fullName: string;\n  email: string;\n  role: string;\n  mustChangePassword?: boolean;\n}\n\ninterface AuthContextType {\n  user: AuthUser | null;\n  token: string | null;\n  isLoading: boolean;\n  isAuthenticated: boolean;\n  login: (email: string, password: string) => Promise<void>;\n  logout: () => void;\n}\n\nconst AuthContext = createContext<AuthContextType | null>(null);\n\nexport function AuthProvider({ children }: { children: React.ReactNode }) {\n  const [user, setUser] = useState<AuthUser | null>(null);\n  const [token, setToken] = useState<string | null>(null);\n  const [isLoading, setIsLoading] = useState(true);\n  const [, setLocation] = useLocation();\n\n  useEffect(() => {\n    const storedToken = localStorage.getItem(\"authToken\");\n    if (storedToken) {\n      setToken(storedToken);\n      fetchUser(storedToken);\n    } else {\n      setIsLoading(false);\n    }\n  }, []);\n\n  const fetchUser = async (authToken: string) => {\n    try {\n      const response = await fetch(\"/api/auth/me\", {\n        headers: {\n          Authorization: `Bearer ${authToken}`,\n        },\n      });\n      if (response.ok) {\n        const userData = await response.json();\n        setUser(userData);\n      } else {\n        localStorage.removeItem(\"authToken\");\n        setToken(null);\n      }\n    } catch {\n      localStorage.removeItem(\"authToken\");\n      setToken(null);\n    } finally {\n      setIsLoading(false);\n    }\n  };\n\n  const login = useCallback(async (email: string, password: string) => {\n    const response = await fetch(\"/api/auth/login\", {\n      method: \"POST\",\n      headers: {\n        \"Content-Type\": \"application/json\",\n      },\n      body: JSON.stringify({ email, password }),\n    });\n\n    if (!response.ok) {\n      const data = await response.json();\n      throw new Error(data.error || \"Login failed\");\n    }\n\n    const data = await response.json();\n    localStorage.setItem(\"authToken\", data.token);\n    setToken(data.token);\n    setUser(data.user);\n    \n    // Redirect based on mustChangePassword flag\n    if (data.user.mustChangePassword) {\n      setLocation(\"/change-password\");\n    } else {\n      setLocation(\"/\");\n    }\n  }, [setLocation]);\n\n  const logout = useCallback(() => {\n    localStorage.removeItem(\"authToken\");\n    setToken(null);\n    setUser(null);\n    setLocation(\"/login\");\n  }, [setLocation]);\n\n  return (\n    <AuthContext.Provider\n      value={{\n        user,\n        token,\n        isLoading,\n        isAuthenticated: !!user && !!token,\n        login,\n        logout,\n      }}\n    >\n      {children}\n    </AuthContext.Provider>\n  );\n}\n\nexport function useAuth() {\n  const context = useContext(AuthContext);\n  if (!context) {\n    throw new Error(\"useAuth must be used within an AuthProvider\");\n  }\n  return context;\n}\n\nexport function ProtectedRoute({ children, allowChangePassword = false }: { children: React.ReactNode, allowChangePassword?: boolean }) {\n  const { isAuthenticated, isLoading, user } = useAuth();\n  const [, setLocation] = useLocation();\n\n  useEffect(() => {\n    if (!isLoading && !isAuthenticated) {\n      setLocation(\"/login\");\n    }\n  }, [isAuthenticated, isLoading, setLocation]);\n\n  useEffect(() => {\n    // If user must change password and this route doesn't allow it, redirect\n    if (!isLoading && user && user.mustChangePassword && !allowChangePassword) {\n      setLocation(\"/change-password\");\n    }\n  }, [user, isLoading, allowChangePassword, setLocation]);\n\n  if (isLoading) {\n    return (\n      <div className=\"flex h-screen items-center justify-center\" data-testid=\"loading-spinner\">\n        <div className=\"h-8 w-8 animate-spin rounded-full border-4 border-primary border-t-transparent\" />\n      </div>\n    );\n  }\n\n  if (!isAuthenticated) {\n    return null;\n  }\n\n  return <>{children}</>;\n}\n\ninterface RoleGuardProps {\n  children: React.ReactNode;\n  allowedRoles?: string[];\n  requiredPage?: PageKey;\n  fallback?: React.ReactNode;\n}\n\nexport function RoleGuard({ \n  children, \n  allowedRoles, \n  requiredPage,\n  fallback \n}: RoleGuardProps) {\n  const { user, isLoading } = useAuth();\n  const [, setLocation] = useLocation();\n\n  if (isLoading) {\n    return (\n      <div className=\"flex h-64 items-center justify-center\" data-testid=\"role-guard-loading\">\n        <div className=\"h-6 w-6 animate-spin rounded-full border-2 border-primary border-t-transparent\" />\n      </div>\n    );\n  }\n\n  if (!user) {\n    return null;\n  }\n\n  let hasAccess = false;\n\n  if (requiredPage) {\n    hasAccess = canAccessPage(user.role, requiredPage);\n  } else if (allowedRoles) {\n    hasAccess = allowedRoles.includes(user.role);\n  } else {\n    hasAccess = true;\n  }\n\n  if (!hasAccess) {\n    if (fallback) {\n      return <>{fallback}</>;\n    }\n    \n    return (\n      <div className=\"flex h-64 flex-col items-center justify-center gap-4\" data-testid=\"access-denied\">\n        <div className=\"text-4xl text-muted-foreground\">403</div>\n        <h2 className=\"text-xl font-semibold\">Access Denied</h2>\n        <p className=\"text-muted-foreground\">You do not have permission to view this page.</p>\n        <button\n          onClick={() => setLocation(\"/\")}\n          className=\"text-primary hover:underline\"\n          data-testid=\"button-go-home\"\n        >\n          Go to Dashboard\n        </button>\n      </div>\n    );\n  }\n\n  return <>{children}</>;\n}\n","path":null,"size_bytes":5494,"size_tokens":null},"client/src/components/data-table-skeleton.tsx":{"content":"import { Skeleton } from \"@/components/ui/skeleton\";\nimport {\n  Table,\n  TableBody,\n  TableCell,\n  TableHead,\n  TableHeader,\n  TableRow,\n} from \"@/components/ui/table\";\n\ninterface DataTableSkeletonProps {\n  columns: number;\n  rows?: number;\n}\n\nexport function DataTableSkeleton({ columns, rows = 5 }: DataTableSkeletonProps) {\n  return (\n    <Table>\n      <TableHeader>\n        <TableRow>\n          {Array.from({ length: columns }).map((_, i) => (\n            <TableHead key={i}>\n              <Skeleton className=\"h-4 w-24\" />\n            </TableHead>\n          ))}\n        </TableRow>\n      </TableHeader>\n      <TableBody>\n        {Array.from({ length: rows }).map((_, rowIndex) => (\n          <TableRow key={rowIndex}>\n            {Array.from({ length: columns }).map((_, colIndex) => (\n              <TableCell key={colIndex}>\n                <Skeleton className=\"h-4 w-full max-w-32\" />\n              </TableCell>\n            ))}\n          </TableRow>\n        ))}\n      </TableBody>\n    </Table>\n  );\n}\n","path":null,"size_bytes":1009,"size_tokens":null},"client/src/components/ui/label.tsx":{"content":"import * as React from \"react\"\nimport * as LabelPrimitive from \"@radix-ui/react-label\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst labelVariants = cva(\n  \"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70\"\n)\n\nconst Label = React.forwardRef<\n  React.ElementRef<typeof LabelPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof LabelPrimitive.Root> &\n    VariantProps<typeof labelVariants>\n>(({ className, ...props }, ref) => (\n  <LabelPrimitive.Root\n    ref={ref}\n    className={cn(labelVariants(), className)}\n    {...props}\n  />\n))\nLabel.displayName = LabelPrimitive.Root.displayName\n\nexport { Label }\n","path":null,"size_bytes":710,"size_tokens":null},"client/src/pages/employees.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { Plus, MoreHorizontal, Key, Edit, ToggleLeft, ToggleRight, Shield, UserCheck, Users, Calculator, Phone, DollarSign, Clock, X, Building, ArrowUp, ArrowDown, Filter, ChevronDown } from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Avatar, AvatarFallback } from \"@/components/ui/avatar\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogDescription,\n  DialogFooter,\n  DialogHeader,\n  DialogTitle,\n} from \"@/components/ui/dialog\";\nimport {\n  DropdownMenu,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuSeparator,\n  DropdownMenuTrigger,\n} from \"@/components/ui/dropdown-menu\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport {\n  Table,\n  TableBody,\n  TableCell,\n  TableHead,\n  TableHeader,\n  TableRow,\n} from \"@/components/ui/table\";\nimport {\n  Sheet,\n  SheetContent,\n  SheetHeader,\n  SheetTitle,\n} from \"@/components/ui/sheet\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport type { User } from \"@shared/schema\";\nimport { RoleGuard } from \"@/lib/auth\";\n\ninterface EmployeeOverview {\n  employee: {\n    id: number;\n    fullName: string;\n    email: string;\n    role: string;\n    status: string;\n    joinedAt: string;\n  };\n  kpi: {\n    period: {\n      month: number;\n      year: number;\n      timezone: string;\n    };\n    totalCU: number;\n    completedCalls: number;\n    incentive: number;\n  };\n  accounts: {\n    clientId: number | null;\n    clientName: string;\n    totalCUThisMonth: number;\n    completedCallsThisMonth: number;\n    revenueThisMonthUSD: number;\n    contractedCU: number | null;\n    usageRate: number | null;\n    lastActivityAt: string | null;\n  }[];\n}\n\ntype UserRole = \"admin\" | \"pm\" | \"ra\" | \"finance\";\n\nconst ROLES: { value: UserRole; label: string; icon: any }[] = [\n  { value: \"admin\", label: \"Admin\", icon: Shield },\n  { value: \"pm\", label: \"Project Manager\", icon: UserCheck },\n  { value: \"ra\", label: \"Research Associate\", icon: Users },\n  { value: \"finance\", label: \"Finance\", icon: Calculator },\n];\n\nfunction getRoleIcon(role: string) {\n  const roleConfig = ROLES.find(r => r.value === role);\n  return roleConfig?.icon || Users;\n}\n\nfunction getRoleLabel(role: string): string {\n  const roleConfig = ROLES.find(r => r.value === role);\n  return roleConfig?.label || role;\n}\n\nfunction getRoleVariant(role: string): \"default\" | \"secondary\" | \"destructive\" | \"outline\" {\n  switch (role) {\n    case \"admin\": return \"destructive\";\n    case \"pm\": return \"default\";\n    case \"ra\": return \"secondary\";\n    case \"finance\": return \"outline\";\n    default: return \"secondary\";\n  }\n}\n\nfunction EmployeesContent() {\n  const { toast } = useToast();\n  const [isCreateOpen, setIsCreateOpen] = useState(false);\n  const [isEditOpen, setIsEditOpen] = useState(false);\n  const [isResetPasswordOpen, setIsResetPasswordOpen] = useState(false);\n  const [isDetailOpen, setIsDetailOpen] = useState(false);\n  const [selectedEmployee, setSelectedEmployee] = useState<User | null>(null);\n  const [detailEmployeeId, setDetailEmployeeId] = useState<number | null>(null);\n  const [sortColumn, setSortColumn] = useState<\"name\" | \"email\" | \"role\" | \"status\">(\"name\");\n  const [sortOrder, setSortOrder] = useState<\"asc\" | \"desc\">(\"asc\");\n  const [selectedRoles, setSelectedRoles] = useState<string[]>([]);\n  const [selectedStatuses, setSelectedStatuses] = useState<string[]>([]);\n  \n  const [createForm, setCreateForm] = useState({\n    fullName: \"\",\n    localPart: \"\",\n    role: \"ra\" as UserRole,\n    tempPassword: \"\",\n  });\n  \n  const [editForm, setEditForm] = useState({\n    fullName: \"\",\n    role: \"ra\" as UserRole,\n    isActive: true,\n  });\n  \n  const [resetPasswordForm, setResetPasswordForm] = useState({\n    tempPassword: \"\",\n  });\n\n  const { data: employees, isLoading } = useQuery<User[]>({\n    queryKey: [\"/api/employees\"],\n  });\n\n  const { data: employeeOverview, isLoading: isOverviewLoading } = useQuery<EmployeeOverview>({\n    queryKey: [`/api/employees/${detailEmployeeId}/overview`],\n    enabled: !!detailEmployeeId && isDetailOpen,\n  });\n\n  const handleEmployeeClick = (employee: User) => {\n    setDetailEmployeeId(employee.id);\n    setIsDetailOpen(true);\n  };\n\n  const createMutation = useMutation({\n    mutationFn: (data: typeof createForm) => \n      apiRequest(\"POST\", \"/api/employees\", data),\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/employees\"] });\n      setIsCreateOpen(false);\n      setCreateForm({ fullName: \"\", localPart: \"\", role: \"ra\", tempPassword: \"\" });\n      toast({ title: \"Employee created successfully\" });\n    },\n    onError: (error: any) => {\n      toast({ title: \"Failed to create employee\", description: error.message, variant: \"destructive\" });\n    },\n  });\n\n  const updateMutation = useMutation({\n    mutationFn: ({ id, data }: { id: number; data: Partial<typeof editForm> }) =>\n      apiRequest(\"PUT\", `/api/employees/${id}`, data),\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/employees\"] });\n      setIsEditOpen(false);\n      setSelectedEmployee(null);\n      toast({ title: \"Employee updated successfully\" });\n    },\n    onError: (error: any) => {\n      toast({ title: \"Failed to update employee\", description: error.message, variant: \"destructive\" });\n    },\n  });\n\n  const resetPasswordMutation = useMutation({\n    mutationFn: ({ id, tempPassword }: { id: number; tempPassword: string }) =>\n      apiRequest(\"POST\", `/api/employees/${id}/reset-password`, { tempPassword }),\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/employees\"] });\n      setIsResetPasswordOpen(false);\n      setSelectedEmployee(null);\n      setResetPasswordForm({ tempPassword: \"\" });\n      toast({ title: \"Password reset successfully\" });\n    },\n    onError: (error: any) => {\n      toast({ title: \"Failed to reset password\", description: error.message, variant: \"destructive\" });\n    },\n  });\n\n  const handleCreateSubmit = (e: React.FormEvent) => {\n    e.preventDefault();\n    createMutation.mutate(createForm);\n  };\n\n  const handleEditSubmit = (e: React.FormEvent) => {\n    e.preventDefault();\n    if (selectedEmployee) {\n      updateMutation.mutate({ id: selectedEmployee.id, data: editForm });\n    }\n  };\n\n  const handleResetPasswordSubmit = (e: React.FormEvent) => {\n    e.preventDefault();\n    if (selectedEmployee) {\n      resetPasswordMutation.mutate({ id: selectedEmployee.id, tempPassword: resetPasswordForm.tempPassword });\n    }\n  };\n\n  const handleEditClick = (employee: User) => {\n    setSelectedEmployee(employee);\n    setEditForm({\n      fullName: employee.fullName,\n      role: employee.role as UserRole,\n      isActive: employee.isActive ?? true,\n    });\n    setIsEditOpen(true);\n  };\n\n  const handleResetPasswordClick = (employee: User) => {\n    setSelectedEmployee(employee);\n    setResetPasswordForm({ tempPassword: \"\" });\n    setIsResetPasswordOpen(true);\n  };\n\n  const handleToggleActive = (employee: User) => {\n    updateMutation.mutate({ \n      id: employee.id, \n      data: { isActive: !(employee.isActive ?? true) } \n    });\n  };\n\n  const activeCount = employees?.filter(e => e.isActive !== false).length ?? 0;\n  const inactiveCount = employees?.filter(e => e.isActive === false).length ?? 0;\n\n  // Apply filters first\n  const filteredEmployees = employees\n    ? employees.filter(e => {\n        // Role filter\n        if (selectedRoles.length > 0 && !selectedRoles.includes(e.role)) {\n          return false;\n        }\n        // Status filter\n        if (selectedStatuses.length > 0) {\n          const status = e.isActive !== false ? \"active\" : \"inactive\";\n          if (!selectedStatuses.includes(status)) {\n            return false;\n          }\n        }\n        return true;\n      })\n    : employees;\n\n  // Apply sorting to filtered results\n  const sortedEmployees = filteredEmployees\n    ? [...filteredEmployees].sort((a, b) => {\n        let comparison = 0;\n        \n        switch (sortColumn) {\n          case \"name\":\n            comparison = a.fullName.localeCompare(b.fullName);\n            break;\n          case \"email\":\n            comparison = a.email.localeCompare(b.email);\n            break;\n          case \"role\":\n            comparison = a.role.localeCompare(b.role);\n            break;\n          case \"status\":\n            const statusA = a.isActive !== false ? \"active\" : \"inactive\";\n            const statusB = b.isActive !== false ? \"active\" : \"inactive\";\n            comparison = statusA.localeCompare(statusB);\n            break;\n          default:\n            comparison = 0;\n        }\n        \n        return sortOrder === \"asc\" ? comparison : -comparison;\n      })\n    : filteredEmployees;\n\n  const handleColumnSort = (column: \"name\" | \"email\" | \"role\" | \"status\") => {\n    if (sortColumn === column) {\n      setSortOrder(sortOrder === \"asc\" ? \"desc\" : \"asc\");\n    } else {\n      setSortColumn(column);\n      setSortOrder(\"asc\");\n    }\n  };\n\n  const handleToggleRoleFilter = (role: string) => {\n    setSelectedRoles(prev => \n      prev.includes(role) ? prev.filter(r => r !== role) : [...prev, role]\n    );\n  };\n\n  const handleToggleStatusFilter = (status: string) => {\n    setSelectedStatuses(prev => \n      prev.includes(status) ? prev.filter(s => s !== status) : [...prev, status]\n    );\n  };\n\n  const handleClearFilters = () => {\n    setSelectedRoles([]);\n    setSelectedStatuses([]);\n  };\n\n  const hasActiveFilters = selectedRoles.length > 0 || selectedStatuses.length > 0;\n\n  return (\n    <div className=\"flex flex-col gap-6 p-6\">\n      <div className=\"flex flex-wrap items-center justify-between gap-4\">\n        <div>\n          <h1 className=\"text-2xl font-semibold\" data-testid=\"text-page-title\">Employees</h1>\n          <p className=\"text-muted-foreground\">Manage internal team members and their access levels</p>\n        </div>\n        <Button onClick={() => setIsCreateOpen(true)} data-testid=\"button-create-employee\">\n          <Plus className=\"mr-2 h-4 w-4\" />\n          Add Employee\n        </Button>\n      </div>\n\n      <div className=\"grid gap-4 md:grid-cols-4\">\n        <Card>\n          <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2 gap-2\">\n            <CardTitle className=\"text-sm font-medium\">Total Employees</CardTitle>\n            <Users className=\"h-4 w-4 text-muted-foreground\" />\n          </CardHeader>\n          <CardContent>\n            <div className=\"text-2xl font-bold\" data-testid=\"text-total-count\">{employees?.length ?? 0}</div>\n          </CardContent>\n        </Card>\n        <Card>\n          <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2 gap-2\">\n            <CardTitle className=\"text-sm font-medium\">Active</CardTitle>\n            <ToggleRight className=\"h-4 w-4 text-green-500\" />\n          </CardHeader>\n          <CardContent>\n            <div className=\"text-2xl font-bold text-green-600\" data-testid=\"text-active-count\">{activeCount}</div>\n          </CardContent>\n        </Card>\n        <Card>\n          <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2 gap-2\">\n            <CardTitle className=\"text-sm font-medium\">Inactive</CardTitle>\n            <ToggleLeft className=\"h-4 w-4 text-muted-foreground\" />\n          </CardHeader>\n          <CardContent>\n            <div className=\"text-2xl font-bold text-muted-foreground\" data-testid=\"text-inactive-count\">{inactiveCount}</div>\n          </CardContent>\n        </Card>\n        <Card>\n          <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2 gap-2\">\n            <CardTitle className=\"text-sm font-medium\">Admins</CardTitle>\n            <Shield className=\"h-4 w-4 text-red-500\" />\n          </CardHeader>\n          <CardContent>\n            <div className=\"text-2xl font-bold\" data-testid=\"text-admin-count\">\n              {employees?.filter(e => e.role === \"admin\").length ?? 0}\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n\n      <Card>\n        <CardContent className=\"p-0\">\n          {/* Filter Bar */}\n          <div className=\"border-b p-4 flex items-center gap-3 flex-wrap\">\n            {/* Role Filter */}\n            <div className=\"relative group\">\n              <button\n                className={`inline-flex items-center gap-2 px-3 py-2 rounded-md border text-sm transition-colors ${\n                  selectedRoles.length > 0\n                    ? \"bg-blue-50 border-blue-300 text-blue-700 dark:bg-blue-950 dark:border-blue-700 dark:text-blue-200\"\n                    : \"hover:bg-muted\"\n                }`}\n                data-testid=\"button-filter-role\"\n              >\n                <Filter className=\"h-4 w-4\" />\n                Role\n                {selectedRoles.length > 0 && (\n                  <Badge variant=\"default\" className=\"ml-1 h-5 w-5 p-0 flex items-center justify-center\">\n                    {selectedRoles.length}\n                  </Badge>\n                )}\n                <ChevronDown className=\"h-4 w-4 ml-1\" />\n              </button>\n              \n              {/* Role Dropdown */}\n              <div className=\"absolute left-0 top-full mt-1 w-48 bg-white dark:bg-slate-950 border rounded-md shadow-lg hidden group-hover:block z-50\">\n                <div className=\"p-2 space-y-1\">\n                  {ROLES.map(role => (\n                    <button\n                      key={role.value}\n                      onClick={() => handleToggleRoleFilter(role.value)}\n                      className={`w-full text-left px-3 py-2 rounded-md text-sm flex items-center gap-2 transition-colors ${\n                        selectedRoles.includes(role.value)\n                          ? \"bg-blue-100 text-blue-900 dark:bg-blue-900 dark:text-blue-100\"\n                          : \"hover:bg-muted\"\n                      }`}\n                      data-testid={`button-filter-role-${role.value}`}\n                    >\n                      <role.icon className=\"h-3 w-3\" />\n                      {role.label}\n                      {selectedRoles.includes(role.value) && (\n                        <span className=\"ml-auto text-xs\"></span>\n                      )}\n                    </button>\n                  ))}\n                </div>\n              </div>\n            </div>\n\n            {/* Status Filter */}\n            <div className=\"relative group\">\n              <button\n                className={`inline-flex items-center gap-2 px-3 py-2 rounded-md border text-sm transition-colors ${\n                  selectedStatuses.length > 0\n                    ? \"bg-blue-50 border-blue-300 text-blue-700 dark:bg-blue-950 dark:border-blue-700 dark:text-blue-200\"\n                    : \"hover:bg-muted\"\n                }`}\n                data-testid=\"button-filter-status\"\n              >\n                <Filter className=\"h-4 w-4\" />\n                Status\n                {selectedStatuses.length > 0 && (\n                  <Badge variant=\"default\" className=\"ml-1 h-5 w-5 p-0 flex items-center justify-center\">\n                    {selectedStatuses.length}\n                  </Badge>\n                )}\n                <ChevronDown className=\"h-4 w-4 ml-1\" />\n              </button>\n              \n              {/* Status Dropdown */}\n              <div className=\"absolute left-0 top-full mt-1 w-40 bg-white dark:bg-slate-950 border rounded-md shadow-lg hidden group-hover:block z-50\">\n                <div className=\"p-2 space-y-1\">\n                  {[\n                    { value: \"active\", label: \"Active\", icon: ToggleRight },\n                    { value: \"inactive\", label: \"Inactive\", icon: ToggleLeft },\n                  ].map(status => (\n                    <button\n                      key={status.value}\n                      onClick={() => handleToggleStatusFilter(status.value)}\n                      className={`w-full text-left px-3 py-2 rounded-md text-sm flex items-center gap-2 transition-colors ${\n                        selectedStatuses.includes(status.value)\n                          ? \"bg-blue-100 text-blue-900 dark:bg-blue-900 dark:text-blue-100\"\n                          : \"hover:bg-muted\"\n                      }`}\n                      data-testid={`button-filter-status-${status.value}`}\n                    >\n                      <status.icon className=\"h-3 w-3\" />\n                      {status.label}\n                      {selectedStatuses.includes(status.value) && (\n                        <span className=\"ml-auto text-xs\"></span>\n                      )}\n                    </button>\n                  ))}\n                </div>\n              </div>\n            </div>\n\n            {/* Clear Filters Button */}\n            {hasActiveFilters && (\n              <button\n                onClick={handleClearFilters}\n                className=\"inline-flex items-center gap-2 px-3 py-2 rounded-md border text-sm hover:bg-muted transition-colors\"\n                data-testid=\"button-clear-filters\"\n              >\n                <X className=\"h-4 w-4\" />\n                Clear Filters\n              </button>\n            )}\n          </div>\n\n          {/* Results Count */}\n          {hasActiveFilters && (\n            <div className=\"border-b px-4 py-2 text-xs text-muted-foreground bg-muted/30\">\n              Showing {sortedEmployees?.length ?? 0} of {employees?.length ?? 0} employees\n            </div>\n          )}\n\n          <Table>\n            <TableHeader>\n              <TableRow>\n                <TableHead>\n                  <button\n                    onClick={() => handleColumnSort(\"name\")}\n                    className=\"flex items-center gap-2 hover:text-primary transition-colors\"\n                    data-testid=\"button-sort-name\"\n                  >\n                    Name\n                    {sortColumn === \"name\" && (\n                      sortOrder === \"asc\" ? (\n                        <ArrowUp className=\"h-4 w-4\" />\n                      ) : (\n                        <ArrowDown className=\"h-4 w-4\" />\n                      )\n                    )}\n                  </button>\n                </TableHead>\n                <TableHead>\n                  <button\n                    onClick={() => handleColumnSort(\"email\")}\n                    className=\"flex items-center gap-2 hover:text-primary transition-colors\"\n                    data-testid=\"button-sort-email\"\n                  >\n                    Email\n                    {sortColumn === \"email\" && (\n                      sortOrder === \"asc\" ? (\n                        <ArrowUp className=\"h-4 w-4\" />\n                      ) : (\n                        <ArrowDown className=\"h-4 w-4\" />\n                      )\n                    )}\n                  </button>\n                </TableHead>\n                <TableHead>\n                  <button\n                    onClick={() => handleColumnSort(\"role\")}\n                    className=\"flex items-center gap-2 hover:text-primary transition-colors\"\n                    data-testid=\"button-sort-role\"\n                  >\n                    Role\n                    {sortColumn === \"role\" && (\n                      sortOrder === \"asc\" ? (\n                        <ArrowUp className=\"h-4 w-4\" />\n                      ) : (\n                        <ArrowDown className=\"h-4 w-4\" />\n                      )\n                    )}\n                  </button>\n                </TableHead>\n                <TableHead>\n                  <button\n                    onClick={() => handleColumnSort(\"status\")}\n                    className=\"flex items-center gap-2 hover:text-primary transition-colors\"\n                    data-testid=\"button-sort-status\"\n                  >\n                    Status\n                    {sortColumn === \"status\" && (\n                      sortOrder === \"asc\" ? (\n                        <ArrowUp className=\"h-4 w-4\" />\n                      ) : (\n                        <ArrowDown className=\"h-4 w-4\" />\n                      )\n                    )}\n                  </button>\n                </TableHead>\n                <TableHead className=\"w-12\"></TableHead>\n              </TableRow>\n            </TableHeader>\n            <TableBody>\n              {isLoading ? (\n                <TableRow>\n                  <TableCell colSpan={5} className=\"text-center py-8\">\n                    <div className=\"flex items-center justify-center\">\n                      <div className=\"h-6 w-6 animate-spin rounded-full border-2 border-primary border-t-transparent\" />\n                    </div>\n                  </TableCell>\n                </TableRow>\n              ) : employees?.length === 0 ? (\n                <TableRow>\n                  <TableCell colSpan={5} className=\"text-center py-8 text-muted-foreground\">\n                    No employees found. Add your first employee to get started.\n                  </TableCell>\n                </TableRow>\n              ) : (\n                sortedEmployees?.map((employee) => {\n                  const RoleIcon = getRoleIcon(employee.role);\n                  return (\n                    <TableRow key={employee.id} data-testid={`row-employee-${employee.id}`}>\n                      <TableCell className=\"font-medium\" data-testid={`text-name-${employee.id}`}>\n                        <button\n                          onClick={() => handleEmployeeClick(employee)}\n                          className=\"text-left hover:text-primary hover:underline cursor-pointer\"\n                          data-testid={`button-view-${employee.id}`}\n                        >\n                          {employee.fullName}\n                        </button>\n                      </TableCell>\n                      <TableCell className=\"text-muted-foreground\" data-testid={`text-email-${employee.id}`}>\n                        {employee.email}\n                      </TableCell>\n                      <TableCell>\n                        <Badge variant={getRoleVariant(employee.role)} className=\"gap-1\" data-testid={`badge-role-${employee.id}`}>\n                          <RoleIcon className=\"h-3 w-3\" />\n                          {getRoleLabel(employee.role)}\n                        </Badge>\n                      </TableCell>\n                      <TableCell>\n                        <Badge \n                          variant={employee.isActive !== false ? \"default\" : \"secondary\"}\n                          className={employee.isActive !== false ? \"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-100\" : \"\"}\n                          data-testid={`badge-status-${employee.id}`}\n                        >\n                          {employee.isActive !== false ? \"Active\" : \"Inactive\"}\n                        </Badge>\n                      </TableCell>\n                      <TableCell>\n                        <DropdownMenu>\n                          <DropdownMenuTrigger asChild>\n                            <Button variant=\"ghost\" size=\"icon\" data-testid={`button-actions-${employee.id}`}>\n                              <MoreHorizontal className=\"h-4 w-4\" />\n                            </Button>\n                          </DropdownMenuTrigger>\n                          <DropdownMenuContent align=\"end\">\n                            <DropdownMenuItem onClick={() => handleEditClick(employee)} data-testid={`button-edit-${employee.id}`}>\n                              <Edit className=\"mr-2 h-4 w-4\" />\n                              Edit\n                            </DropdownMenuItem>\n                            <DropdownMenuItem onClick={() => handleResetPasswordClick(employee)} data-testid={`button-reset-password-${employee.id}`}>\n                              <Key className=\"mr-2 h-4 w-4\" />\n                              Reset Password\n                            </DropdownMenuItem>\n                            <DropdownMenuSeparator />\n                            <DropdownMenuItem onClick={() => handleToggleActive(employee)} data-testid={`button-toggle-status-${employee.id}`}>\n                              {employee.isActive !== false ? (\n                                <>\n                                  <ToggleLeft className=\"mr-2 h-4 w-4\" />\n                                  Deactivate\n                                </>\n                              ) : (\n                                <>\n                                  <ToggleRight className=\"mr-2 h-4 w-4\" />\n                                  Activate\n                                </>\n                              )}\n                            </DropdownMenuItem>\n                          </DropdownMenuContent>\n                        </DropdownMenu>\n                      </TableCell>\n                    </TableRow>\n                  );\n                })\n              )}\n            </TableBody>\n          </Table>\n        </CardContent>\n      </Card>\n\n      <Dialog open={isCreateOpen} onOpenChange={setIsCreateOpen}>\n        <DialogContent>\n          <DialogHeader>\n            <DialogTitle>Add New Employee</DialogTitle>\n            <DialogDescription>\n              Create a new employee account with a @miraeconnext.com email address.\n            </DialogDescription>\n          </DialogHeader>\n          <form onSubmit={handleCreateSubmit}>\n            <div className=\"grid gap-4 py-4\">\n              <div className=\"grid gap-2\">\n                <Label htmlFor=\"fullName\">Full Name</Label>\n                <Input\n                  id=\"fullName\"\n                  value={createForm.fullName}\n                  onChange={(e) => setCreateForm(prev => ({ ...prev, fullName: e.target.value }))}\n                  placeholder=\"John Doe\"\n                  required\n                  data-testid=\"input-fullname\"\n                />\n              </div>\n              <div className=\"grid gap-2\">\n                <Label htmlFor=\"localPart\">Email Username</Label>\n                <div className=\"flex items-center gap-2\">\n                  <Input\n                    id=\"localPart\"\n                    value={createForm.localPart}\n                    onChange={(e) => setCreateForm(prev => ({ ...prev, localPart: e.target.value.toLowerCase().replace(/[^a-z0-9.-]/g, '') }))}\n                    placeholder=\"john.doe\"\n                    required\n                    className=\"flex-1\"\n                    data-testid=\"input-localpart\"\n                  />\n                  <span className=\"text-muted-foreground\">@miraeconnext.com</span>\n                </div>\n                {createForm.localPart && (\n                  <p className=\"text-xs text-muted-foreground\">\n                    Email will be: {createForm.localPart}@miraeconnext.com\n                  </p>\n                )}\n              </div>\n              <div className=\"grid gap-2\">\n                <Label htmlFor=\"role\">Role</Label>\n                <Select\n                  value={createForm.role}\n                  onValueChange={(value: UserRole) => setCreateForm(prev => ({ ...prev, role: value }))}\n                >\n                  <SelectTrigger data-testid=\"select-role\">\n                    <SelectValue />\n                  </SelectTrigger>\n                  <SelectContent>\n                    {ROLES.map(role => (\n                      <SelectItem key={role.value} value={role.value}>\n                        <div className=\"flex items-center gap-2\">\n                          <role.icon className=\"h-4 w-4\" />\n                          {role.label}\n                        </div>\n                      </SelectItem>\n                    ))}\n                  </SelectContent>\n                </Select>\n              </div>\n              <div className=\"grid gap-2\">\n                <Label htmlFor=\"tempPassword\">Temporary Password</Label>\n                <Input\n                  id=\"tempPassword\"\n                  type=\"password\"\n                  value={createForm.tempPassword}\n                  onChange={(e) => setCreateForm(prev => ({ ...prev, tempPassword: e.target.value }))}\n                  placeholder=\"Enter temporary password\"\n                  required\n                  data-testid=\"input-password\"\n                />\n                <p className=\"text-xs text-muted-foreground\">\n                  Share this password securely with the employee. They should change it after first login.\n                </p>\n              </div>\n            </div>\n            <DialogFooter>\n              <Button type=\"button\" variant=\"outline\" onClick={() => setIsCreateOpen(false)}>\n                Cancel\n              </Button>\n              <Button type=\"submit\" disabled={createMutation.isPending} data-testid=\"button-submit-create\">\n                {createMutation.isPending ? \"Creating...\" : \"Create Employee\"}\n              </Button>\n            </DialogFooter>\n          </form>\n        </DialogContent>\n      </Dialog>\n\n      <Dialog open={isEditOpen} onOpenChange={setIsEditOpen}>\n        <DialogContent>\n          <DialogHeader>\n            <DialogTitle>Edit Employee</DialogTitle>\n            <DialogDescription>\n              Update employee information for {selectedEmployee?.fullName}\n            </DialogDescription>\n          </DialogHeader>\n          <form onSubmit={handleEditSubmit}>\n            <div className=\"grid gap-4 py-4\">\n              <div className=\"grid gap-2\">\n                <Label htmlFor=\"editFullName\">Full Name</Label>\n                <Input\n                  id=\"editFullName\"\n                  value={editForm.fullName}\n                  onChange={(e) => setEditForm(prev => ({ ...prev, fullName: e.target.value }))}\n                  required\n                  data-testid=\"input-edit-fullname\"\n                />\n              </div>\n              <div className=\"grid gap-2\">\n                <Label>Email</Label>\n                <Input\n                  value={selectedEmployee?.email ?? \"\"}\n                  disabled\n                  className=\"bg-muted\"\n                />\n                <p className=\"text-xs text-muted-foreground\">Email cannot be changed</p>\n              </div>\n              <div className=\"grid gap-2\">\n                <Label htmlFor=\"editRole\">Role</Label>\n                <Select\n                  value={editForm.role}\n                  onValueChange={(value: UserRole) => setEditForm(prev => ({ ...prev, role: value }))}\n                >\n                  <SelectTrigger data-testid=\"select-edit-role\">\n                    <SelectValue />\n                  </SelectTrigger>\n                  <SelectContent>\n                    {ROLES.map(role => (\n                      <SelectItem key={role.value} value={role.value}>\n                        <div className=\"flex items-center gap-2\">\n                          <role.icon className=\"h-4 w-4\" />\n                          {role.label}\n                        </div>\n                      </SelectItem>\n                    ))}\n                  </SelectContent>\n                </Select>\n              </div>\n            </div>\n            <DialogFooter>\n              <Button type=\"button\" variant=\"outline\" onClick={() => setIsEditOpen(false)}>\n                Cancel\n              </Button>\n              <Button type=\"submit\" disabled={updateMutation.isPending} data-testid=\"button-submit-edit\">\n                {updateMutation.isPending ? \"Saving...\" : \"Save Changes\"}\n              </Button>\n            </DialogFooter>\n          </form>\n        </DialogContent>\n      </Dialog>\n\n      <Dialog open={isResetPasswordOpen} onOpenChange={setIsResetPasswordOpen}>\n        <DialogContent>\n          <DialogHeader>\n            <DialogTitle>Reset Password</DialogTitle>\n            <DialogDescription>\n              Set a new temporary password for {selectedEmployee?.fullName}\n            </DialogDescription>\n          </DialogHeader>\n          <form onSubmit={handleResetPasswordSubmit}>\n            <div className=\"grid gap-4 py-4\">\n              <div className=\"grid gap-2\">\n                <Label htmlFor=\"newTempPassword\">New Temporary Password</Label>\n                <Input\n                  id=\"newTempPassword\"\n                  type=\"password\"\n                  value={resetPasswordForm.tempPassword}\n                  onChange={(e) => setResetPasswordForm({ tempPassword: e.target.value })}\n                  placeholder=\"Enter new temporary password\"\n                  required\n                  data-testid=\"input-new-password\"\n                />\n                <p className=\"text-xs text-muted-foreground\">\n                  Share this password securely with the employee.\n                </p>\n              </div>\n            </div>\n            <DialogFooter>\n              <Button type=\"button\" variant=\"outline\" onClick={() => setIsResetPasswordOpen(false)}>\n                Cancel\n              </Button>\n              <Button type=\"submit\" disabled={resetPasswordMutation.isPending} data-testid=\"button-submit-reset\">\n                {resetPasswordMutation.isPending ? \"Resetting...\" : \"Reset Password\"}\n              </Button>\n            </DialogFooter>\n          </form>\n        </DialogContent>\n      </Dialog>\n\n      <Sheet open={isDetailOpen} onOpenChange={(open) => {\n        setIsDetailOpen(open);\n        if (!open) setDetailEmployeeId(null);\n      }}>\n        <SheetContent className=\"w-full sm:max-w-xl overflow-y-auto\" data-testid=\"sheet-employee-detail\">\n          <SheetHeader>\n            <SheetTitle>Employee Details</SheetTitle>\n          </SheetHeader>\n          \n          {isOverviewLoading ? (\n            <div className=\"flex items-center justify-center py-12\">\n              <div className=\"h-8 w-8 animate-spin rounded-full border-2 border-primary border-t-transparent\" />\n            </div>\n          ) : employeeOverview ? (\n            <div className=\"space-y-6 py-4\">\n              <div className=\"flex items-center gap-4\">\n                <Avatar className=\"h-16 w-16\">\n                  <AvatarFallback className=\"text-lg\">\n                    {employeeOverview.employee.fullName.split(\" \").map(n => n[0]).join(\"\").toUpperCase()}\n                  </AvatarFallback>\n                </Avatar>\n                <div className=\"flex-1\">\n                  <h3 className=\"text-xl font-semibold\" data-testid=\"text-detail-name\">\n                    {employeeOverview.employee.fullName}\n                  </h3>\n                  <p className=\"text-sm text-muted-foreground\" data-testid=\"text-detail-email\">\n                    {employeeOverview.employee.email}\n                  </p>\n                  <div className=\"flex items-center gap-2 mt-2\">\n                    <Badge variant={getRoleVariant(employeeOverview.employee.role)} className=\"gap-1\">\n                      {(() => {\n                        const RoleIcon = getRoleIcon(employeeOverview.employee.role);\n                        return <RoleIcon className=\"h-3 w-3\" />;\n                      })()}\n                      {getRoleLabel(employeeOverview.employee.role)}\n                    </Badge>\n                    <Badge \n                      variant={employeeOverview.employee.status === \"active\" ? \"default\" : \"secondary\"}\n                      className={employeeOverview.employee.status === \"active\" ? \"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-100\" : \"\"}\n                    >\n                      {employeeOverview.employee.status === \"active\" ? \"Active\" : \"Inactive\"}\n                    </Badge>\n                  </div>\n                  {employeeOverview.employee.joinedAt && (\n                    <p className=\"text-xs text-muted-foreground mt-1\">\n                      Employee since {new Date(employeeOverview.employee.joinedAt).toLocaleDateString(\"en-US\", { month: \"long\", year: \"numeric\" })}\n                    </p>\n                  )}\n                </div>\n              </div>\n\n              <div>\n                <h4 className=\"font-medium mb-3\">\n                  Monthly Performance ({employeeOverview.kpi.period.month}/{employeeOverview.kpi.period.year})\n                </h4>\n                <div className=\"grid grid-cols-3 gap-3\">\n                  <Card>\n                    <CardHeader className=\"p-3 pb-1\">\n                      <CardTitle className=\"text-xs font-normal text-muted-foreground flex items-center gap-1\">\n                        <Clock className=\"h-3 w-3\" />\n                        Total CU\n                      </CardTitle>\n                    </CardHeader>\n                    <CardContent className=\"p-3 pt-0\">\n                      <div className=\"text-xl font-bold\" data-testid=\"text-detail-cu\">\n                        {employeeOverview.kpi.totalCU}\n                      </div>\n                    </CardContent>\n                  </Card>\n                  <Card>\n                    <CardHeader className=\"p-3 pb-1\">\n                      <CardTitle className=\"text-xs font-normal text-muted-foreground flex items-center gap-1\">\n                        <Phone className=\"h-3 w-3\" />\n                        Calls\n                      </CardTitle>\n                    </CardHeader>\n                    <CardContent className=\"p-3 pt-0\">\n                      <div className=\"text-xl font-bold\" data-testid=\"text-detail-calls\">\n                        {employeeOverview.kpi.completedCalls}\n                      </div>\n                    </CardContent>\n                  </Card>\n                  <Card>\n                    <CardHeader className=\"p-3 pb-1\">\n                      <CardTitle className=\"text-xs font-normal text-muted-foreground flex items-center gap-1\">\n                        <DollarSign className=\"h-3 w-3\" />\n                        Incentive\n                      </CardTitle>\n                    </CardHeader>\n                    <CardContent className=\"p-3 pt-0\">\n                      <div className=\"text-xl font-bold\" data-testid=\"text-detail-incentive\">\n                        {employeeOverview.employee.role === \"admin\" || employeeOverview.employee.role === \"finance\" \n                          ? \"N/A\" \n                          : `R$ ${employeeOverview.kpi.incentive.toLocaleString()}`}\n                      </div>\n                    </CardContent>\n                  </Card>\n                </div>\n              </div>\n\n              {employeeOverview.employee.role === \"pm\" && (\n              <div>\n                <h4 className=\"font-medium mb-3 flex items-center gap-2\">\n                  <Building className=\"h-4 w-4\" />\n                  Accounts ({employeeOverview.accounts.length})\n                </h4>\n                {employeeOverview.accounts.length === 0 ? (\n                  <div className=\"text-sm text-muted-foreground text-center py-6 border rounded-md\">\n                    No accounts with activity this month\n                  </div>\n                ) : (\n                  <div className=\"border rounded-md overflow-hidden\">\n                    <Table>\n                      <TableHeader>\n                        <TableRow>\n                          <TableHead>Client</TableHead>\n                          <TableHead className=\"text-right\">CU</TableHead>\n                          <TableHead className=\"text-right\">Calls</TableHead>\n                          <TableHead className=\"text-right\">Revenue</TableHead>\n                          <TableHead className=\"text-right\">Last Activity</TableHead>\n                        </TableRow>\n                      </TableHeader>\n                      <TableBody>\n                        {employeeOverview.accounts.map((account, index) => (\n                          <TableRow key={index} data-testid={`row-account-${index}`}>\n                            <TableCell className=\"font-medium\">\n                              {account.clientName}\n                            </TableCell>\n                            <TableCell className=\"text-right\">\n                              {account.totalCUThisMonth}\n                            </TableCell>\n                            <TableCell className=\"text-right\">\n                              {account.completedCallsThisMonth}\n                            </TableCell>\n                            <TableCell className=\"text-right\">\n                              ${account.revenueThisMonthUSD.toLocaleString()}\n                            </TableCell>\n                            <TableCell className=\"text-right text-muted-foreground text-sm\">\n                              {account.lastActivityAt \n                                ? new Date(account.lastActivityAt).toLocaleDateString() \n                                : \"-\"}\n                            </TableCell>\n                          </TableRow>\n                        ))}\n                      </TableBody>\n                    </Table>\n                  </div>\n                )}\n              </div>\n              )}\n            </div>\n          ) : (\n            <div className=\"text-center py-12 text-muted-foreground\">\n              Failed to load employee details\n            </div>\n          )}\n        </SheetContent>\n      </Sheet>\n    </div>\n  );\n}\n\nexport default function EmployeesPage() {\n  return (\n    <RoleGuard requiredPage=\"employees\">\n      <EmployeesContent />\n    </RoleGuard>\n  );\n}\n","path":null,"size_bytes":41396,"size_tokens":null},"client/src/components/ui/breadcrumb.tsx":{"content":"import * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { ChevronRight, MoreHorizontal } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Breadcrumb = React.forwardRef<\n  HTMLElement,\n  React.ComponentPropsWithoutRef<\"nav\"> & {\n    separator?: React.ReactNode\n  }\n>(({ ...props }, ref) => <nav ref={ref} aria-label=\"breadcrumb\" {...props} />)\nBreadcrumb.displayName = \"Breadcrumb\"\n\nconst BreadcrumbList = React.forwardRef<\n  HTMLOListElement,\n  React.ComponentPropsWithoutRef<\"ol\">\n>(({ className, ...props }, ref) => (\n  <ol\n    ref={ref}\n    className={cn(\n      \"flex flex-wrap items-center gap-1.5 break-words text-sm text-muted-foreground sm:gap-2.5\",\n      className\n    )}\n    {...props}\n  />\n))\nBreadcrumbList.displayName = \"BreadcrumbList\"\n\nconst BreadcrumbItem = React.forwardRef<\n  HTMLLIElement,\n  React.ComponentPropsWithoutRef<\"li\">\n>(({ className, ...props }, ref) => (\n  <li\n    ref={ref}\n    className={cn(\"inline-flex items-center gap-1.5\", className)}\n    {...props}\n  />\n))\nBreadcrumbItem.displayName = \"BreadcrumbItem\"\n\nconst BreadcrumbLink = React.forwardRef<\n  HTMLAnchorElement,\n  React.ComponentPropsWithoutRef<\"a\"> & {\n    asChild?: boolean\n  }\n>(({ asChild, className, ...props }, ref) => {\n  const Comp = asChild ? Slot : \"a\"\n\n  return (\n    <Comp\n      ref={ref}\n      className={cn(\"transition-colors hover:text-foreground\", className)}\n      {...props}\n    />\n  )\n})\nBreadcrumbLink.displayName = \"BreadcrumbLink\"\n\nconst BreadcrumbPage = React.forwardRef<\n  HTMLSpanElement,\n  React.ComponentPropsWithoutRef<\"span\">\n>(({ className, ...props }, ref) => (\n  <span\n    ref={ref}\n    role=\"link\"\n    aria-disabled=\"true\"\n    aria-current=\"page\"\n    className={cn(\"font-normal text-foreground\", className)}\n    {...props}\n  />\n))\nBreadcrumbPage.displayName = \"BreadcrumbPage\"\n\nconst BreadcrumbSeparator = ({\n  children,\n  className,\n  ...props\n}: React.ComponentProps<\"li\">) => (\n  <li\n    role=\"presentation\"\n    aria-hidden=\"true\"\n    className={cn(\"[&>svg]:w-3.5 [&>svg]:h-3.5\", className)}\n    {...props}\n  >\n    {children ?? <ChevronRight />}\n  </li>\n)\nBreadcrumbSeparator.displayName = \"BreadcrumbSeparator\"\n\nconst BreadcrumbEllipsis = ({\n  className,\n  ...props\n}: React.ComponentProps<\"span\">) => (\n  <span\n    role=\"presentation\"\n    aria-hidden=\"true\"\n    className={cn(\"flex h-9 w-9 items-center justify-center\", className)}\n    {...props}\n  >\n    <MoreHorizontal className=\"h-4 w-4\" />\n    <span className=\"sr-only\">More</span>\n  </span>\n)\nBreadcrumbEllipsis.displayName = \"BreadcrumbElipssis\"\n\nexport {\n  Breadcrumb,\n  BreadcrumbList,\n  BreadcrumbItem,\n  BreadcrumbLink,\n  BreadcrumbPage,\n  BreadcrumbSeparator,\n  BreadcrumbEllipsis,\n}\n","path":null,"size_bytes":2712,"size_tokens":null},"client/src/App.tsx":{"content":"import { Switch, Route } from \"wouter\";\nimport { queryClient } from \"./lib/queryClient\";\nimport { QueryClientProvider } from \"@tanstack/react-query\";\nimport { Toaster } from \"@/components/ui/toaster\";\nimport { TooltipProvider } from \"@/components/ui/tooltip\";\nimport { SidebarProvider, SidebarTrigger } from \"@/components/ui/sidebar\";\nimport { AppSidebar } from \"@/components/app-sidebar\";\nimport { ThemeToggle } from \"@/components/theme-toggle\";\nimport { AuthProvider, ProtectedRoute } from \"@/lib/auth\";\nimport Login from \"@/pages/login\";\nimport Dashboard from \"@/pages/dashboard\";\nimport Projects from \"@/pages/projects\";\nimport ProjectDetail from \"@/pages/project-detail\";\nimport Experts from \"@/pages/experts\";\nimport Clients from \"@/pages/clients\";\nimport InsightHub from \"@/pages/insight-hub\";\nimport Consultations from \"@/pages/consultations\";\nimport Usage from \"@/pages/usage\";\nimport Analytics from \"@/pages/analytics\";\nimport Employees from \"@/pages/employees\";\nimport ExpertRegister from \"@/pages/expert-register\";\nimport ExpertInvite from \"@/pages/expert-invite\";\nimport ExpertOnboarding from \"@/pages/expert-onboarding\";\nimport ExpertProjectInvite from \"@/pages/expert-project-invite\";\nimport QuickInviteOnboarding from \"@/pages/quick-invite-onboarding\";\nimport QuickInviteDecision from \"@/pages/quick-invite-decision\";\nimport ExpertProfile from \"@/pages/expert-profile\";\nimport Invites from \"@/pages/invites\";\nimport RaPerformance from \"@/pages/ra-performance\";\nimport ClientShortlist from \"@/pages/client-shortlist\";\nimport ChangePassword from \"@/pages/change-password\";\nimport NotFound from \"@/pages/not-found\";\n\nfunction MainLayout({ children }: { children: React.ReactNode }) {\n  const sidebarStyle = {\n    \"--sidebar-width\": \"16rem\",\n    \"--sidebar-width-icon\": \"3rem\",\n  };\n\n  return (\n    <ProtectedRoute>\n      <SidebarProvider style={sidebarStyle as React.CSSProperties}>\n        <div className=\"flex h-screen w-full\">\n          <AppSidebar />\n          <div className=\"flex flex-1 flex-col overflow-hidden\">\n            <header className=\"flex h-14 shrink-0 items-center justify-between gap-4 border-b border-border bg-background px-4\">\n              <SidebarTrigger data-testid=\"button-sidebar-toggle\" />\n              <ThemeToggle />\n            </header>\n            <main className=\"flex-1 overflow-auto bg-background\">\n              {children}\n            </main>\n          </div>\n        </div>\n      </SidebarProvider>\n    </ProtectedRoute>\n  );\n}\n\nfunction Router() {\n  return (\n    <Switch>\n      <Route path=\"/login\">\n        <Login />\n      </Route>\n      <Route path=\"/change-password\">\n        <ProtectedRoute allowChangePassword={true}>\n          <ChangePassword />\n        </ProtectedRoute>\n      </Route>\n      <Route path=\"/register/:token\">\n        {(params) => <ExpertRegister token={params.token} />}\n      </Route>\n      <Route path=\"/expert-invite/:token\">\n        {(params) => <ExpertInvite token={params.token} />}\n      </Route>\n      <Route path=\"/invite/:projectId/:inviteType/:token\">\n        {(params) => (\n          <ExpertOnboarding \n            projectId={params.projectId} \n            inviteType={params.inviteType} \n            token={params.token} \n          />\n        )}\n      </Route>\n      <Route path=\"/expert/project-invite/:token\">\n        {(params) => <ExpertProjectInvite />}\n      </Route>\n      <Route path=\"/invite/onboarding/:token\">\n        {(params) => <QuickInviteOnboarding />}\n      </Route>\n      <Route path=\"/invite/decide/:token\">\n        {(params) => <QuickInviteDecision />}\n      </Route>\n      <Route path=\"/\">\n        <MainLayout><Dashboard /></MainLayout>\n      </Route>\n      <Route path=\"/projects\">\n        <MainLayout><Projects /></MainLayout>\n      </Route>\n      <Route path=\"/projects/:id\">\n        <MainLayout><ProjectDetail /></MainLayout>\n      </Route>\n      <Route path=\"/projects/:projectId/client-shortlist\">\n        <MainLayout><ClientShortlist /></MainLayout>\n      </Route>\n      <Route path=\"/experts\">\n        <MainLayout><Experts /></MainLayout>\n      </Route>\n      <Route path=\"/expert-profile/:id\">\n        {(params) => <MainLayout><ExpertProfile /></MainLayout>}\n      </Route>\n      <Route path=\"/clients\">\n        <MainLayout><Clients /></MainLayout>\n      </Route>\n      <Route path=\"/insight-hub\">\n        <MainLayout><InsightHub /></MainLayout>\n      </Route>\n      <Route path=\"/consultations\">\n        <MainLayout><Consultations /></MainLayout>\n      </Route>\n      <Route path=\"/usage\">\n        <MainLayout><Usage /></MainLayout>\n      </Route>\n      <Route path=\"/analytics\">\n        <MainLayout><Analytics /></MainLayout>\n      </Route>\n      <Route path=\"/employees\">\n        <MainLayout><Employees /></MainLayout>\n      </Route>\n      <Route path=\"/invites\">\n        <MainLayout><Invites /></MainLayout>\n      </Route>\n      <Route path=\"/ra-performance\">\n        <MainLayout><RaPerformance /></MainLayout>\n      </Route>\n      <Route path=\"/ra-performance/:raId\">\n        <MainLayout><RaPerformance /></MainLayout>\n      </Route>\n      <Route>\n        <MainLayout><NotFound /></MainLayout>\n      </Route>\n    </Switch>\n  );\n}\n\nfunction App() {\n  return (\n    <QueryClientProvider client={queryClient}>\n      <TooltipProvider>\n        <AuthProvider>\n          <Router />\n          <Toaster />\n        </AuthProvider>\n      </TooltipProvider>\n    </QueryClientProvider>\n  );\n}\n\nexport default App;\n","path":null,"size_bytes":5422,"size_tokens":null},"client/src/components/ui/accordion.tsx":{"content":"import * as React from \"react\"\nimport * as AccordionPrimitive from \"@radix-ui/react-accordion\"\nimport { ChevronDown } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Accordion = AccordionPrimitive.Root\n\nconst AccordionItem = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Item>\n>(({ className, ...props }, ref) => (\n  <AccordionPrimitive.Item\n    ref={ref}\n    className={cn(\"border-b\", className)}\n    {...props}\n  />\n))\nAccordionItem.displayName = \"AccordionItem\"\n\nconst AccordionTrigger = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <AccordionPrimitive.Header className=\"flex\">\n    <AccordionPrimitive.Trigger\n      ref={ref}\n      className={cn(\n        \"flex flex-1 items-center justify-between py-4 font-medium transition-all hover:underline [&[data-state=open]>svg]:rotate-180\",\n        className\n      )}\n      {...props}\n    >\n      {children}\n      <ChevronDown className=\"h-4 w-4 shrink-0 transition-transform duration-200\" />\n    </AccordionPrimitive.Trigger>\n  </AccordionPrimitive.Header>\n))\nAccordionTrigger.displayName = AccordionPrimitive.Trigger.displayName\n\nconst AccordionContent = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <AccordionPrimitive.Content\n    ref={ref}\n    className=\"overflow-hidden text-sm transition-all data-[state=closed]:animate-accordion-up data-[state=open]:animate-accordion-down\"\n    {...props}\n  >\n    <div className={cn(\"pb-4 pt-0\", className)}>{children}</div>\n  </AccordionPrimitive.Content>\n))\n\nAccordionContent.displayName = AccordionPrimitive.Content.displayName\n\nexport { Accordion, AccordionItem, AccordionTrigger, AccordionContent }\n","path":null,"size_bytes":1977,"size_tokens":null},"client/src/components/ui/drawer.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport { Drawer as DrawerPrimitive } from \"vaul\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Drawer = ({\n  shouldScaleBackground = true,\n  ...props\n}: React.ComponentProps<typeof DrawerPrimitive.Root>) => (\n  <DrawerPrimitive.Root\n    shouldScaleBackground={shouldScaleBackground}\n    {...props}\n  />\n)\nDrawer.displayName = \"Drawer\"\n\nconst DrawerTrigger = DrawerPrimitive.Trigger\n\nconst DrawerPortal = DrawerPrimitive.Portal\n\nconst DrawerClose = DrawerPrimitive.Close\n\nconst DrawerOverlay = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Overlay\n    ref={ref}\n    className={cn(\"fixed inset-0 z-50 bg-black/80\", className)}\n    {...props}\n  />\n))\nDrawerOverlay.displayName = DrawerPrimitive.Overlay.displayName\n\nconst DrawerContent = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <DrawerPortal>\n    <DrawerOverlay />\n    <DrawerPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed inset-x-0 bottom-0 z-50 mt-24 flex h-auto flex-col rounded-t-[10px] border bg-background\",\n        className\n      )}\n      {...props}\n    >\n      <div className=\"mx-auto mt-4 h-2 w-[100px] rounded-full bg-muted\" />\n      {children}\n    </DrawerPrimitive.Content>\n  </DrawerPortal>\n))\nDrawerContent.displayName = \"DrawerContent\"\n\nconst DrawerHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\"grid gap-1.5 p-4 text-center sm:text-left\", className)}\n    {...props}\n  />\n)\nDrawerHeader.displayName = \"DrawerHeader\"\n\nconst DrawerFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\"mt-auto flex flex-col gap-2 p-4\", className)}\n    {...props}\n  />\n)\nDrawerFooter.displayName = \"DrawerFooter\"\n\nconst DrawerTitle = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Title\n    ref={ref}\n    className={cn(\n      \"text-lg font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nDrawerTitle.displayName = DrawerPrimitive.Title.displayName\n\nconst DrawerDescription = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nDrawerDescription.displayName = DrawerPrimitive.Description.displayName\n\nexport {\n  Drawer,\n  DrawerPortal,\n  DrawerOverlay,\n  DrawerTrigger,\n  DrawerClose,\n  DrawerContent,\n  DrawerHeader,\n  DrawerFooter,\n  DrawerTitle,\n  DrawerDescription,\n}\n","path":null,"size_bytes":3021,"size_tokens":null},"client/src/pages/project-detail.tsx":{"content":"import { useState, useMemo } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { useParams, useLocation, Link } from \"wouter\";\nimport { format, formatDistanceToNow } from \"date-fns\";\nimport {\n  ArrowLeft,\n  Users,\n  ClipboardList,\n  Search,\n  Mail,\n  MessageCircle,\n  Check,\n  X,\n  Clock,\n  UserPlus,\n  Send,\n  CheckCircle2,\n  XCircle,\n  HelpCircle,\n  Link2,\n  Copy,\n  Activity,\n  Building2,\n  Calendar,\n  DollarSign,\n  FileText,\n  UserCheck,\n  ExternalLink,\n  MoreHorizontal,\n  Eye,\n  ChevronDown,\n  ChevronRight,\n  Plus,\n  Trash2,\n  GripVertical,\n  Pencil,\n  Layers,\n  Download,\n  FileSearch,\n} from \"lucide-react\";\nimport { Card, CardContent, CardHeader, CardTitle, CardDescription } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Checkbox } from \"@/components/ui/checkbox\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport {\n  Table,\n  TableBody,\n  TableCell,\n  TableHead,\n  TableHeader,\n  TableRow,\n} from \"@/components/ui/table\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogDescription,\n  DialogFooter,\n  DialogHeader,\n  DialogTitle,\n} from \"@/components/ui/dialog\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport {\n  DropdownMenu,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuTrigger,\n} from \"@/components/ui/dropdown-menu\";\nimport { Separator } from \"@/components/ui/separator\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { queryClient, apiRequest } from \"@/lib/queryClient\";\nimport { StatusBadge } from \"@/components/status-badge\";\nimport { EmptyState } from \"@/components/empty-state\";\nimport { DataTableSkeleton } from \"@/components/data-table-skeleton\";\nimport { RegisterExpertForm } from \"@/components/experts/RegisterExpertForm\";\nimport { QuickInviteForm } from \"@/components/experts/QuickInviteForm\";\nimport type { Project, Expert, VettingQuestion, ProjectExpert, ProjectActivity, ProjectAngle } from \"@shared/schema\";\n\ninterface EnrichedExpert extends ProjectExpert {\n  expert?: Expert;\n  sourcedByRa?: { id: number; fullName: string } | null;\n}\n\ninterface ProjectDetailData extends Project {\n  createdByPm?: { id: number; fullName: string; email: string } | null;\n  assignedRas?: { id: number; fullName: string; email: string }[];\n  vettingQuestions?: VettingQuestion[];\n  internalExperts?: EnrichedExpert[];\n  raSourcedExperts?: EnrichedExpert[];\n  activities?: ProjectActivity[];\n  raInviteLinks?: any[];\n  angles?: ProjectAngle[];\n}\n\ninterface RAUser {\n  id: number;\n  fullName: string;\n  email: string;\n}\n\nexport default function ProjectDetail() {\n  const { id } = useParams<{ id: string }>();\n  const [, setLocation] = useLocation();\n  const { toast } = useToast();\n  const projectId = parseInt(id || \"0\");\n\n  const [selectedExperts, setSelectedExperts] = useState<Set<number>>(new Set());\n  const [selectedRaIds, setSelectedRaIds] = useState<number[]>([]);\n  const [isAssignRaModalOpen, setIsAssignRaModalOpen] = useState(false);\n  const [activityNote, setActivityNote] = useState(\"\");\n  const [copiedLink, setCopiedLink] = useState<string | null>(null);\n  const [isQuickInviteModalOpen, setIsQuickInviteModalOpen] = useState(false);\n  \n  // Angles & VQ state\n  const [expandedAngles, setExpandedAngles] = useState<Set<number>>(new Set());\n  const [isAngleModalOpen, setIsAngleModalOpen] = useState(false);\n  const [editingAngle, setEditingAngle] = useState<ProjectAngle | null>(null);\n  const [angleTitle, setAngleTitle] = useState(\"\");\n  const [angleDescription, setAngleDescription] = useState(\"\");\n  const [isVQModalOpen, setIsVQModalOpen] = useState(false);\n  const [editingVQ, setEditingVQ] = useState<VettingQuestion | null>(null);\n  const [vqAngleId, setVQAngleId] = useState<number | null>(null);\n  const [vqQuestion, setVQQuestion] = useState(\"\");\n  const [vqQuestionType, setVQQuestionType] = useState<\"screening\" | \"insight\" | \"general\">(\"insight\");\n  const [vqIsRequired, setVQIsRequired] = useState(false);\n  \n  // Internal Experts angle filter state\n  const [internalExpertsAngleFilter, setInternalExpertsAngleFilter] = useState<string>(\"all\");\n  \n  // Bulk invite modal state\n  const [isBulkInviteModalOpen, setIsBulkInviteModalOpen] = useState(false);\n  const [selectedInternalExpertIds, setSelectedInternalExpertIds] = useState<Set<number>>(new Set());\n  const [bulkInviteAngleIds, setBulkInviteAngleIds] = useState<number[]>([]);\n  \n  // Expert Search modal state\n  const [isExpertSearchModalOpen, setIsExpertSearchModalOpen] = useState(false);\n  const [searchQuery, setSearchQuery] = useState(\"\");\n  const [searchCurrentEmployer, setSearchCurrentEmployer] = useState(\"\");\n  const [searchPastEmployers, setSearchPastEmployers] = useState(\"\");\n  const [searchMinExp, setSearchMinExp] = useState(\"\");\n  const [searchMaxExp, setSearchMaxExp] = useState(\"\");\n  const [searchAvailableOnly, setSearchAvailableOnly] = useState(false);\n  const [searchCountry, setSearchCountry] = useState(\"\");\n  const [searchJobTitle, setSearchJobTitle] = useState(\"\");\n  const [searchIndustry, setSearchIndustry] = useState(\"\");\n  const [searchLanguage, setSearchLanguage] = useState(\"\");\n  const [searchMinHoursWorked, setSearchMinHoursWorked] = useState(\"\");\n  const [searchHasPriorProjects, setSearchHasPriorProjects] = useState(false);\n  const [searchMinAcceptanceRate, setSearchMinAcceptanceRate] = useState(\"\");\n  \n  // Register Expert modal state\n  const [isRegisterExpertModalOpen, setIsRegisterExpertModalOpen] = useState(false);\n  \n  // Shortlist export state\n  const [isExportingShortlist, setIsExportingShortlist] = useState(false);\n\n  const { data: projectDetail, isLoading: projectLoading, refetch: refetchProject } = useQuery<ProjectDetailData>({\n    queryKey: [\"/api/projects\", projectId, \"detail\"],\n    queryFn: async () => {\n      const res = await fetch(`/api/projects/${projectId}/detail`, {\n        headers: {\n          Authorization: `Bearer ${localStorage.getItem(\"authToken\")}`,\n        },\n      });\n      if (!res.ok) throw new Error(\"Failed to fetch project\");\n      return res.json();\n    },\n    enabled: !!projectId,\n  });\n\n  const { data: allRAs } = useQuery<RAUser[]>({\n    queryKey: [\"/api/users/ras\"],\n    queryFn: async () => {\n      console.log(\"[RA DEBUG] Frontend: Fetching RAs from /api/users/ras\");\n      const res = await fetch(\"/api/users/ras\", {\n        headers: {\n          Authorization: `Bearer ${localStorage.getItem(\"authToken\")}`,\n        },\n      });\n      if (!res.ok) {\n        console.error(\"[RA DEBUG] Frontend: Failed to fetch RAs, status:\", res.status);\n        throw new Error(\"Failed to fetch RAs\");\n      }\n      const data = await res.json();\n      console.log(\"[RA DEBUG] Frontend: RAs fetched for project\", projectId, \":\", data);\n      return data;\n    },\n  });\n\n  const { data: allExperts } = useQuery<Expert[]>({\n    queryKey: [\"/api/experts\"],\n    queryFn: async () => {\n      const res = await fetch(\"/api/experts\", {\n        headers: {\n          Authorization: `Bearer ${localStorage.getItem(\"authToken\")}`,\n        },\n      });\n      if (!res.ok) throw new Error(\"Failed to fetch experts\");\n      return res.json();\n    },\n  });\n\n  // Expert search results query with metrics\n  type ExpertWithMetrics = Expert & { priorProjectCount?: number; acceptanceRate?: number };\n  const { data: expertSearchResults, isLoading: expertSearchLoading } = useQuery<ExpertWithMetrics[]>({\n    queryKey: [\n      \"/api/experts/search\",\n      { \n        query: searchQuery, country: searchCountry, minExp: searchMinExp, maxExp: searchMaxExp, \n        jobTitle: searchJobTitle, industry: searchIndustry, language: searchLanguage,\n        hasPriorProjects: searchHasPriorProjects, currentEmployer: searchCurrentEmployer,\n        pastEmployers: searchPastEmployers, availableOnly: searchAvailableOnly,\n        minHoursWorked: searchMinHoursWorked, minAcceptanceRate: searchMinAcceptanceRate,\n        excludeProjectId: projectId\n      },\n    ],\n    queryFn: async () => {\n      const params = new URLSearchParams();\n      if (searchQuery) params.append(\"q\", searchQuery);\n      if (searchCurrentEmployer) params.append(\"currentEmployer\", searchCurrentEmployer);\n      if (searchPastEmployers) params.append(\"pastEmployers\", searchPastEmployers);\n      if (searchCountry) params.append(\"country\", searchCountry);\n      if (searchMinExp) params.append(\"minYearsExperience\", searchMinExp);\n      if (searchMaxExp) params.append(\"maxYearsExperience\", searchMaxExp);\n      if (searchJobTitle) params.append(\"jobTitle\", searchJobTitle);\n      if (searchIndustry) params.append(\"industry\", searchIndustry);\n      if (searchLanguage) params.append(\"language\", searchLanguage);\n      if (searchAvailableOnly) params.append(\"availableOnly\", \"true\");\n      if (searchMinHoursWorked) params.append(\"minHoursWorked\", searchMinHoursWorked);\n      if (searchMinAcceptanceRate) params.append(\"minAcceptanceRate\", searchMinAcceptanceRate);\n      if (searchHasPriorProjects) params.append(\"hasPriorProjects\", \"true\");\n      if (projectId) params.append(\"excludeProjectId\", String(projectId));\n      const res = await fetch(`/api/experts/search?${params}`, {\n        headers: {\n          Authorization: `Bearer ${localStorage.getItem(\"authToken\")}`,\n        },\n      });\n      if (!res.ok) return [];\n      return res.json();\n    },\n    enabled: isExpertSearchModalOpen,\n  });\n\n  const expertsToShow = allExperts;\n\n  const assignedExpertIds = new Set([\n    ...(projectDetail?.internalExperts?.map((pe) => pe.expertId) || []),\n    ...(projectDetail?.raSourcedExperts?.map((pe) => pe.expertId) || []),\n  ]);\n\n  const assignRasMutation = useMutation({\n    mutationFn: async (raIds: number[]) => {\n      const res = await apiRequest(\"POST\", `/api/projects/${projectId}/assign-ras`, { raIds });\n      return res.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/projects\", projectId, \"detail\"] });\n      setIsAssignRaModalOpen(false);\n      toast({ title: \"RAs assigned successfully\" });\n    },\n    onError: () => {\n      toast({ title: \"Failed to assign RAs\", variant: \"destructive\" });\n    },\n  });\n\n  const attachExpertsMutation = useMutation({\n    mutationFn: async (expertIds: number[]) => {\n      const res = await apiRequest(\"POST\", `/api/projects/${projectId}/experts/bulk`, { expertIds });\n      return res.json();\n    },\n    onSuccess: (data) => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/projects\", projectId, \"detail\"] });\n      setSelectedExperts(new Set());\n      toast({ title: data.message || \"Experts attached successfully\" });\n    },\n    onError: () => {\n      toast({ title: \"Failed to attach experts\", variant: \"destructive\" });\n    },\n  });\n\n  const generateInviteLinkMutation = useMutation({\n    mutationFn: async ({ expertId }: { expertId: number }) => {\n      const res = await apiRequest(\"POST\", `/api/projects/${projectId}/experts/${expertId}/invite-link`);\n      return res.json();\n    },\n    onSuccess: (data) => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/projects\", projectId, \"detail\"] });\n      const fullUrl = `${window.location.origin}${data.inviteUrl}`;\n      navigator.clipboard.writeText(fullUrl);\n      setCopiedLink(data.inviteUrl);\n      toast({ title: \"Invite link copied to clipboard\" });\n      setTimeout(() => setCopiedLink(null), 3000);\n    },\n    onError: () => {\n      toast({ title: \"Failed to generate invite link\", variant: \"destructive\" });\n    },\n  });\n\n  const addActivityMutation = useMutation({\n    mutationFn: async (description: string) => {\n      const res = await apiRequest(\"POST\", `/api/projects/${projectId}/activities`, {\n        activityType: \"note_added\",\n        description,\n      });\n      return res.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/projects\", projectId, \"detail\"] });\n      setActivityNote(\"\");\n      toast({ title: \"Note added\" });\n    },\n    onError: () => {\n      toast({ title: \"Failed to add note\", variant: \"destructive\" });\n    },\n  });\n\n  const removeExpertMutation = useMutation({\n    mutationFn: (assignmentId: number) => apiRequest(\"DELETE\", `/api/project-experts/${assignmentId}`),\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/projects\", projectId, \"detail\"] });\n      toast({ title: \"Expert removed from project\" });\n    },\n    onError: () => {\n      toast({ title: \"Failed to remove expert\", variant: \"destructive\" });\n    },\n  });\n\n  const bulkInviteMutation = useMutation({\n    mutationFn: async (data: { projectExpertIds: number[]; angleIds: number[]; channel?: string }) => {\n      console.log(\"[INVITES] Frontend: Starting bulk invitation request\");\n      try {\n        const res = await apiRequest(\"POST\", `/api/projects/${projectId}/invitations/bulk-send`, data);\n        console.log(\"[INVITES] Frontend: Response status:\", res.status);\n        const result = await res.json();\n        console.log(\"[INVITES] Bulk invite response\", res.status, result);\n        \n        // Check if we have a successful response with at least some invitations sent\n        if (res.ok && result?.summary?.sent > 0) {\n          console.log(\"[INVITES] Frontend: Success - at least one invitation sent\");\n          return result;\n        }\n        \n        // If status is OK but no invitations were sent, still treat as success\n        if (res.ok) {\n          console.log(\"[INVITES] Frontend: Status OK, returning response\");\n          return result;\n        }\n        \n        // If we got here, something went wrong\n        throw new Error(result?.error || \"Failed to send invitations\");\n      } catch (err) {\n        console.error(\"[INVITES] Frontend: Error in mutationFn:\", err);\n        throw err;\n      }\n    },\n    onSuccess: (data) => {\n      console.log(\"[INVITES] Frontend: onSuccess called with data:\", data);\n      queryClient.invalidateQueries({ queryKey: [\"/api/projects\", projectId, \"detail\"] });\n      setSelectedInternalExpertIds(new Set());\n      setBulkInviteAngleIds([]);\n      setIsBulkInviteModalOpen(false);\n      const sent = data?.summary?.sent || 0;\n      const failed = data?.summary?.failed || 0;\n      const total = data?.summary?.total || 0;\n      \n      // Always show success if at least one invitation was sent\n      if (sent > 0) {\n        console.log(\"[INVITES] Frontend: Showing success toast - sent:\", sent, \"failed:\", failed);\n        toast({ \n          title: `Invitations sent: ${sent}${failed > 0 ? ` (${failed} failed)` : ''}`,\n          variant: \"default\"\n        });\n      } else if (total > 0) {\n        console.log(\"[INVITES] Frontend: All invitations failed\");\n        toast({ \n          title: \"Failed to send all invitations\",\n          variant: \"destructive\"\n        });\n      } else {\n        console.log(\"[INVITES] Frontend: No invitations to send\");\n        toast({ title: \"No invitations sent\", variant: \"default\" });\n      }\n    },\n    onError: (error) => {\n      console.error(\"[INVITES] Frontend: onError called with error:\", error);\n      toast({ title: \"Failed to send invitations\", variant: \"destructive\" });\n    },\n  });\n\n  const attachExpertMutation = useMutation({\n    mutationFn: async (expertId: number) => {\n      const res = await apiRequest(\"POST\", `/api/projects/${projectId}/experts/bulk`, {\n        expertIds: [expertId],\n      });\n      return res.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/projects\", projectId, \"detail\"] });\n      toast({ title: \"Expert attached to project\" });\n    },\n    onError: () => {\n      toast({ title: \"Failed to attach expert\", variant: \"destructive\" });\n    },\n  });\n\n  // Angles mutations\n  const createAngleMutation = useMutation({\n    mutationFn: async (data: { title: string; description?: string }) => {\n      const res = await apiRequest(\"POST\", `/api/projects/${projectId}/angles`, {\n        ...data,\n        orderIndex: (projectDetail?.angles?.length || 0),\n      });\n      return res.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/projects\", projectId, \"detail\"] });\n      setIsAngleModalOpen(false);\n      setAngleTitle(\"\");\n      setAngleDescription(\"\");\n      toast({ title: \"Angle created successfully\" });\n    },\n    onError: () => {\n      toast({ title: \"Failed to create angle\", variant: \"destructive\" });\n    },\n  });\n\n  const updateAngleMutation = useMutation({\n    mutationFn: async ({ id, data }: { id: number; data: { title?: string; description?: string } }) => {\n      const res = await apiRequest(\"PATCH\", `/api/angles/${id}`, data);\n      return res.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/projects\", projectId, \"detail\"] });\n      setIsAngleModalOpen(false);\n      setEditingAngle(null);\n      setAngleTitle(\"\");\n      setAngleDescription(\"\");\n      toast({ title: \"Angle updated successfully\" });\n    },\n    onError: () => {\n      toast({ title: \"Failed to update angle\", variant: \"destructive\" });\n    },\n  });\n\n  const deleteAngleMutation = useMutation({\n    mutationFn: (id: number) => apiRequest(\"DELETE\", `/api/angles/${id}`),\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/projects\", projectId, \"detail\"] });\n      toast({ title: \"Angle deleted successfully\" });\n    },\n    onError: () => {\n      toast({ title: \"Failed to delete angle\", variant: \"destructive\" });\n    },\n  });\n\n  // Vetting Questions mutations\n  const createVQMutation = useMutation({\n    mutationFn: async (data: { question: string; angleId: number | null; questionType: string; isRequired: boolean }) => {\n      const existingVQs = projectDetail?.vettingQuestions?.filter(vq => vq.angleId === data.angleId) || [];\n      const res = await apiRequest(\"POST\", `/api/vetting-questions`, {\n        ...data,\n        projectId,\n        orderIndex: existingVQs.length,\n      });\n      return res.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/projects\", projectId, \"detail\"] });\n      setIsVQModalOpen(false);\n      setVQQuestion(\"\");\n      setVQAngleId(null);\n      setVQQuestionType(\"insight\");\n      setVQIsRequired(false);\n      toast({ title: \"Vetting question created successfully\" });\n    },\n    onError: () => {\n      toast({ title: \"Failed to create vetting question\", variant: \"destructive\" });\n    },\n  });\n\n  const updateVQMutation = useMutation({\n    mutationFn: async ({ id, data }: { id: number; data: Partial<VettingQuestion> }) => {\n      const res = await apiRequest(\"PATCH\", `/api/vetting-questions/${id}`, data);\n      return res.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/projects\", projectId, \"detail\"] });\n      setIsVQModalOpen(false);\n      setEditingVQ(null);\n      setVQQuestion(\"\");\n      setVQAngleId(null);\n      setVQQuestionType(\"insight\");\n      setVQIsRequired(false);\n      toast({ title: \"Vetting question updated successfully\" });\n    },\n    onError: () => {\n      toast({ title: \"Failed to update vetting question\", variant: \"destructive\" });\n    },\n  });\n\n  const deleteVQMutation = useMutation({\n    mutationFn: (id: number) => apiRequest(\"DELETE\", `/api/vetting-questions/${id}`),\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/projects\", projectId, \"detail\"] });\n      toast({ title: \"Vetting question deleted successfully\" });\n    },\n    onError: () => {\n      toast({ title: \"Failed to delete vetting question\", variant: \"destructive\" });\n    },\n  });\n\n  // Helper functions for Angles\n  const toggleAngleExpanded = (angleId: number) => {\n    const newExpanded = new Set(expandedAngles);\n    if (newExpanded.has(angleId)) {\n      newExpanded.delete(angleId);\n    } else {\n      newExpanded.add(angleId);\n    }\n    setExpandedAngles(newExpanded);\n  };\n\n  const openAddAngleModal = () => {\n    setEditingAngle(null);\n    setAngleTitle(\"\");\n    setAngleDescription(\"\");\n    setIsAngleModalOpen(true);\n  };\n\n  const openEditAngleModal = (angle: ProjectAngle) => {\n    setEditingAngle(angle);\n    setAngleTitle(angle.title);\n    setAngleDescription(angle.description || \"\");\n    setIsAngleModalOpen(true);\n  };\n\n  const handleSaveAngle = () => {\n    if (!angleTitle.trim()) return;\n    if (editingAngle) {\n      updateAngleMutation.mutate({ \n        id: editingAngle.id, \n        data: { title: angleTitle, description: angleDescription || undefined } \n      });\n    } else {\n      createAngleMutation.mutate({ \n        title: angleTitle, \n        description: angleDescription || undefined \n      });\n    }\n  };\n\n  const openAddVQModal = (angleId: number | null) => {\n    setEditingVQ(null);\n    setVQAngleId(angleId);\n    setVQQuestion(\"\");\n    setVQQuestionType(\"insight\");\n    setVQIsRequired(false);\n    setIsVQModalOpen(true);\n  };\n\n  const openEditVQModal = (vq: VettingQuestion) => {\n    setEditingVQ(vq);\n    setVQAngleId(vq.angleId || null);\n    setVQQuestion(vq.question);\n    setVQQuestionType((vq.questionType as \"screening\" | \"insight\" | \"general\") || \"insight\");\n    setVQIsRequired(vq.isRequired || false);\n    setIsVQModalOpen(true);\n  };\n\n  const handleSaveVQ = () => {\n    if (!vqQuestion.trim()) return;\n    if (editingVQ) {\n      updateVQMutation.mutate({\n        id: editingVQ.id,\n        data: { \n          question: vqQuestion, \n          angleId: vqAngleId, \n          questionType: vqQuestionType,\n          isRequired: vqIsRequired \n        },\n      });\n    } else {\n      createVQMutation.mutate({\n        question: vqQuestion,\n        angleId: vqAngleId,\n        questionType: vqQuestionType,\n        isRequired: vqIsRequired,\n      });\n    }\n  };\n\n  const getVQsForAngle = (angleId: number | null) => {\n    return (projectDetail?.vettingQuestions || [])\n      .filter(vq => vq.angleId === angleId)\n      .sort((a, b) => a.orderIndex - b.orderIndex);\n  };\n\n  // Get angle names for display based on expert's angleIds\n  const getAngleBadges = (pe: EnrichedExpert) => {\n    if (!pe.angleIds || pe.angleIds.length === 0) return null;\n    const angleNames = pe.angleIds\n      .map(id => projectDetail?.angles?.find(a => a.id === id)?.title)\n      .filter(Boolean);\n    return angleNames;\n  };\n\n  // Filter internal experts by angle\n  const filteredInternalExperts = useMemo(() => {\n    const experts = projectDetail?.internalExperts || [];\n    if (internalExpertsAngleFilter === \"all\") return experts;\n    if (internalExpertsAngleFilter === \"none\") {\n      return experts.filter(pe => !pe.angleIds || pe.angleIds.length === 0);\n    }\n    const angleId = parseInt(internalExpertsAngleFilter);\n    return experts.filter(pe => pe.angleIds?.includes(angleId));\n  }, [projectDetail?.internalExperts, internalExpertsAngleFilter]);\n\n  const handleSelectExpert = (expertId: number, checked: boolean) => {\n    const newSelected = new Set(selectedExperts);\n    if (checked) {\n      newSelected.add(expertId);\n    } else {\n      newSelected.delete(expertId);\n    }\n    setSelectedExperts(newSelected);\n  };\n\n  const handleAttachExperts = () => {\n    if (selectedExperts.size === 0) return;\n    attachExpertsMutation.mutate(Array.from(selectedExperts));\n  };\n\n  // =====================================================\n  // SHORTLIST EXPORT HANDLER\n  // Button location: Internal Experts Pipeline section header (next to \"Search & Add\")\n  // Exports experts with pipelineStatus = \"interested\" as CSV\n  // =====================================================\n  const handleExportShortlist = async () => {\n    // Check if there are any experts with \"interested\" pipeline status\n    const shortlistedExperts = (projectDetail?.internalExperts || [])\n      .filter(pe => pe.pipelineStatus === \"interested\");\n    \n    if (shortlistedExperts.length === 0) {\n      toast({\n        title: \"No shortlisted experts to export yet.\",\n        description: \"Experts must have 'Interested' pipeline status to be included.\",\n        variant: \"default\",\n      });\n      return;\n    }\n\n    setIsExportingShortlist(true);\n    try {\n      const response = await fetch(`/api/projects/${projectId}/export-shortlist`, {\n        headers: {\n          Authorization: `Bearer ${localStorage.getItem(\"authToken\")}`,\n        },\n      });\n\n      if (!response.ok) {\n        const errorData = await response.json().catch(() => ({}));\n        throw new Error(errorData.error || \"Failed to export shortlist\");\n      }\n\n      // Get the CSV content as a blob\n      const blob = await response.blob();\n      const url = window.URL.createObjectURL(blob);\n      const a = document.createElement(\"a\");\n      a.href = url;\n      a.download = `shortlist_project_${projectId}.csv`;\n      document.body.appendChild(a);\n      a.click();\n      document.body.removeChild(a);\n      window.URL.revokeObjectURL(url);\n\n      toast({\n        title: \"Shortlist exported successfully\",\n        description: `${shortlistedExperts.length} expert(s) exported to CSV.`,\n      });\n    } catch (error) {\n      toast({\n        title: \"Export failed\",\n        description: error instanceof Error ? error.message : \"Failed to export shortlist\",\n        variant: \"destructive\",\n      });\n    } finally {\n      setIsExportingShortlist(false);\n    }\n  };\n\n  const getInvitationStatusIcon = (status?: string) => {\n    switch (status) {\n      case \"accepted\":\n        return <CheckCircle2 className=\"h-4 w-4 text-green-500\" />;\n      case \"declined\":\n        return <XCircle className=\"h-4 w-4 text-red-500\" />;\n      case \"opened\":\n        return <Eye className=\"h-4 w-4 text-blue-500\" />;\n      case \"invited\":\n        return <Clock className=\"h-4 w-4 text-yellow-500\" />;\n      default:\n        return <HelpCircle className=\"h-4 w-4 text-muted-foreground\" />;\n    }\n  };\n\n  const getInvitationStatusBadge = (status?: string) => {\n    switch (status) {\n      case \"accepted\":\n        return <Badge className=\"bg-green-500/10 text-green-600 border-green-500/20\">Accepted</Badge>;\n      case \"declined\":\n        return <Badge className=\"bg-red-500/10 text-red-600 border-red-500/20\">Declined</Badge>;\n      case \"opened\":\n        return <Badge className=\"bg-blue-500/10 text-blue-600 border-blue-500/20\">Opened</Badge>;\n      case \"invited\":\n        return <Badge className=\"bg-yellow-500/10 text-yellow-600 border-yellow-500/20\">Invited</Badge>;\n      default:\n        return <Badge variant=\"secondary\">Not Invited</Badge>;\n    }\n  };\n\n  const getPipelineStatusBadge = (status?: string) => {\n    switch (status) {\n      case \"interested\":\n        return <Badge className=\"bg-purple-500/10 text-purple-600 border-purple-500/20\">Interested</Badge>;\n      case \"shortlisted\":\n        return <Badge className=\"bg-blue-500/10 text-blue-600 border-blue-500/20\">Shortlisted</Badge>;\n      case \"accepted\":\n        return <Badge className=\"bg-green-500/10 text-green-600 border-green-500/20\">Accepted</Badge>;\n      case \"declined\":\n        return <Badge className=\"bg-red-500/10 text-red-600 border-red-500/20\">Declined</Badge>;\n      case \"completed\":\n        return <Badge className=\"bg-emerald-500/10 text-emerald-600 border-emerald-500/20\">Completed</Badge>;\n      default:\n        return <Badge variant=\"secondary\">-</Badge>;\n    }\n  };\n\n  const getActivityIcon = (type: string) => {\n    switch (type) {\n      case \"expert_invited\":\n        return <Send className=\"h-4 w-4 text-blue-500\" />;\n      case \"expert_opened\":\n        return <Eye className=\"h-4 w-4 text-purple-500\" />;\n      case \"expert_accepted\":\n        return <CheckCircle2 className=\"h-4 w-4 text-green-500\" />;\n      case \"expert_declined\":\n        return <XCircle className=\"h-4 w-4 text-red-500\" />;\n      case \"ra_assigned\":\n        return <UserCheck className=\"h-4 w-4 text-orange-500\" />;\n      case \"note_added\":\n        return <FileText className=\"h-4 w-4 text-muted-foreground\" />;\n      case \"project_created\":\n        return <Calendar className=\"h-4 w-4 text-blue-500\" />;\n      default:\n        return <Activity className=\"h-4 w-4 text-muted-foreground\" />;\n    }\n  };\n\n  if (projectLoading) {\n    return (\n      <div className=\"p-8\">\n        <DataTableSkeleton columns={4} rows={3} />\n      </div>\n    );\n  }\n\n  if (!projectDetail) {\n    return (\n      <div className=\"p-8\">\n        <EmptyState\n          icon={ClipboardList}\n          title=\"Project not found\"\n          description=\"The project you're looking for doesn't exist.\"\n          action={\n            <Button onClick={() => setLocation(\"/projects\")}>\n              <ArrowLeft className=\"h-4 w-4 mr-2\" /> Back to Projects\n            </Button>\n          }\n        />\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"space-y-6 p-8\">\n      <div className=\"flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between\">\n        <div className=\"flex items-center gap-4\">\n          <Button\n            variant=\"ghost\"\n            size=\"icon\"\n            onClick={() => setLocation(\"/projects\")}\n            data-testid=\"button-back\"\n          >\n            <ArrowLeft className=\"h-4 w-4\" />\n          </Button>\n          <div>\n            <h1 className=\"text-2xl font-semibold text-foreground\">{projectDetail.name}</h1>\n            <div className=\"flex items-center gap-2 mt-1 flex-wrap\">\n              <StatusBadge status={projectDetail.status} type=\"project\" />\n              <span className=\"text-sm text-muted-foreground\">{projectDetail.clientName}</span>\n              <span className=\"text-sm text-muted-foreground\"></span>\n              <span className=\"text-sm text-muted-foreground\">{projectDetail.industry}</span>\n              {projectDetail.createdByPm && (\n                <>\n                  <span className=\"text-sm text-muted-foreground\"></span>\n                  <span className=\"text-sm text-muted-foreground\">PM: {projectDetail.createdByPm.fullName}</span>\n                </>\n              )}\n            </div>\n          </div>\n        </div>\n      </div>\n\n      <Tabs defaultValue=\"overview\" className=\"space-y-4\">\n        <TabsList className=\"flex-wrap\">\n          <TabsTrigger value=\"overview\" data-testid=\"tab-overview\">Overview</TabsTrigger>\n          <TabsTrigger value=\"angles-vq\" data-testid=\"tab-angles-vq\">\n            Angles & VQ {projectDetail.angles?.length ? `(${projectDetail.angles.length})` : \"\"}\n          </TabsTrigger>\n          <TabsTrigger value=\"existing-experts\" data-testid=\"tab-existing-experts\">\n            Existing Experts {projectDetail.internalExperts?.length ? `(${projectDetail.internalExperts.length})` : \"\"}\n          </TabsTrigger>\n          <TabsTrigger value=\"ra-sourcing\" data-testid=\"tab-ra-sourcing\">\n            RA Sourcing {projectDetail.raSourcedExperts?.length ? `(${projectDetail.raSourcedExperts.length})` : \"\"}\n          </TabsTrigger>\n          <TabsTrigger value=\"activity\" data-testid=\"tab-activity\">\n            Activity {projectDetail.activities?.length ? `(${projectDetail.activities.length})` : \"\"}\n          </TabsTrigger>\n        </TabsList>\n\n        <TabsContent value=\"overview\" className=\"space-y-4\">\n          <div className=\"grid gap-4 md:grid-cols-2\">\n            <Card>\n              <CardHeader>\n                <CardTitle className=\"text-base flex items-center gap-2\">\n                  <Building2 className=\"h-4 w-4\" />\n                  Client Details\n                </CardTitle>\n              </CardHeader>\n              <CardContent className=\"space-y-4\">\n                <div className=\"grid grid-cols-2 gap-4\">\n                  <div>\n                    <p className=\"text-sm text-muted-foreground\">Client</p>\n                    <p className=\"font-medium\">{projectDetail.clientName}</p>\n                  </div>\n                  <div>\n                    <p className=\"text-sm text-muted-foreground\">Industry</p>\n                    <p className=\"font-medium\">{projectDetail.industry}</p>\n                  </div>\n                  {projectDetail.clientCompany && (\n                    <div>\n                      <p className=\"text-sm text-muted-foreground\">Company</p>\n                      <p className=\"font-medium\">{projectDetail.clientCompany}</p>\n                    </div>\n                  )}\n                  {projectDetail.region && (\n                    <div>\n                      <p className=\"text-sm text-muted-foreground\">Region</p>\n                      <p className=\"font-medium\">{projectDetail.region}</p>\n                    </div>\n                  )}\n                  {projectDetail.clientPocName && (\n                    <div>\n                      <p className=\"text-sm text-muted-foreground\">POC Name</p>\n                      <p className=\"font-medium\">{projectDetail.clientPocName}</p>\n                    </div>\n                  )}\n                  {projectDetail.clientPocEmail && (\n                    <div>\n                      <p className=\"text-sm text-muted-foreground\">POC Email</p>\n                      <p className=\"font-medium text-sm\">{projectDetail.clientPocEmail}</p>\n                    </div>\n                  )}\n                </div>\n              </CardContent>\n            </Card>\n\n            <Card>\n              <CardHeader>\n                <CardTitle className=\"text-base flex items-center gap-2\">\n                  <Calendar className=\"h-4 w-4\" />\n                  Timeline & Metrics\n                </CardTitle>\n              </CardHeader>\n              <CardContent className=\"space-y-4\">\n                <div className=\"grid grid-cols-2 gap-4\">\n                  <div>\n                    <p className=\"text-sm text-muted-foreground\">Start Date</p>\n                    <p className=\"font-medium\">\n                      {projectDetail.startDate\n                        ? format(new Date(projectDetail.startDate), \"MMM dd, yyyy\")\n                        : \"Not set\"}\n                    </p>\n                  </div>\n                  <div>\n                    <p className=\"text-sm text-muted-foreground\">Due Date</p>\n                    <p className=\"font-medium\">\n                      {projectDetail.dueDate\n                        ? format(new Date(projectDetail.dueDate), \"MMM dd, yyyy\")\n                        : \"Not set\"}\n                    </p>\n                  </div>\n                  <div>\n                    <p className=\"text-sm text-muted-foreground\">CU Used</p>\n                    <p className=\"font-mono font-medium\">{parseFloat(projectDetail.totalCuUsed || \"0\").toFixed(1)}</p>\n                  </div>\n                  <div>\n                    <p className=\"text-sm text-muted-foreground\">Rate per CU</p>\n                    <p className=\"font-mono font-medium\">${parseFloat(projectDetail.cuRatePerCU || \"1150\").toFixed(0)}</p>\n                  </div>\n                  <div>\n                    <p className=\"text-sm text-muted-foreground\">Created</p>\n                    <p className=\"font-mono text-sm\">{format(new Date(projectDetail.createdAt), \"MMM dd, yyyy\")}</p>\n                  </div>\n                  {projectDetail.updatedAt && (\n                    <div>\n                      <p className=\"text-sm text-muted-foreground\">Updated</p>\n                      <p className=\"font-mono text-sm\">{format(new Date(projectDetail.updatedAt), \"MMM dd, yyyy\")}</p>\n                    </div>\n                  )}\n                </div>\n              </CardContent>\n            </Card>\n          </div>\n\n          {projectDetail.projectOverview && (\n            <Card>\n              <CardHeader>\n                <CardTitle className=\"text-base\">Project Overview</CardTitle>\n              </CardHeader>\n              <CardContent>\n                <p className=\"text-sm whitespace-pre-wrap\">{projectDetail.projectOverview}</p>\n              </CardContent>\n            </Card>\n          )}\n\n          {projectDetail.clientRequestNotes && (\n            <Card className=\"border-amber-500/20 bg-amber-500/5\">\n              <CardHeader>\n                <CardTitle className=\"text-base flex items-center gap-2\">\n                  <FileText className=\"h-4 w-4 text-amber-500\" />\n                  Client Request Notes\n                </CardTitle>\n              </CardHeader>\n              <CardContent>\n                <p className=\"text-sm whitespace-pre-wrap\">{projectDetail.clientRequestNotes}</p>\n              </CardContent>\n            </Card>\n          )}\n\n          {projectDetail.description && (\n            <Card>\n              <CardHeader>\n                <CardTitle className=\"text-base\">Detailed Description</CardTitle>\n              </CardHeader>\n              <CardContent>\n                <p className=\"text-sm whitespace-pre-wrap\">{projectDetail.description}</p>\n              </CardContent>\n            </Card>\n          )}\n\n          {projectDetail.vettingQuestions && projectDetail.vettingQuestions.length > 0 && (\n            <Card>\n              <CardHeader>\n                <CardTitle className=\"text-base flex items-center gap-2\">\n                  <ClipboardList className=\"h-4 w-4\" />\n                  Vetting Questions (Insight Hub)\n                </CardTitle>\n              </CardHeader>\n              <CardContent>\n                <div className=\"space-y-3\">\n                  {projectDetail.vettingQuestions\n                    .sort((a, b) => a.orderIndex - b.orderIndex)\n                    .map((q, index) => (\n                      <div key={q.id} className=\"flex gap-3 p-3 rounded-lg bg-muted/50\">\n                        <span className=\"font-mono text-sm text-muted-foreground w-6 flex-shrink-0\">\n                          {index + 1}.\n                        </span>\n                        <div className=\"flex-1\">\n                          <p className=\"text-sm\">{q.question}</p>\n                          {q.isRequired && (\n                            <Badge variant=\"secondary\" className=\"mt-1 text-xs\">Required</Badge>\n                          )}\n                        </div>\n                      </div>\n                    ))}\n                </div>\n              </CardContent>\n            </Card>\n          )}\n\n          <Card>\n            <CardHeader>\n              <CardTitle className=\"text-base flex items-center gap-2\">\n                <UserCheck className=\"h-4 w-4\" />\n                Assigned RAs\n              </CardTitle>\n              <CardDescription>Research Associates assigned to source experts for this project</CardDescription>\n            </CardHeader>\n            <CardContent>\n              <div className=\"flex flex-wrap gap-2 mb-4\">\n                {projectDetail.assignedRas && projectDetail.assignedRas.length > 0 ? (\n                  projectDetail.assignedRas.map((ra) => (\n                    <Badge key={ra.id} variant=\"outline\" className=\"gap-1\">\n                      <UserCheck className=\"h-3 w-3\" />\n                      {ra.fullName}\n                    </Badge>\n                  ))\n                ) : (\n                  <p className=\"text-sm text-muted-foreground\">No RAs assigned yet</p>\n                )}\n              </div>\n              <Button\n                variant=\"outline\"\n                size=\"sm\"\n                onClick={() => {\n                  setSelectedRaIds(projectDetail.assignedRas?.map(r => r.id) || []);\n                  setIsAssignRaModalOpen(true);\n                }}\n                data-testid=\"button-assign-ras\"\n              >\n                <UserPlus className=\"h-4 w-4 mr-2\" />\n                Manage RA Assignments\n              </Button>\n            </CardContent>\n          </Card>\n        </TabsContent>\n\n        {/* Angles & VQ Tab */}\n        <TabsContent value=\"angles-vq\" className=\"space-y-4\">\n          <Card>\n            <CardHeader>\n              <div className=\"flex items-center justify-between gap-4 flex-wrap\">\n                <div>\n                  <CardTitle className=\"text-base flex items-center gap-2\">\n                    <Layers className=\"h-4 w-4\" />\n                    Expert Angles\n                  </CardTitle>\n                  <CardDescription>\n                    Define angles (expert profiles) and their vetting questions\n                  </CardDescription>\n                </div>\n                <Button size=\"sm\" onClick={openAddAngleModal} data-testid=\"button-add-angle\">\n                  <Plus className=\"h-4 w-4 mr-2\" />\n                  Add Angle\n                </Button>\n              </div>\n            </CardHeader>\n            <CardContent>\n              {(!projectDetail.angles || projectDetail.angles.length === 0) ? (\n                <EmptyState\n                  icon={Layers}\n                  title=\"No angles defined\"\n                  description=\"Create angles to organize experts by profile type and define specific vetting questions for each\"\n                  action={\n                    <Button size=\"sm\" onClick={openAddAngleModal} data-testid=\"button-add-angle-empty\">\n                      <Plus className=\"h-4 w-4 mr-2\" />\n                      Add First Angle\n                    </Button>\n                  }\n                />\n              ) : (\n                <div className=\"space-y-4\">\n                  {projectDetail.angles\n                    .sort((a, b) => a.orderIndex - b.orderIndex)\n                    .map((angle) => {\n                      const isExpanded = expandedAngles.has(angle.id);\n                      const vqs = getVQsForAngle(angle.id);\n                      return (\n                        <div key={angle.id} className=\"border rounded-lg\">\n                          <div\n                            className=\"flex items-center justify-between p-4 cursor-pointer hover-elevate\"\n                            onClick={() => toggleAngleExpanded(angle.id)}\n                            data-testid={`angle-header-${angle.id}`}\n                          >\n                            <div className=\"flex items-center gap-3\">\n                              {isExpanded ? (\n                                <ChevronDown className=\"h-4 w-4 text-muted-foreground\" />\n                              ) : (\n                                <ChevronRight className=\"h-4 w-4 text-muted-foreground\" />\n                              )}\n                              <div>\n                                <h3 className=\"font-medium\">{angle.title}</h3>\n                                {angle.description && (\n                                  <p className=\"text-sm text-muted-foreground\">{angle.description}</p>\n                                )}\n                              </div>\n                              <Badge variant=\"secondary\" className=\"ml-2\">\n                                {vqs.length} question{vqs.length !== 1 ? \"s\" : \"\"}\n                              </Badge>\n                            </div>\n                            <div className=\"flex items-center gap-2\" onClick={(e) => e.stopPropagation()}>\n                              <Button\n                                variant=\"ghost\"\n                                size=\"icon\"\n                                onClick={() => openEditAngleModal(angle)}\n                                data-testid={`button-edit-angle-${angle.id}`}\n                              >\n                                <Pencil className=\"h-4 w-4\" />\n                              </Button>\n                              <Button\n                                variant=\"ghost\"\n                                size=\"icon\"\n                                onClick={() => {\n                                  if (confirm(`Delete angle \"${angle.title}\" and all its vetting questions?`)) {\n                                    deleteAngleMutation.mutate(angle.id);\n                                  }\n                                }}\n                                data-testid={`button-delete-angle-${angle.id}`}\n                              >\n                                <Trash2 className=\"h-4 w-4 text-destructive\" />\n                              </Button>\n                            </div>\n                          </div>\n                          {isExpanded && (\n                            <div className=\"border-t p-4 bg-muted/30\">\n                              <div className=\"flex items-center justify-between mb-3\">\n                                <h4 className=\"text-sm font-medium text-muted-foreground\">Vetting Questions</h4>\n                                <Button\n                                  variant=\"outline\"\n                                  size=\"sm\"\n                                  onClick={() => openAddVQModal(angle.id)}\n                                  data-testid={`button-add-vq-${angle.id}`}\n                                >\n                                  <Plus className=\"h-4 w-4 mr-2\" />\n                                  Add Question\n                                </Button>\n                              </div>\n                              {vqs.length === 0 ? (\n                                <p className=\"text-sm text-muted-foreground italic\">No questions yet</p>\n                              ) : (\n                                <div className=\"space-y-2\">\n                                  {vqs.map((vq, index) => (\n                                    <div\n                                      key={vq.id}\n                                      className=\"flex items-start gap-3 p-3 rounded-lg bg-background border\"\n                                      data-testid={`vq-item-${vq.id}`}\n                                    >\n                                      <span className=\"font-mono text-sm text-muted-foreground w-6 flex-shrink-0\">\n                                        {index + 1}.\n                                      </span>\n                                      <div className=\"flex-1\">\n                                        <p className=\"text-sm\">{vq.question}</p>\n                                        <div className=\"flex items-center gap-2 mt-1 flex-wrap\">\n                                          {vq.questionType && (\n                                            <Badge\n                                              variant=\"outline\"\n                                              className={\n                                                vq.questionType === \"screening\"\n                                                  ? \"bg-orange-500/10 text-orange-600 border-orange-500/20\"\n                                                  : vq.questionType === \"insight\"\n                                                  ? \"bg-blue-500/10 text-blue-600 border-blue-500/20\"\n                                                  : \"\"\n                                              }\n                                            >\n                                              {vq.questionType}\n                                            </Badge>\n                                          )}\n                                          {vq.isRequired && (\n                                            <Badge variant=\"secondary\" className=\"text-xs\">Required</Badge>\n                                          )}\n                                        </div>\n                                      </div>\n                                      <div className=\"flex items-center gap-1\">\n                                        <Button\n                                          variant=\"ghost\"\n                                          size=\"icon\"\n                                          onClick={() => openEditVQModal(vq)}\n                                          data-testid={`button-edit-vq-${vq.id}`}\n                                        >\n                                          <Pencil className=\"h-3 w-3\" />\n                                        </Button>\n                                        <Button\n                                          variant=\"ghost\"\n                                          size=\"icon\"\n                                          onClick={() => {\n                                            if (confirm(\"Delete this vetting question?\")) {\n                                              deleteVQMutation.mutate(vq.id);\n                                            }\n                                          }}\n                                          data-testid={`button-delete-vq-${vq.id}`}\n                                        >\n                                          <Trash2 className=\"h-3 w-3 text-destructive\" />\n                                        </Button>\n                                      </div>\n                                    </div>\n                                  ))}\n                                </div>\n                              )}\n                            </div>\n                          )}\n                        </div>\n                      );\n                    })}\n                </div>\n              )}\n            </CardContent>\n          </Card>\n\n          {/* Unassigned VQs (legacy or general questions) */}\n          {getVQsForAngle(null).length > 0 && (\n            <Card>\n              <CardHeader>\n                <div className=\"flex items-center justify-between gap-4 flex-wrap\">\n                  <div>\n                    <CardTitle className=\"text-base flex items-center gap-2\">\n                      <ClipboardList className=\"h-4 w-4\" />\n                      General Vetting Questions\n                    </CardTitle>\n                    <CardDescription>\n                      Questions not assigned to any specific angle\n                    </CardDescription>\n                  </div>\n                  <Button variant=\"outline\" size=\"sm\" onClick={() => openAddVQModal(null)} data-testid=\"button-add-general-vq\">\n                    <Plus className=\"h-4 w-4 mr-2\" />\n                    Add Question\n                  </Button>\n                </div>\n              </CardHeader>\n              <CardContent>\n                <div className=\"space-y-2\">\n                  {getVQsForAngle(null).map((vq, index) => (\n                    <div\n                      key={vq.id}\n                      className=\"flex items-start gap-3 p-3 rounded-lg bg-muted/50\"\n                      data-testid={`general-vq-item-${vq.id}`}\n                    >\n                      <span className=\"font-mono text-sm text-muted-foreground w-6 flex-shrink-0\">\n                        {index + 1}.\n                      </span>\n                      <div className=\"flex-1\">\n                        <p className=\"text-sm\">{vq.question}</p>\n                        <div className=\"flex items-center gap-2 mt-1 flex-wrap\">\n                          {vq.questionType && (\n                            <Badge\n                              variant=\"outline\"\n                              className={\n                                vq.questionType === \"screening\"\n                                  ? \"bg-orange-500/10 text-orange-600 border-orange-500/20\"\n                                  : vq.questionType === \"insight\"\n                                  ? \"bg-blue-500/10 text-blue-600 border-blue-500/20\"\n                                  : \"\"\n                              }\n                            >\n                              {vq.questionType}\n                            </Badge>\n                          )}\n                          {vq.isRequired && (\n                            <Badge variant=\"secondary\" className=\"text-xs\">Required</Badge>\n                          )}\n                        </div>\n                      </div>\n                      <div className=\"flex items-center gap-1\">\n                        <Button\n                          variant=\"ghost\"\n                          size=\"icon\"\n                          onClick={() => openEditVQModal(vq)}\n                          data-testid={`button-edit-general-vq-${vq.id}`}\n                        >\n                          <Pencil className=\"h-3 w-3\" />\n                        </Button>\n                        <Button\n                          variant=\"ghost\"\n                          size=\"icon\"\n                          onClick={() => {\n                            if (confirm(\"Delete this vetting question?\")) {\n                              deleteVQMutation.mutate(vq.id);\n                            }\n                          }}\n                          data-testid={`button-delete-general-vq-${vq.id}`}\n                        >\n                          <Trash2 className=\"h-3 w-3 text-destructive\" />\n                        </Button>\n                      </div>\n                    </div>\n                  ))}\n                </div>\n              </CardContent>\n            </Card>\n          )}\n        </TabsContent>\n\n        <TabsContent value=\"existing-experts\" className=\"space-y-4\">\n          <Card>\n            <CardHeader>\n              <div className=\"flex items-center justify-between gap-4 flex-wrap\">\n                <div>\n                  <CardTitle className=\"text-base flex items-center gap-2\">\n                    <Search className=\"h-4 w-4\" />\n                    Search Internal Expert Database\n                  </CardTitle>\n                  <CardDescription>\n                    Search and invite experts from the internal database\n                  </CardDescription>\n                </div>\n                <Button\n                  variant=\"default\"\n                  onClick={() => setIsExpertSearchModalOpen(true)}\n                  data-testid=\"button-search-add-experts\"\n                >\n                  <Search className=\"h-4 w-4 mr-2\" />\n                  Search & Add\n                </Button>\n              </div>\n            </CardHeader>\n            <CardContent>\n              <EmptyState\n                icon={Users}\n                title=\"No experts found\"\n                description=\"Click 'Search & Add' to find and add experts from your database.\"\n              />\n            </CardContent>\n          </Card>\n\n          <Card>\n            <CardHeader>\n              <div className=\"flex items-center justify-between gap-4 flex-wrap\">\n                <div>\n                  <CardTitle className=\"text-base flex items-center gap-2\">\n                    <Users className=\"h-4 w-4\" />\n                    Internal Experts Pipeline\n                  </CardTitle>\n                  <CardDescription>\n                    Experts from internal database assigned to this project\n                  </CardDescription>\n                </div>\n                <div className=\"flex items-center gap-2 flex-wrap\">\n                  <Button\n                    variant=\"outline\"\n                    size=\"sm\"\n                    onClick={() => setIsExpertSearchModalOpen(true)}\n                    data-testid=\"button-search-experts\"\n                  >\n                    <Search className=\"h-4 w-4 mr-2\" />\n                    Search & Add\n                  </Button>\n                  <Link href={`/projects/${projectId}/client-shortlist`}>\n                    <Button\n                      variant=\"outline\"\n                      size=\"sm\"\n                      data-testid=\"button-client-shortlist\"\n                    >\n                      <FileSearch className=\"h-4 w-4 mr-2\" />\n                      Client Shortlist\n                    </Button>\n                  </Link>\n                  <Button\n                    variant=\"secondary\"\n                    size=\"sm\"\n                    onClick={handleExportShortlist}\n                    disabled={isExportingShortlist}\n                    data-testid=\"button-export-shortlist\"\n                  >\n                    <Download className=\"h-4 w-4 mr-2\" />\n                    {isExportingShortlist ? \"Exporting...\" : \"Export Shortlist\"}\n                  </Button>\n                  {projectDetail?.angles && projectDetail.angles.length > 0 && (\n                    <Select value={internalExpertsAngleFilter} onValueChange={setInternalExpertsAngleFilter}>\n                      <SelectTrigger className=\"w-[180px]\" data-testid=\"select-angle-filter\">\n                        <SelectValue placeholder=\"Filter by Angle\" />\n                      </SelectTrigger>\n                      <SelectContent>\n                        <SelectItem value=\"all\">All Angles</SelectItem>\n                        <SelectItem value=\"none\">No Angle Assigned</SelectItem>\n                        {projectDetail.angles.map((angle) => (\n                          <SelectItem key={angle.id} value={angle.id.toString()}>\n                            {angle.title}\n                          </SelectItem>\n                        ))}\n                      </SelectContent>\n                    </Select>\n                  )}\n                </div>\n              </div>\n            </CardHeader>\n            <CardContent>\n              {filteredInternalExperts.length === 0 ? (\n                <EmptyState\n                  icon={Users}\n                  title={internalExpertsAngleFilter !== \"all\" ? \"No experts match this filter\" : \"No internal experts yet\"}\n                  description={internalExpertsAngleFilter !== \"all\" ? \"Try selecting a different angle filter.\" : \"Use the search above to add experts from your database.\"}\n                />\n              ) : (\n                <div className=\"space-y-3\">\n                  {selectedInternalExpertIds.size > 0 && (\n                    <div className=\"flex items-center justify-between p-3 bg-muted rounded-lg\">\n                      <span className=\"text-sm\">{selectedInternalExpertIds.size} expert(s) selected</span>\n                      <Button\n                        onClick={() => setIsBulkInviteModalOpen(true)}\n                        disabled={bulkInviteMutation.isPending}\n                        size=\"sm\"\n                        data-testid=\"button-create-invitations\"\n                      >\n                        <Send className=\"h-4 w-4 mr-2\" />\n                        {bulkInviteMutation.isPending ? \"Creating...\" : \"Create Invitations\"}\n                      </Button>\n                    </div>\n                  )}\n                  <div className=\"overflow-x-auto\">\n                    <Table>\n                      <TableHeader>\n                        <TableRow>\n                          <TableHead className=\"w-12\"></TableHead>\n                          <TableHead className=\"text-xs font-semibold uppercase\">Expert</TableHead>\n                          <TableHead className=\"text-xs font-semibold uppercase\">Angles</TableHead>\n                          <TableHead className=\"text-xs font-semibold uppercase\">Invitation Status</TableHead>\n                        <TableHead className=\"text-xs font-semibold uppercase\">Pipeline</TableHead>\n                        <TableHead className=\"text-xs font-semibold uppercase\">VQ Answers</TableHead>\n                        <TableHead className=\"text-xs font-semibold uppercase\">Last Activity</TableHead>\n                        <TableHead className=\"text-right text-xs font-semibold uppercase\">Actions</TableHead>\n                      </TableRow>\n                    </TableHeader>\n                    <TableBody>\n                      {filteredInternalExperts.map((pe) => {\n                        const angleNames = getAngleBadges(pe);\n                        return (\n                          <TableRow key={pe.id} data-testid={`row-internal-expert-${pe.id}`}>\n                            <TableCell>\n                              <Checkbox\n                                checked={selectedInternalExpertIds.has(pe.id)}\n                                onCheckedChange={(checked) => {\n                                  const newSelected = new Set(selectedInternalExpertIds);\n                                  if (checked) {\n                                    newSelected.add(pe.id);\n                                  } else {\n                                    newSelected.delete(pe.id);\n                                  }\n                                  setSelectedInternalExpertIds(newSelected);\n                                }}\n                                data-testid={`checkbox-internal-expert-${pe.id}`}\n                              />\n                            </TableCell>\n                            <TableCell>\n                              <div>\n                                <p className=\"font-medium\">{pe.expert?.name || `Expert #${pe.expertId}`}</p>\n                                <p className=\"text-xs text-muted-foreground\">\n                                  {pe.expert?.email} {pe.expert?.jobTitle ? ` ${pe.expert.jobTitle}` : \"\"}\n                                </p>\n                              </div>\n                            </TableCell>\n                            <TableCell>\n                              {angleNames && angleNames.length > 0 ? (\n                                <div className=\"flex flex-wrap gap-1\">\n                                  {angleNames.map((name, idx) => (\n                                    <Badge key={idx} variant=\"outline\" className=\"text-xs\">\n                                      <Layers className=\"h-3 w-3 mr-1\" />\n                                      {name}\n                                    </Badge>\n                                  ))}\n                                </div>\n                              ) : (\n                                <span className=\"text-xs text-muted-foreground\">-</span>\n                              )}\n                            </TableCell>\n                            <TableCell>\n                              <div className=\"flex items-center gap-2\">\n                                {getInvitationStatusIcon(pe.invitationStatus)}\n                                {getInvitationStatusBadge(pe.invitationStatus)}\n                              </div>\n                            </TableCell>\n                            <TableCell>\n                              {getPipelineStatusBadge(pe.pipelineStatus)}\n                            </TableCell>\n                            <TableCell>\n                              {pe.vqAnswers && Array.isArray(pe.vqAnswers) && pe.vqAnswers.length > 0 ? (\n                                <Badge variant=\"outline\" className=\"text-xs\">\n                                  <Check className=\"h-3 w-3 mr-1\" />\n                                  {pe.vqAnswers.length} answers\n                                </Badge>\n                              ) : (\n                                <span className=\"text-xs text-muted-foreground\">-</span>\n                              )}\n                            </TableCell>\n                            <TableCell className=\"font-mono text-xs text-muted-foreground\">\n                              {pe.lastActivityAt\n                                ? formatDistanceToNow(new Date(pe.lastActivityAt), { addSuffix: true })\n                                : pe.invitedAt\n                                ? formatDistanceToNow(new Date(pe.invitedAt), { addSuffix: true })\n                                : \"-\"}\n                            </TableCell>\n                            <TableCell className=\"text-right\">\n                              <div className=\"flex items-center justify-end gap-1\">\n                                {pe.invitationStatus !== \"accepted\" && pe.invitationStatus !== \"declined\" && (\n                                  <Button\n                                    variant=\"ghost\"\n                                    size=\"icon\"\n                                    onClick={() => generateInviteLinkMutation.mutate({ expertId: pe.expertId })}\n                                    disabled={generateInviteLinkMutation.isPending}\n                                    title=\"Generate and copy invite link\"\n                                    data-testid={`button-invite-link-${pe.id}`}\n                                  >\n                                    {copiedLink?.includes(String(pe.expertId)) ? (\n                                      <Check className=\"h-4 w-4 text-green-500\" />\n                                    ) : (\n                                      <Link2 className=\"h-4 w-4\" />\n                                    )}\n                                  </Button>\n                                )}\n                                <DropdownMenu>\n                                  <DropdownMenuTrigger asChild>\n                                    <Button variant=\"ghost\" size=\"icon\">\n                                      <MoreHorizontal className=\"h-4 w-4\" />\n                                    </Button>\n                                  </DropdownMenuTrigger>\n                                  <DropdownMenuContent align=\"end\">\n                                    <DropdownMenuItem\n                                      onClick={() => removeExpertMutation.mutate(pe.id)}\n                                      className=\"text-destructive\"\n                                    >\n                                      <X className=\"h-4 w-4 mr-2\" />\n                                      Remove from project\n                                    </DropdownMenuItem>\n                                  </DropdownMenuContent>\n                                </DropdownMenu>\n                              </div>\n                            </TableCell>\n                          </TableRow>\n                        );\n                      })}\n                    </TableBody>\n                  </Table>\n                  </div>\n                </div>\n              )}\n            </CardContent>\n          </Card>\n        </TabsContent>\n\n        <TabsContent value=\"ra-sourcing\" className=\"space-y-4\"> \n          <Card>\n            <CardHeader>\n              <div className=\"flex items-center justify-between\">\n                <div>\n                  <CardTitle className=\"text-base flex items-center gap-2\">\n                    <UserCheck className=\"h-4 w-4\" />\n                    Assigned RAs & Invite Links\n                  </CardTitle>\n                  <CardDescription>\n                    RAs can use their personalized invite links to onboard new experts\n                  </CardDescription>\n                </div>\n                <Button\n                  variant=\"outline\"\n                  size=\"sm\"\n                  onClick={() => {\n                    setSelectedRaIds(projectDetail.assignedRas?.map(r => r.id) || []);\n                    setIsAssignRaModalOpen(true);\n                  }}\n                  data-testid=\"button-manage-ras\"\n                >\n                  <UserPlus className=\"h-4 w-4 mr-2\" />\n                  Manage RAs\n                </Button>\n              </div>\n            </CardHeader>\n            <CardContent>\n              {!projectDetail.assignedRas || projectDetail.assignedRas.length === 0 ? (\n                <EmptyState\n                  icon={UserCheck}\n                  title=\"No RAs assigned\"\n                  description=\"Assign RAs to enable external expert sourcing.\"\n                />\n              ) : (\n                <div className=\"space-y-3\">\n                  {projectDetail.assignedRas.map((ra) => (\n                    <div key={ra.id} className=\"flex items-center justify-between p-3 rounded-lg border\">\n                      <div className=\"flex items-center gap-3\">\n                        <div className=\"w-8 h-8 rounded-full bg-muted flex items-center justify-center\">\n                          <UserCheck className=\"h-4 w-4 text-muted-foreground\" />\n                        </div>\n                        <div>\n                          <p className=\"font-medium\">{ra.fullName}</p>\n                          <p className=\"text-xs text-muted-foreground\">{ra.email}</p>\n                        </div>\n                      </div>\n                    </div>\n                  ))}\n                </div>\n              )}\n            </CardContent>\n          </Card>\n\n          <Card>\n            <CardHeader>\n              <div className=\"flex items-center justify-between\">\n                <div>\n                  <CardTitle className=\"text-base flex items-center gap-2\">\n                    <ExternalLink className=\"h-4 w-4\" />\n                    RA-Sourced Experts Pipeline\n                  </CardTitle>\n                  <CardDescription>\n                    Experts sourced by RAs through external channels\n                  </CardDescription>\n                </div>\n                <Button\n                  variant=\"outline\"\n                  size=\"sm\"\n                  onClick={() => setIsQuickInviteModalOpen(true)}\n                  className=\"gap-2\"\n                  data-testid=\"button-quick-invite\"\n                >\n                  <Plus className=\"h-4 w-4\" />\n                  Invite New Expert\n                </Button>\n              </div>\n            </CardHeader>\n            <CardContent>\n              {(() => {\n                const pendingInvites = projectDetail.raInviteLinks?.filter(\n                  (link: any) => link.status === \"pending_onboarding\" || link.status === \"onboarded\"\n                ) || [];\n                \n                const hasExperts = projectDetail.raSourcedExperts && projectDetail.raSourcedExperts.length > 0;\n                const hasPending = pendingInvites.length > 0;\n                \n                if (!hasExperts && !hasPending) {\n                  return (\n                    <EmptyState\n                      icon={ExternalLink}\n                      title=\"No RA-sourced experts yet\"\n                      description=\"Click 'Invite New Expert' to generate an invite link.\"\n                    />\n                  );\n                }\n                \n                return (\n                  <div className=\"space-y-6\">\n                    {hasPending && (\n                      <div>\n                        <h4 className=\"text-sm font-medium mb-3 flex items-center gap-2\">\n                          <Clock className=\"h-4 w-4 text-amber-500\" />\n                          Pending Invites ({pendingInvites.length})\n                        </h4>\n                        <div className=\"overflow-x-auto\">\n                          <Table>\n                            <TableHeader>\n                              <TableRow>\n                                <TableHead className=\"text-xs font-semibold uppercase\">Candidate</TableHead>\n                                <TableHead className=\"text-xs font-semibold uppercase\">Contact</TableHead>\n                                <TableHead className=\"text-xs font-semibold uppercase\">Status</TableHead>\n                                <TableHead className=\"text-xs font-semibold uppercase\">Created</TableHead>\n                                <TableHead className=\"text-right text-xs font-semibold uppercase\">Actions</TableHead>\n                              </TableRow>\n                            </TableHeader>\n                            <TableBody>\n                              {pendingInvites.map((invite: any) => (\n                                <TableRow key={invite.id} data-testid={`row-pending-invite-${invite.id}`}>\n                                  <TableCell>\n                                    <p className=\"font-medium\">{invite.candidateName || \"Unknown\"}</p>\n                                  </TableCell>\n                                  <TableCell>\n                                    <p className=\"text-xs text-muted-foreground truncate max-w-[150px]\">\n                                      {invite.candidateEmail || \"-\"}\n                                    </p>\n                                  </TableCell>\n                                  <TableCell>\n                                    <Badge variant=\"outline\" className=\"text-xs bg-amber-500/10 text-amber-700 dark:text-amber-400\">\n                                      <Clock className=\"h-3 w-3 mr-1\" />\n                                      {invite.status === \"pending_onboarding\" ? \"Awaiting Onboarding\" : \"Awaiting Decision\"}\n                                    </Badge>\n                                  </TableCell>\n                                  <TableCell className=\"font-mono text-xs text-muted-foreground\">\n                                    {invite.createdAt\n                                      ? formatDistanceToNow(new Date(invite.createdAt), { addSuffix: true })\n                                      : \"-\"}\n                                  </TableCell>\n                                  <TableCell className=\"text-right\">\n                                    <Button\n                                      variant=\"outline\"\n                                      size=\"sm\"\n                                      className=\"gap-1\"\n                                      onClick={async () => {\n                                        const fullUrl = `${window.location.origin}/invite/onboarding/${invite.token}`;\n                                        await navigator.clipboard.writeText(fullUrl);\n                                        toast({\n                                          title: \"Link copied\",\n                                          description: \"Invite link copied to clipboard\",\n                                        });\n                                      }}\n                                      data-testid={`button-copy-invite-${invite.id}`}\n                                    >\n                                      <Copy className=\"h-3 w-3\" />\n                                      Copy Link\n                                    </Button>\n                                  </TableCell>\n                                </TableRow>\n                              ))}\n                            </TableBody>\n                          </Table>\n                        </div>\n                      </div>\n                    )}\n                    \n                    {hasExperts && (\n                      <div>\n                        {hasPending && (\n                          <h4 className=\"text-sm font-medium mb-3 flex items-center gap-2\">\n                            <CheckCircle2 className=\"h-4 w-4 text-green-500\" />\n                            Onboarded Experts ({projectDetail.raSourcedExperts?.length || 0})\n                          </h4>\n                        )}\n                        <div className=\"overflow-x-auto\">\n                          <Table>\n                            <TableHeader>\n                              <TableRow>\n                                <TableHead className=\"text-xs font-semibold uppercase\">Expert</TableHead>\n                                <TableHead className=\"text-xs font-semibold uppercase\">Sourced By</TableHead>\n                                <TableHead className=\"text-xs font-semibold uppercase\">Pipeline Status</TableHead>\n                                <TableHead className=\"text-xs font-semibold uppercase\">VQ Answers</TableHead>\n                                <TableHead className=\"text-xs font-semibold uppercase\">Onboarded</TableHead>\n                                <TableHead className=\"text-right text-xs font-semibold uppercase\">Actions</TableHead>\n                              </TableRow>\n                            </TableHeader>\n                            <TableBody>\n                              {projectDetail.raSourcedExperts?.map((pe) => (\n                                <TableRow key={pe.id} data-testid={`row-ra-expert-${pe.id}`}>\n                                  <TableCell>\n                                    <div>\n                                      <p className=\"font-medium\">{pe.expert?.name || `Expert #${pe.expertId}`}</p>\n                                      <p className=\"text-xs text-muted-foreground\">\n                                        {pe.expert?.email} {pe.expert?.jobTitle ? ` ${pe.expert.jobTitle}` : \"\"}\n                                      </p>\n                                    </div>\n                                  </TableCell>\n                                  <TableCell>\n                                    {pe.sourcedByRa ? (\n                                      <Badge variant=\"outline\" className=\"gap-1\">\n                                        <UserCheck className=\"h-3 w-3\" />\n                                        {pe.sourcedByRa.fullName}\n                                      </Badge>\n                                    ) : (\n                                      <span className=\"text-xs text-muted-foreground\">-</span>\n                                    )}\n                                  </TableCell>\n                                  <TableCell>\n                                    {getPipelineStatusBadge(pe.pipelineStatus)}\n                                  </TableCell>\n                                  <TableCell>\n                                    {pe.vqAnswers && Array.isArray(pe.vqAnswers) && pe.vqAnswers.length > 0 ? (\n                                      <Badge variant=\"outline\" className=\"text-xs\">\n                                        <Check className=\"h-3 w-3 mr-1\" />\n                                        {pe.vqAnswers.length} answers\n                                      </Badge>\n                                    ) : (\n                                      <span className=\"text-xs text-muted-foreground\">-</span>\n                                    )}\n                                  </TableCell>\n                                  <TableCell className=\"font-mono text-xs text-muted-foreground\">\n                                    {pe.respondedAt\n                                      ? formatDistanceToNow(new Date(pe.respondedAt), { addSuffix: true })\n                                      : pe.invitedAt\n                                      ? formatDistanceToNow(new Date(pe.invitedAt), { addSuffix: true })\n                                      : \"-\"}\n                                  </TableCell>\n                                  <TableCell className=\"text-right\">\n                                    <DropdownMenu>\n                                      <DropdownMenuTrigger asChild>\n                                        <Button variant=\"ghost\" size=\"icon\">\n                                          <MoreHorizontal className=\"h-4 w-4\" />\n                                        </Button>\n                                      </DropdownMenuTrigger>\n                                      <DropdownMenuContent align=\"end\">\n                                        <DropdownMenuItem\n                                          onClick={() => removeExpertMutation.mutate(pe.id)}\n                                          className=\"text-destructive\"\n                                        >\n                                          <X className=\"h-4 w-4 mr-2\" />\n                                          Remove from project\n                                        </DropdownMenuItem>\n                                      </DropdownMenuContent>\n                                    </DropdownMenu>\n                                  </TableCell>\n                                </TableRow>\n                              ))}\n                            </TableBody>\n                          </Table>\n                        </div>\n                      </div>\n                    )}\n                  </div>\n                );\n              })()}\n            </CardContent>\n          </Card>\n        </TabsContent>\n\n        <TabsContent value=\"activity\" className=\"space-y-4\">\n          <Card>\n            <CardHeader>\n              <CardTitle className=\"text-base flex items-center gap-2\">\n                <FileText className=\"h-4 w-4\" />\n                Add Note\n              </CardTitle>\n            </CardHeader>\n            <CardContent>\n              <div className=\"flex gap-2\">\n                <Textarea\n                  placeholder=\"Add a note or update about this project...\"\n                  value={activityNote}\n                  onChange={(e) => setActivityNote(e.target.value)}\n                  className=\"min-h-[80px]\"\n                  data-testid=\"input-activity-note\"\n                />\n                <Button\n                  onClick={() => addActivityMutation.mutate(activityNote)}\n                  disabled={!activityNote.trim() || addActivityMutation.isPending}\n                  data-testid=\"button-add-note\"\n                >\n                  <Send className=\"h-4 w-4\" />\n                </Button>\n              </div>\n            </CardContent>\n          </Card>\n\n          <Card>\n            <CardHeader>\n              <CardTitle className=\"text-base flex items-center gap-2\">\n                <Activity className=\"h-4 w-4\" />\n                Activity Timeline\n              </CardTitle>\n              <CardDescription>\n                History of all activities and updates for this project\n              </CardDescription>\n            </CardHeader>\n            <CardContent>\n              {!projectDetail.activities || projectDetail.activities.length === 0 ? (\n                <EmptyState\n                  icon={Activity}\n                  title=\"No activity yet\"\n                  description=\"Activities will appear here as the project progresses.\"\n                />\n              ) : (\n                <div className=\"space-y-4\">\n                  {projectDetail.activities\n                    .sort((a, b) => new Date(b.createdAt).getTime() - new Date(a.createdAt).getTime())\n                    .map((activity) => (\n                      <div key={activity.id} className=\"flex gap-3 p-3 rounded-lg border\">\n                        <div className=\"flex-shrink-0 mt-0.5\">\n                          {getActivityIcon(activity.activityType)}\n                        </div>\n                        <div className=\"flex-1 min-w-0\">\n                          <p className=\"text-sm\">{activity.description}</p>\n                          <p className=\"text-xs text-muted-foreground mt-1\">\n                            {format(new Date(activity.createdAt), \"MMM dd, yyyy 'at' HH:mm\")}\n                          </p>\n                        </div>\n                      </div>\n                    ))}\n                </div>\n              )}\n            </CardContent>\n          </Card>\n        </TabsContent>\n      </Tabs>\n\n      <Dialog open={isAssignRaModalOpen} onOpenChange={setIsAssignRaModalOpen}>\n        <DialogContent className=\"max-w-md\" aria-describedby=\"assign-ra-description\">\n          <DialogHeader>\n            <DialogTitle>Assign RAs to Project</DialogTitle>\n            <DialogDescription id=\"assign-ra-description\">\n              Select RAs who will source experts for this project\n            </DialogDescription>\n          </DialogHeader>\n          <div className=\"space-y-3 py-4 max-h-[400px] overflow-y-auto\">\n            {allRAs?.map((ra) => (\n              <div\n                key={ra.id}\n                className=\"flex items-center justify-between p-3 rounded-lg border cursor-pointer hover-elevate\"\n                onClick={() => {\n                  setSelectedRaIds((prev) =>\n                    prev.includes(ra.id)\n                      ? prev.filter((id) => id !== ra.id)\n                      : [...prev, ra.id]\n                  );\n                }}\n              >\n                <div className=\"flex items-center gap-3\">\n                  <Checkbox\n                    checked={selectedRaIds.includes(ra.id)}\n                    onCheckedChange={(checked) => {\n                      setSelectedRaIds((prev) =>\n                        checked\n                          ? [...prev, ra.id]\n                          : prev.filter((id) => id !== ra.id)\n                      );\n                    }}\n                    data-testid={`checkbox-ra-${ra.id}`}\n                  />\n                  <div>\n                    <p className=\"font-medium\">{ra.fullName}</p>\n                    <p className=\"text-xs text-muted-foreground\">{ra.email}</p>\n                  </div>\n                </div>\n              </div>\n            )) || (\n              <p className=\"text-sm text-muted-foreground text-center py-4\">\n                No RAs available\n              </p>\n            )}\n          </div>\n          <DialogFooter>\n            <Button\n              variant=\"outline\"\n              onClick={() => setIsAssignRaModalOpen(false)}\n              data-testid=\"button-cancel-assign-ra\"\n            >\n              Cancel\n            </Button>\n            <Button\n              onClick={() => assignRasMutation.mutate(selectedRaIds)}\n              disabled={assignRasMutation.isPending}\n              data-testid=\"button-confirm-assign-ra\"\n            >\n              {assignRasMutation.isPending ? \"Saving...\" : \"Save Assignments\"}\n            </Button>\n          </DialogFooter>\n        </DialogContent>\n      </Dialog>\n\n      {/* Angle Modal */}\n      <Dialog open={isAngleModalOpen} onOpenChange={setIsAngleModalOpen}>\n        <DialogContent className=\"max-w-md\" aria-describedby=\"angle-modal-description\">\n          <DialogHeader>\n            <DialogTitle>{editingAngle ? \"Edit Angle\" : \"Add Angle\"}</DialogTitle>\n            <DialogDescription id=\"angle-modal-description\">\n              {editingAngle\n                ? \"Update the angle details\"\n                : \"Create a new angle to organize experts by profile type\"}\n            </DialogDescription>\n          </DialogHeader>\n          <div className=\"space-y-4 py-4\">\n            <div className=\"space-y-2\">\n              <label className=\"text-sm font-medium\">Title</label>\n              <Input\n                placeholder=\"e.g., Battery Cell Engineers\"\n                value={angleTitle}\n                onChange={(e) => setAngleTitle(e.target.value)}\n                data-testid=\"input-angle-title\"\n              />\n            </div>\n            <div className=\"space-y-2\">\n              <label className=\"text-sm font-medium\">Description (optional)</label>\n              <Textarea\n                placeholder=\"Brief description of this expert profile type...\"\n                value={angleDescription}\n                onChange={(e) => setAngleDescription(e.target.value)}\n                rows={3}\n                data-testid=\"input-angle-description\"\n              />\n            </div>\n          </div>\n          <DialogFooter>\n            <Button\n              variant=\"outline\"\n              onClick={() => {\n                setIsAngleModalOpen(false);\n                setEditingAngle(null);\n                setAngleTitle(\"\");\n                setAngleDescription(\"\");\n              }}\n              data-testid=\"button-cancel-angle\"\n            >\n              Cancel\n            </Button>\n            <Button\n              onClick={handleSaveAngle}\n              disabled={!angleTitle.trim() || createAngleMutation.isPending || updateAngleMutation.isPending}\n              data-testid=\"button-save-angle\"\n            >\n              {createAngleMutation.isPending || updateAngleMutation.isPending ? \"Saving...\" : \"Save\"}\n            </Button>\n          </DialogFooter>\n        </DialogContent>\n      </Dialog>\n\n      {/* VQ Modal */}\n      <Dialog open={isVQModalOpen} onOpenChange={setIsVQModalOpen}>\n        <DialogContent className=\"max-w-lg\" aria-describedby=\"vq-modal-description\">\n          <DialogHeader>\n            <DialogTitle>{editingVQ ? \"Edit Vetting Question\" : \"Add Vetting Question\"}</DialogTitle>\n            <DialogDescription id=\"vq-modal-description\">\n              {editingVQ\n                ? \"Update the vetting question details\"\n                : \"Add a new question for experts to answer\"}\n            </DialogDescription>\n          </DialogHeader>\n          <div className=\"space-y-4 py-4\">\n            <div className=\"space-y-2\">\n              <label className=\"text-sm font-medium\">Question</label>\n              <Textarea\n                placeholder=\"Enter your vetting question...\"\n                value={vqQuestion}\n                onChange={(e) => setVQQuestion(e.target.value)}\n                rows={3}\n                data-testid=\"input-vq-question\"\n              />\n            </div>\n            <div className=\"grid grid-cols-2 gap-4\">\n              <div className=\"space-y-2\">\n                <label className=\"text-sm font-medium\">Question Type</label>\n                <Select value={vqQuestionType} onValueChange={(v) => setVQQuestionType(v as \"screening\" | \"insight\" | \"general\")}>\n                  <SelectTrigger data-testid=\"select-vq-type\">\n                    <SelectValue />\n                  </SelectTrigger>\n                  <SelectContent>\n                    <SelectItem value=\"screening\">Screening</SelectItem>\n                    <SelectItem value=\"insight\">Insight</SelectItem>\n                    <SelectItem value=\"general\">General</SelectItem>\n                  </SelectContent>\n                </Select>\n              </div>\n              <div className=\"space-y-2\">\n                <label className=\"text-sm font-medium\">Angle</label>\n                <Select \n                  value={vqAngleId?.toString() || \"none\"} \n                  onValueChange={(v) => setVQAngleId(v === \"none\" ? null : parseInt(v))}\n                >\n                  <SelectTrigger data-testid=\"select-vq-angle\">\n                    <SelectValue placeholder=\"Select angle\" />\n                  </SelectTrigger>\n                  <SelectContent>\n                    <SelectItem value=\"none\">General (No Angle)</SelectItem>\n                    {projectDetail?.angles?.map((angle) => (\n                      <SelectItem key={angle.id} value={angle.id.toString()}>\n                        {angle.title}\n                      </SelectItem>\n                    ))}\n                  </SelectContent>\n                </Select>\n              </div>\n            </div>\n            <div className=\"flex items-center gap-2\">\n              <Checkbox\n                id=\"vq-required\"\n                checked={vqIsRequired}\n                onCheckedChange={(checked) => setVQIsRequired(!!checked)}\n                data-testid=\"checkbox-vq-required\"\n              />\n              <label htmlFor=\"vq-required\" className=\"text-sm font-medium cursor-pointer\">\n                Required question\n              </label>\n            </div>\n          </div>\n          <DialogFooter>\n            <Button\n              variant=\"outline\"\n              onClick={() => {\n                setIsVQModalOpen(false);\n                setEditingVQ(null);\n                setVQQuestion(\"\");\n                setVQAngleId(null);\n                setVQQuestionType(\"insight\");\n                setVQIsRequired(false);\n              }}\n              data-testid=\"button-cancel-vq\"\n            >\n              Cancel\n            </Button>\n            <Button\n              onClick={handleSaveVQ}\n              disabled={!vqQuestion.trim() || createVQMutation.isPending || updateVQMutation.isPending}\n              data-testid=\"button-save-vq\"\n            >\n              {createVQMutation.isPending || updateVQMutation.isPending ? \"Saving...\" : \"Save\"}\n            </Button>\n          </DialogFooter>\n        </DialogContent>\n      </Dialog>\n\n      {/* Bulk Invite Modal */}\n      <Dialog open={isBulkInviteModalOpen} onOpenChange={setIsBulkInviteModalOpen}>\n        <DialogContent className=\"max-w-lg\">\n          <DialogHeader>\n            <DialogTitle>Create Invitations</DialogTitle>\n            <DialogDescription>\n              Send invitations to {selectedInternalExpertIds.size} expert(s){projectDetail?.angles && projectDetail.angles.length > 0 ? \" and optionally assign angles\" : \"\"}\n            </DialogDescription>\n          </DialogHeader>\n          <div className=\"space-y-4 py-4\">\n            <div className=\"space-y-2\">\n              <label className=\"text-sm font-medium\">Assign Angles (Optional)</label>\n              <p className=\"text-xs text-muted-foreground mb-2\">Select which angles these experts should be invited for (leave empty to invite without angle assignment)</p>\n              <div className=\"space-y-2 max-h-[200px] overflow-y-auto\">\n                {projectDetail?.angles && projectDetail.angles.length > 0 ? (\n                  projectDetail.angles.map((angle) => (\n                    <div key={angle.id} className=\"flex items-center gap-2\">\n                      <Checkbox\n                        id={`angle-${angle.id}`}\n                        checked={bulkInviteAngleIds.includes(angle.id)}\n                        onCheckedChange={(checked) => {\n                          if (checked) {\n                            setBulkInviteAngleIds([...bulkInviteAngleIds, angle.id]);\n                          } else {\n                            setBulkInviteAngleIds(bulkInviteAngleIds.filter(id => id !== angle.id));\n                          }\n                        }}\n                        data-testid={`checkbox-angle-${angle.id}`}\n                      />\n                      <label htmlFor={`angle-${angle.id}`} className=\"text-sm cursor-pointer\">\n                        {angle.title}\n                      </label>\n                    </div>\n                  ))\n                ) : (\n                  <p className=\"text-xs text-muted-foreground\">No angles available</p>\n                )}\n              </div>\n            </div>\n          </div>\n          <DialogFooter>\n            <Button\n              variant=\"outline\"\n              onClick={() => setIsBulkInviteModalOpen(false)}\n              data-testid=\"button-cancel-bulk-invite\"\n            >\n              Cancel\n            </Button>\n            <Button\n              onClick={() => {\n                const peIds = Array.from(selectedInternalExpertIds);\n                bulkInviteMutation.mutate({\n                  projectExpertIds: peIds,\n                  angleIds: bulkInviteAngleIds,\n                  channel: \"email\",\n                });\n              }}\n              disabled={\n                selectedInternalExpertIds.size === 0 ||\n                bulkInviteMutation.isPending\n              }\n              data-testid=\"button-send-bulk-invites\"\n            >\n              {bulkInviteMutation.isPending ? \"Sending...\" : \"Send Invitations\"}\n            </Button>\n          </DialogFooter>\n        </DialogContent>\n      </Dialog>\n\n      {/* Expert Search Modal */}\n      <Dialog open={isExpertSearchModalOpen} onOpenChange={setIsExpertSearchModalOpen}>\n        <DialogContent className=\"max-w-3xl max-h-[90vh] flex flex-col\">\n          <DialogHeader>\n            <DialogTitle>Search & Add Experts</DialogTitle>\n            <DialogDescription>\n              Find experts from your database with advanced filters (all filters work together)\n            </DialogDescription>\n          </DialogHeader>\n          <div className=\"space-y-4 py-4 overflow-y-auto flex-1\">\n            {/* Two-column filter layout */}\n            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n              {/* LEFT COLUMN */}\n              <div className=\"space-y-4\">\n                <div className=\"space-y-2\">\n                  <label className=\"text-sm font-medium\">Keywords / Expertise</label>\n                  <Input\n                    placeholder=\"Search by name, skills, bio...\"\n                    value={searchQuery}\n                    onChange={(e) => setSearchQuery(e.target.value)}\n                    data-testid=\"input-search-query\"\n                  />\n                  <p className=\"text-xs text-muted-foreground\">Multiple keywords separated by space or comma</p>\n                </div>\n                <div className=\"space-y-2\">\n                  <label className=\"text-sm font-medium\">Current Employer</label>\n                  <Input\n                    placeholder=\"e.g., Google, Tesla\"\n                    value={searchCurrentEmployer}\n                    onChange={(e) => setSearchCurrentEmployer(e.target.value)}\n                    data-testid=\"input-current-employer\"\n                  />\n                </div>\n                <div className=\"space-y-2\">\n                  <label className=\"text-sm font-medium\">Past Employers</label>\n                  <Input\n                    placeholder=\"e.g., Apple, Microsoft, Amazon\"\n                    value={searchPastEmployers}\n                    onChange={(e) => setSearchPastEmployers(e.target.value)}\n                    data-testid=\"input-past-employers\"\n                  />\n                  <p className=\"text-xs text-muted-foreground\">Comma-separated list of company names</p>\n                </div>\n                <div className=\"space-y-2\">\n                  <label className=\"text-sm font-medium\">Years of Experience</label>\n                  <div className=\"flex gap-2\">\n                    <Input\n                      type=\"number\"\n                      placeholder=\"Min\"\n                      value={searchMinExp}\n                      onChange={(e) => setSearchMinExp(e.target.value)}\n                      data-testid=\"input-min-exp\"\n                    />\n                    <Input\n                      type=\"number\"\n                      placeholder=\"Max\"\n                      value={searchMaxExp}\n                      onChange={(e) => setSearchMaxExp(e.target.value)}\n                      data-testid=\"input-max-exp\"\n                    />\n                  </div>\n                </div>\n                <div className=\"flex items-center gap-2 pt-2\">\n                  <Checkbox\n                    id=\"available-only\"\n                    checked={searchAvailableOnly}\n                    onCheckedChange={(checked) => setSearchAvailableOnly(checked === true)}\n                    data-testid=\"checkbox-available-only\"\n                  />\n                  <label htmlFor=\"available-only\" className=\"text-sm font-medium cursor-pointer\">\n                    Only show currently available experts\n                  </label>\n                </div>\n              </div>\n\n              {/* RIGHT COLUMN */}\n              <div className=\"space-y-4\">\n                <div className=\"space-y-2\">\n                  <label className=\"text-sm font-medium\">Country / Location</label>\n                  <Input\n                    placeholder=\"e.g., Brazil, So Paulo, Rio\"\n                    value={searchCountry}\n                    onChange={(e) => setSearchCountry(e.target.value)}\n                    data-testid=\"input-search-country\"\n                  />\n                  <p className=\"text-xs text-muted-foreground\">Multiple locations separated by commas</p>\n                </div>\n                <div className=\"space-y-2\">\n                  <label className=\"text-sm font-medium\">Job Title / Role</label>\n                  <Input\n                    placeholder=\"e.g., Director, VP, Manager\"\n                    value={searchJobTitle}\n                    onChange={(e) => setSearchJobTitle(e.target.value)}\n                    data-testid=\"input-search-job-title\"\n                  />\n                </div>\n                <div className=\"space-y-2\">\n                  <label className=\"text-sm font-medium\">Industry / Sector</label>\n                  <Input\n                    placeholder=\"e.g., Energy, Mining, Healthcare\"\n                    value={searchIndustry}\n                    onChange={(e) => setSearchIndustry(e.target.value)}\n                    data-testid=\"input-search-industry\"\n                  />\n                  <p className=\"text-xs text-muted-foreground\">Comma-separated list of industries</p>\n                </div>\n                <div className=\"space-y-2\">\n                  <label className=\"text-sm font-medium\">Language</label>\n                  <Input\n                    placeholder=\"e.g., English, Portuguese, Spanish\"\n                    value={searchLanguage}\n                    onChange={(e) => setSearchLanguage(e.target.value)}\n                    data-testid=\"input-search-language\"\n                  />\n                  <p className=\"text-xs text-muted-foreground\">Comma-separated list of languages</p>\n                </div>\n                <div className=\"grid grid-cols-2 gap-2\">\n                  <div className=\"space-y-2\">\n                    <label className=\"text-sm font-medium\">Min Hours Worked</label>\n                    <Input\n                      type=\"number\"\n                      placeholder=\"e.g., 10\"\n                      value={searchMinHoursWorked}\n                      onChange={(e) => setSearchMinHoursWorked(e.target.value)}\n                      data-testid=\"input-min-hours-worked\"\n                    />\n                  </div>\n                  <div className=\"space-y-2\">\n                    <label className=\"text-sm font-medium\">Min Accept Rate (%)</label>\n                    <Input\n                      type=\"number\"\n                      placeholder=\"e.g., 50\"\n                      value={searchMinAcceptanceRate}\n                      onChange={(e) => setSearchMinAcceptanceRate(e.target.value)}\n                      data-testid=\"input-min-acceptance-rate\"\n                    />\n                  </div>\n                </div>\n                <div className=\"flex items-center gap-2 pt-2\">\n                  <Checkbox\n                    id=\"prior-projects\"\n                    checked={searchHasPriorProjects}\n                    onCheckedChange={(checked) => setSearchHasPriorProjects(checked === true)}\n                    data-testid=\"checkbox-prior-projects\"\n                  />\n                  <label htmlFor=\"prior-projects\" className=\"text-sm font-medium cursor-pointer\">\n                    Only show experts with prior project involvement\n                  </label>\n                </div>\n              </div>\n            </div>\n\n            {/* Results */}\n            <div className=\"space-y-3 border-t pt-4\">\n              <div className=\"flex items-center justify-between\">\n                <p className=\"text-sm font-medium\">\n                  {expertSearchLoading ? \"Searching...\" : `${expertSearchResults?.length || 0} experts found`}\n                </p>\n              </div>\n              {expertSearchLoading && (\n                <p className=\"text-sm text-muted-foreground text-center py-4\">Loading results...</p>\n              )}\n              {!expertSearchLoading && expertSearchResults && expertSearchResults.length === 0 && (\n                <p className=\"text-sm text-muted-foreground text-center py-4\">No experts match your filters</p>\n              )}\n              <div className=\"max-h-[300px] overflow-y-auto space-y-2\">\n                {expertSearchResults?.map((expert: ExpertWithMetrics) => {\n                  const isAssigned = assignedExpertIds.has(expert.id);\n                  return (\n                    <Card key={expert.id} className=\"p-3\">\n                      <div className=\"flex items-start justify-between gap-3\">\n                        <div className=\"flex-1 min-w-0\">\n                          <p className=\"font-medium text-sm truncate\" data-testid={`text-expert-name-${expert.id}`}>{expert.name}</p>\n                          <p className=\"text-xs text-muted-foreground truncate\">{expert.jobTitle || expert.expertise} {expert.company ? `at ${expert.company}` : \"\"}</p>\n                          <div className=\"flex gap-2 mt-1 flex-wrap\">\n                            {expert.country && (\n                              <Badge variant=\"secondary\" className=\"text-xs\">{expert.country}</Badge>\n                            )}\n                            {expert.yearsOfExperience && (\n                              <Badge variant=\"secondary\" className=\"text-xs\">{expert.yearsOfExperience}y exp</Badge>\n                            )}\n                            {expert.industry && (\n                              <Badge variant=\"secondary\" className=\"text-xs\">{expert.industry}</Badge>\n                            )}\n                            {expert.priorProjectCount !== undefined && expert.priorProjectCount > 0 && (\n                              <Badge variant=\"outline\" className=\"text-xs\">\n                                {expert.priorProjectCount} prior project{expert.priorProjectCount !== 1 ? \"s\" : \"\"}\n                              </Badge>\n                            )}\n                            {expert.acceptanceRate !== undefined && (\n                              <Badge variant=\"outline\" className=\"text-xs\">\n                                {expert.acceptanceRate}% accept rate\n                              </Badge>\n                            )}\n                          </div>\n                        </div>\n                        <div className=\"flex gap-2 flex-wrap justify-end\">\n                          {!isAssigned && (\n                            <Button\n                              size=\"sm\"\n                              variant=\"default\"\n                              onClick={() => attachExpertMutation.mutate(expert.id)}\n                              disabled={attachExpertMutation.isPending}\n                              data-testid={`button-attach-expert-${expert.id}`}\n                            >\n                              {attachExpertMutation.isPending ? \"...\" : \"Attach\"}\n                            </Button>\n                          )}\n                          {isAssigned && (\n                            <Badge variant=\"outline\" className=\"text-xs\">Already in Project</Badge>\n                          )}\n                        </div>\n                      </div>\n                    </Card>\n                  );\n                })}\n              </div>\n            </div>\n          </div>\n          <DialogFooter>\n            <Button\n              variant=\"outline\"\n              onClick={() => {\n                setIsExpertSearchModalOpen(false);\n                setSearchQuery(\"\");\n                setSearchCurrentEmployer(\"\");\n                setSearchPastEmployers(\"\");\n                setSearchCountry(\"\");\n                setSearchMinExp(\"\");\n                setSearchMaxExp(\"\");\n                setSearchJobTitle(\"\");\n                setSearchIndustry(\"\");\n                setSearchLanguage(\"\");\n                setSearchAvailableOnly(false);\n                setSearchMinHoursWorked(\"\");\n                setSearchMinAcceptanceRate(\"\");\n                setSearchHasPriorProjects(false);\n              }}\n              data-testid=\"button-close-search\"\n            >\n              Close\n            </Button>\n          </DialogFooter>\n        </DialogContent>\n      </Dialog>\n\n      <Dialog open={isQuickInviteModalOpen} onOpenChange={setIsQuickInviteModalOpen}>\n        <DialogContent className=\"max-w-md\" aria-describedby=\"quick-invite-description\">\n          <DialogDescription id=\"quick-invite-description\" className=\"sr-only\">\n            Generate a quick invite link for a new candidate\n          </DialogDescription>\n          <QuickInviteForm\n            projectId={projectId}\n            onSuccess={() => {\n              refetchProject();\n              queryClient.invalidateQueries({ queryKey: [\"/api/projects\", projectId, \"detail\"] });\n            }}\n            onCancel={() => setIsQuickInviteModalOpen(false)}\n          />\n        </DialogContent>\n      </Dialog>\n    </div>\n  );\n}\n","path":null,"size_bytes":106896,"size_tokens":null},"client/src/index.css":{"content":"@tailwind base;\n@tailwind components;\n@tailwind utilities;\n\n/* LIGHT MODE */\n:root {\n  --button-outline: rgba(0,0,0, .10);\n  --badge-outline: rgba(0,0,0, .05);\n  --opaque-button-border-intensity: -8;\n  --elevate-1: rgba(0,0,0, .03);\n  --elevate-2: rgba(0,0,0, .08);\n  --background: 0 0% 100%;\n  --foreground: 0 0% 10%;\n  --border: 0 0% 90%;\n  --card: 0 0% 98%;\n  --card-foreground: 0 0% 10%;\n  --card-border: 0 0% 94%;\n  --sidebar: 0 0% 96%;\n  --sidebar-foreground: 0 0% 10%;\n  --sidebar-border: 0 0% 92%;\n  --sidebar-primary: 217 91% 35%;\n  --sidebar-primary-foreground: 217 91% 98%;\n  --sidebar-accent: 217 15% 88%;\n  --sidebar-accent-foreground: 217 15% 20%;\n  --sidebar-ring: 217 91% 35%;\n  --popover: 0 0% 94%;\n  --popover-foreground: 0 0% 10%;\n  --popover-border: 0 0% 90%;\n  --primary: 217 91% 35%;\n  --primary-foreground: 217 91% 98%;\n  --secondary: 217 8% 90%;\n  --secondary-foreground: 217 8% 15%;\n  --muted: 217 10% 92%;\n  --muted-foreground: 217 10% 35%;\n  --accent: 217 12% 90%;\n  --accent-foreground: 217 12% 15%;\n  --destructive: 0 84% 42%;\n  --destructive-foreground: 0 84% 98%;\n  --input: 0 0% 75%;\n  --ring: 217 91% 35%;\n  --chart-1: 217 91% 35%;\n  --chart-2: 142 76% 36%;\n  --chart-3: 27 87% 45%;\n  --chart-4: 280 65% 40%;\n  --chart-5: 340 82% 45%;\n  --font-sans: Inter, sans-serif;\n  --font-serif: Georgia, serif;\n  --font-mono: JetBrains Mono, monospace;\n  --radius: .5rem;\n  --shadow-2xs: 0px 2px 0px 0px hsl(0 0% 0% / 0.00);\n  --shadow-xs: 0px 2px 0px 0px hsl(0 0% 0% / 0.00);\n  --shadow-sm: 0px 2px 0px 0px hsl(0 0% 0% / 0.00), 0px 1px 2px -1px hsl(0 0% 0% / 0.00);\n  --shadow: 0px 2px 0px 0px hsl(0 0% 0% / 0.00), 0px 1px 2px -1px hsl(0 0% 0% / 0.00);\n  --shadow-md: 0px 2px 0px 0px hsl(0 0% 0% / 0.00), 0px 2px 4px -1px hsl(0 0% 0% / 0.00);\n  --shadow-lg: 0px 2px 0px 0px hsl(0 0% 0% / 0.00), 0px 4px 6px -1px hsl(0 0% 0% / 0.00);\n  --shadow-xl: 0px 2px 0px 0px hsl(0 0% 0% / 0.00), 0px 8px 10px -1px hsl(0 0% 0% / 0.00);\n  --shadow-2xl: 0px 2px 0px 0px hsl(0 0% 0% / 0.00);\n  --tracking-normal: 0em;\n  --spacing: 0.25rem;\n\n/* Fallback for older browsers */\n  --sidebar-primary-border: hsl(var(--sidebar-primary));\n  --sidebar-primary-border: hsl(from hsl(var(--sidebar-primary)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --sidebar-accent-border: hsl(var(--sidebar-accent));\n  --sidebar-accent-border: hsl(from hsl(var(--sidebar-accent)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --primary-border: hsl(var(--primary));\n  --primary-border: hsl(from hsl(var(--primary)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --secondary-border: hsl(var(--secondary));\n  --secondary-border: hsl(from hsl(var(--secondary)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --muted-border: hsl(var(--muted));\n  --muted-border: hsl(from hsl(var(--muted)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --accent-border: hsl(var(--accent));\n  --accent-border: hsl(from hsl(var(--accent)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --destructive-border: hsl(var(--destructive));\n  --destructive-border: hsl(from hsl(var(--destructive)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n}\n\n.dark {\n  --button-outline: rgba(255,255,255, .10);\n  --badge-outline: rgba(255,255,255, .05);\n  --opaque-button-border-intensity: 9;\n  --elevate-1: rgba(255,255,255, .04);\n  --elevate-2: rgba(255,255,255, .09);\n  --background: 0 0% 8%;\n  --foreground: 0 0% 95%;\n  --border: 0 0% 16%;\n  --card: 0 0% 10%;\n  --card-foreground: 0 0% 95%;\n  --card-border: 0 0% 14%;\n  --sidebar: 0 0% 12%;\n  --sidebar-foreground: 0 0% 95%;\n  --sidebar-border: 0 0% 16%;\n  --sidebar-primary: 217 91% 45%;\n  --sidebar-primary-foreground: 217 91% 98%;\n  --sidebar-accent: 217 15% 18%;\n  --sidebar-accent-foreground: 217 15% 90%;\n  --sidebar-ring: 217 91% 45%;\n  --popover: 0 0% 14%;\n  --popover-foreground: 0 0% 95%;\n  --popover-border: 0 0% 18%;\n  --primary: 217 91% 35%;\n  --primary-foreground: 217 91% 98%;\n  --muted: 217 10% 16%;\n  --muted-foreground: 217 10% 70%;\n  --secondary: 217 8% 18%;\n  --secondary-foreground: 217 8% 90%;\n  --accent: 217 12% 16%;\n  --accent-foreground: 217 12% 90%;\n  --destructive: 0 84% 35%;\n  --destructive-foreground: 0 84% 98%;\n  --input: 0 0% 30%;\n  --ring: 217 91% 45%;\n  --chart-1: 217 91% 65%;\n  --chart-2: 142 76% 60%;\n  --chart-3: 27 87% 65%;\n  --chart-4: 280 65% 65%;\n  --chart-5: 340 82% 65%;\n  --shadow-2xs: 0px 2px 0px 0px hsl(0 0% 0% / 0.00);\n  --shadow-xs: 0px 2px 0px 0px hsl(0 0% 0% / 0.00);\n  --shadow-sm: 0px 2px 0px 0px hsl(0 0% 0% / 0.00), 0px 1px 2px -1px hsl(0 0% 0% / 0.00);\n  --shadow: 0px 2px 0px 0px hsl(0 0% 0% / 0.00), 0px 1px 2px -1px hsl(0 0% 0% / 0.00);\n  --shadow-md: 0px 2px 0px 0px hsl(0 0% 0% / 0.00), 0px 2px 4px -1px hsl(0 0% 0% / 0.00);\n  --shadow-lg: 0px 2px 0px 0px hsl(0 0% 0% / 0.00), 0px 4px 6px -1px hsl(0 0% 0% / 0.00);\n  --shadow-xl: 0px 2px 0px 0px hsl(0 0% 0% / 0.00), 0px 8px 10px -1px hsl(0 0% 0% / 0.00);\n  --shadow-2xl: 0px 2px 0px 0px hsl(0 0% 0% / 0.00);\n\n/* Fallback for older browsers */\n  --sidebar-primary-border: hsl(var(--sidebar-primary));\n  --sidebar-primary-border: hsl(from hsl(var(--sidebar-primary)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --sidebar-accent-border: hsl(var(--sidebar-accent));\n  --sidebar-accent-border: hsl(from hsl(var(--sidebar-accent)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --primary-border: hsl(var(--primary));\n  --primary-border: hsl(from hsl(var(--primary)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --secondary-border: hsl(var(--secondary));\n  --secondary-border: hsl(from hsl(var(--secondary)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --muted-border: hsl(var(--muted));\n  --muted-border: hsl(from hsl(var(--muted)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --accent-border: hsl(var(--accent));\n  --accent-border: hsl(from hsl(var(--accent)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --destructive-border: hsl(var(--destructive));\n  --destructive-border: hsl(from hsl(var(--destructive)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n}\n\n@layer base {\n  * {\n    @apply border-border;\n  }\n\n  body {\n    @apply font-sans antialiased bg-background text-foreground;\n  }\n}\n\n/**\n * Using the elevate system.\n * Automatic contrast adjustment.\n *\n * <element className=\"hover-elevate\" />\n * <element className=\"active-elevate-2\" />\n *\n * // Using the tailwind utility when a data attribute is \"on\"\n * <element className=\"toggle-elevate data-[state=on]:toggle-elevated\" />\n * // Or manually controlling the toggle state\n * <element className=\"toggle-elevate toggle-elevated\" />\n *\n * Elevation systems have to handle many states.\n * - not-hovered, vs. hovered vs. active  (three mutually exclusive states)\n * - toggled or not\n * - focused or not (this is not handled with these utilities)\n *\n * Even without handling focused or not, this is six possible combinations that\n * need to be distinguished from eachother visually.\n */\n@layer utilities {\n\n  /* Hide ugly search cancel button in Chrome until we can style it properly */\n  input[type=\"search\"]::-webkit-search-cancel-button {\n    @apply hidden;\n  }\n\n  /* Placeholder styling for contentEditable div */\n  [contenteditable][data-placeholder]:empty::before {\n    content: attr(data-placeholder);\n    color: hsl(var(--muted-foreground));\n    pointer-events: none;\n  }\n\n  /* .no-default-hover-elevate/no-default-active-elevate is an escape hatch so consumers of\n   * buttons/badges can remove the automatic brightness adjustment on interactions\n   * and program their own. */\n  .no-default-hover-elevate {}\n\n  .no-default-active-elevate {}\n\n\n  /**\n   * Toggleable backgrounds go behind the content. Hoverable/active goes on top.\n   * This way they can stack/compound. Both will overlap the parent's borders!\n   * So borders will be automatically adjusted both on toggle, and hover/active,\n   * and they will be compounded.\n   */\n  .toggle-elevate::before,\n  .toggle-elevate-2::before {\n    content: \"\";\n    pointer-events: none;\n    position: absolute;\n    inset: 0px;\n    /*border-radius: inherit;   match rounded corners */\n    border-radius: inherit;\n    z-index: -1;\n    /* sits behind content but above backdrop */\n  }\n\n  .toggle-elevate.toggle-elevated::before {\n    background-color: var(--elevate-2);\n  }\n\n  /* If there's a 1px border, adjust the inset so that it covers that parent's border */\n  .border.toggle-elevate::before {\n    inset: -1px;\n  }\n\n  /* Does not work on elements with overflow:hidden! */\n  .hover-elevate:not(.no-default-hover-elevate),\n  .active-elevate:not(.no-default-active-elevate),\n  .hover-elevate-2:not(.no-default-hover-elevate),\n  .active-elevate-2:not(.no-default-active-elevate) {\n    position: relative;\n    z-index: 0;\n  }\n\n  .hover-elevate:not(.no-default-hover-elevate)::after,\n  .active-elevate:not(.no-default-active-elevate)::after,\n  .hover-elevate-2:not(.no-default-hover-elevate)::after,\n  .active-elevate-2:not(.no-default-active-elevate)::after {\n    content: \"\";\n    pointer-events: none;\n    position: absolute;\n    inset: 0px;\n    /*border-radius: inherit;   match rounded corners */\n    border-radius: inherit;\n    z-index: 999;\n    /* sits in front of content */\n  }\n\n  .hover-elevate:hover:not(.no-default-hover-elevate)::after,\n  .active-elevate:active:not(.no-default-active-elevate)::after {\n    background-color: var(--elevate-1);\n  }\n\n  .hover-elevate-2:hover:not(.no-default-hover-elevate)::after,\n  .active-elevate-2:active:not(.no-default-active-elevate)::after {\n    background-color: var(--elevate-2);\n  }\n\n  /* If there's a 1px border, adjust the inset so that it covers that parent's border */\n  .border.hover-elevate:not(.no-hover-interaction-elevate)::after,\n  .border.active-elevate:not(.no-active-interaction-elevate)::after,\n  .border.hover-elevate-2:not(.no-hover-interaction-elevate)::after,\n  .border.active-elevate-2:not(.no-active-interaction-elevate)::after,\n  .border.hover-elevate:not(.no-hover-interaction-elevate)::after {\n    inset: -1px;\n  }\n}\n","path":null,"size_bytes":10596,"size_tokens":null},"client/src/components/ui/pagination.tsx":{"content":"import * as React from \"react\"\nimport { ChevronLeft, ChevronRight, MoreHorizontal } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { ButtonProps, buttonVariants } from \"@/components/ui/button\"\n\nconst Pagination = ({ className, ...props }: React.ComponentProps<\"nav\">) => (\n  <nav\n    role=\"navigation\"\n    aria-label=\"pagination\"\n    className={cn(\"mx-auto flex w-full justify-center\", className)}\n    {...props}\n  />\n)\nPagination.displayName = \"Pagination\"\n\nconst PaginationContent = React.forwardRef<\n  HTMLUListElement,\n  React.ComponentProps<\"ul\">\n>(({ className, ...props }, ref) => (\n  <ul\n    ref={ref}\n    className={cn(\"flex flex-row items-center gap-1\", className)}\n    {...props}\n  />\n))\nPaginationContent.displayName = \"PaginationContent\"\n\nconst PaginationItem = React.forwardRef<\n  HTMLLIElement,\n  React.ComponentProps<\"li\">\n>(({ className, ...props }, ref) => (\n  <li ref={ref} className={cn(\"\", className)} {...props} />\n))\nPaginationItem.displayName = \"PaginationItem\"\n\ntype PaginationLinkProps = {\n  isActive?: boolean\n} & Pick<ButtonProps, \"size\"> &\n  React.ComponentProps<\"a\">\n\nconst PaginationLink = ({\n  className,\n  isActive,\n  size = \"icon\",\n  ...props\n}: PaginationLinkProps) => (\n  <a\n    aria-current={isActive ? \"page\" : undefined}\n    className={cn(\n      buttonVariants({\n        variant: isActive ? \"outline\" : \"ghost\",\n        size,\n      }),\n      className\n    )}\n    {...props}\n  />\n)\nPaginationLink.displayName = \"PaginationLink\"\n\nconst PaginationPrevious = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof PaginationLink>) => (\n  <PaginationLink\n    aria-label=\"Go to previous page\"\n    size=\"default\"\n    className={cn(\"gap-1 pl-2.5\", className)}\n    {...props}\n  >\n    <ChevronLeft className=\"h-4 w-4\" />\n    <span>Previous</span>\n  </PaginationLink>\n)\nPaginationPrevious.displayName = \"PaginationPrevious\"\n\nconst PaginationNext = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof PaginationLink>) => (\n  <PaginationLink\n    aria-label=\"Go to next page\"\n    size=\"default\"\n    className={cn(\"gap-1 pr-2.5\", className)}\n    {...props}\n  >\n    <span>Next</span>\n    <ChevronRight className=\"h-4 w-4\" />\n  </PaginationLink>\n)\nPaginationNext.displayName = \"PaginationNext\"\n\nconst PaginationEllipsis = ({\n  className,\n  ...props\n}: React.ComponentProps<\"span\">) => (\n  <span\n    aria-hidden\n    className={cn(\"flex h-9 w-9 items-center justify-center\", className)}\n    {...props}\n  >\n    <MoreHorizontal className=\"h-4 w-4\" />\n    <span className=\"sr-only\">More pages</span>\n  </span>\n)\nPaginationEllipsis.displayName = \"PaginationEllipsis\"\n\nexport {\n  Pagination,\n  PaginationContent,\n  PaginationEllipsis,\n  PaginationItem,\n  PaginationLink,\n  PaginationNext,\n  PaginationPrevious,\n}\n","path":null,"size_bytes":2751,"size_tokens":null},"client/src/components/ui/alert-dialog.tsx":{"content":"import * as React from \"react\"\nimport * as AlertDialogPrimitive from \"@radix-ui/react-alert-dialog\"\n\nimport { cn } from \"@/lib/utils\"\nimport { buttonVariants } from \"@/components/ui/button\"\n\nconst AlertDialog = AlertDialogPrimitive.Root\n\nconst AlertDialogTrigger = AlertDialogPrimitive.Trigger\n\nconst AlertDialogPortal = AlertDialogPrimitive.Portal\n\nconst AlertDialogOverlay = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Overlay\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  />\n))\nAlertDialogOverlay.displayName = AlertDialogPrimitive.Overlay.displayName\n\nconst AlertDialogContent = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPortal>\n    <AlertDialogOverlay />\n    <AlertDialogPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg\",\n        className\n      )}\n      {...props}\n    />\n  </AlertDialogPortal>\n))\nAlertDialogContent.displayName = AlertDialogPrimitive.Content.displayName\n\nconst AlertDialogHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-2 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nAlertDialogHeader.displayName = \"AlertDialogHeader\"\n\nconst AlertDialogFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nAlertDialogFooter.displayName = \"AlertDialogFooter\"\n\nconst AlertDialogTitle = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Title\n    ref={ref}\n    className={cn(\"text-lg font-semibold\", className)}\n    {...props}\n  />\n))\nAlertDialogTitle.displayName = AlertDialogPrimitive.Title.displayName\n\nconst AlertDialogDescription = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nAlertDialogDescription.displayName =\n  AlertDialogPrimitive.Description.displayName\n\nconst AlertDialogAction = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Action>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Action>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Action\n    ref={ref}\n    className={cn(buttonVariants(), className)}\n    {...props}\n  />\n))\nAlertDialogAction.displayName = AlertDialogPrimitive.Action.displayName\n\nconst AlertDialogCancel = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Cancel>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Cancel>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Cancel\n    ref={ref}\n    className={cn(\n      buttonVariants({ variant: \"outline\" }),\n      \"mt-2 sm:mt-0\",\n      className\n    )}\n    {...props}\n  />\n))\nAlertDialogCancel.displayName = AlertDialogPrimitive.Cancel.displayName\n\nexport {\n  AlertDialog,\n  AlertDialogPortal,\n  AlertDialogOverlay,\n  AlertDialogTrigger,\n  AlertDialogContent,\n  AlertDialogHeader,\n  AlertDialogFooter,\n  AlertDialogTitle,\n  AlertDialogDescription,\n  AlertDialogAction,\n  AlertDialogCancel,\n}\n","path":null,"size_bytes":4420,"size_tokens":null},"client/src/pages/assignments.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { format } from \"date-fns\";\nimport { Plus, UserPlus, Trash2, Search, Send, Check, X, Link, Copy, MessageSquare } from \"lucide-react\";\nimport { Card, CardContent, CardHeader, CardTitle, CardDescription } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Avatar, AvatarFallback } from \"@/components/ui/avatar\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogDescription,\n  DialogFooter,\n  DialogHeader,\n  DialogTitle,\n} from \"@/components/ui/dialog\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport {\n  AlertDialog,\n  AlertDialogAction,\n  AlertDialogCancel,\n  AlertDialogContent,\n  AlertDialogDescription,\n  AlertDialogFooter,\n  AlertDialogHeader,\n  AlertDialogTitle,\n} from \"@/components/ui/alert-dialog\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { queryClient, apiRequest } from \"@/lib/queryClient\";\nimport { StatusBadge } from \"@/components/status-badge\";\nimport { EmptyState } from \"@/components/empty-state\";\nimport type { Project, Expert, ProjectExpert, InsertProjectExpert, ExpertInvitationLink } from \"@shared/schema\";\n\nexport default function Assignments() {\n  const { toast } = useToast();\n  const [selectedProjectId, setSelectedProjectId] = useState<number | null>(null);\n  const [isDialogOpen, setIsDialogOpen] = useState(false);\n  const [isInviteLinkDialogOpen, setIsInviteLinkDialogOpen] = useState(false);\n  const [searchQuery, setSearchQuery] = useState(\"\");\n  const [removingAssignment, setRemovingAssignment] = useState<ProjectExpert | null>(null);\n  const [notes, setNotes] = useState(\"\");\n  const [selectedExpertId, setSelectedExpertId] = useState<number | null>(null);\n  const [newInviteLink, setNewInviteLink] = useState<string | null>(null);\n\n  const { data: projects, isLoading: projectsLoading } = useQuery<Project[]>({\n    queryKey: [\"/api/projects\"],\n  });\n\n  const { data: experts, isLoading: expertsLoading } = useQuery<Expert[]>({\n    queryKey: [\"/api/experts\"],\n  });\n\n  const { data: assignments, isLoading: assignmentsLoading } = useQuery<ProjectExpert[]>({\n    queryKey: [\"/api/project-experts\"],\n  });\n\n  const { data: invitationLinks } = useQuery<ExpertInvitationLink[]>({\n    queryKey: [\"/api/invitation-links\"],\n  });\n\n  const assignMutation = useMutation({\n    mutationFn: (data: InsertProjectExpert) =>\n      apiRequest(\"POST\", \"/api/project-experts\", data),\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/project-experts\"] });\n      setIsDialogOpen(false);\n      setNotes(\"\");\n      setSelectedExpertId(null);\n      toast({ title: \"Expert assigned successfully\" });\n    },\n    onError: () => {\n      toast({ title: \"Failed to assign expert\", variant: \"destructive\" });\n    },\n  });\n\n  const inviteMutation = useMutation({\n    mutationFn: (id: number) => apiRequest(\"POST\", `/api/project-experts/${id}/invite`),\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/project-experts\"] });\n      toast({ title: \"Invitation sent successfully\" });\n    },\n    onError: () => {\n      toast({ title: \"Failed to send invitation\", variant: \"destructive\" });\n    },\n  });\n\n  const selectMutation = useMutation({\n    mutationFn: (id: number) => apiRequest(\"POST\", `/api/project-experts/${id}/select`),\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/project-experts\"] });\n      toast({ title: \"Expert marked as client selected\" });\n    },\n    onError: () => {\n      toast({ title: \"Failed to select expert\", variant: \"destructive\" });\n    },\n  });\n\n  const removeMutation = useMutation({\n    mutationFn: (id: number) => apiRequest(\"DELETE\", `/api/project-experts/${id}`),\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/project-experts\"] });\n      setRemovingAssignment(null);\n      toast({ title: \"Expert removed from project\" });\n    },\n    onError: () => {\n      toast({ title: \"Failed to remove expert\", variant: \"destructive\" });\n    },\n  });\n\n  const createInviteLinkMutation = useMutation({\n    mutationFn: async (data: { projectId?: number; recruitedBy: string }) => {\n      const res = await apiRequest(\"POST\", \"/api/invitation-links\", data);\n      return res.json() as Promise<ExpertInvitationLink>;\n    },\n    onSuccess: (data) => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/invitation-links\"] });\n      const baseUrl = typeof window !== \"undefined\" ? window.location.origin : \"\";\n      setNewInviteLink(`${baseUrl}/register/${data.token}`);\n      toast({ title: \"Invitation link created\" });\n    },\n    onError: () => {\n      toast({ title: \"Failed to create invitation link\", variant: \"destructive\" });\n    },\n  });\n\n  const selectedProject = projects?.find((p) => p.id === selectedProjectId);\n  const projectAssignments = assignments?.filter((a) => a.projectId === selectedProjectId);\n  const assignedExpertIds = new Set(projectAssignments?.map((a) => a.expertId));\n\n  const availableExperts = experts?.filter(\n    (e) =>\n      !assignedExpertIds.has(e.id) &&\n      (e.name.toLowerCase().includes(searchQuery.toLowerCase()) ||\n        e.expertise.toLowerCase().includes(searchQuery.toLowerCase()))\n  );\n\n  const getExpert = (expertId: number) => experts?.find((e) => e.id === expertId);\n\n  const getInitials = (name: string) => {\n    return name\n      .split(\" \")\n      .map((n) => n[0])\n      .join(\"\")\n      .toUpperCase()\n      .slice(0, 2);\n  };\n\n  const handleAssign = () => {\n    if (!selectedProjectId || !selectedExpertId) return;\n    assignMutation.mutate({\n      projectId: selectedProjectId,\n      expertId: selectedExpertId,\n      status: \"assigned\",\n      notes: notes || null,\n    });\n  };\n\n  const handleCreateInviteLink = () => {\n    createInviteLinkMutation.mutate({\n      projectId: selectedProjectId || undefined,\n      recruitedBy: \"pm@mirae.com\",\n    });\n  };\n\n  const copyToClipboard = (text: string) => {\n    navigator.clipboard.writeText(text);\n    toast({ title: \"Link copied to clipboard\" });\n  };\n\n  const isLoading = projectsLoading || expertsLoading || assignmentsLoading;\n\n  const assignedCount = projectAssignments?.filter(a => a.status === \"assigned\").length || 0;\n  const invitedCount = projectAssignments?.filter(a => a.status === \"invited\").length || 0;\n  const acceptedCount = projectAssignments?.filter(a => a.status === \"accepted\").length || 0;\n  const selectedCount = projectAssignments?.filter(a => a.status === \"client_selected\").length || 0;\n\n  return (\n    <div className=\"space-y-6 p-8\">\n      <div className=\"flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between\">\n        <div>\n          <h1 className=\"text-3xl font-semibold text-foreground\">Expert Assignments</h1>\n          <p className=\"text-sm text-muted-foreground\">\n            Manage expert assignments and invitations for projects.\n          </p>\n        </div>\n        <Button \n          onClick={() => setIsInviteLinkDialogOpen(true)} \n          variant=\"outline\" \n          className=\"gap-2\"\n          data-testid=\"button-create-invite-link\"\n        >\n          <Link className=\"h-4 w-4\" /> Create Invite Link\n        </Button>\n      </div>\n\n      <div className=\"flex items-center gap-4\">\n        <Select\n          value={selectedProjectId?.toString() || \"\"}\n          onValueChange={(val) => setSelectedProjectId(val ? Number(val) : null)}\n        >\n          <SelectTrigger className=\"w-72\" data-testid=\"select-assignment-project\">\n            <SelectValue placeholder=\"Select a project to manage\" />\n          </SelectTrigger>\n          <SelectContent>\n            {projects?.map((project) => (\n              <SelectItem key={project.id} value={project.id.toString()}>\n                {project.name}\n              </SelectItem>\n            ))}\n          </SelectContent>\n        </Select>\n      </div>\n\n      {isLoading ? (\n        <div className=\"grid gap-6 lg:grid-cols-2\">\n          <Card>\n            <CardContent className=\"p-6\">\n              <Skeleton className=\"h-48 w-full\" />\n            </CardContent>\n          </Card>\n          <Card>\n            <CardContent className=\"p-6\">\n              <Skeleton className=\"h-48 w-full\" />\n            </CardContent>\n          </Card>\n        </div>\n      ) : !selectedProjectId ? (\n        <EmptyState\n          icon={UserPlus}\n          title=\"Select a project\"\n          description=\"Choose a project from the dropdown to manage expert assignments.\"\n        />\n      ) : (\n        <>\n          <div className=\"grid gap-4 sm:grid-cols-4\">\n            <Card>\n              <CardContent className=\"pt-6\">\n                <div className=\"text-2xl font-bold\">{assignedCount}</div>\n                <p className=\"text-xs text-muted-foreground\">Assigned</p>\n              </CardContent>\n            </Card>\n            <Card>\n              <CardContent className=\"pt-6\">\n                <div className=\"text-2xl font-bold\">{invitedCount}</div>\n                <p className=\"text-xs text-muted-foreground\">Invited</p>\n              </CardContent>\n            </Card>\n            <Card>\n              <CardContent className=\"pt-6\">\n                <div className=\"text-2xl font-bold\">{acceptedCount}</div>\n                <p className=\"text-xs text-muted-foreground\">Accepted</p>\n              </CardContent>\n            </Card>\n            <Card>\n              <CardContent className=\"pt-6\">\n                <div className=\"text-2xl font-bold\">{selectedCount}</div>\n                <p className=\"text-xs text-muted-foreground\">Client Selected</p>\n              </CardContent>\n            </Card>\n          </div>\n\n          <div className=\"grid gap-6 lg:grid-cols-2\">\n            <Card>\n              <CardHeader className=\"flex flex-row items-center justify-between gap-4 space-y-0 pb-4\">\n                <div>\n                  <CardTitle className=\"text-base font-medium\">Assigned Experts</CardTitle>\n                  <CardDescription>Manage expert invitations and status</CardDescription>\n                </div>\n                <Badge variant=\"secondary\" className=\"no-default-hover-elevate no-default-active-elevate\">\n                  {projectAssignments?.length || 0} total\n                </Badge>\n              </CardHeader>\n              <CardContent>\n                {!projectAssignments?.length ? (\n                  <EmptyState\n                    icon={UserPlus}\n                    title=\"No experts assigned\"\n                    description=\"Add experts from the available pool.\"\n                  />\n                ) : (\n                  <div className=\"space-y-3\">\n                    {projectAssignments.map((assignment) => {\n                      const expert = getExpert(assignment.expertId);\n                      if (!expert) return null;\n                      return (\n                        <div\n                          key={assignment.id}\n                          className=\"flex flex-col gap-3 rounded-lg border border-border bg-background p-4\"\n                          data-testid={`assigned-expert-${expert.id}`}\n                        >\n                          <div className=\"flex items-center justify-between gap-4\">\n                            <div className=\"flex items-center gap-3\">\n                              <Avatar className=\"h-10 w-10 border border-border\">\n                                <AvatarFallback className=\"bg-primary/10 text-primary\">\n                                  {getInitials(expert.name)}\n                                </AvatarFallback>\n                              </Avatar>\n                              <div>\n                                <p className=\"font-medium\">{expert.name}</p>\n                                <p className=\"text-sm text-muted-foreground\">{expert.expertise}</p>\n                              </div>\n                            </div>\n                            <StatusBadge status={assignment.status} type=\"assignment\" />\n                          </div>\n                          \n                          {assignment.availabilityNote && (\n                            <div className=\"flex items-start gap-2 rounded bg-muted/50 p-2 text-sm\">\n                              <MessageSquare className=\"mt-0.5 h-4 w-4 text-muted-foreground\" />\n                              <span>{assignment.availabilityNote}</span>\n                            </div>\n                          )}\n\n                          <div className=\"flex flex-wrap gap-2\">\n                            {assignment.status === \"assigned\" && (\n                              <Button\n                                size=\"sm\"\n                                variant=\"outline\"\n                                onClick={() => inviteMutation.mutate(assignment.id)}\n                                disabled={inviteMutation.isPending}\n                                className=\"gap-1\"\n                                data-testid={`button-invite-${expert.id}`}\n                              >\n                                <Send className=\"h-3 w-3\" /> Send Invite\n                              </Button>\n                            )}\n                            {assignment.status === \"accepted\" && (\n                              <Button\n                                size=\"sm\"\n                                onClick={() => selectMutation.mutate(assignment.id)}\n                                disabled={selectMutation.isPending}\n                                className=\"gap-1\"\n                                data-testid={`button-select-${expert.id}`}\n                              >\n                                <Check className=\"h-3 w-3\" /> Mark Client Selected\n                              </Button>\n                            )}\n                            <Button\n                              variant=\"ghost\"\n                              size=\"sm\"\n                              onClick={() => setRemovingAssignment(assignment)}\n                              className=\"text-destructive\"\n                              data-testid={`button-remove-expert-${expert.id}`}\n                            >\n                              <Trash2 className=\"h-3 w-3\" />\n                            </Button>\n                          </div>\n                        </div>\n                      );\n                    })}\n                  </div>\n                )}\n              </CardContent>\n            </Card>\n\n            <Card>\n              <CardHeader className=\"flex flex-row items-center justify-between gap-4 space-y-0 pb-4\">\n                <div>\n                  <CardTitle className=\"text-base font-medium\">Available Experts</CardTitle>\n                  <CardDescription>Add experts to this project</CardDescription>\n                </div>\n                <Badge variant=\"secondary\" className=\"no-default-hover-elevate no-default-active-elevate\">\n                  {availableExperts?.length || 0} available\n                </Badge>\n              </CardHeader>\n              <CardContent>\n                <div className=\"mb-4\">\n                  <div className=\"relative\">\n                    <Search className=\"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground\" />\n                    <Input\n                      placeholder=\"Search experts...\"\n                      value={searchQuery}\n                      onChange={(e) => setSearchQuery(e.target.value)}\n                      className=\"pl-9\"\n                      data-testid=\"input-search-available-experts\"\n                    />\n                  </div>\n                </div>\n                {!availableExperts?.length ? (\n                  <EmptyState\n                    icon={UserPlus}\n                    title={searchQuery ? \"No experts found\" : \"All experts assigned\"}\n                    description={\n                      searchQuery\n                        ? \"Try adjusting your search.\"\n                        : \"All available experts are already assigned to this project.\"\n                    }\n                  />\n                ) : (\n                  <div className=\"space-y-3\">\n                    {availableExperts.map((expert) => (\n                      <div\n                        key={expert.id}\n                        className=\"flex items-center justify-between gap-4 rounded-lg border border-border bg-background p-4 hover-elevate\"\n                        data-testid={`available-expert-${expert.id}`}\n                      >\n                        <div className=\"flex items-center gap-3\">\n                          <Avatar className=\"h-10 w-10 border border-border\">\n                            <AvatarFallback className=\"bg-muted\">\n                              {getInitials(expert.name)}\n                            </AvatarFallback>\n                          </Avatar>\n                          <div>\n                            <p className=\"font-medium\">{expert.name}</p>\n                            <div className=\"flex items-center gap-2 text-sm text-muted-foreground\">\n                              <span>{expert.expertise}</span>\n                              <span className=\"text-muted-foreground\"></span>\n                              <StatusBadge status={expert.status} type=\"expert\" />\n                            </div>\n                          </div>\n                        </div>\n                        <Button\n                          size=\"sm\"\n                          onClick={() => {\n                            setSelectedExpertId(expert.id);\n                            setIsDialogOpen(true);\n                          }}\n                          disabled={assignMutation.isPending}\n                          className=\"gap-1\"\n                          data-testid={`button-assign-expert-${expert.id}`}\n                        >\n                          <Plus className=\"h-4 w-4\" /> Assign\n                        </Button>\n                      </div>\n                    ))}\n                  </div>\n                )}\n              </CardContent>\n            </Card>\n          </div>\n        </>\n      )}\n\n      <Dialog open={isDialogOpen} onOpenChange={setIsDialogOpen}>\n        <DialogContent className=\"max-w-lg\">\n          <DialogHeader>\n            <DialogTitle>Assign Expert to Project</DialogTitle>\n            <DialogDescription>\n              Add notes about this assignment for \"{selectedProject?.name}\".\n            </DialogDescription>\n          </DialogHeader>\n          <div className=\"space-y-4\">\n            {selectedExpertId && (\n              <div className=\"flex items-center gap-3 rounded-lg border p-3\">\n                <Avatar className=\"h-10 w-10\">\n                  <AvatarFallback className=\"bg-primary/10 text-primary\">\n                    {getInitials(getExpert(selectedExpertId)?.name || \"\")}\n                  </AvatarFallback>\n                </Avatar>\n                <div>\n                  <p className=\"font-medium\">{getExpert(selectedExpertId)?.name}</p>\n                  <p className=\"text-sm text-muted-foreground\">{getExpert(selectedExpertId)?.expertise}</p>\n                </div>\n              </div>\n            )}\n            <div className=\"space-y-2\">\n              <label className=\"text-sm font-medium\">Assignment Notes (optional)</label>\n              <Textarea\n                placeholder=\"Add any notes about this assignment...\"\n                value={notes}\n                onChange={(e) => setNotes(e.target.value)}\n                className=\"resize-none\"\n                rows={3}\n                data-testid=\"input-assignment-notes\"\n              />\n            </div>\n          </div>\n          <DialogFooter>\n            <Button\n              variant=\"outline\"\n              onClick={() => {\n                setIsDialogOpen(false);\n                setSelectedExpertId(null);\n                setNotes(\"\");\n              }}\n              data-testid=\"button-cancel-assign\"\n            >\n              Cancel\n            </Button>\n            <Button\n              onClick={handleAssign}\n              disabled={assignMutation.isPending}\n              data-testid=\"button-confirm-assign\"\n            >\n              {assignMutation.isPending ? \"Assigning...\" : \"Assign Expert\"}\n            </Button>\n          </DialogFooter>\n        </DialogContent>\n      </Dialog>\n\n      <Dialog open={isInviteLinkDialogOpen} onOpenChange={setIsInviteLinkDialogOpen}>\n        <DialogContent className=\"max-w-lg\">\n          <DialogHeader>\n            <DialogTitle>Create Expert Invitation Link</DialogTitle>\n            <DialogDescription>\n              Generate a unique registration link to invite new experts to the platform.\n            </DialogDescription>\n          </DialogHeader>\n          <div className=\"space-y-4\">\n            {newInviteLink ? (\n              <div className=\"space-y-3\">\n                <p className=\"text-sm text-muted-foreground\">\n                  Share this link with the expert to register:\n                </p>\n                <div className=\"flex items-center gap-2\">\n                  <Input value={newInviteLink} readOnly className=\"flex-1 font-mono text-xs\" />\n                  <Button\n                    size=\"icon\"\n                    variant=\"outline\"\n                    onClick={() => copyToClipboard(newInviteLink)}\n                  >\n                    <Copy className=\"h-4 w-4\" />\n                  </Button>\n                </div>\n              </div>\n            ) : (\n              <div className=\"space-y-2\">\n                <p className=\"text-sm text-muted-foreground\">\n                  {selectedProjectId\n                    ? `This link will be associated with \"${selectedProject?.name}\".`\n                    : \"This will create a general invitation link.\"}\n                </p>\n              </div>\n            )}\n          </div>\n          <DialogFooter>\n            <Button\n              variant=\"outline\"\n              onClick={() => {\n                setIsInviteLinkDialogOpen(false);\n                setNewInviteLink(null);\n              }}\n            >\n              Close\n            </Button>\n            {!newInviteLink && (\n              <Button\n                onClick={handleCreateInviteLink}\n                disabled={createInviteLinkMutation.isPending}\n              >\n                {createInviteLinkMutation.isPending ? \"Creating...\" : \"Generate Link\"}\n              </Button>\n            )}\n          </DialogFooter>\n        </DialogContent>\n      </Dialog>\n\n      <AlertDialog open={!!removingAssignment} onOpenChange={() => setRemovingAssignment(null)}>\n        <AlertDialogContent>\n          <AlertDialogHeader>\n            <AlertDialogTitle>Remove Expert</AlertDialogTitle>\n            <AlertDialogDescription>\n              Are you sure you want to remove this expert from the project?\n            </AlertDialogDescription>\n          </AlertDialogHeader>\n          <AlertDialogFooter>\n            <AlertDialogCancel data-testid=\"button-cancel-remove\">Cancel</AlertDialogCancel>\n            <AlertDialogAction\n              onClick={() => removingAssignment && removeMutation.mutate(removingAssignment.id)}\n              className=\"bg-destructive text-destructive-foreground hover:bg-destructive/90\"\n              data-testid=\"button-confirm-remove\"\n            >\n              {removeMutation.isPending ? \"Removing...\" : \"Remove\"}\n            </AlertDialogAction>\n          </AlertDialogFooter>\n        </AlertDialogContent>\n      </AlertDialog>\n    </div>\n  );\n}\n","path":null,"size_bytes":23762,"size_tokens":null},"client/src/components/ui/sheet.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as SheetPrimitive from \"@radix-ui/react-dialog\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Sheet = SheetPrimitive.Root\n\nconst SheetTrigger = SheetPrimitive.Trigger\n\nconst SheetClose = SheetPrimitive.Close\n\nconst SheetPortal = SheetPrimitive.Portal\n\nconst SheetOverlay = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Overlay\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  />\n))\nSheetOverlay.displayName = SheetPrimitive.Overlay.displayName\n\nconst sheetVariants = cva(\n  \"fixed z-50 gap-4 bg-background p-6 shadow-lg transition ease-in-out data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:duration-300 data-[state=open]:duration-500\",\n  {\n    variants: {\n      side: {\n        top: \"inset-x-0 top-0 border-b data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top\",\n        bottom:\n          \"inset-x-0 bottom-0 border-t data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom\",\n        left: \"inset-y-0 left-0 h-full w-3/4 border-r data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left sm:max-w-sm\",\n        right:\n          \"inset-y-0 right-0 h-full w-3/4  border-l data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right sm:max-w-sm\",\n      },\n    },\n    defaultVariants: {\n      side: \"right\",\n    },\n  }\n)\n\ninterface SheetContentProps\n  extends React.ComponentPropsWithoutRef<typeof SheetPrimitive.Content>,\n    VariantProps<typeof sheetVariants> {}\n\nconst SheetContent = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Content>,\n  SheetContentProps\n>(({ side = \"right\", className, children, ...props }, ref) => (\n  <SheetPortal>\n    <SheetOverlay />\n    <SheetPrimitive.Content\n      ref={ref}\n      className={cn(sheetVariants({ side }), className)}\n      {...props}\n    >\n      {children}\n      <SheetPrimitive.Close className=\"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-secondary\">\n        <X className=\"h-4 w-4\" />\n        <span className=\"sr-only\">Close</span>\n      </SheetPrimitive.Close>\n    </SheetPrimitive.Content>\n  </SheetPortal>\n))\nSheetContent.displayName = SheetPrimitive.Content.displayName\n\nconst SheetHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-2 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nSheetHeader.displayName = \"SheetHeader\"\n\nconst SheetFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nSheetFooter.displayName = \"SheetFooter\"\n\nconst SheetTitle = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Title\n    ref={ref}\n    className={cn(\"text-lg font-semibold text-foreground\", className)}\n    {...props}\n  />\n))\nSheetTitle.displayName = SheetPrimitive.Title.displayName\n\nconst SheetDescription = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nSheetDescription.displayName = SheetPrimitive.Description.displayName\n\nexport {\n  Sheet,\n  SheetPortal,\n  SheetOverlay,\n  SheetTrigger,\n  SheetClose,\n  SheetContent,\n  SheetHeader,\n  SheetFooter,\n  SheetTitle,\n  SheetDescription,\n}\n","path":null,"size_bytes":4281,"size_tokens":null},"design_guidelines.md":{"content":"# Design Guidelines: Mirae Connext Expert Network Platform\n\n## Design Approach\n**Reference-Based: Linear + Notion Hybrid**\nDrawing inspiration from Linear's precision and Notion's approachability to create a professional B2B SaaS experience. Clean, functional, and efficient without unnecessary visual flourish.\n\n## Typography\n- **Primary Font:** Inter (Google Fonts)\n- **Secondary Font:** JetBrains Mono (for IDs, codes, metrics)\n\n**Hierarchy:**\n- Page Titles: text-3xl font-semibold\n- Section Headers: text-xl font-medium\n- Card Titles: text-base font-medium\n- Body Text: text-sm font-normal\n- Labels: text-xs font-medium uppercase tracking-wide\n- Table Headers: text-xs font-semibold uppercase\n- Metrics/Numbers: text-2xl font-bold (JetBrains Mono)\n\n## Layout System\n**Spacing Primitives:** Use Tailwind units of 2, 4, 6, 8, and 12\n- Component padding: p-6\n- Card spacing: space-y-4\n- Section margins: mb-8\n- Table cell padding: px-4 py-3\n- Form field gaps: gap-4\n- Page container: px-8 py-6\n\n**Grid Structure:**\n- Main container: max-w-7xl mx-auto\n- Dashboard: 12-column grid (grid-cols-12)\n- Tables: Full-width within containers\n- Forms: max-w-2xl for single-column, grid-cols-2 for multi-column\n\n## Component Library\n\n### Navigation\n- **Top Navigation Bar:** Full-width, fixed, with logo left, navigation center, user profile right\n- **Sidebar Navigation:** Fixed left, 240px wide, collapsible to 60px icon-only\n- Active states with subtle left border accent\n\n### Data Tables\n- Striped rows for readability (alternate row background)\n- Sticky header on scroll\n- Row hover states\n- Action buttons (Edit/Delete/View) aligned right\n- Status badges with rounded-full design\n- Pagination controls at bottom\n- Search and filter controls above table\n\n### Forms\n- Two-column layout for registration/profile forms\n- Single-column for short forms (vetting questions)\n- Input fields with subtle border, focus ring on interaction\n- Required field indicators (asterisk)\n- Helper text below inputs (text-xs)\n- Submit buttons aligned right\n\n### Cards\n- Subtle border with rounded-lg corners\n- Minimal shadow (shadow-sm)\n- Header with icon and title\n- Body with consistent p-6 padding\n- Footer for actions when needed\n\n### Buttons\n- Primary: Solid fill for main actions\n- Secondary: Outlined for secondary actions  \n- Tertiary: Ghost/text-only for low-priority actions\n- Icon buttons: Circular for table actions\n- Sizes: Small (px-3 py-2 text-sm), Medium (px-4 py-2 text-base), Large (px-6 py-3 text-lg)\n\n### Modals\n- Centered overlay with backdrop blur\n- max-w-2xl for forms, max-w-md for confirmations\n- Close button top-right\n- Footer with action buttons right-aligned\n\n### Status Indicators\n- Badges: rounded-full px-3 py-1 text-xs font-medium\n- Project Status: Active, Pending, Completed, Archived\n- Expert Status: Available, Busy, Inactive\n- Call Status: Scheduled, In Progress, Completed\n\n### Data Visualization\n- Simple progress bars for CU usage\n- Metric cards with large numbers and trend indicators\n- Clean table layouts for usage history\n\n## Key Pages\n\n### Dashboard\n- Overview metrics in 3-4 card grid at top (grid-cols-4)\n- Recent projects table below\n- Quick actions sidebar on right (if space allows)\n\n### Expert Directory\n- Search bar with filters (expertise, industry, availability)\n- Grid of expert cards (grid-cols-3) with photo, name, specialty, rate\n- Click to expand detailed profile modal\n\n### Project Details\n- Breadcrumb navigation\n- Project info card at top\n- Tabs for: Overview, Vetting Questions, Assigned Experts, Usage Tracker\n- Table within each tab as appropriate\n\n### Vetting Questions\n- Question list with add/edit/delete capabilities\n- Drag handles for reordering\n- Inline editing or modal form for creation\n\n### Assignment Interface\n- Split view: Available experts (left), Assigned experts (right)\n- Transfer buttons between lists\n- Filter/search in both panels\n\n### CU Tracker\n- Summary cards showing total usage, credits remaining\n- Detailed table with columns: Expert, Project, Date, Duration, Credits Used\n- Export button for reports\n\n## Icons\n**Heroicons** (via CDN)\n- Navigation: outline style\n- Actions: solid style at 20px\n- Decorative/illustrative: outline at 24px\n\n## Images\nThis is a B2B dashboard application - no hero images or decorative photography needed. Focus on:\n- Expert profile photos (circular avatars)\n- Company logo in navigation\n- Empty state illustrations (simple, minimalist line art)\n\n## Animations\nMinimal and purposeful:\n- Smooth transitions on hover (transition-colors duration-200)\n- Modal fade-in/scale (duration-300)\n- Loading spinners for data fetching\n- No scroll animations or complex motion","path":null,"size_bytes":4655,"size_tokens":null},"server/static.ts":{"content":"import express, { type Express } from \"express\";\nimport fs from \"fs\";\nimport path from \"path\";\n\nexport function serveStatic(app: Express) {\n  const distPath = path.resolve(__dirname, \"public\");\n  if (!fs.existsSync(distPath)) {\n    throw new Error(\n      `Could not find the build directory: ${distPath}, make sure to build the client first`,\n    );\n  }\n\n  app.use(express.static(distPath));\n\n  // fall through to index.html if the file doesn't exist\n  app.use(\"*\", (_req, res) => {\n    res.sendFile(path.resolve(distPath, \"index.html\"));\n  });\n}\n","path":null,"size_bytes":547,"size_tokens":null},"client/src/components/ui/input-otp.tsx":{"content":"import * as React from \"react\"\nimport { OTPInput, OTPInputContext } from \"input-otp\"\nimport { Dot } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst InputOTP = React.forwardRef<\n  React.ElementRef<typeof OTPInput>,\n  React.ComponentPropsWithoutRef<typeof OTPInput>\n>(({ className, containerClassName, ...props }, ref) => (\n  <OTPInput\n    ref={ref}\n    containerClassName={cn(\n      \"flex items-center gap-2 has-[:disabled]:opacity-50\",\n      containerClassName\n    )}\n    className={cn(\"disabled:cursor-not-allowed\", className)}\n    {...props}\n  />\n))\nInputOTP.displayName = \"InputOTP\"\n\nconst InputOTPGroup = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\">\n>(({ className, ...props }, ref) => (\n  <div ref={ref} className={cn(\"flex items-center\", className)} {...props} />\n))\nInputOTPGroup.displayName = \"InputOTPGroup\"\n\nconst InputOTPSlot = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\"> & { index: number }\n>(({ index, className, ...props }, ref) => {\n  const inputOTPContext = React.useContext(OTPInputContext)\n  const { char, hasFakeCaret, isActive } = inputOTPContext.slots[index]\n\n  return (\n    <div\n      ref={ref}\n      className={cn(\n        \"relative flex h-10 w-10 items-center justify-center border-y border-r border-input text-sm transition-all first:rounded-l-md first:border-l last:rounded-r-md\",\n        isActive && \"z-10 ring-2 ring-ring ring-offset-background\",\n        className\n      )}\n      {...props}\n    >\n      {char}\n      {hasFakeCaret && (\n        <div className=\"pointer-events-none absolute inset-0 flex items-center justify-center\">\n          <div className=\"h-4 w-px animate-caret-blink bg-foreground duration-1000\" />\n        </div>\n      )}\n    </div>\n  )\n})\nInputOTPSlot.displayName = \"InputOTPSlot\"\n\nconst InputOTPSeparator = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\">\n>(({ ...props }, ref) => (\n  <div ref={ref} role=\"separator\" {...props}>\n    <Dot />\n  </div>\n))\nInputOTPSeparator.displayName = \"InputOTPSeparator\"\n\nexport { InputOTP, InputOTPGroup, InputOTPSlot, InputOTPSeparator }\n","path":null,"size_bytes":2154,"size_tokens":null},"client/src/lib/queryClient.ts":{"content":"import { QueryClient, QueryFunction } from \"@tanstack/react-query\";\n\nfunction getAuthToken(): string | null {\n  return localStorage.getItem(\"authToken\");\n}\n\nfunction getAuthHeaders(): Record<string, string> {\n  const token = getAuthToken();\n  const headers: Record<string, string> = {};\n  if (token) {\n    headers[\"Authorization\"] = `Bearer ${token}`;\n  }\n  return headers;\n}\n\nasync function throwIfResNotOk(res: Response) {\n  if (!res.ok) {\n    if (res.status === 401) {\n      localStorage.removeItem(\"authToken\");\n      window.location.href = \"/login\";\n      throw new Error(\"Unauthorized\");\n    }\n    const text = (await res.text()) || res.statusText;\n    throw new Error(`${res.status}: ${text}`);\n  }\n}\n\nexport async function apiRequest(\n  method: string,\n  url: string,\n  data?: unknown | undefined,\n): Promise<Response> {\n  const headers: Record<string, string> = {\n    ...getAuthHeaders(),\n  };\n  if (data) {\n    headers[\"Content-Type\"] = \"application/json\";\n  }\n\n  const res = await fetch(url, {\n    method,\n    headers,\n    body: data ? JSON.stringify(data) : undefined,\n    credentials: \"include\",\n  });\n\n  await throwIfResNotOk(res);\n  return res;\n}\n\ntype UnauthorizedBehavior = \"returnNull\" | \"throw\";\nexport const getQueryFn: <T>(options: {\n  on401: UnauthorizedBehavior;\n}) => QueryFunction<T> =\n  ({ on401: unauthorizedBehavior }) =>\n  async ({ queryKey }) => {\n    const res = await fetch(queryKey.join(\"/\") as string, {\n      credentials: \"include\",\n      headers: getAuthHeaders(),\n    });\n\n    if (unauthorizedBehavior === \"returnNull\" && res.status === 401) {\n      return null;\n    }\n\n    if (res.status === 401) {\n      localStorage.removeItem(\"authToken\");\n      window.location.href = \"/login\";\n      throw new Error(\"Unauthorized\");\n    }\n\n    await throwIfResNotOk(res);\n    return await res.json();\n  };\n\nexport const queryClient = new QueryClient({\n  defaultOptions: {\n    queries: {\n      queryFn: getQueryFn({ on401: \"throw\" }),\n      refetchInterval: false,\n      refetchOnWindowFocus: false,\n      staleTime: Infinity,\n      retry: false,\n    },\n    mutations: {\n      retry: false,\n    },\n  },\n});\n","path":null,"size_bytes":2132,"size_tokens":null},"client/src/components/ui/slider.tsx":{"content":"import * as React from \"react\"\nimport * as SliderPrimitive from \"@radix-ui/react-slider\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Slider = React.forwardRef<\n  React.ElementRef<typeof SliderPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof SliderPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <SliderPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative flex w-full touch-none select-none items-center\",\n      className\n    )}\n    {...props}\n  >\n    <SliderPrimitive.Track className=\"relative h-2 w-full grow overflow-hidden rounded-full bg-secondary\">\n      <SliderPrimitive.Range className=\"absolute h-full bg-primary\" />\n    </SliderPrimitive.Track>\n    <SliderPrimitive.Thumb className=\"block h-5 w-5 rounded-full border-2 border-primary bg-background ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50\" />\n  </SliderPrimitive.Root>\n))\nSlider.displayName = SliderPrimitive.Root.displayName\n\nexport { Slider }\n","path":null,"size_bytes":1077,"size_tokens":null},"client/src/components/ui/dropdown-menu.tsx":{"content":"import * as React from \"react\"\nimport * as DropdownMenuPrimitive from \"@radix-ui/react-dropdown-menu\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst DropdownMenu = DropdownMenuPrimitive.Root\n\nconst DropdownMenuTrigger = DropdownMenuPrimitive.Trigger\n\nconst DropdownMenuGroup = DropdownMenuPrimitive.Group\n\nconst DropdownMenuPortal = DropdownMenuPrimitive.Portal\n\nconst DropdownMenuSub = DropdownMenuPrimitive.Sub\n\nconst DropdownMenuRadioGroup = DropdownMenuPrimitive.RadioGroup\n\nconst DropdownMenuSubTrigger = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <DropdownMenuPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto\" />\n  </DropdownMenuPrimitive.SubTrigger>\n))\nDropdownMenuSubTrigger.displayName =\n  DropdownMenuPrimitive.SubTrigger.displayName\n\nconst DropdownMenuSubContent = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <DropdownMenuPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-dropdown-menu-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuSubContent.displayName =\n  DropdownMenuPrimitive.SubContent.displayName\n\nconst DropdownMenuContent = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Content>\n>(({ className, sideOffset = 4, ...props }, ref) => (\n  <DropdownMenuPrimitive.Portal>\n    <DropdownMenuPrimitive.Content\n      ref={ref}\n      sideOffset={sideOffset}\n      className={cn(\n        \"z-50 max-h-[var(--radix-dropdown-menu-content-available-height)] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-dropdown-menu-content-transform-origin]\",\n        className\n      )}\n      {...props}\n    />\n  </DropdownMenuPrimitive.Portal>\n))\nDropdownMenuContent.displayName = DropdownMenuPrimitive.Content.displayName\n\nconst DropdownMenuItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <DropdownMenuPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuItem.displayName = DropdownMenuPrimitive.Item.displayName\n\nconst DropdownMenuCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <DropdownMenuPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <DropdownMenuPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </DropdownMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </DropdownMenuPrimitive.CheckboxItem>\n))\nDropdownMenuCheckboxItem.displayName =\n  DropdownMenuPrimitive.CheckboxItem.displayName\n\nconst DropdownMenuRadioItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <DropdownMenuPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <DropdownMenuPrimitive.ItemIndicator>\n        <Circle className=\"h-2 w-2 fill-current\" />\n      </DropdownMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </DropdownMenuPrimitive.RadioItem>\n))\nDropdownMenuRadioItem.displayName = DropdownMenuPrimitive.RadioItem.displayName\n\nconst DropdownMenuLabel = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <DropdownMenuPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuLabel.displayName = DropdownMenuPrimitive.Label.displayName\n\nconst DropdownMenuSeparator = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <DropdownMenuPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nDropdownMenuSeparator.displayName = DropdownMenuPrimitive.Separator.displayName\n\nconst DropdownMenuShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\"ml-auto text-xs tracking-widest opacity-60\", className)}\n      {...props}\n    />\n  )\n}\nDropdownMenuShortcut.displayName = \"DropdownMenuShortcut\"\n\nexport {\n  DropdownMenu,\n  DropdownMenuTrigger,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuCheckboxItem,\n  DropdownMenuRadioItem,\n  DropdownMenuLabel,\n  DropdownMenuSeparator,\n  DropdownMenuShortcut,\n  DropdownMenuGroup,\n  DropdownMenuPortal,\n  DropdownMenuSub,\n  DropdownMenuSubContent,\n  DropdownMenuSubTrigger,\n  DropdownMenuRadioGroup,\n}\n","path":null,"size_bytes":7609,"size_tokens":null},"client/src/pages/expert-invite.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { useForm } from \"react-hook-form\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport { z } from \"zod\";\nimport { format } from \"date-fns\";\nimport { Building2, ClipboardList, Check, X, Loader2, AlertCircle, CheckCircle2, XCircle } from \"lucide-react\";\nimport { Card, CardContent, CardHeader, CardTitle, CardDescription, CardFooter } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Separator } from \"@/components/ui/separator\";\nimport {\n  Form,\n  FormControl,\n  FormField,\n  FormItem,\n  FormLabel,\n  FormMessage,\n} from \"@/components/ui/form\";\nimport {\n  Alert,\n  AlertDescription,\n  AlertTitle,\n} from \"@/components/ui/alert\";\n\ninterface InvitationData {\n  projectExpertId: number;\n  project: {\n    id: number;\n    name: string;\n    clientName: string;\n    industry: string;\n    projectOverview: string | null;\n    description: string | null;\n  };\n  expert: {\n    id: number;\n    name: string;\n    email: string;\n  };\n  vettingQuestions: Array<{\n    id: number;\n    question: string;\n    orderIndex: number;\n    isRequired: boolean;\n  }>;\n  invitedAt: string;\n}\n\ninterface ExpertInviteProps {\n  token: string;\n}\n\nexport default function ExpertInvite({ token }: ExpertInviteProps) {\n  const [hasResponded, setHasResponded] = useState(false);\n  const [responseStatus, setResponseStatus] = useState<\"accepted\" | \"declined\" | null>(null);\n\n  const { data: invitation, isLoading, error } = useQuery<InvitationData>({\n    queryKey: [\"/api/expert-invite\", token],\n    queryFn: async () => {\n      const res = await fetch(`/api/expert-invite/${token}`);\n      if (!res.ok) {\n        const data = await res.json();\n        throw new Error(data.error || \"Failed to load invitation\");\n      }\n      return res.json();\n    },\n    retry: false,\n  });\n\n  const answerSchema = z.object({\n    answers: z.array(z.object({\n      questionId: z.number(),\n      answer: z.string().min(1, \"Answer is required\"),\n    })),\n    availabilityNote: z.string().optional(),\n  });\n\n  type AnswerFormData = z.infer<typeof answerSchema>;\n\n  const form = useForm<AnswerFormData>({\n    resolver: zodResolver(answerSchema),\n    defaultValues: {\n      answers: [],\n      availabilityNote: \"\",\n    },\n  });\n\n  useEffect(() => {\n    if (invitation?.vettingQuestions) {\n      form.reset({\n        answers: invitation.vettingQuestions.map((q) => ({\n          questionId: q.id,\n          answer: \"\",\n        })),\n        availabilityNote: \"\",\n      });\n    }\n  }, [invitation, form]);\n\n  const acceptMutation = useMutation({\n    mutationFn: async (data: AnswerFormData) => {\n      const res = await fetch(`/api/expert-invite/${token}/accept`, {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify({\n          vqAnswers: data.answers,\n          availabilityNote: data.availabilityNote,\n        }),\n      });\n      if (!res.ok) {\n        const errData = await res.json();\n        throw new Error(errData.error || \"Failed to accept invitation\");\n      }\n      return res.json();\n    },\n    onSuccess: () => {\n      setHasResponded(true);\n      setResponseStatus(\"accepted\");\n    },\n  });\n\n  const declineMutation = useMutation({\n    mutationFn: async () => {\n      const res = await fetch(`/api/expert-invite/${token}/decline`, {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify({ reason: \"Declined via invitation link\" }),\n      });\n      if (!res.ok) {\n        const errData = await res.json();\n        throw new Error(errData.error || \"Failed to decline invitation\");\n      }\n      return res.json();\n    },\n    onSuccess: () => {\n      setHasResponded(true);\n      setResponseStatus(\"declined\");\n    },\n  });\n\n  const onSubmit = (data: AnswerFormData) => {\n    acceptMutation.mutate(data);\n  };\n\n  if (isLoading) {\n    return (\n      <div className=\"min-h-screen bg-background flex items-center justify-center\">\n        <div className=\"flex items-center gap-2 text-muted-foreground\">\n          <Loader2 className=\"h-5 w-5 animate-spin\" />\n          <span>Loading invitation...</span>\n        </div>\n      </div>\n    );\n  }\n\n  if (error) {\n    return (\n      <div className=\"min-h-screen bg-background p-8 flex items-center justify-center\">\n        <Card className=\"max-w-md w-full\">\n          <CardHeader>\n            <CardTitle className=\"flex items-center gap-2 text-destructive\">\n              <AlertCircle className=\"h-5 w-5\" />\n              Invitation Error\n            </CardTitle>\n          </CardHeader>\n          <CardContent>\n            <p className=\"text-muted-foreground\">\n              {(error as Error).message || \"This invitation link is invalid or has expired.\"}\n            </p>\n          </CardContent>\n        </Card>\n      </div>\n    );\n  }\n\n  if (hasResponded) {\n    return (\n      <div className=\"min-h-screen bg-background p-8 flex items-center justify-center\">\n        <Card className=\"max-w-md w-full\">\n          <CardHeader className=\"text-center\">\n            {responseStatus === \"accepted\" ? (\n              <>\n                <div className=\"mx-auto mb-4 h-12 w-12 rounded-full bg-green-100 flex items-center justify-center\">\n                  <CheckCircle2 className=\"h-6 w-6 text-green-600\" />\n                </div>\n                <CardTitle>Thank You!</CardTitle>\n                <CardDescription>\n                  Your response has been recorded. The team will review your answers and get in touch soon.\n                </CardDescription>\n              </>\n            ) : (\n              <>\n                <div className=\"mx-auto mb-4 h-12 w-12 rounded-full bg-red-100 flex items-center justify-center\">\n                  <XCircle className=\"h-6 w-6 text-red-600\" />\n                </div>\n                <CardTitle>Response Recorded</CardTitle>\n                <CardDescription>\n                  We've noted your decision to decline this project. Thank you for your time.\n                </CardDescription>\n              </>\n            )}\n          </CardHeader>\n        </Card>\n      </div>\n    );\n  }\n\n  if (!invitation) {\n    return null;\n  }\n\n  return (\n    <div className=\"min-h-screen bg-background\">\n      <div className=\"max-w-3xl mx-auto p-6 space-y-6\">\n        <div className=\"text-center space-y-2\">\n          <h1 className=\"text-2xl font-semibold\">Project Invitation</h1>\n          <p className=\"text-muted-foreground\">\n            Hello {invitation.expert.name}, you've been invited to participate in a project.\n          </p>\n        </div>\n\n        <Card>\n          <CardHeader>\n            <div className=\"flex items-center gap-2\">\n              <Building2 className=\"h-5 w-5 text-muted-foreground\" />\n              <CardTitle className=\"text-lg\">{invitation.project.name}</CardTitle>\n            </div>\n            <CardDescription>\n              {invitation.project.clientName}  {invitation.project.industry}\n            </CardDescription>\n          </CardHeader>\n          <CardContent className=\"space-y-4\">\n            {invitation.project.projectOverview && (\n              <div>\n                <p className=\"text-sm font-medium mb-1\">Overview</p>\n                <p className=\"text-sm text-muted-foreground\">{invitation.project.projectOverview}</p>\n              </div>\n            )}\n            {invitation.project.description && (\n              <div>\n                <p className=\"text-sm font-medium mb-1\">Description</p>\n                <p className=\"text-sm text-muted-foreground whitespace-pre-wrap\">\n                  {invitation.project.description}\n                </p>\n              </div>\n            )}\n            <div className=\"text-xs text-muted-foreground\">\n              Invited on {format(new Date(invitation.invitedAt), \"MMMM dd, yyyy 'at' h:mm a\")}\n            </div>\n          </CardContent>\n        </Card>\n\n        <Card>\n          <CardHeader>\n            <div className=\"flex items-center gap-2\">\n              <ClipboardList className=\"h-5 w-5 text-muted-foreground\" />\n              <CardTitle className=\"text-lg\">Vetting Questions</CardTitle>\n            </div>\n            <CardDescription>\n              Please answer the following questions to help us understand your fit for this project.\n            </CardDescription>\n          </CardHeader>\n          <CardContent>\n            <Form {...form}>\n              <form onSubmit={form.handleSubmit(onSubmit)} className=\"space-y-6\">\n                {invitation.vettingQuestions.length === 0 ? (\n                  <p className=\"text-sm text-muted-foreground italic\">\n                    No vetting questions for this project.\n                  </p>\n                ) : (\n                  <div className=\"space-y-6\">\n                    {invitation.vettingQuestions\n                      .sort((a, b) => a.orderIndex - b.orderIndex)\n                      .map((q, index) => (\n                        <FormField\n                          key={q.id}\n                          control={form.control}\n                          name={`answers.${index}.answer`}\n                          render={({ field }) => (\n                            <FormItem>\n                              <FormLabel className=\"flex items-start gap-2\">\n                                <span className=\"font-mono text-sm text-muted-foreground\">\n                                  {index + 1}.\n                                </span>\n                                <span>\n                                  {q.question}\n                                  {q.isRequired && (\n                                    <span className=\"text-destructive ml-1\">*</span>\n                                  )}\n                                </span>\n                              </FormLabel>\n                              <FormControl>\n                                <Textarea\n                                  placeholder=\"Type your answer here...\"\n                                  className=\"resize-none min-h-[100px]\"\n                                  {...field}\n                                  data-testid={`input-answer-${index}`}\n                                />\n                              </FormControl>\n                              <FormMessage />\n                            </FormItem>\n                          )}\n                        />\n                      ))}\n                  </div>\n                )}\n\n                <Separator />\n\n                <FormField\n                  control={form.control}\n                  name=\"availabilityNote\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Availability Note (Optional)</FormLabel>\n                      <FormControl>\n                        <Textarea\n                          placeholder=\"Any notes about your availability, preferred meeting times, etc.\"\n                          className=\"resize-none\"\n                          {...field}\n                          data-testid=\"input-availability-note\"\n                        />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n\n                {acceptMutation.error && (\n                  <Alert variant=\"destructive\">\n                    <AlertCircle className=\"h-4 w-4\" />\n                    <AlertTitle>Error</AlertTitle>\n                    <AlertDescription>\n                      {(acceptMutation.error as Error).message}\n                    </AlertDescription>\n                  </Alert>\n                )}\n\n                <div className=\"flex flex-col-reverse gap-3 sm:flex-row sm:justify-between\">\n                  <Button\n                    type=\"button\"\n                    variant=\"outline\"\n                    onClick={() => declineMutation.mutate()}\n                    disabled={acceptMutation.isPending || declineMutation.isPending}\n                    className=\"gap-2\"\n                    data-testid=\"button-decline\"\n                  >\n                    {declineMutation.isPending ? (\n                      <Loader2 className=\"h-4 w-4 animate-spin\" />\n                    ) : (\n                      <X className=\"h-4 w-4\" />\n                    )}\n                    Decline Invitation\n                  </Button>\n                  <Button\n                    type=\"submit\"\n                    disabled={acceptMutation.isPending || declineMutation.isPending}\n                    className=\"gap-2\"\n                    data-testid=\"button-accept\"\n                  >\n                    {acceptMutation.isPending ? (\n                      <Loader2 className=\"h-4 w-4 animate-spin\" />\n                    ) : (\n                      <Check className=\"h-4 w-4\" />\n                    )}\n                    Accept & Submit Answers\n                  </Button>\n                </div>\n              </form>\n            </Form>\n          </CardContent>\n        </Card>\n      </div>\n    </div>\n  );\n}\n","path":null,"size_bytes":13160,"size_tokens":null},"server/vite.ts":{"content":"import { type Express } from \"express\";\nimport { createServer as createViteServer, createLogger } from \"vite\";\nimport { type Server } from \"http\";\nimport viteConfig from \"../vite.config\";\nimport fs from \"fs\";\nimport path from \"path\";\nimport { nanoid } from \"nanoid\";\n\nconst viteLogger = createLogger();\n\nexport async function setupVite(server: Server, app: Express) {\n  const serverOptions = {\n    middlewareMode: true,\n    hmr: { server, path: \"/vite-hmr\" },\n    allowedHosts: true as const,\n  };\n\n  const vite = await createViteServer({\n    ...viteConfig,\n    configFile: false,\n    customLogger: {\n      ...viteLogger,\n      error: (msg, options) => {\n        viteLogger.error(msg, options);\n        process.exit(1);\n      },\n    },\n    server: serverOptions,\n    appType: \"custom\",\n  });\n\n  app.use(vite.middlewares);\n\n  app.use(\"*\", async (req, res, next) => {\n    const url = req.originalUrl;\n\n    try {\n      const clientTemplate = path.resolve(\n        import.meta.dirname,\n        \"..\",\n        \"client\",\n        \"index.html\",\n      );\n\n      // always reload the index.html file from disk incase it changes\n      let template = await fs.promises.readFile(clientTemplate, \"utf-8\");\n      template = template.replace(\n        `src=\"/src/main.tsx\"`,\n        `src=\"/src/main.tsx?v=${nanoid()}\"`,\n      );\n      const page = await vite.transformIndexHtml(url, template);\n      res.status(200).set({ \"Content-Type\": \"text/html\" }).end(page);\n    } catch (e) {\n      vite.ssrFixStacktrace(e as Error);\n      next(e);\n    }\n  });\n}\n","path":null,"size_bytes":1534,"size_tokens":null},"client/src/components/ui/sidebar.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { cva, VariantProps } from \"class-variance-authority\"\nimport { PanelLeftIcon } from \"lucide-react\"\n\nimport { useIsMobile } from \"@/hooks/use-mobile\"\nimport { cn } from \"@/lib/utils\"\nimport { Button } from \"@/components/ui/button\"\nimport { Input } from \"@/components/ui/input\"\nimport { Separator } from \"@/components/ui/separator\"\nimport {\n  Sheet,\n  SheetContent,\n  SheetDescription,\n  SheetHeader,\n  SheetTitle,\n} from \"@/components/ui/sheet\"\nimport { Skeleton } from \"@/components/ui/skeleton\"\nimport {\n  Tooltip,\n  TooltipContent,\n  TooltipProvider,\n  TooltipTrigger,\n} from \"@/components/ui/tooltip\"\n\nconst SIDEBAR_COOKIE_NAME = \"sidebar_state\"\nconst SIDEBAR_COOKIE_MAX_AGE = 60 * 60 * 24 * 7\nconst SIDEBAR_WIDTH = \"16rem\"\nconst SIDEBAR_WIDTH_MOBILE = \"18rem\"\nconst SIDEBAR_WIDTH_ICON = \"3rem\"\nconst SIDEBAR_KEYBOARD_SHORTCUT = \"b\"\n\ntype SidebarContextProps = {\n  state: \"expanded\" | \"collapsed\"\n  open: boolean\n  setOpen: (open: boolean) => void\n  openMobile: boolean\n  setOpenMobile: (open: boolean) => void\n  isMobile: boolean\n  toggleSidebar: () => void\n}\n\nconst SidebarContext = React.createContext<SidebarContextProps | null>(null)\n\nfunction useSidebar() {\n  const context = React.useContext(SidebarContext)\n  if (!context) {\n    throw new Error(\"useSidebar must be used within a SidebarProvider.\")\n  }\n\n  return context\n}\n\nfunction SidebarProvider({\n  defaultOpen = true,\n  open: openProp,\n  onOpenChange: setOpenProp,\n  className,\n  style,\n  children,\n  ...props\n}: React.ComponentProps<\"div\"> & {\n  defaultOpen?: boolean\n  open?: boolean\n  onOpenChange?: (open: boolean) => void\n}) {\n  const isMobile = useIsMobile()\n  const [openMobile, setOpenMobile] = React.useState(false)\n\n  // This is the internal state of the sidebar.\n  // We use openProp and setOpenProp for control from outside the component.\n  const [_open, _setOpen] = React.useState(defaultOpen)\n  const open = openProp ?? _open\n  const setOpen = React.useCallback(\n    (value: boolean | ((value: boolean) => boolean)) => {\n      const openState = typeof value === \"function\" ? value(open) : value\n      if (setOpenProp) {\n        setOpenProp(openState)\n      } else {\n        _setOpen(openState)\n      }\n\n      // This sets the cookie to keep the sidebar state.\n      document.cookie = `${SIDEBAR_COOKIE_NAME}=${openState}; path=/; max-age=${SIDEBAR_COOKIE_MAX_AGE}`\n    },\n    [setOpenProp, open]\n  )\n\n  // Helper to toggle the sidebar.\n  const toggleSidebar = React.useCallback(() => {\n    return isMobile ? setOpenMobile((open) => !open) : setOpen((open) => !open)\n  }, [isMobile, setOpen, setOpenMobile])\n\n  // Adds a keyboard shortcut to toggle the sidebar.\n  React.useEffect(() => {\n    const handleKeyDown = (event: KeyboardEvent) => {\n      if (\n        event.key === SIDEBAR_KEYBOARD_SHORTCUT &&\n        (event.metaKey || event.ctrlKey)\n      ) {\n        event.preventDefault()\n        toggleSidebar()\n      }\n    }\n\n    window.addEventListener(\"keydown\", handleKeyDown)\n    return () => window.removeEventListener(\"keydown\", handleKeyDown)\n  }, [toggleSidebar])\n\n  // We add a state so that we can do data-state=\"expanded\" or \"collapsed\".\n  // This makes it easier to style the sidebar with Tailwind classes.\n  const state = open ? \"expanded\" : \"collapsed\"\n\n  const contextValue = React.useMemo<SidebarContextProps>(\n    () => ({\n      state,\n      open,\n      setOpen,\n      isMobile,\n      openMobile,\n      setOpenMobile,\n      toggleSidebar,\n    }),\n    [state, open, setOpen, isMobile, openMobile, setOpenMobile, toggleSidebar]\n  )\n\n  return (\n    <SidebarContext.Provider value={contextValue}>\n      <TooltipProvider delayDuration={0}>\n        <div\n          data-slot=\"sidebar-wrapper\"\n          style={\n            {\n              \"--sidebar-width\": SIDEBAR_WIDTH,\n              \"--sidebar-width-icon\": SIDEBAR_WIDTH_ICON,\n              ...style,\n            } as React.CSSProperties\n          }\n          className={cn(\n            \"group/sidebar-wrapper has-data-[variant=inset]:bg-sidebar flex min-h-svh w-full\",\n            className\n          )}\n          {...props}\n        >\n          {children}\n        </div>\n      </TooltipProvider>\n    </SidebarContext.Provider>\n  )\n}\n\nfunction Sidebar({\n  side = \"left\",\n  variant = \"sidebar\",\n  collapsible = \"offcanvas\",\n  className,\n  children,\n  ...props\n}: React.ComponentProps<\"div\"> & {\n  side?: \"left\" | \"right\"\n  variant?: \"sidebar\" | \"floating\" | \"inset\"\n  collapsible?: \"offcanvas\" | \"icon\" | \"none\"\n}) {\n  const { isMobile, state, openMobile, setOpenMobile } = useSidebar()\n\n  if (collapsible === \"none\") {\n    return (\n      <div\n        data-slot=\"sidebar\"\n        className={cn(\n          \"bg-sidebar text-sidebar-foreground flex h-full w-[var(--sidebar-width)] flex-col\",\n          className\n        )}\n        {...props}\n      >\n        {children}\n      </div>\n    )\n  }\n\n  if (isMobile) {\n    return (\n      <Sheet open={openMobile} onOpenChange={setOpenMobile} {...props}>\n        <SheetContent\n          data-sidebar=\"sidebar\"\n          data-slot=\"sidebar\"\n          data-mobile=\"true\"\n          className=\"bg-sidebar text-sidebar-foreground w-[var(--sidebar-width)] p-0 [&>button]:hidden\"\n          style={\n            {\n              \"--sidebar-width\": SIDEBAR_WIDTH_MOBILE,\n            } as React.CSSProperties\n          }\n          side={side}\n        >\n          <SheetHeader className=\"sr-only\">\n            <SheetTitle>Sidebar</SheetTitle>\n            <SheetDescription>Displays the mobile sidebar.</SheetDescription>\n          </SheetHeader>\n          <div className=\"flex h-full w-full flex-col\">{children}</div>\n        </SheetContent>\n      </Sheet>\n    )\n  }\n\n  return (\n    <div\n      className=\"group peer text-sidebar-foreground hidden md:block\"\n      data-state={state}\n      data-collapsible={state === \"collapsed\" ? collapsible : \"\"}\n      data-variant={variant}\n      data-side={side}\n      data-slot=\"sidebar\"\n    >\n      {/* This is what handles the sidebar gap on desktop */}\n      <div\n        data-slot=\"sidebar-gap\"\n        className={cn(\n          \"relative w-[var(--sidebar-width)] bg-transparent transition-[width] duration-200 ease-linear\",\n          \"group-data-[collapsible=offcanvas]:w-0\",\n          \"group-data-[side=right]:rotate-180\",\n          variant === \"floating\" || variant === \"inset\"\n            ? \"group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)+var(--spacing-4))]\"\n            : \"group-data-[collapsible=icon]:w-[var(--sidebar-width-icon)]\"\n        )}\n      />\n      <div\n        data-slot=\"sidebar-container\"\n        className={cn(\n          \"fixed inset-y-0 z-10 hidden h-svh w-[var(--sidebar-width)] transition-[left,right,width] duration-200 ease-linear md:flex\",\n          side === \"left\"\n            ? \"left-0 group-data-[collapsible=offcanvas]:left-[calc(var(--sidebar-width)*-1)]\"\n            : \"right-0 group-data-[collapsible=offcanvas]:right-[calc(var(--sidebar-width)*-1)]\",\n          // Adjust the padding for floating and inset variants.\n          variant === \"floating\" || variant === \"inset\"\n            ? \"p-2 group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)+var(--spacing-4)+2px)]\"\n            : \"group-data-[collapsible=icon]:w-[var(--sidebar-width-icon)] group-data-[side=left]:border-r group-data-[side=right]:border-l\",\n          className\n        )}\n        {...props}\n      >\n        <div\n          data-sidebar=\"sidebar\"\n          data-slot=\"sidebar-inner\"\n          className=\"bg-sidebar group-data-[variant=floating]:border-sidebar-border flex h-full w-full flex-col group-data-[variant=floating]:rounded-lg group-data-[variant=floating]:border group-data-[variant=floating]:shadow-sm\"\n        >\n          {children}\n        </div>\n      </div>\n    </div>\n  )\n}\n\nfunction SidebarTrigger({\n  className,\n  onClick,\n  ...props\n}: React.ComponentProps<typeof Button>) {\n  const { toggleSidebar } = useSidebar()\n\n  return (\n    <Button\n      data-sidebar=\"trigger\"\n      data-slot=\"sidebar-trigger\"\n      variant=\"ghost\"\n      size=\"icon\"\n      className={cn(\"h-7 w-7\", className)}\n      onClick={(event) => {\n        onClick?.(event)\n        toggleSidebar()\n      }}\n      {...props}\n    >\n      <PanelLeftIcon />\n      <span className=\"sr-only\">Toggle Sidebar</span>\n    </Button>\n  )\n}\n\nfunction SidebarRail({ className, ...props }: React.ComponentProps<\"button\">) {\n  const { toggleSidebar } = useSidebar()\n\n  // Note: Tailwind v3.4 doesn't support \"in-\" selectors. So the rail won't work perfectly.\n  return (\n    <button\n      data-sidebar=\"rail\"\n      data-slot=\"sidebar-rail\"\n      aria-label=\"Toggle Sidebar\"\n      tabIndex={-1}\n      onClick={toggleSidebar}\n      title=\"Toggle Sidebar\"\n      className={cn(\n        \"hover:after:bg-sidebar-border absolute inset-y-0 z-20 hidden w-4 -translate-x-1/2 transition-all ease-linear group-data-[side=left]:-right-4 group-data-[side=right]:left-0 after:absolute after:inset-y-0 after:left-1/2 after:w-[2px] sm:flex\",\n        \"in-data-[side=left]:cursor-w-resize in-data-[side=right]:cursor-e-resize\",\n        \"[[data-side=left][data-state=collapsed]_&]:cursor-e-resize [[data-side=right][data-state=collapsed]_&]:cursor-w-resize\",\n        \"hover:group-data-[collapsible=offcanvas]:bg-sidebar group-data-[collapsible=offcanvas]:translate-x-0 group-data-[collapsible=offcanvas]:after:left-full\",\n        \"[[data-side=left][data-collapsible=offcanvas]_&]:-right-2\",\n        \"[[data-side=right][data-collapsible=offcanvas]_&]:-left-2\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarInset({ className, ...props }: React.ComponentProps<\"main\">) {\n  return (\n    <main\n      data-slot=\"sidebar-inset\"\n      className={cn(\n        \"bg-background relative flex w-full flex-1 flex-col\",\n        \"md:peer-data-[variant=inset]:m-2 md:peer-data-[variant=inset]:ml-0 md:peer-data-[variant=inset]:rounded-xl md:peer-data-[variant=inset]:shadow-sm md:peer-data-[variant=inset]:peer-data-[state=collapsed]:ml-2\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarInput({\n  className,\n  ...props\n}: React.ComponentProps<typeof Input>) {\n  return (\n    <Input\n      data-slot=\"sidebar-input\"\n      data-sidebar=\"input\"\n      className={cn(\"bg-background h-8 w-full shadow-none\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarHeader({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-header\"\n      data-sidebar=\"header\"\n      className={cn(\"flex flex-col gap-2 p-2\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarFooter({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-footer\"\n      data-sidebar=\"footer\"\n      className={cn(\"flex flex-col gap-2 p-2\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarSeparator({\n  className,\n  ...props\n}: React.ComponentProps<typeof Separator>) {\n  return (\n    <Separator\n      data-slot=\"sidebar-separator\"\n      data-sidebar=\"separator\"\n      className={cn(\"bg-sidebar-border mx-2 w-auto\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarContent({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-content\"\n      data-sidebar=\"content\"\n      className={cn(\n        \"flex min-h-0 flex-1 flex-col gap-2 overflow-auto group-data-[collapsible=icon]:overflow-hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarGroup({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-group\"\n      data-sidebar=\"group\"\n      className={cn(\"relative flex w-full min-w-0 flex-col p-2\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarGroupLabel({\n  className,\n  asChild = false,\n  ...props\n}: React.ComponentProps<\"div\"> & { asChild?: boolean }) {\n  const Comp = asChild ? Slot : \"div\"\n\n  return (\n    <Comp\n      data-slot=\"sidebar-group-label\"\n      data-sidebar=\"group-label\"\n      className={cn(\n        \"text-sidebar-foreground/70 ring-sidebar-ring flex h-8 shrink-0 items-center rounded-md px-2 text-xs font-medium outline-hidden transition-[margin,opacity] duration-200 ease-linear focus-visible:ring-2 [&>svg]:h-4 [&>svg]:w-4 [&>svg]:shrink-0\",\n        \"group-data-[collapsible=icon]:-mt-8 group-data-[collapsible=icon]:opacity-0\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarGroupAction({\n  className,\n  asChild = false,\n  ...props\n}: React.ComponentProps<\"button\"> & { asChild?: boolean }) {\n  const Comp = asChild ? Slot : \"button\"\n\n  return (\n    <Comp\n      data-slot=\"sidebar-group-action\"\n      data-sidebar=\"group-action\"\n      className={cn(\n        \"text-sidebar-foreground ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground absolute top-3.5 right-3 flex aspect-square w-5 items-center justify-center rounded-md p-0 outline-hidden transition-transform focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0\",\n        // Increases the hit area of the button on mobile.\n        \"after:absolute after:-inset-2 md:after:hidden\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarGroupContent({\n  className,\n  ...props\n}: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-group-content\"\n      data-sidebar=\"group-content\"\n      className={cn(\"w-full text-sm\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenu({ className, ...props }: React.ComponentProps<\"ul\">) {\n  return (\n    <ul\n      data-slot=\"sidebar-menu\"\n      data-sidebar=\"menu\"\n      className={cn(\"flex w-full min-w-0 flex-col gap-1\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuItem({ className, ...props }: React.ComponentProps<\"li\">) {\n  return (\n    <li\n      data-slot=\"sidebar-menu-item\"\n      data-sidebar=\"menu-item\"\n      className={cn(\"group/menu-item relative\", className)}\n      {...props}\n    />\n  )\n}\n\nconst sidebarMenuButtonVariants = cva(\n  \"peer/menu-button flex w-full items-center gap-2 overflow-hidden rounded-md p-2 text-left text-sm outline-hidden ring-sidebar-ring transition-[width,height,padding] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 active:bg-sidebar-accent active:text-sidebar-accent-foreground disabled:pointer-events-none disabled:opacity-50 group-has-data-[sidebar=menu-action]/menu-item:pr-8 aria-disabled:pointer-events-none aria-disabled:opacity-50 data-[active=true]:bg-sidebar-accent data-[active=true]:font-medium data-[active=true]:text-sidebar-accent-foreground data-[state=open]:hover:bg-sidebar-accent data-[state=open]:hover:text-sidebar-accent-foreground group-data-[collapsible=icon]:w-8! group-data-[collapsible=icon]:h-8! group-data-[collapsible=icon]:p-2! [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0\",\n  {\n    variants: {\n      variant: {\n        default: \"hover:bg-sidebar-accent hover:text-sidebar-accent-foreground\",\n        outline:\n          \"bg-background shadow-[0_0_0_1px_hsl(var(--sidebar-border))] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground hover:shadow-[0_0_0_1px_hsl(var(--sidebar-accent))]\",\n      },\n      size: {\n        default: \"h-8 text-sm\",\n        sm: \"h-7 text-xs\",\n        lg: \"h-12 text-sm group-data-[collapsible=icon]:p-0!\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  }\n)\n\nfunction SidebarMenuButton({\n  asChild = false,\n  isActive = false,\n  variant = \"default\",\n  size = \"default\",\n  tooltip,\n  className,\n  ...props\n}: React.ComponentProps<\"button\"> & {\n  asChild?: boolean\n  isActive?: boolean\n  tooltip?: string | React.ComponentProps<typeof TooltipContent>\n} & VariantProps<typeof sidebarMenuButtonVariants>) {\n  const Comp = asChild ? Slot : \"button\"\n  const { isMobile, state } = useSidebar()\n\n  const button = (\n    <Comp\n      data-slot=\"sidebar-menu-button\"\n      data-sidebar=\"menu-button\"\n      data-size={size}\n      data-active={isActive}\n      className={cn(sidebarMenuButtonVariants({ variant, size }), className)}\n      {...props}\n    />\n  )\n\n  if (!tooltip) {\n    return button\n  }\n\n  if (typeof tooltip === \"string\") {\n    tooltip = {\n      children: tooltip,\n    }\n  }\n\n  return (\n    <Tooltip>\n      <TooltipTrigger asChild>{button}</TooltipTrigger>\n      <TooltipContent\n        side=\"right\"\n        align=\"center\"\n        hidden={state !== \"collapsed\" || isMobile}\n        {...tooltip}\n      />\n    </Tooltip>\n  )\n}\n\nfunction SidebarMenuAction({\n  className,\n  asChild = false,\n  showOnHover = false,\n  ...props\n}: React.ComponentProps<\"button\"> & {\n  asChild?: boolean\n  showOnHover?: boolean\n}) {\n  const Comp = asChild ? Slot : \"button\"\n\n  return (\n    <Comp\n      data-slot=\"sidebar-menu-action\"\n      data-sidebar=\"menu-action\"\n      className={cn(\n        \"text-sidebar-foreground ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground peer-hover/menu-button:text-sidebar-accent-foreground absolute top-1.5 right-1 flex aspect-square w-5 items-center justify-center rounded-md p-0 outline-hidden transition-transform focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0\",\n        // Increases the hit area of the button on mobile.\n        \"after:absolute after:-inset-2 md:after:hidden\",\n        \"peer-data-[size=sm]/menu-button:top-1\",\n        \"peer-data-[size=default]/menu-button:top-1.5\",\n        \"peer-data-[size=lg]/menu-button:top-2.5\",\n        \"group-data-[collapsible=icon]:hidden\",\n        showOnHover &&\n          \"peer-data-[active=true]/menu-button:text-sidebar-accent-foreground group-focus-within/menu-item:opacity-100 group-hover/menu-item:opacity-100 data-[state=open]:opacity-100 md:opacity-0\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuBadge({\n  className,\n  ...props\n}: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-menu-badge\"\n      data-sidebar=\"menu-badge\"\n      className={cn(\n        \"text-sidebar-foreground pointer-events-none absolute right-1 flex h-5 min-w-5 items-center justify-center rounded-md px-1 text-xs font-medium tabular-nums select-none\",\n        \"peer-hover/menu-button:text-sidebar-accent-foreground peer-data-[active=true]/menu-button:text-sidebar-accent-foreground\",\n        \"peer-data-[size=sm]/menu-button:top-1\",\n        \"peer-data-[size=default]/menu-button:top-1.5\",\n        \"peer-data-[size=lg]/menu-button:top-2.5\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuSkeleton({\n  className,\n  showIcon = false,\n  ...props\n}: React.ComponentProps<\"div\"> & {\n  showIcon?: boolean\n}) {\n  // Random width between 50 to 90%.\n  const width = React.useMemo(() => {\n    return `${Math.floor(Math.random() * 40) + 50}%`\n  }, [])\n\n  return (\n    <div\n      data-slot=\"sidebar-menu-skeleton\"\n      data-sidebar=\"menu-skeleton\"\n      className={cn(\"flex h-8 items-center gap-2 rounded-md px-2\", className)}\n      {...props}\n    >\n      {showIcon && (\n        <Skeleton\n          className=\"size-4 rounded-md\"\n          data-sidebar=\"menu-skeleton-icon\"\n        />\n      )}\n      <Skeleton\n        className=\"h-4 max-w-[var(--skeleton-width)] flex-1\"\n        data-sidebar=\"menu-skeleton-text\"\n        style={\n          {\n            \"--skeleton-width\": width,\n          } as React.CSSProperties\n        }\n      />\n    </div>\n  )\n}\n\nfunction SidebarMenuSub({ className, ...props }: React.ComponentProps<\"ul\">) {\n  return (\n    <ul\n      data-slot=\"sidebar-menu-sub\"\n      data-sidebar=\"menu-sub\"\n      className={cn(\n        \"border-sidebar-border mx-3.5 flex min-w-0 translate-x-px flex-col gap-1 border-l px-2.5 py-0.5\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuSubItem({\n  className,\n  ...props\n}: React.ComponentProps<\"li\">) {\n  return (\n    <li\n      data-slot=\"sidebar-menu-sub-item\"\n      data-sidebar=\"menu-sub-item\"\n      className={cn(\"group/menu-sub-item relative\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuSubButton({\n  asChild = false,\n  size = \"md\",\n  isActive = false,\n  className,\n  ...props\n}: React.ComponentProps<\"a\"> & {\n  asChild?: boolean\n  size?: \"sm\" | \"md\"\n  isActive?: boolean\n}) {\n  const Comp = asChild ? Slot : \"a\"\n\n  return (\n    <Comp\n      data-slot=\"sidebar-menu-sub-button\"\n      data-sidebar=\"menu-sub-button\"\n      data-size={size}\n      data-active={isActive}\n      className={cn(\n        \"text-sidebar-foreground ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground active:bg-sidebar-accent active:text-sidebar-accent-foreground [&>svg]:text-sidebar-accent-foreground flex h-7 min-w-0 -translate-x-px items-center gap-2 overflow-hidden rounded-md px-2 outline outline-2 outline-transparent outline-offset-2 focus-visible:ring-2 disabled:pointer-events-none disabled:opacity-50 aria-disabled:pointer-events-none aria-disabled:opacity-50 [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0\",\n        \"data-[active=true]:bg-sidebar-accent data-[active=true]:text-sidebar-accent-foreground\",\n        size === \"sm\" && \"text-xs\",\n        size === \"md\" && \"text-sm\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nexport {\n  Sidebar,\n  SidebarContent,\n  SidebarFooter,\n  SidebarGroup,\n  SidebarGroupAction,\n  SidebarGroupContent,\n  SidebarGroupLabel,\n  SidebarHeader,\n  SidebarInput,\n  SidebarInset,\n  SidebarMenu,\n  SidebarMenuAction,\n  SidebarMenuBadge,\n  SidebarMenuButton,\n  SidebarMenuItem,\n  SidebarMenuSkeleton,\n  SidebarMenuSub,\n  SidebarMenuSubButton,\n  SidebarMenuSubItem,\n  SidebarProvider,\n  SidebarRail,\n  SidebarSeparator,\n  SidebarTrigger,\n  useSidebar,\n}\n","path":null,"size_bytes":21846,"size_tokens":null},"shared/schema.ts":{"content":"import { sql } from \"drizzle-orm\";\nimport { pgTable, text, varchar, integer, timestamp, boolean, decimal, serial, jsonb } from \"drizzle-orm/pg-core\";\nimport { relations } from \"drizzle-orm\";\nimport { createInsertSchema } from \"drizzle-zod\";\nimport { z } from \"zod\";\n\n// Users table (Admin, PM, RA, Finance roles - internal employees only)\nexport const users = pgTable(\"users\", {\n  id: serial(\"id\").primaryKey(),\n  fullName: text(\"full_name\").notNull(),\n  email: text(\"email\").notNull().unique(),\n  passwordHash: text(\"password_hash\"),\n  role: text(\"role\").notNull().default(\"pm\"), // admin, pm, ra, finance\n  isActive: boolean(\"is_active\").notNull().default(true),\n  mustChangePassword: boolean(\"must_change_password\").notNull().default(false),\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n});\n\n// Clients table (Internal CRM - managed by employees)\nexport const clients = pgTable(\"clients\", {\n  id: serial(\"id\").primaryKey(),\n  clientName: text(\"client_name\").notNull(),\n  country: text(\"country\"),\n  region: text(\"region\"),\n  industry: text(\"industry\"),\n  mainContactName: text(\"main_contact_name\"),\n  mainContactEmail: text(\"main_contact_email\"),\n  mainContactPhone: text(\"main_contact_phone\"),\n  notes: text(\"notes\"),\n  status: text(\"status\").notNull().default(\"prospect\"), // active, inactive, prospect\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n});\n\n// Client Organizations table\nexport const clientOrganizations = pgTable(\"client_organizations\", {\n  id: serial(\"id\").primaryKey(),\n  name: text(\"name\").notNull(),\n  industry: text(\"industry\").notNull(),\n  billingAddress: text(\"billing_address\"),\n  mainPmId: integer(\"main_pm_id\").references(() => users.id),\n  totalCuUsed: decimal(\"total_cu_used\", { precision: 10, scale: 2 }).default(\"0\"),\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n});\n\n// Client POCs (Points of Contact)\nexport const clientPocs = pgTable(\"client_pocs\", {\n  id: serial(\"id\").primaryKey(),\n  organizationId: integer(\"organization_id\").notNull().references(() => clientOrganizations.id, { onDelete: \"cascade\" }),\n  name: text(\"name\").notNull(),\n  email: text(\"email\").notNull(),\n  phone: text(\"phone\"),\n  jobTitle: text(\"job_title\"),\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n});\n\n// Projects table (Extended)\nexport const projects = pgTable(\"projects\", {\n  id: serial(\"id\").primaryKey(),\n  name: text(\"name\").notNull(),\n  projectOverview: text(\"project_overview\"),\n  clientOrganizationId: integer(\"client_organization_id\").references(() => clientOrganizations.id),\n  clientName: text(\"client_name\").notNull(),\n  clientCompany: text(\"client_company\"),\n  clientPocName: text(\"client_poc_name\"),\n  clientPocEmail: text(\"client_poc_email\"),\n  clientRequestNotes: text(\"client_request_notes\"), // Free-text notes summarizing original email request\n  description: text(\"description\"),\n  industry: text(\"industry\").notNull(),\n  region: text(\"region\"),\n  status: text(\"status\").notNull().default(\"new\"), // new, sourcing, shortlisted, confirmed, completed, cancelled\n  budget: decimal(\"budget\", { precision: 10, scale: 2 }),\n  startDate: timestamp(\"start_date\"),\n  endDate: timestamp(\"end_date\"),\n  dueDate: timestamp(\"due_date\"),\n  createdByPmId: integer(\"created_by_pm_id\").references(() => users.id),\n  assignedRaId: integer(\"assigned_ra_id\").references(() => users.id), // Legacy single RA\n  assignedRaIds: integer(\"assigned_ra_ids\").array(), // Multiple RAs for sourcing\n  totalCuUsed: decimal(\"total_cu_used\", { precision: 10, scale: 2 }).default(\"0\"),\n  cuRatePerCU: decimal(\"cu_rate_per_cu\", { precision: 10, scale: 2 }).default(\"1150\"), // USD 1,150 default\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n  updatedAt: timestamp(\"updated_at\").defaultNow().notNull(),\n});\n\n// Experts table (Extended)\nexport const experts = pgTable(\"experts\", {\n  id: serial(\"id\").primaryKey(),\n  name: text(\"name\").notNull(),\n  email: text(\"email\").notNull().unique(),\n  passwordHash: text(\"password_hash\"),\n  phone: text(\"phone\"),\n  linkedinUrl: text(\"linkedin_url\"),\n  country: text(\"country\"),\n  city: text(\"city\"), // City for geographic filtering\n  timezone: text(\"timezone\"),\n  whatsapp: text(\"whatsapp\"),\n  expertise: text(\"expertise\").notNull(),\n  areasOfExpertise: text(\"areas_of_expertise\").array(),\n  industry: text(\"industry\").notNull(),\n  company: text(\"company\"), // Current employer\n  pastEmployers: text(\"past_employers\").array(), // List of past employer names\n  jobTitle: text(\"job_title\"),\n  yearsOfExperience: integer(\"years_of_experience\").notNull(),\n  hourlyRate: decimal(\"hourly_rate\", { precision: 10, scale: 2 }).notNull(),\n  bio: text(\"bio\"),\n  workHistory: jsonb(\"work_history\").$type<Array<{ company: string; jobTitle: string; fromYear: number; toYear: number }>>(), // Work history entries\n  biography: text(\"biography\"), // Detailed biography for RA review/editing\n  status: text(\"status\").notNull().default(\"available\"), // available, busy, inactive\n  availableNow: boolean(\"available_now\").default(true), // Whether expert is currently available\n  nextAvailableDate: timestamp(\"next_available_date\"), // When expert becomes available next\n  totalHoursWorked: decimal(\"total_hours_worked\", { precision: 10, scale: 2 }).default(\"0\"), // Total hours in past projects\n  recruitedBy: text(\"recruited_by\"),\n  sourcedByRaId: integer(\"sourced_by_ra_id\").references(() => users.id),\n  sourcedAt: timestamp(\"sourced_at\"),\n  termsAccepted: boolean(\"terms_accepted\").default(false),\n  lgpdAccepted: boolean(\"lgpd_accepted\").default(false),\n  billingInfo: text(\"billing_info\"),\n  languages: text(\"languages\").array(), // Languages spoken by expert (e.g., [\"en\", \"pt\", \"es\"])\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n});\n\n// Project Angles table (groups of vetting questions per project)\nexport const projectAngles = pgTable(\"project_angles\", {\n  id: serial(\"id\").primaryKey(),\n  projectId: integer(\"project_id\").notNull().references(() => projects.id, { onDelete: \"cascade\" }),\n  title: text(\"title\").notNull(),\n  description: text(\"description\"),\n  orderIndex: integer(\"order_index\").notNull().default(0),\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n  updatedAt: timestamp(\"updated_at\").defaultNow().notNull(),\n});\n\n// Vetting Questions table (linked to Angles)\nexport const vettingQuestions = pgTable(\"vetting_questions\", {\n  id: serial(\"id\").primaryKey(),\n  projectId: integer(\"project_id\").notNull().references(() => projects.id, { onDelete: \"cascade\" }),\n  angleId: integer(\"angle_id\").references(() => projectAngles.id, { onDelete: \"cascade\" }), // Optional: null = project-level, set = angle-specific\n  question: text(\"question\").notNull(),\n  questionType: text(\"question_type\").notNull().default(\"text\"), // text, yes_no, scale\n  orderIndex: integer(\"order_index\").notNull().default(0),\n  isRequired: boolean(\"is_required\").notNull().default(true),\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n});\n\n// Project-Expert Assignments table (Extended with invitation flow and angle support)\nexport const projectExperts = pgTable(\"project_experts\", {\n  id: serial(\"id\").primaryKey(),\n  projectId: integer(\"project_id\").notNull().references(() => projects.id, { onDelete: \"cascade\" }),\n  expertId: integer(\"expert_id\").notNull().references(() => experts.id, { onDelete: \"cascade\" }),\n  angleIds: integer(\"angle_ids\").array(), // Array of angle IDs this expert is relevant for\n  status: text(\"status\").notNull().default(\"assigned\"), // assigned, invited, accepted, declined, client_selected, scheduled, completed\n  invitationStatus: text(\"invitation_status\").notNull().default(\"not_invited\"), // not_invited, invited, opened, accepted, declined\n  pipelineStatus: text(\"pipeline_status\").notNull().default(\"interested\"), // interested, shortlisted, accepted, declined, completed\n  sourceType: text(\"source_type\").notNull().default(\"internal_db\"), // internal_db, ra_external\n  sourcedByRaId: integer(\"sourced_by_ra_id\").references(() => users.id), // RA who sourced this expert for this project\n  assignedAt: timestamp(\"assigned_at\").defaultNow().notNull(),\n  invitedAt: timestamp(\"invited_at\"),\n  openedAt: timestamp(\"opened_at\"), // When expert opened the invite link\n  respondedAt: timestamp(\"responded_at\"),\n  invitationToken: text(\"invitation_token\").unique(),\n  vqAnswers: jsonb(\"vq_answers\").$type<{ questionId: number; questionText: string; answerText: string }[]>(),\n  availabilityNote: text(\"availability_note\"),\n  availabilitySlots: jsonb(\"availability_slots\").$type<{ date: string; startTime: string; endTime: string; timezone: string }[]>(), // Structured time slots for consultations\n  notes: text(\"notes\"),\n  lastActivityAt: timestamp(\"last_activity_at\"),\n});\n\n// Call Records table (CU Usage with scheduling)\nexport const callRecords = pgTable(\"call_records\", {\n  id: serial(\"id\").primaryKey(),\n  projectId: integer(\"project_id\").notNull().references(() => projects.id, { onDelete: \"cascade\" }),\n  expertId: integer(\"expert_id\").notNull().references(() => experts.id, { onDelete: \"cascade\" }),\n  projectExpertId: integer(\"project_expert_id\").references(() => projectExperts.id),\n  pmId: integer(\"pm_id\").references(() => users.id),\n  raId: integer(\"ra_id\").references(() => users.id),\n  callDate: timestamp(\"call_date\").notNull(),\n  scheduledStartTime: timestamp(\"scheduled_start_time\"),\n  scheduledEndTime: timestamp(\"scheduled_end_time\"),\n  actualDurationMinutes: integer(\"actual_duration_minutes\"),\n  durationMinutes: integer(\"duration_minutes\").notNull(),\n  cuUsed: decimal(\"cu_used\", { precision: 10, scale: 2 }).notNull(),\n  status: text(\"status\").notNull().default(\"pending\"), // pending, scheduled, completed, cancelled, no_show\n  completedAt: timestamp(\"completed_at\"),\n  zoomLink: text(\"zoom_link\"),\n  recordingUrl: text(\"recording_url\"),\n  notes: text(\"notes\"),\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n});\n\n// Expert Invitation Links table (Extended with types)\n// Each invitation generates a UNIQUE token - tokens are never reused\nexport const expertInvitationLinks = pgTable(\"expert_invitation_links\", {\n  id: serial(\"id\").primaryKey(),\n  token: text(\"token\").notNull().unique(),\n  projectId: integer(\"project_id\").references(() => projects.id, { onDelete: \"cascade\" }),\n  raId: integer(\"ra_id\").references(() => users.id), // RA user ID for RA-specific links\n  expertId: integer(\"expert_id\").references(() => experts.id), // For existing expert invites\n  angleIds: integer(\"angle_ids\").array(), // Angles this expert is being invited for\n  inviteType: text(\"invite_type\").notNull().default(\"general\"), // general, ra, existing\n  candidateName: text(\"candidate_name\"), // Optional: Name of candidate invite was created for\n  candidateEmail: text(\"candidate_email\"), // Optional: Email of candidate invite was created for\n  status: text(\"status\").notNull().default(\"pending\"), // pending, accepted, declined, expired\n  recruitedBy: text(\"recruited_by\").notNull(),\n  isActive: boolean(\"is_active\").notNull().default(true),\n  expiresAt: timestamp(\"expires_at\"),\n  usedAt: timestamp(\"used_at\"),\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n  updatedAt: timestamp(\"updated_at\").defaultNow().notNull(),\n});\n\n// Project Activities table (for activity log)\nexport const projectActivities = pgTable(\"project_activities\", {\n  id: serial(\"id\").primaryKey(),\n  projectId: integer(\"project_id\").notNull().references(() => projects.id, { onDelete: \"cascade\" }),\n  userId: integer(\"user_id\").references(() => users.id),\n  expertId: integer(\"expert_id\").references(() => experts.id),\n  activityType: text(\"activity_type\").notNull(), // expert_assigned, expert_invited, expert_accepted, expert_declined, ra_assigned, status_changed, note_added\n  description: text(\"description\").notNull(),\n  metadata: jsonb(\"metadata\").$type<Record<string, any>>(),\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n});\n\n// Legacy usage records (keeping for backward compatibility)\nexport const usageRecords = pgTable(\"usage_records\", {\n  id: serial(\"id\").primaryKey(),\n  projectId: integer(\"project_id\").notNull().references(() => projects.id, { onDelete: \"cascade\" }),\n  expertId: integer(\"expert_id\").notNull().references(() => experts.id, { onDelete: \"cascade\" }),\n  callDate: timestamp(\"call_date\").notNull(),\n  durationMinutes: integer(\"duration_minutes\").notNull(),\n  creditsUsed: decimal(\"credits_used\", { precision: 10, scale: 2 }).notNull(),\n  notes: text(\"notes\"),\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n});\n\n// Relations\nexport const usersRelations = relations(users, ({ many }) => ({\n  managedOrganizations: many(clientOrganizations),\n  createdProjects: many(projects, { relationName: \"createdBy\" }),\n  assistedProjects: many(projects, { relationName: \"assignedRa\" }),\n}));\n\nexport const clientOrganizationsRelations = relations(clientOrganizations, ({ one, many }) => ({\n  mainPm: one(users, {\n    fields: [clientOrganizations.mainPmId],\n    references: [users.id],\n  }),\n  pocs: many(clientPocs),\n  projects: many(projects),\n}));\n\nexport const clientPocsRelations = relations(clientPocs, ({ one }) => ({\n  organization: one(clientOrganizations, {\n    fields: [clientPocs.organizationId],\n    references: [clientOrganizations.id],\n  }),\n}));\n\nexport const projectsRelations = relations(projects, ({ one, many }) => ({\n  clientOrganization: one(clientOrganizations, {\n    fields: [projects.clientOrganizationId],\n    references: [clientOrganizations.id],\n  }),\n  createdBy: one(users, {\n    fields: [projects.createdByPmId],\n    references: [users.id],\n    relationName: \"createdBy\",\n  }),\n  assignedRa: one(users, {\n    fields: [projects.assignedRaId],\n    references: [users.id],\n    relationName: \"assignedRa\",\n  }),\n  angles: many(projectAngles),\n  vettingQuestions: many(vettingQuestions),\n  projectExperts: many(projectExperts),\n  callRecords: many(callRecords),\n  usageRecords: many(usageRecords),\n  invitationLinks: many(expertInvitationLinks),\n}));\n\nexport const projectAnglesRelations = relations(projectAngles, ({ one, many }) => ({\n  project: one(projects, {\n    fields: [projectAngles.projectId],\n    references: [projects.id],\n  }),\n  vettingQuestions: many(vettingQuestions),\n}));\n\nexport const expertsRelations = relations(experts, ({ one, many }) => ({\n  sourcedByRa: one(users, {\n    fields: [experts.sourcedByRaId],\n    references: [users.id],\n    relationName: \"sourcedExperts\",\n  }),\n  projectExperts: many(projectExperts),\n  callRecords: many(callRecords),\n  usageRecords: many(usageRecords),\n}));\n\nexport const vettingQuestionsRelations = relations(vettingQuestions, ({ one }) => ({\n  project: one(projects, {\n    fields: [vettingQuestions.projectId],\n    references: [projects.id],\n  }),\n  angle: one(projectAngles, {\n    fields: [vettingQuestions.angleId],\n    references: [projectAngles.id],\n  }),\n}));\n\nexport const projectExpertsRelations = relations(projectExperts, ({ one, many }) => ({\n  project: one(projects, {\n    fields: [projectExperts.projectId],\n    references: [projects.id],\n  }),\n  expert: one(experts, {\n    fields: [projectExperts.expertId],\n    references: [experts.id],\n  }),\n  sourcedByRa: one(users, {\n    fields: [projectExperts.sourcedByRaId],\n    references: [users.id],\n    relationName: \"sourcedProjectExperts\",\n  }),\n  callRecords: many(callRecords),\n}));\n\nexport const callRecordsRelations = relations(callRecords, ({ one }) => ({\n  project: one(projects, {\n    fields: [callRecords.projectId],\n    references: [projects.id],\n  }),\n  expert: one(experts, {\n    fields: [callRecords.expertId],\n    references: [experts.id],\n  }),\n  projectExpert: one(projectExperts, {\n    fields: [callRecords.projectExpertId],\n    references: [projectExperts.id],\n  }),\n  pm: one(users, {\n    fields: [callRecords.pmId],\n    references: [users.id],\n    relationName: \"pmCalls\",\n  }),\n  ra: one(users, {\n    fields: [callRecords.raId],\n    references: [users.id],\n    relationName: \"raCalls\",\n  }),\n}));\n\nexport const expertInvitationLinksRelations = relations(expertInvitationLinks, ({ one }) => ({\n  project: one(projects, {\n    fields: [expertInvitationLinks.projectId],\n    references: [projects.id],\n  }),\n  ra: one(users, {\n    fields: [expertInvitationLinks.raId],\n    references: [users.id],\n    relationName: \"raInviteLinks\",\n  }),\n  expert: one(experts, {\n    fields: [expertInvitationLinks.expertId],\n    references: [experts.id],\n  }),\n}));\n\nexport const projectActivitiesRelations = relations(projectActivities, ({ one }) => ({\n  project: one(projects, {\n    fields: [projectActivities.projectId],\n    references: [projects.id],\n  }),\n  user: one(users, {\n    fields: [projectActivities.userId],\n    references: [users.id],\n  }),\n  expert: one(experts, {\n    fields: [projectActivities.expertId],\n    references: [experts.id],\n  }),\n}));\n\nexport const usageRecordsRelations = relations(usageRecords, ({ one }) => ({\n  project: one(projects, {\n    fields: [usageRecords.projectId],\n    references: [projects.id],\n  }),\n  expert: one(experts, {\n    fields: [usageRecords.expertId],\n    references: [experts.id],\n  }),\n}));\n\n// Helper for coercing date strings to Date objects\nconst coerceDate = z.preprocess((val) => {\n  if (val === null || val === undefined || val === \"\") return null;\n  if (val instanceof Date) return val;\n  if (typeof val === \"string\") return new Date(val);\n  return val;\n}, z.date().nullable());\n\nconst coerceDateRequired = z.preprocess((val) => {\n  if (val instanceof Date) return val;\n  if (typeof val === \"string\") return new Date(val);\n  return val;\n}, z.date());\n\n// Insert schemas\nexport const insertUserSchema = createInsertSchema(users).omit({\n  id: true,\n  createdAt: true,\n}).extend({\n  mustChangePassword: z.boolean().default(false),\n});\n\nexport const insertClientSchema = createInsertSchema(clients).omit({\n  id: true,\n  createdAt: true,\n});\n\nexport const insertClientOrganizationSchema = createInsertSchema(clientOrganizations).omit({\n  id: true,\n  createdAt: true,\n  totalCuUsed: true,\n});\n\nexport const insertClientPocSchema = createInsertSchema(clientPocs).omit({\n  id: true,\n  createdAt: true,\n});\n\nexport const insertProjectSchema = createInsertSchema(projects).omit({\n  id: true,\n  createdAt: true,\n  updatedAt: true,\n  totalCuUsed: true,\n}).extend({\n  startDate: coerceDate.optional(),\n  endDate: coerceDate.optional(),\n  dueDate: coerceDate.optional(),\n});\n\nexport const insertExpertSchema = createInsertSchema(experts).omit({\n  id: true,\n  createdAt: true,\n}).extend({\n  sourcedAt: coerceDate.optional(),\n});\n\nexport const insertProjectAngleSchema = createInsertSchema(projectAngles).omit({\n  id: true,\n  createdAt: true,\n  updatedAt: true,\n});\n\nexport const insertVettingQuestionSchema = createInsertSchema(vettingQuestions).omit({\n  id: true,\n  createdAt: true,\n});\n\nexport const insertProjectExpertSchema = createInsertSchema(projectExperts).omit({\n  id: true,\n  assignedAt: true,\n}).extend({\n  invitedAt: coerceDate.optional(),\n  openedAt: coerceDate.optional(),\n  respondedAt: coerceDate.optional(),\n  lastActivityAt: coerceDate.optional(),\n});\n\nexport const insertCallRecordSchema = createInsertSchema(callRecords).omit({\n  id: true,\n  createdAt: true,\n}).extend({\n  callDate: coerceDateRequired,\n  scheduledStartTime: coerceDate.optional(),\n  scheduledEndTime: coerceDate.optional(),\n  completedAt: coerceDate.optional(),\n});\n\nexport const insertExpertInvitationLinkSchema = createInsertSchema(expertInvitationLinks).omit({\n  id: true,\n  createdAt: true,\n  updatedAt: true,\n  usedAt: true,\n}).extend({\n  expiresAt: coerceDate.optional(),\n});\n\nexport const insertProjectActivitySchema = createInsertSchema(projectActivities).omit({\n  id: true,\n  createdAt: true,\n});\n\nexport const insertUsageRecordSchema = createInsertSchema(usageRecords).omit({\n  id: true,\n  createdAt: true,\n}).extend({\n  callDate: coerceDateRequired,\n});\n\n// Types\nexport type User = typeof users.$inferSelect;\nexport type InsertUser = z.infer<typeof insertUserSchema>;\n\nexport type Client = typeof clients.$inferSelect;\nexport type InsertClient = z.infer<typeof insertClientSchema>;\n\nexport type ClientOrganization = typeof clientOrganizations.$inferSelect;\nexport type InsertClientOrganization = z.infer<typeof insertClientOrganizationSchema>;\n\nexport type ClientPoc = typeof clientPocs.$inferSelect;\nexport type InsertClientPoc = z.infer<typeof insertClientPocSchema>;\n\nexport type Project = typeof projects.$inferSelect;\nexport type InsertProject = z.infer<typeof insertProjectSchema>;\n\nexport type Expert = typeof experts.$inferSelect;\nexport type InsertExpert = z.infer<typeof insertExpertSchema>;\n\nexport type ProjectAngle = typeof projectAngles.$inferSelect;\nexport type InsertProjectAngle = z.infer<typeof insertProjectAngleSchema>;\n\nexport type VettingQuestion = typeof vettingQuestions.$inferSelect;\nexport type InsertVettingQuestion = z.infer<typeof insertVettingQuestionSchema>;\n\nexport type ProjectExpert = typeof projectExperts.$inferSelect;\nexport type InsertProjectExpert = z.infer<typeof insertProjectExpertSchema>;\n\nexport type CallRecord = typeof callRecords.$inferSelect;\nexport type InsertCallRecord = z.infer<typeof insertCallRecordSchema>;\n\nexport type ExpertInvitationLink = typeof expertInvitationLinks.$inferSelect;\nexport type InsertExpertInvitationLink = z.infer<typeof insertExpertInvitationLinkSchema>;\n\nexport type UsageRecord = typeof usageRecords.$inferSelect;\nexport type InsertUsageRecord = z.infer<typeof insertUsageRecordSchema>;\n\nexport type ProjectActivity = typeof projectActivities.$inferSelect;\nexport type InsertProjectActivity = z.infer<typeof insertProjectActivitySchema>;\n\n// CU Calculation Helper (1 CU = 60 minutes, 0.25 CU increments, min 1 CU if > 52 min)\nexport function calculateCU(durationMinutes: number): number {\n  if (durationMinutes <= 0) return 0;\n  if (durationMinutes > 52) {\n    return Math.max(1, Math.ceil((durationMinutes / 60) * 4) / 4);\n  }\n  return Math.ceil((durationMinutes / 60) * 4) / 4;\n}\n\n// Project status flow\nexport const PROJECT_STATUSES = [\n  \"new\",\n  \"sourcing\",\n  \"shortlisted\",\n  \"confirmed\",\n  \"scheduled\",\n  \"completed\",\n  \"cancelled\",\n] as const;\n\nexport const PROJECT_EXPERT_STATUSES = [\n  \"assigned\",\n  \"invited\",\n  \"accepted\",\n  \"declined\",\n  \"client_selected\",\n  \"scheduled\",\n  \"completed\",\n] as const;\n\n// Expert invitation status for project participation\nexport const INVITATION_STATUSES = [\n  \"not_invited\",\n  \"invited\",\n  \"opened\",\n  \"accepted\",\n  \"declined\",\n] as const;\n\n// Expert pipeline status within a project\nexport const PIPELINE_STATUSES = [\n  \"interested\",\n  \"shortlisted\",\n  \"accepted\",\n  \"declined\",\n  \"completed\",\n] as const;\n\n// Source type for how expert was added to project\nexport const SOURCE_TYPES = [\n  \"internal_db\",\n  \"ra_external\",\n] as const;\n\n// Invite link types\nexport const INVITE_TYPES = [\n  \"general\",\n  \"ra\",\n  \"existing\",\n] as const;\n\n// Activity types for project activity log\nexport const ACTIVITY_TYPES = [\n  \"project_created\",\n  \"expert_assigned\",\n  \"expert_invited\",\n  \"expert_opened\",\n  \"expert_accepted\",\n  \"expert_declined\",\n  \"ra_assigned\",\n  \"status_changed\",\n  \"note_added\",\n] as const;\n\nexport const CALL_STATUSES = [\n  \"pending\",\n  \"scheduled\",\n  \"completed\",\n  \"cancelled\",\n  \"no_show\",\n] as const;\n\n// Internal employee roles only (no client/expert login)\nexport const USER_ROLES = [\n  \"admin\",\n  \"pm\",\n  \"ra\",\n  \"finance\",\n] as const;\n\nexport const CLIENT_STATUSES = [\n  \"active\",\n  \"inactive\", \n  \"prospect\",\n] as const;\n","path":null,"size_bytes":23476,"size_tokens":null},"client/src/components/ui/input.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Input = React.forwardRef<HTMLInputElement, React.ComponentProps<\"input\">>(\n  ({ className, type, ...props }, ref) => {\n    // h-9 to match icon buttons and default buttons.\n    return (\n      <input\n        type={type}\n        className={cn(\n          \"flex h-9 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm\",\n          className\n        )}\n        ref={ref}\n        {...props}\n      />\n    )\n  }\n)\nInput.displayName = \"Input\"\n\nexport { Input }\n","path":null,"size_bytes":844,"size_tokens":null},"client/src/components/ui/separator.tsx":{"content":"import * as React from \"react\"\nimport * as SeparatorPrimitive from \"@radix-ui/react-separator\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Separator = React.forwardRef<\n  React.ElementRef<typeof SeparatorPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof SeparatorPrimitive.Root>\n>(\n  (\n    { className, orientation = \"horizontal\", decorative = true, ...props },\n    ref\n  ) => (\n    <SeparatorPrimitive.Root\n      ref={ref}\n      decorative={decorative}\n      orientation={orientation}\n      className={cn(\n        \"shrink-0 bg-border\",\n        orientation === \"horizontal\" ? \"h-[1px] w-full\" : \"h-full w-[1px]\",\n        className\n      )}\n      {...props}\n    />\n  )\n)\nSeparator.displayName = SeparatorPrimitive.Root.displayName\n\nexport { Separator }\n","path":null,"size_bytes":756,"size_tokens":null},"client/src/components/metric-card.tsx":{"content":"import { Card, CardContent } from \"@/components/ui/card\";\nimport { cn } from \"@/lib/utils\";\nimport type { LucideIcon } from \"lucide-react\";\n\ninterface MetricCardProps {\n  title: string;\n  value: string | number;\n  subtitle?: string;\n  icon: LucideIcon;\n  trend?: {\n    value: number;\n    isPositive: boolean;\n  };\n  className?: string;\n}\n\nexport function MetricCard({\n  title,\n  value,\n  subtitle,\n  icon: Icon,\n  trend,\n  className,\n}: MetricCardProps) {\n  return (\n    <Card className={cn(\"\", className)} data-testid={`card-metric-${title.toLowerCase().replace(/\\s+/g, '-')}`}>\n      <CardContent className=\"p-6\">\n        <div className=\"flex items-start justify-between gap-4\">\n          <div className=\"flex-1 space-y-2\">\n            <p className=\"text-xs font-medium uppercase tracking-wide text-muted-foreground\">\n              {title}\n            </p>\n            <div className=\"flex items-baseline gap-2\">\n              <span className=\"font-mono text-2xl font-bold text-foreground\">\n                {value}\n              </span>\n              {trend && (\n                <span\n                  className={cn(\n                    \"text-xs font-medium\",\n                    trend.isPositive ? \"text-emerald-600 dark:text-emerald-400\" : \"text-red-600 dark:text-red-400\"\n                  )}\n                >\n                  {trend.isPositive ? \"+\" : \"\"}{trend.value}%\n                </span>\n              )}\n            </div>\n            {subtitle && (\n              <p className=\"text-xs text-muted-foreground\">{subtitle}</p>\n            )}\n          </div>\n          <div className=\"flex h-10 w-10 shrink-0 items-center justify-center rounded-lg bg-primary/10\">\n            <Icon className=\"h-5 w-5 text-primary\" />\n          </div>\n        </div>\n      </CardContent>\n    </Card>\n  );\n}\n","path":null,"size_bytes":1803,"size_tokens":null},"client/src/components/theme-toggle.tsx":{"content":"import { useEffect, useState } from \"react\";\nimport { Moon, Sun } from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\n\nexport function ThemeToggle() {\n  const [theme, setTheme] = useState<\"light\" | \"dark\">(\"light\");\n\n  useEffect(() => {\n    const stored = localStorage.getItem(\"theme\") as \"light\" | \"dark\" | null;\n    if (stored) {\n      setTheme(stored);\n      document.documentElement.classList.toggle(\"dark\", stored === \"dark\");\n    } else if (window.matchMedia(\"(prefers-color-scheme: dark)\").matches) {\n      setTheme(\"dark\");\n      document.documentElement.classList.add(\"dark\");\n    }\n  }, []);\n\n  const toggleTheme = () => {\n    const newTheme = theme === \"light\" ? \"dark\" : \"light\";\n    setTheme(newTheme);\n    localStorage.setItem(\"theme\", newTheme);\n    document.documentElement.classList.toggle(\"dark\", newTheme === \"dark\");\n  };\n\n  return (\n    <Button\n      variant=\"ghost\"\n      size=\"icon\"\n      onClick={toggleTheme}\n      data-testid=\"button-theme-toggle\"\n    >\n      {theme === \"light\" ? (\n        <Moon className=\"h-4 w-4\" />\n      ) : (\n        <Sun className=\"h-4 w-4\" />\n      )}\n    </Button>\n  );\n}\n","path":null,"size_bytes":1142,"size_tokens":null},"client/src/components/ui/toast.tsx":{"content":"import * as React from \"react\"\nimport * as ToastPrimitives from \"@radix-ui/react-toast\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ToastProvider = ToastPrimitives.Provider\n\nconst ToastViewport = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Viewport>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Viewport>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Viewport\n    ref={ref}\n    className={cn(\n      \"fixed top-0 z-[100] flex max-h-screen w-full flex-col-reverse p-4 sm:bottom-0 sm:right-0 sm:top-auto sm:flex-col md:max-w-[420px]\",\n      className\n    )}\n    {...props}\n  />\n))\nToastViewport.displayName = ToastPrimitives.Viewport.displayName\n\nconst toastVariants = cva(\n  \"group pointer-events-auto relative flex w-full items-center justify-between space-x-4 overflow-hidden rounded-md border p-6 pr-8 shadow-lg transition-all data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=move]:transition-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=closed]:slide-out-to-right-full data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-bottom-full\",\n  {\n    variants: {\n      variant: {\n        default: \"border bg-background text-foreground\",\n        destructive:\n          \"destructive group border-destructive bg-destructive text-destructive-foreground\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nconst Toast = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Root>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Root> &\n    VariantProps<typeof toastVariants>\n>(({ className, variant, ...props }, ref) => {\n  return (\n    <ToastPrimitives.Root\n      ref={ref}\n      className={cn(toastVariants({ variant }), className)}\n      {...props}\n    />\n  )\n})\nToast.displayName = ToastPrimitives.Root.displayName\n\nconst ToastAction = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Action>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Action>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Action\n    ref={ref}\n    className={cn(\n      \"inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium ring-offset-background transition-colors hover:bg-secondary focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 group-[.destructive]:border-muted/40 group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground group-[.destructive]:focus:ring-destructive\",\n      className\n    )}\n    {...props}\n  />\n))\nToastAction.displayName = ToastPrimitives.Action.displayName\n\nconst ToastClose = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Close>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Close>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Close\n    ref={ref}\n    className={cn(\n      \"absolute right-2 top-2 rounded-md p-1 text-foreground/50 opacity-0 transition-opacity hover:text-foreground focus:opacity-100 focus:outline-none focus:ring-2 group-hover:opacity-100 group-[.destructive]:text-red-300 group-[.destructive]:hover:text-red-50 group-[.destructive]:focus:ring-red-400 group-[.destructive]:focus:ring-offset-red-600\",\n      className\n    )}\n    toast-close=\"\"\n    {...props}\n  >\n    <X className=\"h-4 w-4\" />\n  </ToastPrimitives.Close>\n))\nToastClose.displayName = ToastPrimitives.Close.displayName\n\nconst ToastTitle = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Title>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Title>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Title\n    ref={ref}\n    className={cn(\"text-sm font-semibold\", className)}\n    {...props}\n  />\n))\nToastTitle.displayName = ToastPrimitives.Title.displayName\n\nconst ToastDescription = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Description>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Description>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Description\n    ref={ref}\n    className={cn(\"text-sm opacity-90\", className)}\n    {...props}\n  />\n))\nToastDescription.displayName = ToastPrimitives.Description.displayName\n\ntype ToastProps = React.ComponentPropsWithoutRef<typeof Toast>\n\ntype ToastActionElement = React.ReactElement<typeof ToastAction>\n\nexport {\n  type ToastProps,\n  type ToastActionElement,\n  ToastProvider,\n  ToastViewport,\n  Toast,\n  ToastTitle,\n  ToastDescription,\n  ToastClose,\n  ToastAction,\n}\n","path":null,"size_bytes":4845,"size_tokens":null},"client/src/main.tsx":{"content":"import { createRoot } from \"react-dom/client\";\nimport App from \"./App\";\nimport \"./index.css\";\n\ncreateRoot(document.getElementById(\"root\")!).render(<App />);\n","path":null,"size_bytes":157,"size_tokens":null},"client/src/pages/login.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { useLocation } from \"wouter\";\nimport { useForm } from \"react-hook-form\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport { z } from \"zod\";\nimport { useAuth } from \"@/lib/auth\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Form, FormControl, FormField, FormItem, FormLabel, FormMessage } from \"@/components/ui/form\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { Loader2 } from \"lucide-react\";\nimport logoUrl from \"@assets/Logo_1764384177823.png\";\n\nconst loginSchema = z.object({\n  email: z.string().email(\"Please enter a valid email\"),\n  password: z.string().min(1, \"Password is required\"),\n});\n\ntype LoginForm = z.infer<typeof loginSchema>;\n\nexport default function Login() {\n  const { login, isAuthenticated, isLoading } = useAuth();\n  const [, setLocation] = useLocation();\n  const [isSubmitting, setIsSubmitting] = useState(false);\n  const { toast } = useToast();\n\n  const form = useForm<LoginForm>({\n    resolver: zodResolver(loginSchema),\n    defaultValues: {\n      email: \"\",\n      password: \"\",\n    },\n  });\n\n  useEffect(() => {\n    if (!isLoading && isAuthenticated) {\n      setLocation(\"/\");\n    }\n  }, [isAuthenticated, isLoading, setLocation]);\n\n  const onSubmit = async (data: LoginForm) => {\n    setIsSubmitting(true);\n    try {\n      await login(data.email, data.password);\n      toast({ title: \"Welcome back!\" });\n    } catch (error) {\n      toast({\n        title: \"Login failed\",\n        description: error instanceof Error ? error.message : \"Invalid email or password\",\n        variant: \"destructive\",\n      });\n    } finally {\n      setIsSubmitting(false);\n    }\n  };\n\n  if (isLoading) {\n    return (\n      <div className=\"flex h-screen items-center justify-center bg-background\" data-testid=\"loading-login\">\n        <div className=\"h-8 w-8 animate-spin rounded-full border-4 border-primary border-t-transparent\" />\n      </div>\n    );\n  }\n\n  if (isAuthenticated) {\n    return null;\n  }\n\n  return (\n    <div className=\"flex min-h-screen items-center justify-center bg-muted/30 p-4\" data-testid=\"page-login\">\n      <Card className=\"w-full max-w-md\">\n        <CardHeader className=\"space-y-1 text-center\">\n          <div className=\"mx-auto mb-4\">\n            <img src={logoUrl} alt=\"Mirae Connext\" className=\"h-20 w-20\" />\n          </div>\n          <CardTitle className=\"text-2xl font-bold\" data-testid=\"text-login-title\">\n            Mirae Connext\n          </CardTitle>\n          <CardDescription>\n            Sign in to access the expert network platform\n          </CardDescription>\n        </CardHeader>\n        <CardContent>\n          <Form {...form}>\n            <form onSubmit={form.handleSubmit(onSubmit)} className=\"space-y-4\">\n              <FormField\n                control={form.control}\n                name=\"email\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>Email</FormLabel>\n                    <FormControl>\n                      <Input\n                        type=\"email\"\n                        placeholder=\"you@example.com\"\n                        autoComplete=\"email\"\n                        data-testid=\"input-email\"\n                        {...field}\n                      />\n                    </FormControl>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n              <FormField\n                control={form.control}\n                name=\"password\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>Password</FormLabel>\n                    <FormControl>\n                      <Input\n                        type=\"password\"\n                        placeholder=\"Enter your password\"\n                        autoComplete=\"current-password\"\n                        data-testid=\"input-password\"\n                        {...field}\n                      />\n                    </FormControl>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n              <Button\n                type=\"submit\"\n                className=\"w-full\"\n                disabled={isSubmitting}\n                data-testid=\"button-login\"\n              >\n                {isSubmitting ? (\n                  <>\n                    <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />\n                    Signing in...\n                  </>\n                ) : (\n                  \"Sign in\"\n                )}\n              </Button>\n            </form>\n          </Form>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","path":null,"size_bytes":4786,"size_tokens":null},"client/src/pages/experts.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { useForm } from \"react-hook-form\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport { z } from \"zod\";\nimport { Plus, Pencil, Trash2, Search, Users, Mail, Phone, Briefcase, DollarSign, X } from \"lucide-react\";\nimport { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from \"@/components/ui/table\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Avatar, AvatarFallback } from \"@/components/ui/avatar\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogDescription,\n  DialogFooter,\n  DialogHeader,\n  DialogTitle,\n} from \"@/components/ui/dialog\";\nimport {\n  Form,\n  FormControl,\n  FormField,\n  FormItem,\n  FormLabel,\n  FormMessage,\n} from \"@/components/ui/form\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport {\n  AlertDialog,\n  AlertDialogAction,\n  AlertDialogCancel,\n  AlertDialogContent,\n  AlertDialogDescription,\n  AlertDialogFooter,\n  AlertDialogHeader,\n  AlertDialogTitle,\n} from \"@/components/ui/alert-dialog\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport { Slider } from \"@/components/ui/slider\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { queryClient, apiRequest } from \"@/lib/queryClient\";\nimport { StatusBadge } from \"@/components/status-badge\";\nimport { EmptyState } from \"@/components/empty-state\";\nimport type { Expert, InsertExpert } from \"@shared/schema\";\nimport { format } from \"date-fns\";\n\ninterface ExpertWithRecruiter extends Expert {\n  recruiterName: string | null;\n  recruiterEmail: string | null;\n}\n\ninterface WorkExperience {\n  company: string;\n  jobTitle: string;\n  fromYear: number;\n  toYear: number;\n}\n\nconst expertFormSchema = z.object({\n  name: z.string().min(1, \"Name is required\"),\n  email: z.string().email(\"Valid email is required\"),\n  phone: z.string().optional(),\n  expertise: z.string().min(1, \"Expertise is required\"),\n  industry: z.string().min(1, \"Industry is required\"),\n  yearsOfExperience: z.coerce.number().min(0, \"Must be 0 or greater\"),\n  hourlyRate: z.string().min(1, \"Hourly rate is required\"),\n  bio: z.string().optional(),\n  status: z.string().default(\"available\"),\n  company: z.string().optional(),\n  jobTitle: z.string().optional(),\n  linkedinUrl: z.string().optional(),\n  workHistory: z.array(z.object({\n    company: z.string().min(1, \"Company name required\"),\n    jobTitle: z.string().min(1, \"Job title required\"),\n    fromYear: z.coerce.number().min(1900, \"Year must be 1900 or later\"),\n    toYear: z.coerce.number().min(1900, \"Year must be 1900 or later\"),\n  }).refine(\n    (exp) => exp.fromYear <= exp.toYear,\n    { message: \"Start year must be before end year\", path: [\"toYear\"] }\n  )).default([]),\n}).refine(\n  (data) => {\n    // Ensure workHistory always exists (empty array if not provided)\n    return data.workHistory !== undefined;\n  },\n  { message: \"Work history must be an array\" }\n);\n\ntype ExpertFormData = z.infer<typeof expertFormSchema>;\n\nconst industries = [\n  \"Technology\",\n  \"Healthcare\",\n  \"Finance\",\n  \"Manufacturing\",\n  \"Energy\",\n  \"Retail\",\n  \"Consulting\",\n  \"Legal\",\n  \"Real Estate\",\n  \"Education\",\n  \"Other\",\n];\n\nconst statuses = [\"available\", \"busy\", \"inactive\"];\n\nexport default function Experts() {\n  const { toast } = useToast();\n  const [searchQuery, setSearchQuery] = useState(\"\");\n  const [statusFilter, setStatusFilter] = useState<string[]>([\"available\", \"busy\", \"inactive\"]);\n  const [rateRange, setRateRange] = useState<[number, number]>([0, 500]);\n  const [isDialogOpen, setIsDialogOpen] = useState(false);\n  const [editingExpert, setEditingExpert] = useState<Expert | null>(null);\n  const [deletingExpert, setDeletingExpert] = useState<Expert | null>(null);\n  const [viewingExpert, setViewingExpert] = useState<ExpertWithRecruiter | null>(null);\n  const [workHistory, setWorkHistory] = useState<WorkExperience[]>([]);\n\n  const { data: experts, isLoading } = useQuery<ExpertWithRecruiter[]>({\n    queryKey: [\"/api/experts-with-recruiter\"],\n  });\n\n  const form = useForm<ExpertFormData>({\n    resolver: zodResolver(expertFormSchema),\n    defaultValues: {\n      name: \"\",\n      email: \"\",\n      phone: \"\",\n      expertise: \"\",\n      industry: \"\",\n      yearsOfExperience: 0,\n      hourlyRate: \"\",\n      bio: \"\",\n      status: \"available\",\n      company: \"\",\n      jobTitle: \"\",\n      linkedinUrl: \"\",\n      workHistory: [],\n    },\n  });\n\n  const createMutation = useMutation({\n    mutationFn: (data: InsertExpert) => apiRequest(\"POST\", \"/api/experts\", data),\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/experts-with-recruiter\"] });\n      setIsDialogOpen(false);\n      form.reset();\n      toast({ title: \"Expert registered successfully\" });\n    },\n    onError: () => {\n      toast({ title: \"Failed to register expert\", variant: \"destructive\" });\n    },\n  });\n\n  const updateMutation = useMutation({\n    mutationFn: (data: InsertExpert & { id: number }) =>\n      apiRequest(\"PATCH\", `/api/experts/${data.id}`, data),\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/experts-with-recruiter\"] });\n      setIsDialogOpen(false);\n      setEditingExpert(null);\n      form.reset();\n      toast({ title: \"Expert updated successfully\" });\n    },\n    onError: () => {\n      toast({ title: \"Failed to update expert\", variant: \"destructive\" });\n    },\n  });\n\n  const deleteMutation = useMutation({\n    mutationFn: (id: number) => apiRequest(\"DELETE\", `/api/experts/${id}`),\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/experts-with-recruiter\"] });\n      setDeletingExpert(null);\n      toast({ title: \"Expert removed successfully\" });\n    },\n    onError: () => {\n      toast({ title: \"Failed to remove expert\", variant: \"destructive\" });\n    },\n  });\n\n  const filteredExperts = experts?.filter((expert) => {\n    // Search filter\n    const searchMatch =\n      expert.name.toLowerCase().includes(searchQuery.toLowerCase()) ||\n      expert.expertise.toLowerCase().includes(searchQuery.toLowerCase()) ||\n      expert.industry.toLowerCase().includes(searchQuery.toLowerCase());\n\n    // Status filter\n    const statusMatch = statusFilter.includes(expert.status);\n\n    // Rate range filter\n    const rate = Number(expert.hourlyRate);\n    const rateMatch = rate >= rateRange[0] && rate <= rateRange[1];\n\n    return searchMatch && statusMatch && rateMatch;\n  });\n\n  const hasActiveFilters =\n    statusFilter.length < statuses.length ||\n    rateRange[0] > 0 ||\n    rateRange[1] < 500 ||\n    searchQuery.length > 0;\n\n  const resetFilters = () => {\n    setSearchQuery(\"\");\n    setStatusFilter([\"available\", \"busy\", \"inactive\"]);\n    setRateRange([0, 500]);\n  };\n\n  const handleOpenDialog = (expert?: Expert) => {\n    if (expert) {\n      setEditingExpert(expert);\n      const expertWorkHistory = (expert.workHistory as WorkExperience[]) || [];\n      setWorkHistory(expertWorkHistory);\n      form.reset({\n        name: expert.name,\n        email: expert.email,\n        phone: expert.phone || \"\",\n        expertise: expert.expertise,\n        industry: expert.industry,\n        yearsOfExperience: expert.yearsOfExperience,\n        hourlyRate: expert.hourlyRate.toString(),\n        bio: expert.bio || \"\",\n        status: expert.status,\n        company: expert.company || \"\",\n        jobTitle: expert.jobTitle || \"\",\n        linkedinUrl: expert.linkedinUrl || \"\",\n        workHistory: expertWorkHistory,\n      });\n    } else {\n      setEditingExpert(null);\n      setWorkHistory([]);\n      form.reset();\n    }\n    setIsDialogOpen(true);\n  };\n\n  const onSubmit = (data: ExpertFormData) => {\n    const expertData: InsertExpert = {\n      ...data,\n      phone: data.phone || null,\n      bio: data.bio || null,\n      company: data.company || null,\n      jobTitle: data.jobTitle || null,\n      linkedinUrl: data.linkedinUrl || null,\n      workHistory: workHistory,\n    };\n\n    if (editingExpert) {\n      updateMutation.mutate({ ...expertData, id: editingExpert.id });\n    } else {\n      createMutation.mutate(expertData);\n    }\n  };\n\n  const getInitials = (name: string) => {\n    return name\n      .split(\" \")\n      .map((n) => n[0])\n      .join(\"\")\n      .toUpperCase()\n      .slice(0, 2);\n  };\n\n  return (\n    <div className=\"space-y-6 p-8\">\n      <div className=\"flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between\">\n        <div>\n          <h1 className=\"text-3xl font-semibold text-foreground\">Experts</h1>\n          <p className=\"text-sm text-muted-foreground\">\n            Manage your expert network and view their profiles.\n          </p>\n        </div>\n        <Button onClick={() => handleOpenDialog()} className=\"gap-2\" data-testid=\"button-register-expert\">\n          <Plus className=\"h-4 w-4\" /> Register Expert\n        </Button>\n      </div>\n\n      <div className=\"space-y-4\">\n        <div className=\"flex flex-col gap-4\">\n          <div className=\"relative\">\n            <Search className=\"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground\" />\n            <Input\n              placeholder=\"Search by name, expertise, or industry...\"\n              value={searchQuery}\n              onChange={(e) => setSearchQuery(e.target.value)}\n              className=\"w-full pl-9 sm:max-w-md\"\n              data-testid=\"input-search-experts\"\n            />\n          </div>\n\n          <div className=\"flex flex-col gap-4 rounded-lg border border-border bg-card/50 p-4 sm:gap-6\">\n            <div>\n              <h3 className=\"mb-3 text-sm font-medium text-foreground\">Availability Status</h3>\n              <div className=\"flex flex-wrap gap-2\">\n                {statuses.map((status) => (\n                  <Button\n                    key={status}\n                    variant={statusFilter.includes(status) ? \"default\" : \"outline\"}\n                    size=\"sm\"\n                    onClick={() => {\n                      setStatusFilter((prev) =>\n                        prev.includes(status)\n                          ? prev.filter((s) => s !== status)\n                          : [...prev, status]\n                      );\n                    }}\n                    data-testid={`button-filter-status-${status}`}\n                  >\n                    {status.charAt(0).toUpperCase() + status.slice(1)}\n                  </Button>\n                ))}\n              </div>\n            </div>\n\n            <div>\n              <div className=\"mb-3 flex items-center justify-between\">\n                <h3 className=\"text-sm font-medium text-foreground\">Hourly Rate Range</h3>\n                <span className=\"text-sm text-muted-foreground font-mono\">\n                  ${rateRange[0]} - ${rateRange[1]}\n                </span>\n              </div>\n              <Slider\n                value={rateRange}\n                onValueChange={(value) =>\n                  setRateRange([value[0], value[1]])\n                }\n                min={0}\n                max={500}\n                step={10}\n                className=\"w-full\"\n                data-testid=\"slider-rate-range\"\n              />\n            </div>\n\n            {hasActiveFilters && (\n              <Button\n                variant=\"ghost\"\n                size=\"sm\"\n                onClick={resetFilters}\n                className=\"w-full justify-center gap-2\"\n                data-testid=\"button-reset-filters\"\n              >\n                <X className=\"h-4 w-4\" />\n                Reset Filters\n              </Button>\n            )}\n          </div>\n        </div>\n      </div>\n\n      {isLoading ? (\n        <div className=\"grid gap-4 sm:grid-cols-2 lg:grid-cols-3\">\n          {Array.from({ length: 6 }).map((_, i) => (\n            <Card key={i}>\n              <CardContent className=\"p-6\">\n                <div className=\"flex items-start gap-4\">\n                  <Skeleton className=\"h-12 w-12 rounded-full\" />\n                  <div className=\"flex-1 space-y-2\">\n                    <Skeleton className=\"h-4 w-24\" />\n                    <Skeleton className=\"h-3 w-32\" />\n                    <Skeleton className=\"h-3 w-20\" />\n                  </div>\n                </div>\n              </CardContent>\n            </Card>\n          ))}\n        </div>\n      ) : filteredExperts?.length === 0 ? (\n        <EmptyState\n          icon={Users}\n          title=\"No experts found\"\n          description={\n            searchQuery\n              ? \"Try adjusting your search query.\"\n              : \"Register your first expert to build your network.\"\n          }\n          action={\n            !searchQuery ? (\n              <Button onClick={() => handleOpenDialog()} className=\"gap-2\" data-testid=\"button-register-first-expert\">\n                <Plus className=\"h-4 w-4\" /> Register Expert\n              </Button>\n            ) : undefined\n          }\n        />\n      ) : (\n        <div className=\"grid gap-4 sm:grid-cols-2 lg:grid-cols-3\">\n          {filteredExperts?.map((expert) => (\n            <Card\n              key={expert.id}\n              className=\"cursor-pointer transition-colors hover-elevate\"\n              onClick={() => setViewingExpert(expert)}\n              data-testid={`card-expert-${expert.id}`}\n            >\n              <CardContent className=\"p-6\">\n                <div className=\"flex items-start justify-between gap-4\">\n                  <div className=\"flex items-start gap-4\">\n                    <Avatar className=\"h-12 w-12 border border-border\">\n                      <AvatarFallback className=\"bg-primary/10 text-primary\">\n                        {getInitials(expert.name)}\n                      </AvatarFallback>\n                    </Avatar>\n                    <div className=\"flex-1 space-y-1\">\n                      <h3 className=\"font-medium text-foreground\">{expert.name}</h3>\n                      <p className=\"text-sm text-muted-foreground\">{expert.expertise}</p>\n                      <div className=\"flex items-center gap-2\">\n                        <StatusBadge status={expert.status} type=\"expert\" />\n                      </div>\n                    </div>\n                  </div>\n                  <div className=\"flex gap-1\">\n                    <Button\n                      variant=\"ghost\"\n                      size=\"icon\"\n                      onClick={(e) => {\n                        e.stopPropagation();\n                        handleOpenDialog(expert);\n                      }}\n                      data-testid={`button-edit-expert-${expert.id}`}\n                    >\n                      <Pencil className=\"h-4 w-4\" />\n                    </Button>\n                    <Button\n                      variant=\"ghost\"\n                      size=\"icon\"\n                      onClick={(e) => {\n                        e.stopPropagation();\n                        setDeletingExpert(expert);\n                      }}\n                      data-testid={`button-delete-expert-${expert.id}`}\n                    >\n                      <Trash2 className=\"h-4 w-4 text-destructive\" />\n                    </Button>\n                  </div>\n                </div>\n                <div className=\"mt-4 flex flex-wrap gap-4 text-sm text-muted-foreground\">\n                  <div className=\"flex items-center gap-1\">\n                    <Briefcase className=\"h-3.5 w-3.5\" />\n                    <span>{expert.industry}</span>\n                  </div>\n                  <div className=\"flex items-center gap-1\">\n                    <DollarSign className=\"h-3.5 w-3.5\" />\n                    <span className=\"font-mono\">${Number(expert.hourlyRate).toFixed(0)}/hr</span>\n                  </div>\n                </div>\n                {expert.recruiterName && (\n                  <div className=\"mt-3 pt-3 border-t border-border\">\n                    <div className=\"flex items-center justify-between text-xs text-muted-foreground\">\n                      <span>Recruited by: <span className=\"font-medium text-foreground\">{expert.recruiterName}</span></span>\n                      {expert.sourcedAt && (\n                        <span>{format(new Date(expert.sourcedAt), \"MMM d, yyyy\")}</span>\n                      )}\n                    </div>\n                  </div>\n                )}\n              </CardContent>\n            </Card>\n          ))}\n        </div>\n      )}\n\n      <Dialog open={isDialogOpen} onOpenChange={setIsDialogOpen}>\n        <DialogContent className=\"max-h-[90vh] max-w-2xl overflow-y-auto\">\n          <DialogHeader>\n            <DialogTitle>{editingExpert ? \"Edit Expert\" : \"Register New Expert\"}</DialogTitle>\n            <DialogDescription>\n              {editingExpert\n                ? \"Update the expert's profile information.\"\n                : \"Add a new expert to your network.\"}\n            </DialogDescription>\n          </DialogHeader>\n          <Form {...form}>\n            <form onSubmit={form.handleSubmit(onSubmit)} className=\"space-y-4\">\n              <div className=\"grid gap-4 sm:grid-cols-2\">\n                <FormField\n                  control={form.control}\n                  name=\"name\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Full Name *</FormLabel>\n                      <FormControl>\n                        <Input placeholder=\"John Doe\" {...field} data-testid=\"input-expert-name\" />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n                <FormField\n                  control={form.control}\n                  name=\"email\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Email *</FormLabel>\n                      <FormControl>\n                        <Input\n                          type=\"email\"\n                          placeholder=\"john@example.com\"\n                          {...field}\n                          data-testid=\"input-expert-email\"\n                        />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n              </div>\n\n              <div className=\"grid gap-4 sm:grid-cols-2\">\n                <FormField\n                  control={form.control}\n                  name=\"phone\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Phone</FormLabel>\n                      <FormControl>\n                        <Input placeholder=\"+1 234 567 8900\" {...field} data-testid=\"input-expert-phone\" />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n                <FormField\n                  control={form.control}\n                  name=\"status\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Status</FormLabel>\n                      <Select onValueChange={field.onChange} value={field.value}>\n                        <FormControl>\n                          <SelectTrigger data-testid=\"select-expert-status\">\n                            <SelectValue placeholder=\"Select status\" />\n                          </SelectTrigger>\n                        </FormControl>\n                        <SelectContent>\n                          {statuses.map((status) => (\n                            <SelectItem key={status} value={status}>\n                              {status.charAt(0).toUpperCase() + status.slice(1)}\n                            </SelectItem>\n                          ))}\n                        </SelectContent>\n                      </Select>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n              </div>\n\n              <div className=\"grid gap-4 sm:grid-cols-2\">\n                <FormField\n                  control={form.control}\n                  name=\"expertise\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Expertise *</FormLabel>\n                      <FormControl>\n                        <Input\n                          placeholder=\"e.g., Supply Chain Management\"\n                          {...field}\n                          data-testid=\"input-expertise\"\n                        />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n                <FormField\n                  control={form.control}\n                  name=\"industry\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Industry *</FormLabel>\n                      <Select onValueChange={field.onChange} value={field.value}>\n                        <FormControl>\n                          <SelectTrigger data-testid=\"select-expert-industry\">\n                            <SelectValue placeholder=\"Select industry\" />\n                          </SelectTrigger>\n                        </FormControl>\n                        <SelectContent>\n                          {industries.map((industry) => (\n                            <SelectItem key={industry} value={industry}>\n                              {industry}\n                            </SelectItem>\n                          ))}\n                        </SelectContent>\n                      </Select>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n              </div>\n\n              <div className=\"grid gap-4 sm:grid-cols-2\">\n                <FormField\n                  control={form.control}\n                  name=\"yearsOfExperience\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Years of Experience *</FormLabel>\n                      <FormControl>\n                        <Input\n                          type=\"number\"\n                          min={0}\n                          {...field}\n                          data-testid=\"input-years-experience\"\n                        />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n                <FormField\n                  control={form.control}\n                  name=\"hourlyRate\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Hourly Rate ($) *</FormLabel>\n                      <FormControl>\n                        <Input\n                          type=\"number\"\n                          min={0}\n                          placeholder=\"150\"\n                          {...field}\n                          data-testid=\"input-hourly-rate\"\n                        />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n              </div>\n\n              <div className=\"grid gap-4 sm:grid-cols-2\">\n                <FormField\n                  control={form.control}\n                  name=\"company\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Company</FormLabel>\n                      <FormControl>\n                        <Input placeholder=\"Acme Corp\" {...field} data-testid=\"input-company\" />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n                <FormField\n                  control={form.control}\n                  name=\"jobTitle\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Job Title</FormLabel>\n                      <FormControl>\n                        <Input placeholder=\"Senior Director\" {...field} data-testid=\"input-job-title\" />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n              </div>\n\n              <div className=\"space-y-4 border-t border-b py-4\">\n                <div className=\"flex items-center justify-between\">\n                  <div>\n                    <h3 className=\"font-semibold text-base\">Work History</h3>\n                    <p className=\"text-xs text-muted-foreground mt-1\">Employment timeline and job roles</p>\n                  </div>\n                  <Button\n                    type=\"button\"\n                    variant=\"outline\"\n                    size=\"sm\"\n                    onClick={() => {\n                      const currentYear = new Date().getFullYear();\n                      setWorkHistory([\n                        ...workHistory,\n                        {\n                          company: \"\",\n                          jobTitle: \"\",\n                          fromYear: currentYear,\n                          toYear: currentYear,\n                        },\n                      ]);\n                    }}\n                    data-testid=\"button-add-work-history\"\n                  >\n                    <Plus className=\"w-4 h-4 mr-1\" />\n                    Add Experience\n                  </Button>\n                </div>\n\n                {workHistory.length === 0 ? (\n                  <p className=\"text-sm text-muted-foreground py-2\">\n                    No work history added yet. Click \"Add Experience\" to get started.\n                  </p>\n                ) : (\n                  <Table>\n                    <TableHeader>\n                      <TableRow>\n                        <TableHead>Company</TableHead>\n                        <TableHead>Job Title</TableHead>\n                        <TableHead>From Year</TableHead>\n                        <TableHead>To Year</TableHead>\n                        <TableHead className=\"w-10\"></TableHead>\n                      </TableRow>\n                    </TableHeader>\n                    <TableBody>\n                      {workHistory.map((exp, idx) => (\n                        <TableRow key={idx}>\n                          <TableCell>\n                            <Input\n                              value={exp.company}\n                              onChange={(e) => {\n                                const updated = [...workHistory];\n                                updated[idx].company = e.target.value;\n                                setWorkHistory(updated);\n                              }}\n                              placeholder=\"e.g. Acme Corp\"\n                              className=\"border-0 p-1 h-8\"\n                              data-testid={`input-work-company-${idx}`}\n                            />\n                          </TableCell>\n                          <TableCell>\n                            <Input\n                              value={exp.jobTitle}\n                              onChange={(e) => {\n                                const updated = [...workHistory];\n                                updated[idx].jobTitle = e.target.value;\n                                setWorkHistory(updated);\n                              }}\n                              placeholder=\"e.g. Senior Manager\"\n                              className=\"border-0 p-1 h-8\"\n                              data-testid={`input-work-jobtitle-${idx}`}\n                            />\n                          </TableCell>\n                          <TableCell>\n                            <Input\n                              type=\"number\"\n                              value={exp.fromYear}\n                              onChange={(e) => {\n                                const updated = [...workHistory];\n                                updated[idx].fromYear = parseInt(e.target.value) || new Date().getFullYear();\n                                setWorkHistory(updated);\n                              }}\n                              placeholder=\"2020\"\n                              className=\"border-0 p-1 w-24 h-8\"\n                              data-testid={`input-work-fromyear-${idx}`}\n                              min=\"1900\"\n                            />\n                          </TableCell>\n                          <TableCell>\n                            <Input\n                              type=\"number\"\n                              value={exp.toYear}\n                              onChange={(e) => {\n                                const updated = [...workHistory];\n                                updated[idx].toYear = parseInt(e.target.value) || new Date().getFullYear();\n                                setWorkHistory(updated);\n                              }}\n                              placeholder=\"2024\"\n                              className=\"border-0 p-1 w-24 h-8\"\n                              data-testid={`input-work-toyear-${idx}`}\n                              min=\"1900\"\n                            />\n                          </TableCell>\n                          <TableCell className=\"text-right\">\n                            <Button\n                              type=\"button\"\n                              variant=\"ghost\"\n                              size=\"icon\"\n                              onClick={() => {\n                                setWorkHistory(workHistory.filter((_, i) => i !== idx));\n                              }}\n                              data-testid={`button-remove-work-history-${idx}`}\n                              className=\"h-8 w-8\"\n                            >\n                              <Trash2 className=\"w-4 h-4 text-destructive\" />\n                            </Button>\n                          </TableCell>\n                        </TableRow>\n                      ))}\n                    </TableBody>\n                  </Table>\n                )}\n              </div>\n\n              <FormField\n                control={form.control}\n                name=\"linkedinUrl\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>LinkedIn URL</FormLabel>\n                    <FormControl>\n                      <Input\n                        placeholder=\"https://linkedin.com/in/username\"\n                        {...field}\n                        data-testid=\"input-linkedin\"\n                      />\n                    </FormControl>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n\n              <FormField\n                control={form.control}\n                name=\"bio\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>Bio</FormLabel>\n                    <FormControl>\n                      <Textarea\n                        placeholder=\"Brief professional background...\"\n                        className=\"resize-none\"\n                        rows={3}\n                        {...field}\n                        data-testid=\"input-bio\"\n                      />\n                    </FormControl>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n\n              <DialogFooter>\n                <Button\n                  type=\"button\"\n                  variant=\"outline\"\n                  onClick={() => setIsDialogOpen(false)}\n                  data-testid=\"button-cancel-expert\"\n                >\n                  Cancel\n                </Button>\n                <Button\n                  type=\"submit\"\n                  disabled={createMutation.isPending || updateMutation.isPending}\n                  data-testid=\"button-save-expert\"\n                >\n                  {createMutation.isPending || updateMutation.isPending\n                    ? \"Saving...\"\n                    : editingExpert\n                      ? \"Update Expert\"\n                      : \"Register Expert\"}\n                </Button>\n              </DialogFooter>\n            </form>\n          </Form>\n        </DialogContent>\n      </Dialog>\n\n      <Dialog open={!!viewingExpert} onOpenChange={() => setViewingExpert(null)}>\n        <DialogContent className=\"max-w-lg\">\n          <DialogHeader>\n            <DialogTitle>Expert Profile</DialogTitle>\n          </DialogHeader>\n          {viewingExpert && (\n            <div className=\"space-y-6\">\n              <div className=\"flex items-start gap-4\">\n                <Avatar className=\"h-16 w-16 border border-border\">\n                  <AvatarFallback className=\"bg-primary/10 text-lg text-primary\">\n                    {getInitials(viewingExpert.name)}\n                  </AvatarFallback>\n                </Avatar>\n                <div className=\"flex-1\">\n                  <h3 className=\"text-xl font-medium\">{viewingExpert.name}</h3>\n                  <p className=\"text-muted-foreground\">\n                    {viewingExpert.jobTitle}\n                    {viewingExpert.company && ` at ${viewingExpert.company}`}\n                  </p>\n                  <StatusBadge status={viewingExpert.status} type=\"expert\" />\n                </div>\n              </div>\n\n              <div className=\"grid gap-4 sm:grid-cols-2\">\n                <div className=\"space-y-1\">\n                  <p className=\"text-xs uppercase tracking-wide text-muted-foreground\">\n                    Expertise\n                  </p>\n                  <p className=\"font-medium\">{viewingExpert.expertise}</p>\n                </div>\n                <div className=\"space-y-1\">\n                  <p className=\"text-xs uppercase tracking-wide text-muted-foreground\">\n                    Industry\n                  </p>\n                  <p className=\"font-medium\">{viewingExpert.industry}</p>\n                </div>\n                <div className=\"space-y-1\">\n                  <p className=\"text-xs uppercase tracking-wide text-muted-foreground\">\n                    Experience\n                  </p>\n                  <p className=\"font-medium\">{viewingExpert.yearsOfExperience} years</p>\n                </div>\n                <div className=\"space-y-1\">\n                  <p className=\"text-xs uppercase tracking-wide text-muted-foreground\">\n                    Hourly Rate\n                  </p>\n                  <p className=\"font-mono font-medium\">\n                    ${Number(viewingExpert.hourlyRate).toFixed(2)}\n                  </p>\n                </div>\n              </div>\n\n              {viewingExpert.bio && (\n                <div className=\"space-y-1\">\n                  <p className=\"text-xs uppercase tracking-wide text-muted-foreground\">Bio</p>\n                  <p className=\"text-sm\">{viewingExpert.bio}</p>\n                </div>\n              )}\n\n              <div className=\"space-y-2\">\n                <p className=\"text-xs uppercase tracking-wide text-muted-foreground\">Contact</p>\n                <div className=\"flex flex-col gap-2\">\n                  <div className=\"flex items-center gap-2 text-sm\">\n                    <Mail className=\"h-4 w-4 text-muted-foreground\" />\n                    <a href={`mailto:${viewingExpert.email}`} className=\"text-primary hover:underline\">\n                      {viewingExpert.email}\n                    </a>\n                  </div>\n                  {viewingExpert.phone && (\n                    <div className=\"flex items-center gap-2 text-sm\">\n                      <Phone className=\"h-4 w-4 text-muted-foreground\" />\n                      <span>{viewingExpert.phone}</span>\n                    </div>\n                  )}\n                </div>\n              </div>\n\n              {viewingExpert.recruiterName && (\n                <div className=\"space-y-2 border-t pt-4\">\n                  <p className=\"text-xs uppercase tracking-wide text-muted-foreground\">Recruitment Info</p>\n                  <div className=\"grid gap-2 sm:grid-cols-2\">\n                    <div className=\"space-y-1\">\n                      <p className=\"text-xs text-muted-foreground\">Recruited By</p>\n                      <p className=\"text-sm font-medium\">{viewingExpert.recruiterName}</p>\n                      <p className=\"text-xs text-muted-foreground\">{viewingExpert.recruiterEmail}</p>\n                    </div>\n                    {viewingExpert.sourcedAt && (\n                      <div className=\"space-y-1\">\n                        <p className=\"text-xs text-muted-foreground\">Recruited On</p>\n                        <p className=\"text-sm font-medium\">{format(new Date(viewingExpert.sourcedAt), \"MMMM d, yyyy\")}</p>\n                      </div>\n                    )}\n                  </div>\n                </div>\n              )}\n            </div>\n          )}\n        </DialogContent>\n      </Dialog>\n\n      <AlertDialog open={!!deletingExpert} onOpenChange={() => setDeletingExpert(null)}>\n        <AlertDialogContent>\n          <AlertDialogHeader>\n            <AlertDialogTitle>Remove Expert</AlertDialogTitle>\n            <AlertDialogDescription>\n              Are you sure you want to remove \"{deletingExpert?.name}\" from your network? This\n              action cannot be undone.\n            </AlertDialogDescription>\n          </AlertDialogHeader>\n          <AlertDialogFooter>\n            <AlertDialogCancel data-testid=\"button-cancel-delete-expert\">Cancel</AlertDialogCancel>\n            <AlertDialogAction\n              onClick={() => deletingExpert && deleteMutation.mutate(deletingExpert.id)}\n              className=\"bg-destructive text-destructive-foreground hover:bg-destructive/90\"\n              data-testid=\"button-confirm-delete-expert\"\n            >\n              {deleteMutation.isPending ? \"Removing...\" : \"Remove\"}\n            </AlertDialogAction>\n          </AlertDialogFooter>\n        </AlertDialogContent>\n      </AlertDialog>\n    </div>\n  );\n}\n","path":null,"size_bytes":37951,"size_tokens":null},"client/src/components/ui/switch.tsx":{"content":"import * as React from \"react\"\nimport * as SwitchPrimitives from \"@radix-ui/react-switch\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Switch = React.forwardRef<\n  React.ElementRef<typeof SwitchPrimitives.Root>,\n  React.ComponentPropsWithoutRef<typeof SwitchPrimitives.Root>\n>(({ className, ...props }, ref) => (\n  <SwitchPrimitives.Root\n    className={cn(\n      \"peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  >\n    <SwitchPrimitives.Thumb\n      className={cn(\n        \"pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0\"\n      )}\n    />\n  </SwitchPrimitives.Root>\n))\nSwitch.displayName = SwitchPrimitives.Root.displayName\n\nexport { Switch }\n","path":null,"size_bytes":1139,"size_tokens":null},"client/src/components/ui/resizable.tsx":{"content":"\"use client\"\n\nimport { GripVertical } from \"lucide-react\"\nimport * as ResizablePrimitive from \"react-resizable-panels\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ResizablePanelGroup = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof ResizablePrimitive.PanelGroup>) => (\n  <ResizablePrimitive.PanelGroup\n    className={cn(\n      \"flex h-full w-full data-[panel-group-direction=vertical]:flex-col\",\n      className\n    )}\n    {...props}\n  />\n)\n\nconst ResizablePanel = ResizablePrimitive.Panel\n\nconst ResizableHandle = ({\n  withHandle,\n  className,\n  ...props\n}: React.ComponentProps<typeof ResizablePrimitive.PanelResizeHandle> & {\n  withHandle?: boolean\n}) => (\n  <ResizablePrimitive.PanelResizeHandle\n    className={cn(\n      \"relative flex w-px items-center justify-center bg-border after:absolute after:inset-y-0 after:left-1/2 after:w-1 after:-translate-x-1/2 focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring focus-visible:ring-offset-1 data-[panel-group-direction=vertical]:h-px data-[panel-group-direction=vertical]:w-full data-[panel-group-direction=vertical]:after:left-0 data-[panel-group-direction=vertical]:after:h-1 data-[panel-group-direction=vertical]:after:w-full data-[panel-group-direction=vertical]:after:-translate-y-1/2 data-[panel-group-direction=vertical]:after:translate-x-0 [&[data-panel-group-direction=vertical]>div]:rotate-90\",\n      className\n    )}\n    {...props}\n  >\n    {withHandle && (\n      <div className=\"z-10 flex h-4 w-3 items-center justify-center rounded-sm border bg-border\">\n        <GripVertical className=\"h-2.5 w-2.5\" />\n      </div>\n    )}\n  </ResizablePrimitive.PanelResizeHandle>\n)\n\nexport { ResizablePanelGroup, ResizablePanel, ResizableHandle }\n","path":null,"size_bytes":1723,"size_tokens":null},"client/src/hooks/use-mobile.tsx":{"content":"import * as React from \"react\"\n\nconst MOBILE_BREAKPOINT = 768\n\nexport function useIsMobile() {\n  const [isMobile, setIsMobile] = React.useState<boolean | undefined>(undefined)\n\n  React.useEffect(() => {\n    const mql = window.matchMedia(`(max-width: ${MOBILE_BREAKPOINT - 1}px)`)\n    const onChange = () => {\n      setIsMobile(window.innerWidth < MOBILE_BREAKPOINT)\n    }\n    mql.addEventListener(\"change\", onChange)\n    setIsMobile(window.innerWidth < MOBILE_BREAKPOINT)\n    return () => mql.removeEventListener(\"change\", onChange)\n  }, [])\n\n  return !!isMobile\n}\n","path":null,"size_bytes":565,"size_tokens":null},"server/db.ts":{"content":"import { Pool, neonConfig } from '@neondatabase/serverless';\nimport { drizzle } from 'drizzle-orm/neon-serverless';\nimport ws from \"ws\";\nimport * as schema from \"@shared/schema\";\n\nneonConfig.webSocketConstructor = ws;\n\nif (!process.env.DATABASE_URL) {\n  throw new Error(\n    \"DATABASE_URL must be set. Did you forget to provision a database?\",\n  );\n}\n\nexport const pool = new Pool({ connectionString: process.env.DATABASE_URL });\nexport const db = drizzle({ client: pool, schema });\n","path":null,"size_bytes":483,"size_tokens":null},"client/src/hooks/use-toast.ts":{"content":"import * as React from \"react\"\n\nimport type {\n  ToastActionElement,\n  ToastProps,\n} from \"@/components/ui/toast\"\n\nconst TOAST_LIMIT = 1\nconst TOAST_REMOVE_DELAY = 1000000\n\ntype ToasterToast = ToastProps & {\n  id: string\n  title?: React.ReactNode\n  description?: React.ReactNode\n  action?: ToastActionElement\n}\n\nconst actionTypes = {\n  ADD_TOAST: \"ADD_TOAST\",\n  UPDATE_TOAST: \"UPDATE_TOAST\",\n  DISMISS_TOAST: \"DISMISS_TOAST\",\n  REMOVE_TOAST: \"REMOVE_TOAST\",\n} as const\n\nlet count = 0\n\nfunction genId() {\n  count = (count + 1) % Number.MAX_SAFE_INTEGER\n  return count.toString()\n}\n\ntype ActionType = typeof actionTypes\n\ntype Action =\n  | {\n      type: ActionType[\"ADD_TOAST\"]\n      toast: ToasterToast\n    }\n  | {\n      type: ActionType[\"UPDATE_TOAST\"]\n      toast: Partial<ToasterToast>\n    }\n  | {\n      type: ActionType[\"DISMISS_TOAST\"]\n      toastId?: ToasterToast[\"id\"]\n    }\n  | {\n      type: ActionType[\"REMOVE_TOAST\"]\n      toastId?: ToasterToast[\"id\"]\n    }\n\ninterface State {\n  toasts: ToasterToast[]\n}\n\nconst toastTimeouts = new Map<string, ReturnType<typeof setTimeout>>()\n\nconst addToRemoveQueue = (toastId: string) => {\n  if (toastTimeouts.has(toastId)) {\n    return\n  }\n\n  const timeout = setTimeout(() => {\n    toastTimeouts.delete(toastId)\n    dispatch({\n      type: \"REMOVE_TOAST\",\n      toastId: toastId,\n    })\n  }, TOAST_REMOVE_DELAY)\n\n  toastTimeouts.set(toastId, timeout)\n}\n\nexport const reducer = (state: State, action: Action): State => {\n  switch (action.type) {\n    case \"ADD_TOAST\":\n      return {\n        ...state,\n        toasts: [action.toast, ...state.toasts].slice(0, TOAST_LIMIT),\n      }\n\n    case \"UPDATE_TOAST\":\n      return {\n        ...state,\n        toasts: state.toasts.map((t) =>\n          t.id === action.toast.id ? { ...t, ...action.toast } : t\n        ),\n      }\n\n    case \"DISMISS_TOAST\": {\n      const { toastId } = action\n\n      // ! Side effects ! - This could be extracted into a dismissToast() action,\n      // but I'll keep it here for simplicity\n      if (toastId) {\n        addToRemoveQueue(toastId)\n      } else {\n        state.toasts.forEach((toast) => {\n          addToRemoveQueue(toast.id)\n        })\n      }\n\n      return {\n        ...state,\n        toasts: state.toasts.map((t) =>\n          t.id === toastId || toastId === undefined\n            ? {\n                ...t,\n                open: false,\n              }\n            : t\n        ),\n      }\n    }\n    case \"REMOVE_TOAST\":\n      if (action.toastId === undefined) {\n        return {\n          ...state,\n          toasts: [],\n        }\n      }\n      return {\n        ...state,\n        toasts: state.toasts.filter((t) => t.id !== action.toastId),\n      }\n  }\n}\n\nconst listeners: Array<(state: State) => void> = []\n\nlet memoryState: State = { toasts: [] }\n\nfunction dispatch(action: Action) {\n  memoryState = reducer(memoryState, action)\n  listeners.forEach((listener) => {\n    listener(memoryState)\n  })\n}\n\ntype Toast = Omit<ToasterToast, \"id\">\n\nfunction toast({ ...props }: Toast) {\n  const id = genId()\n\n  const update = (props: ToasterToast) =>\n    dispatch({\n      type: \"UPDATE_TOAST\",\n      toast: { ...props, id },\n    })\n  const dismiss = () => dispatch({ type: \"DISMISS_TOAST\", toastId: id })\n\n  dispatch({\n    type: \"ADD_TOAST\",\n    toast: {\n      ...props,\n      id,\n      open: true,\n      onOpenChange: (open) => {\n        if (!open) dismiss()\n      },\n    },\n  })\n\n  return {\n    id: id,\n    dismiss,\n    update,\n  }\n}\n\nfunction useToast() {\n  const [state, setState] = React.useState<State>(memoryState)\n\n  React.useEffect(() => {\n    listeners.push(setState)\n    return () => {\n      const index = listeners.indexOf(setState)\n      if (index > -1) {\n        listeners.splice(index, 1)\n      }\n    }\n  }, [state])\n\n  return {\n    ...state,\n    toast,\n    dismiss: (toastId?: string) => dispatch({ type: \"DISMISS_TOAST\", toastId }),\n  }\n}\n\nexport { useToast, toast }\n","path":null,"size_bytes":3895,"size_tokens":null},"client/src/components/ui/popover.tsx":{"content":"import * as React from \"react\"\nimport * as PopoverPrimitive from \"@radix-ui/react-popover\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Popover = PopoverPrimitive.Root\n\nconst PopoverTrigger = PopoverPrimitive.Trigger\n\nconst PopoverContent = React.forwardRef<\n  React.ElementRef<typeof PopoverPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof PopoverPrimitive.Content>\n>(({ className, align = \"center\", sideOffset = 4, ...props }, ref) => (\n  <PopoverPrimitive.Portal>\n    <PopoverPrimitive.Content\n      ref={ref}\n      align={align}\n      sideOffset={sideOffset}\n      className={cn(\n        \"z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-popover-content-transform-origin]\",\n        className\n      )}\n      {...props}\n    />\n  </PopoverPrimitive.Portal>\n))\nPopoverContent.displayName = PopoverPrimitive.Content.displayName\n\nexport { Popover, PopoverTrigger, PopoverContent }\n","path":null,"size_bytes":1280,"size_tokens":null},"client/src/pages/change-password.tsx":{"content":"import { useState } from \"react\";\nimport { useForm } from \"react-hook-form\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport { z } from \"zod\";\nimport { useAuth } from \"@/lib/auth\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Form, FormControl, FormField, FormItem, FormLabel, FormMessage } from \"@/components/ui/form\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { Loader2, LogOut } from \"lucide-react\";\nimport { useLocation } from \"wouter\";\n\nconst changePasswordSchema = z.object({\n  currentPassword: z.string().min(1, \"Current password is required\"),\n  newPassword: z.string().min(8, \"New password must be at least 8 characters\"),\n  confirmPassword: z.string(),\n}).refine((data) => data.newPassword === data.confirmPassword, {\n  message: \"Passwords don't match\",\n  path: [\"confirmPassword\"],\n});\n\ntype ChangePasswordForm = z.infer<typeof changePasswordSchema>;\n\nexport default function ChangePassword() {\n  const { user, logout } = useAuth();\n  const [, setLocation] = useLocation();\n  const [isSubmitting, setIsSubmitting] = useState(false);\n  const { toast } = useToast();\n\n  const form = useForm<ChangePasswordForm>({\n    resolver: zodResolver(changePasswordSchema),\n    defaultValues: {\n      currentPassword: \"\",\n      newPassword: \"\",\n      confirmPassword: \"\",\n    },\n  });\n\n  const onSubmit = async (data: ChangePasswordForm) => {\n    setIsSubmitting(true);\n    try {\n      const token = localStorage.getItem(\"authToken\");\n      if (!token) {\n        throw new Error(\"No authentication token found\");\n      }\n\n      const response = await fetch(\"/api/auth/change-password\", {\n        method: \"POST\",\n        headers: {\n          \"Content-Type\": \"application/json\",\n          Authorization: `Bearer ${token}`,\n        },\n        body: JSON.stringify({\n          currentPassword: data.currentPassword,\n          newPassword: data.newPassword,\n        }),\n      });\n\n      if (!response.ok) {\n        const errorData = await response.json();\n        throw new Error(errorData.error || \"Failed to change password\");\n      }\n\n      // Update user state to clear mustChangePassword flag\n      if (user) {\n        const updatedUser = { ...user, mustChangePassword: false };\n        localStorage.setItem(\"authToken\", token);\n      }\n\n      toast({ title: \"Password updated successfully!\" });\n      setLocation(\"/\");\n    } catch (error) {\n      toast({\n        title: \"Failed to change password\",\n        description: error instanceof Error ? error.message : \"An error occurred\",\n        variant: \"destructive\",\n      });\n    } finally {\n      setIsSubmitting(false);\n    }\n  };\n\n  return (\n    <div className=\"flex min-h-screen items-center justify-center bg-muted/30 p-4\" data-testid=\"page-change-password\">\n      <Card className=\"w-full max-w-md\">\n        <CardHeader className=\"space-y-1 text-center\">\n          <CardTitle className=\"text-2xl font-bold\" data-testid=\"text-change-password-title\">\n            Change Password\n          </CardTitle>\n          <CardDescription>\n            For security, please update your password before accessing the platform.\n          </CardDescription>\n        </CardHeader>\n        <CardContent>\n          <div className=\"mb-4 rounded-md bg-muted p-3\">\n            <p className=\"text-sm text-muted-foreground\" data-testid=\"text-logged-in-as\">\n              Logged in as <span className=\"font-medium text-foreground\">{user?.email}</span>\n            </p>\n          </div>\n          \n          <Form {...form}>\n            <form onSubmit={form.handleSubmit(onSubmit)} className=\"space-y-4\">\n              <FormField\n                control={form.control}\n                name=\"currentPassword\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>Current Password</FormLabel>\n                    <FormControl>\n                      <Input\n                        type=\"password\"\n                        placeholder=\"Enter your current password\"\n                        autoComplete=\"current-password\"\n                        data-testid=\"input-current-password\"\n                        disabled={isSubmitting}\n                        {...field}\n                      />\n                    </FormControl>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n              <FormField\n                control={form.control}\n                name=\"newPassword\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>New Password</FormLabel>\n                    <FormControl>\n                      <Input\n                        type=\"password\"\n                        placeholder=\"Enter your new password (min 8 characters)\"\n                        autoComplete=\"new-password\"\n                        data-testid=\"input-new-password\"\n                        disabled={isSubmitting}\n                        {...field}\n                      />\n                    </FormControl>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n              <FormField\n                control={form.control}\n                name=\"confirmPassword\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>Confirm New Password</FormLabel>\n                    <FormControl>\n                      <Input\n                        type=\"password\"\n                        placeholder=\"Confirm your new password\"\n                        autoComplete=\"new-password\"\n                        data-testid=\"input-confirm-password\"\n                        disabled={isSubmitting}\n                        {...field}\n                      />\n                    </FormControl>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n              <Button\n                type=\"submit\"\n                className=\"w-full\"\n                disabled={isSubmitting}\n                data-testid=\"button-update-password\"\n              >\n                {isSubmitting ? (\n                  <>\n                    <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />\n                    Updating...\n                  </>\n                ) : (\n                  \"Update Password\"\n                )}\n              </Button>\n            </form>\n          </Form>\n\n          <div className=\"mt-6 border-t pt-4\">\n            <Button\n              variant=\"ghost\"\n              className=\"w-full\"\n              onClick={logout}\n              data-testid=\"button-logout\"\n            >\n              <LogOut className=\"mr-2 h-4 w-4\" />\n              Log Out\n            </Button>\n          </div>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","path":null,"size_bytes":6900,"size_tokens":null},"client/src/lib/translations/expert-onboarding.ts":{"content":"export type Language = \"pt\" | \"es\" | \"en\";\n\nexport interface TranslationStrings {\n  pageTitle: string;\n  pageSubtitle: string;\n  projectInfoTitle: string;\n  projectDescription: string;\n  vettingQuestionsTitle: string;\n  vettingQuestionsDescription: string;\n  \n  loginInfoTitle: string;\n  email: string;\n  emailPlaceholder: string;\n  password: string;\n  passwordPlaceholder: string;\n  confirmPassword: string;\n  confirmPasswordPlaceholder: string;\n  passwordMinLength: string;\n  passwordsDoNotMatch: string;\n  \n  basicInfoTitle: string;\n  firstName: string;\n  firstNamePlaceholder: string;\n  lastName: string;\n  lastNamePlaceholder: string;\n  country: string;\n  countryPlaceholder: string;\n  region: string;\n  regionPlaceholder: string;\n  phone: string;\n  countryCode: string;\n  countryCodePlaceholder: string;\n  phoneNumber: string;\n  phoneNumberPlaceholder: string;\n  linkedinUrl: string;\n  linkedinUrlPlaceholder: string;\n  city: string;\n  cityPlaceholder: string;\n  canConsultInEnglish: string;\n  yes: string;\n  no: string;\n  timezone: string;\n  timezonePlaceholder: string;\n  \n  experienceTitle: string;\n  addExperience: string;\n  company: string;\n  companyPlaceholder: string;\n  titleRole: string;\n  titleRolePlaceholder: string;\n  fromDate: string;\n  toDate: string;\n  currentPosition: string;\n  month: string;\n  year: string;\n  removeExperience: string;\n  \n  biographyTitle: string;\n  biographyPlaceholder: string;\n  biographyDescription: string;\n  \n  workHistoryTitle: string;\n  workHistoryPlaceholder: string;\n  workHistoryDescription: string;\n  \n  hourlyRateTitle: string;\n  hourlyRate: string;\n  hourlyRatePlaceholder: string;\n  currency: string;\n  currencyPlaceholder: string;\n  \n  termsTitle: string;\n  termsCheckboxLabel: string;\n  termsLink: string;\n  privacyLink: string;\n  termsRequired: string;\n  lgpdCheckboxLabel: string;\n  lgpdLink: string;\n  lgpdRequired: string;\n  \n  submitButton: string;\n  submitting: string;\n  \n  successTitle: string;\n  successMessage: string;\n  closeButton: string;\n  \n  errorTitle: string;\n  invalidLink: string;\n  expiredLink: string;\n  usedLink: string;\n  \n  loading: string;\n  required: string;\n  invalidEmail: string;\n  invalidUrl: string;\n  \n  languageLabel: string;\n  \n  registerExpertModalTitle: string;\n  registerExpertModalSubtitle: string;\n  registerExpertButton: string;\n  inviteLinkCreated: string;\n  inviteLinkCopied: string;\n  copyLink: string;\n  expertRegistered: string;\n}\n\nexport const translations: Record<Language, TranslationStrings> = {\n  pt: {\n    pageTitle: \"Cadastro de Especialista\",\n    pageSubtitle: \"Preencha o formulrio abaixo para se cadastrar como especialista na Mirae Connext.\",\n    projectInfoTitle: \"Informaes do Projeto\",\n    projectDescription: \"Voc foi convidado para participar deste projeto.\",\n    vettingQuestionsTitle: \"Perguntas de Triagem do Projeto\",\n    vettingQuestionsDescription: \"Por favor, responda s perguntas abaixo para demonstrar sua experincia.\",\n    \n    loginInfoTitle: \"Informaes de Login\",\n    email: \"E-mail\",\n    emailPlaceholder: \"seu.email@exemplo.com\",\n    password: \"Senha\",\n    passwordPlaceholder: \"Mnimo 8 caracteres\",\n    confirmPassword: \"Confirmar Senha\",\n    confirmPasswordPlaceholder: \"Digite a senha novamente\",\n    passwordMinLength: \"A senha deve ter pelo menos 8 caracteres\",\n    passwordsDoNotMatch: \"As senhas no coincidem\",\n    \n    basicInfoTitle: \"Informaes Bsicas\",\n    firstName: \"Nome\",\n    firstNamePlaceholder: \"Seu nome\",\n    lastName: \"Sobrenome\",\n    lastNamePlaceholder: \"Seu sobrenome\",\n    country: \"Pas\",\n    countryPlaceholder: \"Selecione o pas\",\n    region: \"Estado/Regio\",\n    regionPlaceholder: \"Seu estado ou regio\",\n    phone: \"Telefone\",\n    countryCode: \"Cdigo do Pas\",\n    countryCodePlaceholder: \"+55\",\n    phoneNumber: \"Nmero de Telefone\",\n    phoneNumberPlaceholder: \"11 99999-9999\",\n    linkedinUrl: \"URL do LinkedIn\",\n    linkedinUrlPlaceholder: \"https://linkedin.com/in/seu-perfil\",\n    city: \"Cidade\",\n    cityPlaceholder: \"Sua cidade\",\n    canConsultInEnglish: \"Voc pode realizar consultorias em ingls?\",\n    yes: \"Sim\",\n    no: \"No\",\n    timezone: \"Fuso Horrio\",\n    timezonePlaceholder: \"Selecione o fuso horrio\",\n    \n    experienceTitle: \"Experincia Profissional\",\n    addExperience: \"Adicionar Experincia\",\n    company: \"Empresa\",\n    companyPlaceholder: \"Nome da empresa\",\n    titleRole: \"Cargo\",\n    titleRolePlaceholder: \"Seu cargo/funo\",\n    fromDate: \"De\",\n    toDate: \"At\",\n    currentPosition: \"Cargo Atual\",\n    month: \"Ms\",\n    year: \"Ano\",\n    removeExperience: \"Remover\",\n    \n    biographyTitle: \"Biografia\",\n    biographyPlaceholder: \"Descreva sua experincia profissional, conquistas e reas de especializao...\",\n    biographyDescription: \"Uma breve descrio do seu perfil profissional.\",\n    \n    workHistoryTitle: \"Histrico de Trabalho\",\n    workHistoryPlaceholder: \"Descreva seu histrico profissional, principais projetos, responsabilidades e conquistas...\",\n    workHistoryDescription: \"Um resumo detalhado do seu histrico de trabalho e experincias relevantes.\",\n    \n    hourlyRateTitle: \"Taxa por Hora\",\n    hourlyRate: \"Valor por Hora\",\n    hourlyRatePlaceholder: \"Ex: 250\",\n    currency: \"Moeda\",\n    currencyPlaceholder: \"Selecione a moeda\",\n    \n    termsTitle: \"Termos e Condies\",\n    termsCheckboxLabel: \"Ao marcar esta caixa, declaro que concordo com os\",\n    termsLink: \"Termos e Condies\",\n    privacyLink: \"Poltica de Privacidade\",\n    termsRequired: \"Voc deve aceitar os termos para continuar\",\n    lgpdCheckboxLabel: \"Concordo com a\",\n    lgpdLink: \"Poltica LGPD\",\n    lgpdRequired: \"Voc deve aceitar a poltica LGPD para continuar\",\n    \n    submitButton: \"Enviar Cadastro\",\n    submitting: \"Enviando...\",\n    \n    successTitle: \"Obrigado!\",\n    successMessage: \"Seu perfil e respostas foram enviados. A equipe da Mirae Connext entrar em contato se o seu perfil corresponder aos requisitos do projeto.\",\n    closeButton: \"Fechar\",\n    \n    errorTitle: \"Erro\",\n    invalidLink: \"Este link de convite  invlido.\",\n    expiredLink: \"Este link de convite expirou.\",\n    usedLink: \"Este link de convite j foi utilizado.\",\n    \n    loading: \"Carregando...\",\n    required: \"Campo obrigatrio\",\n    invalidEmail: \"E-mail invlido\",\n    invalidUrl: \"URL invlida\",\n    \n    languageLabel: \"Idioma\",\n    \n    registerExpertModalTitle: \"Cadastrar Novo Especialista\",\n    registerExpertModalSubtitle: \"Preencha os dados do especialista para cadastr-lo no projeto.\",\n    registerExpertButton: \"Cadastrar Especialista\",\n    inviteLinkCreated: \"Link de convite criado!\",\n    inviteLinkCopied: \"Link copiado para a rea de transferncia\",\n    copyLink: \"Copiar Link\",\n    expertRegistered: \"Especialista cadastrado com sucesso!\",\n  },\n  es: {\n    pageTitle: \"Registro de Experto\",\n    pageSubtitle: \"Complete el formulario a continuacin para registrarse como experto en Mirae Connext.\",\n    projectInfoTitle: \"Informacin del Proyecto\",\n    projectDescription: \"Ha sido invitado a participar en este proyecto.\",\n    vettingQuestionsTitle: \"Preguntas de Evaluacin del Proyecto\",\n    vettingQuestionsDescription: \"Por favor, responda las siguientes preguntas para demostrar su experiencia.\",\n    \n    loginInfoTitle: \"Informacin de Inicio de Sesin\",\n    email: \"Correo Electrnico\",\n    emailPlaceholder: \"su.email@ejemplo.com\",\n    password: \"Contrasea\",\n    passwordPlaceholder: \"Mnimo 8 caracteres\",\n    confirmPassword: \"Confirmar Contrasea\",\n    confirmPasswordPlaceholder: \"Ingrese la contrasea nuevamente\",\n    passwordMinLength: \"La contrasea debe tener al menos 8 caracteres\",\n    passwordsDoNotMatch: \"Las contraseas no coinciden\",\n    \n    basicInfoTitle: \"Informacin Bsica\",\n    firstName: \"Nombre\",\n    firstNamePlaceholder: \"Su nombre\",\n    lastName: \"Apellido\",\n    lastNamePlaceholder: \"Su apellido\",\n    country: \"Pas\",\n    countryPlaceholder: \"Seleccione el pas\",\n    region: \"Estado/Regin\",\n    regionPlaceholder: \"Su estado o regin\",\n    phone: \"Telfono\",\n    countryCode: \"Cdigo de Pas\",\n    countryCodePlaceholder: \"+54\",\n    phoneNumber: \"Nmero de Telfono\",\n    phoneNumberPlaceholder: \"11 9999-9999\",\n    linkedinUrl: \"URL de LinkedIn\",\n    linkedinUrlPlaceholder: \"https://linkedin.com/in/su-perfil\",\n    city: \"Ciudad\",\n    cityPlaceholder: \"Su ciudad\",\n    canConsultInEnglish: \"Puede realizar consultoras en ingls?\",\n    yes: \"S\",\n    no: \"No\",\n    timezone: \"Zona Horaria\",\n    timezonePlaceholder: \"Seleccione la zona horaria\",\n    \n    experienceTitle: \"Experiencia Profesional\",\n    addExperience: \"Agregar Experiencia\",\n    company: \"Empresa\",\n    companyPlaceholder: \"Nombre de la empresa\",\n    titleRole: \"Cargo\",\n    titleRolePlaceholder: \"Su cargo/funcin\",\n    fromDate: \"Desde\",\n    toDate: \"Hasta\",\n    currentPosition: \"Cargo Actual\",\n    month: \"Mes\",\n    year: \"Ao\",\n    removeExperience: \"Eliminar\",\n    \n    biographyTitle: \"Biografa\",\n    biographyPlaceholder: \"Describa su experiencia profesional, logros y reas de especializacin...\",\n    biographyDescription: \"Una breve descripcin de su perfil profesional.\",\n    \n    workHistoryTitle: \"Historial Laboral\",\n    workHistoryPlaceholder: \"Describa su historial laboral, proyectos principales, responsabilidades y logros...\",\n    workHistoryDescription: \"Un resumen detallado de su historial laboral y experiencias relevantes.\",\n    \n    hourlyRateTitle: \"Tarifa por Hora\",\n    hourlyRate: \"Valor por Hora\",\n    hourlyRatePlaceholder: \"Ej: 250\",\n    currency: \"Moneda\",\n    currencyPlaceholder: \"Seleccione la moneda\",\n    \n    termsTitle: \"Trminos y Condiciones\",\n    termsCheckboxLabel: \"Al marcar esta casilla, declaro que acepto los\",\n    termsLink: \"Trminos y Condiciones\",\n    privacyLink: \"Poltica de Privacidad\",\n    termsRequired: \"Debe aceptar los trminos para continuar\",\n    lgpdCheckboxLabel: \"Acepto la\",\n    lgpdLink: \"Poltica LGPD\",\n    lgpdRequired: \"Debe aceptar la poltica LGPD para continuar\",\n    \n    submitButton: \"Enviar Registro\",\n    submitting: \"Enviando...\",\n    \n    successTitle: \"Gracias!\",\n    successMessage: \"Su perfil y respuestas han sido enviados. El equipo de Mirae Connext se comunicar con usted si su perfil coincide con los requisitos del proyecto.\",\n    closeButton: \"Cerrar\",\n    \n    errorTitle: \"Error\",\n    invalidLink: \"Este enlace de invitacin no es vlido.\",\n    expiredLink: \"Este enlace de invitacin ha expirado.\",\n    usedLink: \"Este enlace de invitacin ya ha sido utilizado.\",\n    \n    loading: \"Cargando...\",\n    required: \"Campo obligatorio\",\n    invalidEmail: \"Correo electrnico invlido\",\n    invalidUrl: \"URL invlida\",\n    \n    languageLabel: \"Idioma\",\n    \n    registerExpertModalTitle: \"Registrar Nuevo Experto\",\n    registerExpertModalSubtitle: \"Complete los datos del experto para registrarlo en el proyecto.\",\n    registerExpertButton: \"Registrar Experto\",\n    inviteLinkCreated: \"Enlace de invitacin creado!\",\n    inviteLinkCopied: \"Enlace copiado al portapapeles\",\n    copyLink: \"Copiar Enlace\",\n    expertRegistered: \"Experto registrado con xito!\",\n  },\n  en: {\n    pageTitle: \"Expert Registration\",\n    pageSubtitle: \"Fill out the form below to register as an expert with Mirae Connext.\",\n    projectInfoTitle: \"Project Information\",\n    projectDescription: \"You have been invited to participate in this project.\",\n    vettingQuestionsTitle: \"Project Vetting Questions\",\n    vettingQuestionsDescription: \"Please answer the questions below to demonstrate your expertise.\",\n    \n    loginInfoTitle: \"Login Information\",\n    email: \"Email\",\n    emailPlaceholder: \"your.email@example.com\",\n    password: \"Password\",\n    passwordPlaceholder: \"Minimum 8 characters\",\n    confirmPassword: \"Confirm Password\",\n    confirmPasswordPlaceholder: \"Re-enter your password\",\n    passwordMinLength: \"Password must be at least 8 characters\",\n    passwordsDoNotMatch: \"Passwords do not match\",\n    \n    basicInfoTitle: \"Basic Information\",\n    firstName: \"First Name\",\n    firstNamePlaceholder: \"Your first name\",\n    lastName: \"Last Name\",\n    lastNamePlaceholder: \"Your last name\",\n    country: \"Country\",\n    countryPlaceholder: \"Select country\",\n    region: \"State/Region\",\n    regionPlaceholder: \"Your state or region\",\n    phone: \"Phone\",\n    countryCode: \"Country Code\",\n    countryCodePlaceholder: \"+1\",\n    phoneNumber: \"Phone Number\",\n    phoneNumberPlaceholder: \"555 123 4567\",\n    linkedinUrl: \"LinkedIn URL\",\n    linkedinUrlPlaceholder: \"https://linkedin.com/in/your-profile\",\n    city: \"City\",\n    cityPlaceholder: \"Your city\",\n    canConsultInEnglish: \"Can you consult in English?\",\n    yes: \"Yes\",\n    no: \"No\",\n    timezone: \"Time Zone\",\n    timezonePlaceholder: \"Select time zone\",\n    \n    experienceTitle: \"Professional Experience\",\n    addExperience: \"Add Experience\",\n    company: \"Company\",\n    companyPlaceholder: \"Company name\",\n    titleRole: \"Title/Role\",\n    titleRolePlaceholder: \"Your job title\",\n    fromDate: \"From\",\n    toDate: \"To\",\n    currentPosition: \"Current Position\",\n    month: \"Month\",\n    year: \"Year\",\n    removeExperience: \"Remove\",\n    \n    biographyTitle: \"Biography\",\n    biographyPlaceholder: \"Describe your professional background, achievements, and areas of expertise...\",\n    biographyDescription: \"A brief description of your professional profile.\",\n    \n    workHistoryTitle: \"Work History\",\n    workHistoryPlaceholder: \"Describe your work history, key projects, responsibilities, and achievements...\",\n    workHistoryDescription: \"A detailed summary of your work history and relevant experiences.\",\n    \n    hourlyRateTitle: \"Hourly Rate\",\n    hourlyRate: \"Hourly Rate\",\n    hourlyRatePlaceholder: \"e.g., 250\",\n    currency: \"Currency\",\n    currencyPlaceholder: \"Select currency\",\n    \n    termsTitle: \"Terms & Conditions\",\n    termsCheckboxLabel: \"By checking this box, I acknowledge that I agree to the\",\n    termsLink: \"Terms and Conditions\",\n    privacyLink: \"Privacy Policy\",\n    termsRequired: \"You must accept the terms to continue\",\n    lgpdCheckboxLabel: \"I agree to the\",\n    lgpdLink: \"LGPD Policy\",\n    lgpdRequired: \"You must accept the LGPD policy to continue\",\n    \n    submitButton: \"Submit Registration\",\n    submitting: \"Submitting...\",\n    \n    successTitle: \"Thank You!\",\n    successMessage: \"Your profile and answers have been submitted. The Mirae Connext team will reach out to you if your profile matches the project requirements.\",\n    closeButton: \"Close\",\n    \n    errorTitle: \"Error\",\n    invalidLink: \"This invitation link is invalid.\",\n    expiredLink: \"This invitation link has expired.\",\n    usedLink: \"This invitation link has already been used.\",\n    \n    loading: \"Loading...\",\n    required: \"Required field\",\n    invalidEmail: \"Invalid email\",\n    invalidUrl: \"Invalid URL\",\n    \n    languageLabel: \"Language\",\n    \n    registerExpertModalTitle: \"Register New Expert\",\n    registerExpertModalSubtitle: \"Fill in the expert details to register them for the project.\",\n    registerExpertButton: \"Register Expert\",\n    inviteLinkCreated: \"Invitation link created!\",\n    inviteLinkCopied: \"Link copied to clipboard\",\n    copyLink: \"Copy Link\",\n    expertRegistered: \"Expert registered successfully!\",\n  },\n};\n\nexport function detectBrowserLanguage(): Language {\n  if (typeof navigator === \"undefined\") return \"en\";\n  \n  const browserLang = navigator.language.toLowerCase();\n  \n  if (browserLang.startsWith(\"pt\")) return \"pt\";\n  if (browserLang.startsWith(\"es\")) return \"es\";\n  return \"en\";\n}\n\nexport const countries = [\n  { code: \"BR\", name: { pt: \"Brasil\", es: \"Brasil\", en: \"Brazil\" } },\n  { code: \"AR\", name: { pt: \"Argentina\", es: \"Argentina\", en: \"Argentina\" } },\n  { code: \"CL\", name: { pt: \"Chile\", es: \"Chile\", en: \"Chile\" } },\n  { code: \"CO\", name: { pt: \"Colmbia\", es: \"Colombia\", en: \"Colombia\" } },\n  { code: \"MX\", name: { pt: \"Mxico\", es: \"Mxico\", en: \"Mexico\" } },\n  { code: \"PE\", name: { pt: \"Peru\", es: \"Per\", en: \"Peru\" } },\n  { code: \"US\", name: { pt: \"Estados Unidos\", es: \"Estados Unidos\", en: \"United States\" } },\n  { code: \"CA\", name: { pt: \"Canad\", es: \"Canad\", en: \"Canada\" } },\n  { code: \"GB\", name: { pt: \"Reino Unido\", es: \"Reino Unido\", en: \"United Kingdom\" } },\n  { code: \"DE\", name: { pt: \"Alemanha\", es: \"Alemania\", en: \"Germany\" } },\n  { code: \"FR\", name: { pt: \"Frana\", es: \"Francia\", en: \"France\" } },\n  { code: \"ES\", name: { pt: \"Espanha\", es: \"Espaa\", en: \"Spain\" } },\n  { code: \"PT\", name: { pt: \"Portugal\", es: \"Portugal\", en: \"Portugal\" } },\n  { code: \"IT\", name: { pt: \"Itlia\", es: \"Italia\", en: \"Italy\" } },\n  { code: \"JP\", name: { pt: \"Japo\", es: \"Japn\", en: \"Japan\" } },\n  { code: \"CN\", name: { pt: \"China\", es: \"China\", en: \"China\" } },\n  { code: \"IN\", name: { pt: \"ndia\", es: \"India\", en: \"India\" } },\n  { code: \"AU\", name: { pt: \"Austrlia\", es: \"Australia\", en: \"Australia\" } },\n  { code: \"ZA\", name: { pt: \"frica do Sul\", es: \"Sudfrica\", en: \"South Africa\" } },\n  { code: \"OTHER\", name: { pt: \"Outro\", es: \"Otro\", en: \"Other\" } },\n];\n\nexport const countryCodes = [\n  { code: \"+1\", country: \"US/CA\" },\n  { code: \"+44\", country: \"UK\" },\n  { code: \"+49\", country: \"DE\" },\n  { code: \"+33\", country: \"FR\" },\n  { code: \"+34\", country: \"ES\" },\n  { code: \"+351\", country: \"PT\" },\n  { code: \"+55\", country: \"BR\" },\n  { code: \"+54\", country: \"AR\" },\n  { code: \"+56\", country: \"CL\" },\n  { code: \"+57\", country: \"CO\" },\n  { code: \"+52\", country: \"MX\" },\n  { code: \"+51\", country: \"PE\" },\n  { code: \"+81\", country: \"JP\" },\n  { code: \"+86\", country: \"CN\" },\n  { code: \"+91\", country: \"IN\" },\n  { code: \"+61\", country: \"AU\" },\n  { code: \"+27\", country: \"ZA\" },\n];\n\nexport const timezones = [\n  { value: \"America/Sao_Paulo\", label: { pt: \"So Paulo (UTC-3)\", es: \"So Paulo (UTC-3)\", en: \"So Paulo (UTC-3)\" } },\n  { value: \"America/Buenos_Aires\", label: { pt: \"Buenos Aires (UTC-3)\", es: \"Buenos Aires (UTC-3)\", en: \"Buenos Aires (UTC-3)\" } },\n  { value: \"America/Santiago\", label: { pt: \"Santiago (UTC-4)\", es: \"Santiago (UTC-4)\", en: \"Santiago (UTC-4)\" } },\n  { value: \"America/Bogota\", label: { pt: \"Bogot (UTC-5)\", es: \"Bogot (UTC-5)\", en: \"Bogota (UTC-5)\" } },\n  { value: \"America/Mexico_City\", label: { pt: \"Cidade do Mxico (UTC-6)\", es: \"Ciudad de Mxico (UTC-6)\", en: \"Mexico City (UTC-6)\" } },\n  { value: \"America/Lima\", label: { pt: \"Lima (UTC-5)\", es: \"Lima (UTC-5)\", en: \"Lima (UTC-5)\" } },\n  { value: \"America/New_York\", label: { pt: \"Nova York (UTC-5)\", es: \"Nueva York (UTC-5)\", en: \"New York (UTC-5)\" } },\n  { value: \"America/Chicago\", label: { pt: \"Chicago (UTC-6)\", es: \"Chicago (UTC-6)\", en: \"Chicago (UTC-6)\" } },\n  { value: \"America/Denver\", label: { pt: \"Denver (UTC-7)\", es: \"Denver (UTC-7)\", en: \"Denver (UTC-7)\" } },\n  { value: \"America/Los_Angeles\", label: { pt: \"Los Angeles (UTC-8)\", es: \"Los Angeles (UTC-8)\", en: \"Los Angeles (UTC-8)\" } },\n  { value: \"Europe/London\", label: { pt: \"Londres (UTC+0)\", es: \"Londres (UTC+0)\", en: \"London (UTC+0)\" } },\n  { value: \"Europe/Paris\", label: { pt: \"Paris (UTC+1)\", es: \"Pars (UTC+1)\", en: \"Paris (UTC+1)\" } },\n  { value: \"Europe/Berlin\", label: { pt: \"Berlim (UTC+1)\", es: \"Berln (UTC+1)\", en: \"Berlin (UTC+1)\" } },\n  { value: \"Europe/Madrid\", label: { pt: \"Madri (UTC+1)\", es: \"Madrid (UTC+1)\", en: \"Madrid (UTC+1)\" } },\n  { value: \"Europe/Lisbon\", label: { pt: \"Lisboa (UTC+0)\", es: \"Lisboa (UTC+0)\", en: \"Lisbon (UTC+0)\" } },\n  { value: \"Asia/Tokyo\", label: { pt: \"Tquio (UTC+9)\", es: \"Tokio (UTC+9)\", en: \"Tokyo (UTC+9)\" } },\n  { value: \"Asia/Shanghai\", label: { pt: \"Xangai (UTC+8)\", es: \"Shanghi (UTC+8)\", en: \"Shanghai (UTC+8)\" } },\n  { value: \"Asia/Kolkata\", label: { pt: \"Calcut (UTC+5:30)\", es: \"Calcuta (UTC+5:30)\", en: \"Kolkata (UTC+5:30)\" } },\n  { value: \"Australia/Sydney\", label: { pt: \"Sydney (UTC+11)\", es: \"Sdney (UTC+11)\", en: \"Sydney (UTC+11)\" } },\n  { value: \"Africa/Johannesburg\", label: { pt: \"Joanesburgo (UTC+2)\", es: \"Johannesburgo (UTC+2)\", en: \"Johannesburg (UTC+2)\" } },\n];\n\nexport const currencies = [\n  { code: \"USD\", symbol: \"$\", name: { pt: \"Dlar Americano\", es: \"Dlar Estadounidense\", en: \"US Dollar\" } },\n  { code: \"BRL\", symbol: \"R$\", name: { pt: \"Real Brasileiro\", es: \"Real Brasileo\", en: \"Brazilian Real\" } },\n  { code: \"EUR\", symbol: \"\", name: { pt: \"Euro\", es: \"Euro\", en: \"Euro\" } },\n  { code: \"GBP\", symbol: \"\", name: { pt: \"Libra Esterlina\", es: \"Libra Esterlina\", en: \"British Pound\" } },\n  { code: \"ARS\", symbol: \"$\", name: { pt: \"Peso Argentino\", es: \"Peso Argentino\", en: \"Argentine Peso\" } },\n  { code: \"CLP\", symbol: \"$\", name: { pt: \"Peso Chileno\", es: \"Peso Chileno\", en: \"Chilean Peso\" } },\n  { code: \"COP\", symbol: \"$\", name: { pt: \"Peso Colombiano\", es: \"Peso Colombiano\", en: \"Colombian Peso\" } },\n  { code: \"MXN\", symbol: \"$\", name: { pt: \"Peso Mexicano\", es: \"Peso Mexicano\", en: \"Mexican Peso\" } },\n];\n\nexport const months = [\n  { value: \"01\", name: { pt: \"Janeiro\", es: \"Enero\", en: \"January\" } },\n  { value: \"02\", name: { pt: \"Fevereiro\", es: \"Febrero\", en: \"February\" } },\n  { value: \"03\", name: { pt: \"Maro\", es: \"Marzo\", en: \"March\" } },\n  { value: \"04\", name: { pt: \"Abril\", es: \"Abril\", en: \"April\" } },\n  { value: \"05\", name: { pt: \"Maio\", es: \"Mayo\", en: \"May\" } },\n  { value: \"06\", name: { pt: \"Junho\", es: \"Junio\", en: \"June\" } },\n  { value: \"07\", name: { pt: \"Julho\", es: \"Julio\", en: \"July\" } },\n  { value: \"08\", name: { pt: \"Agosto\", es: \"Agosto\", en: \"August\" } },\n  { value: \"09\", name: { pt: \"Setembro\", es: \"Septiembre\", en: \"September\" } },\n  { value: \"10\", name: { pt: \"Outubro\", es: \"Octubre\", en: \"October\" } },\n  { value: \"11\", name: { pt: \"Novembro\", es: \"Noviembre\", en: \"November\" } },\n  { value: \"12\", name: { pt: \"Dezembro\", es: \"Diciembre\", en: \"December\" } },\n];\n\nexport function getYearOptions(): string[] {\n  const currentYear = new Date().getFullYear();\n  const years: string[] = [];\n  for (let year = currentYear; year >= currentYear - 50; year--) {\n    years.push(year.toString());\n  }\n  return years;\n}\n","path":null,"size_bytes":22082,"size_tokens":null},"client/src/pages/expert-onboarding.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { useForm, useFieldArray } from \"react-hook-form\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport { z } from \"zod\";\nimport {\n  CheckCircle,\n  AlertCircle,\n  Loader2,\n  Lock,\n  User,\n  Briefcase,\n  FileText,\n  DollarSign,\n  Shield,\n  Plus,\n  Trash2,\n  Globe,\n  Building2,\n  ClipboardList,\n} from \"lucide-react\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Checkbox } from \"@/components/ui/checkbox\";\nimport { RadioGroup, RadioGroupItem } from \"@/components/ui/radio-group\";\nimport { Label } from \"@/components/ui/label\";\nimport { Separator } from \"@/components/ui/separator\";\nimport {\n  Form,\n  FormControl,\n  FormDescription,\n  FormField,\n  FormItem,\n  FormLabel,\n  FormMessage,\n} from \"@/components/ui/form\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport {\n  type Language,\n  translations,\n  detectBrowserLanguage,\n  countries,\n  countryCodes,\n  timezones,\n  currencies,\n  months,\n  getYearOptions,\n} from \"@/lib/translations/expert-onboarding\";\nimport logoPath from \"@assets/Logo_1764384177823.png\";\n\ninterface ExpertOnboardingProps {\n  projectId: string;\n  inviteType: string;\n  token: string;\n}\n\ninterface InvitationData {\n  project: {\n    id: number;\n    name: string;\n    clientName: string;\n    industry: string;\n    projectOverview: string | null;\n    description: string | null;\n  };\n  vettingQuestions: Array<{\n    id: number;\n    question: string;\n    orderIndex: number;\n    isRequired: boolean;\n  }>;\n  recruitedBy: string | null;\n  recruitedByRaId: number | null;\n}\n\nconst experienceSchema = z.object({\n  company: z.string().min(1, \"Required\"),\n  title: z.string().min(1, \"Required\"),\n  fromMonth: z.string().min(1, \"Required\"),\n  fromYear: z.string().min(1, \"Required\"),\n  toMonth: z.string().optional(),\n  toYear: z.string().optional(),\n  isCurrent: z.boolean().default(false),\n});\n\nconst createFormSchema = (t: typeof translations.en) =>\n  z.object({\n    email: z.string().email(t.invalidEmail),\n    password: z.string().min(8, t.passwordMinLength),\n    confirmPassword: z.string(),\n    firstName: z.string().min(1, t.required),\n    lastName: z.string().min(1, t.required),\n    country: z.string().min(1, t.required),\n    region: z.string().optional(),\n    countryCode: z.string().min(1, t.required),\n    phoneNumber: z.string().min(1, t.required),\n    linkedinUrl: z.string().url(t.invalidUrl).optional().or(z.literal(\"\")),\n    city: z.string().optional(),\n    canConsultInEnglish: z.enum([\"yes\", \"no\"]),\n    timezone: z.string().min(1, t.required),\n    experiences: z.array(experienceSchema).min(1, t.required),\n    biography: z.string().min(50, t.required),\n    workHistory: z.string().min(50, t.required),\n    hourlyRate: z.string().min(1, t.required),\n    currency: z.string().min(1, t.required),\n    termsAccepted: z.boolean().refine((v) => v === true, t.termsRequired),\n    vqAnswers: z.array(\n      z.object({\n        questionId: z.number(),\n        answer: z.string(),\n      })\n    ),\n  }).refine((data) => data.password === data.confirmPassword, {\n    message: t.passwordsDoNotMatch,\n    path: [\"confirmPassword\"],\n  });\n\ntype FormData = z.infer<ReturnType<typeof createFormSchema>>;\n\nexport default function ExpertOnboarding({ projectId, inviteType, token }: ExpertOnboardingProps) {\n  const { toast } = useToast();\n  const [language, setLanguage] = useState<Language>(detectBrowserLanguage);\n  const [isSubmitted, setIsSubmitted] = useState(false);\n  const t = translations[language];\n\n  const { data: invitationData, isLoading, error } = useQuery<InvitationData>({\n    queryKey: [\"/api/invite\", projectId, inviteType, token],\n    queryFn: async () => {\n      const response = await fetch(`/api/invite/${projectId}/${inviteType}/${token}`);\n      if (!response.ok) {\n        const errorData = await response.json();\n        throw new Error(errorData.error || \"Invalid invitation link\");\n      }\n      return response.json();\n    },\n  });\n\n  const formSchema = createFormSchema(t);\n  \n  const form = useForm<FormData>({\n    resolver: zodResolver(formSchema),\n    defaultValues: {\n      email: \"\",\n      password: \"\",\n      confirmPassword: \"\",\n      firstName: \"\",\n      lastName: \"\",\n      country: \"\",\n      region: \"\",\n      countryCode: \"+55\",\n      phoneNumber: \"\",\n      linkedinUrl: \"\",\n      city: \"\",\n      canConsultInEnglish: \"yes\",\n      timezone: \"America/Sao_Paulo\",\n      experiences: [\n        {\n          company: \"\",\n          title: \"\",\n          fromMonth: \"\",\n          fromYear: \"\",\n          toMonth: \"\",\n          toYear: \"\",\n          isCurrent: false,\n        },\n      ],\n      biography: \"\",\n      workHistory: \"\",\n      hourlyRate: \"\",\n      currency: \"USD\",\n      termsAccepted: false,\n      vqAnswers: [],\n    },\n  });\n\n  const { fields: experienceFields, append: appendExperience, remove: removeExperience } = useFieldArray({\n    control: form.control,\n    name: \"experiences\",\n  });\n\n  useEffect(() => {\n    if (invitationData?.vettingQuestions) {\n      form.setValue(\n        \"vqAnswers\",\n        invitationData.vettingQuestions.map((q) => ({\n          questionId: q.id,\n          answer: \"\",\n        }))\n      );\n    }\n  }, [invitationData, form]);\n\n  const registerMutation = useMutation({\n    mutationFn: async (data: FormData) => {\n      const response = await fetch(`/api/invite/${projectId}/${inviteType}/${token}/submit`, {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify(data),\n      });\n      if (!response.ok) {\n        const errorData = await response.json();\n        throw new Error(errorData.error || \"Registration failed\");\n      }\n      return response.json();\n    },\n    onSuccess: () => {\n      setIsSubmitted(true);\n    },\n    onError: (error: Error) => {\n      toast({\n        title: t.errorTitle,\n        description: error.message,\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const onSubmit = (data: FormData) => {\n    registerMutation.mutate(data);\n  };\n\n  const yearOptions = getYearOptions();\n\n  const LanguageToggle = () => (\n    <div className=\"flex items-center gap-2\">\n      <Globe className=\"h-4 w-4 text-muted-foreground\" />\n      <Select value={language} onValueChange={(v) => setLanguage(v as Language)}>\n        <SelectTrigger className=\"w-[140px]\" data-testid=\"select-language\">\n          <SelectValue />\n        </SelectTrigger>\n        <SelectContent>\n          <SelectItem value=\"pt\">Portugus</SelectItem>\n          <SelectItem value=\"es\">Espaol</SelectItem>\n          <SelectItem value=\"en\">English</SelectItem>\n        </SelectContent>\n      </Select>\n    </div>\n  );\n\n  if (isLoading) {\n    return (\n      <div className=\"flex min-h-screen items-center justify-center bg-background p-4\">\n        <Card className=\"w-full max-w-lg\">\n          <CardContent className=\"flex flex-col items-center gap-4 py-12\">\n            <Loader2 className=\"h-8 w-8 animate-spin text-primary\" />\n            <p className=\"text-muted-foreground\">{t.loading}</p>\n          </CardContent>\n        </Card>\n      </div>\n    );\n  }\n\n  if (error || !invitationData) {\n    return (\n      <div className=\"flex min-h-screen items-center justify-center bg-background p-4\">\n        <Card className=\"w-full max-w-lg\">\n          <CardHeader className=\"flex flex-row items-center justify-end\">\n            <LanguageToggle />\n          </CardHeader>\n          <CardContent className=\"flex flex-col items-center gap-4 py-12 text-center\">\n            <div className=\"flex h-16 w-16 items-center justify-center rounded-full bg-destructive/10\">\n              <AlertCircle className=\"h-8 w-8 text-destructive\" />\n            </div>\n            <div>\n              <h2 className=\"text-xl font-semibold\">{t.errorTitle}</h2>\n              <p className=\"mt-2 text-muted-foreground\">\n                {(error as Error)?.message || t.invalidLink}\n              </p>\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n    );\n  }\n\n  if (isSubmitted) {\n    return (\n      <div className=\"flex min-h-screen items-center justify-center bg-background p-4\">\n        <Card className=\"w-full max-w-lg\">\n          <CardContent className=\"flex flex-col items-center gap-4 py-12 text-center\">\n            <div className=\"flex h-16 w-16 items-center justify-center rounded-full bg-green-500/10\">\n              <CheckCircle className=\"h-8 w-8 text-green-500\" />\n            </div>\n            <div>\n              <h2 className=\"text-xl font-semibold\">{t.successTitle}</h2>\n              <p className=\"mt-2 text-muted-foreground\">{t.successMessage}</p>\n            </div>\n            <Button onClick={() => window.close()} data-testid=\"button-close\">\n              {t.closeButton}\n            </Button>\n          </CardContent>\n        </Card>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"min-h-screen bg-background p-4 py-8\">\n      <div className=\"mx-auto max-w-4xl\">\n        <div className=\"mb-6 flex items-center justify-between\">\n          <div className=\"flex items-center gap-3\">\n            <img src={logoPath} alt=\"Mirae Connext\" className=\"h-10 w-auto\" />\n          </div>\n          <LanguageToggle />\n        </div>\n\n        <div className=\"mb-8 text-center\">\n          <h1 className=\"text-2xl font-bold\">{t.pageTitle}</h1>\n          <p className=\"mt-2 text-muted-foreground\">{t.pageSubtitle}</p>\n        </div>\n\n        <Card className=\"mb-6\">\n          <CardHeader>\n            <div className=\"flex items-center gap-2\">\n              <Building2 className=\"h-5 w-5 text-muted-foreground\" />\n              <CardTitle className=\"text-lg\">{t.projectInfoTitle}</CardTitle>\n            </div>\n            <CardDescription>{t.projectDescription}</CardDescription>\n          </CardHeader>\n          <CardContent className=\"space-y-3\">\n            <div>\n              <p className=\"text-sm font-medium\">{invitationData.project.name}</p>\n              <p className=\"text-sm text-muted-foreground\">\n                {invitationData.project.clientName}  {invitationData.project.industry}\n              </p>\n            </div>\n            {invitationData.project.projectOverview && (\n              <p className=\"text-sm text-muted-foreground\">\n                {invitationData.project.projectOverview}\n              </p>\n            )}\n          </CardContent>\n        </Card>\n\n        <Form {...form}>\n          <form onSubmit={form.handleSubmit(onSubmit)} className=\"space-y-6\">\n            <Card>\n              <CardHeader>\n                <div className=\"flex items-center gap-2\">\n                  <Lock className=\"h-5 w-5 text-muted-foreground\" />\n                  <CardTitle className=\"text-lg\">{t.loginInfoTitle}</CardTitle>\n                </div>\n              </CardHeader>\n              <CardContent className=\"space-y-4\">\n                <FormField\n                  control={form.control}\n                  name=\"email\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>{t.email} *</FormLabel>\n                      <FormControl>\n                        <Input placeholder={t.emailPlaceholder} {...field} data-testid=\"input-email\" />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n                <div className=\"grid gap-4 sm:grid-cols-2\">\n                  <FormField\n                    control={form.control}\n                    name=\"password\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>{t.password} *</FormLabel>\n                        <FormControl>\n                          <Input\n                            type=\"password\"\n                            placeholder={t.passwordPlaceholder}\n                            {...field}\n                            data-testid=\"input-password\"\n                          />\n                        </FormControl>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n                  <FormField\n                    control={form.control}\n                    name=\"confirmPassword\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>{t.confirmPassword} *</FormLabel>\n                        <FormControl>\n                          <Input\n                            type=\"password\"\n                            placeholder={t.confirmPasswordPlaceholder}\n                            {...field}\n                            data-testid=\"input-confirm-password\"\n                          />\n                        </FormControl>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n                </div>\n              </CardContent>\n            </Card>\n\n            <Card>\n              <CardHeader>\n                <div className=\"flex items-center gap-2\">\n                  <User className=\"h-5 w-5 text-muted-foreground\" />\n                  <CardTitle className=\"text-lg\">{t.basicInfoTitle}</CardTitle>\n                </div>\n              </CardHeader>\n              <CardContent className=\"space-y-4\">\n                <div className=\"grid gap-4 sm:grid-cols-2\">\n                  <FormField\n                    control={form.control}\n                    name=\"firstName\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>{t.firstName} *</FormLabel>\n                        <FormControl>\n                          <Input placeholder={t.firstNamePlaceholder} {...field} data-testid=\"input-first-name\" />\n                        </FormControl>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n                  <FormField\n                    control={form.control}\n                    name=\"lastName\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>{t.lastName} *</FormLabel>\n                        <FormControl>\n                          <Input placeholder={t.lastNamePlaceholder} {...field} data-testid=\"input-last-name\" />\n                        </FormControl>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n                </div>\n\n                <div className=\"grid gap-4 sm:grid-cols-2\">\n                  <FormField\n                    control={form.control}\n                    name=\"country\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>{t.country} *</FormLabel>\n                        <Select onValueChange={field.onChange} value={field.value}>\n                          <FormControl>\n                            <SelectTrigger data-testid=\"select-country\">\n                              <SelectValue placeholder={t.countryPlaceholder} />\n                            </SelectTrigger>\n                          </FormControl>\n                          <SelectContent>\n                            {countries.map((c) => (\n                              <SelectItem key={c.code} value={c.code}>\n                                {c.name[language]}\n                              </SelectItem>\n                            ))}\n                          </SelectContent>\n                        </Select>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n                  <FormField\n                    control={form.control}\n                    name=\"region\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>{t.region}</FormLabel>\n                        <FormControl>\n                          <Input placeholder={t.regionPlaceholder} {...field} data-testid=\"input-region\" />\n                        </FormControl>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n                </div>\n\n                <FormField\n                  control={form.control}\n                  name=\"city\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>{t.city}</FormLabel>\n                      <FormControl>\n                        <Input placeholder={t.cityPlaceholder} {...field} data-testid=\"input-city\" />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n\n                <div className=\"grid gap-4 sm:grid-cols-3\">\n                  <FormField\n                    control={form.control}\n                    name=\"countryCode\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>{t.countryCode} *</FormLabel>\n                        <Select onValueChange={field.onChange} value={field.value}>\n                          <FormControl>\n                            <SelectTrigger data-testid=\"select-country-code\">\n                              <SelectValue placeholder={t.countryCodePlaceholder} />\n                            </SelectTrigger>\n                          </FormControl>\n                          <SelectContent>\n                            {countryCodes.map((cc) => (\n                              <SelectItem key={cc.code} value={cc.code}>\n                                {cc.code} ({cc.country})\n                              </SelectItem>\n                            ))}\n                          </SelectContent>\n                        </Select>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n                  <FormField\n                    control={form.control}\n                    name=\"phoneNumber\"\n                    render={({ field }) => (\n                      <FormItem className=\"sm:col-span-2\">\n                        <FormLabel>{t.phoneNumber} *</FormLabel>\n                        <FormControl>\n                          <Input placeholder={t.phoneNumberPlaceholder} {...field} data-testid=\"input-phone\" />\n                        </FormControl>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n                </div>\n\n                <FormField\n                  control={form.control}\n                  name=\"linkedinUrl\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>{t.linkedinUrl}</FormLabel>\n                      <FormControl>\n                        <Input placeholder={t.linkedinUrlPlaceholder} {...field} data-testid=\"input-linkedin\" />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n\n                <FormField\n                  control={form.control}\n                  name=\"canConsultInEnglish\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>{t.canConsultInEnglish} *</FormLabel>\n                      <FormControl>\n                        <RadioGroup\n                          onValueChange={field.onChange}\n                          value={field.value}\n                          className=\"flex gap-6\"\n                        >\n                          <div className=\"flex items-center gap-2\">\n                            <RadioGroupItem value=\"yes\" id=\"english-yes\" data-testid=\"radio-english-yes\" />\n                            <Label htmlFor=\"english-yes\">{t.yes}</Label>\n                          </div>\n                          <div className=\"flex items-center gap-2\">\n                            <RadioGroupItem value=\"no\" id=\"english-no\" data-testid=\"radio-english-no\" />\n                            <Label htmlFor=\"english-no\">{t.no}</Label>\n                          </div>\n                        </RadioGroup>\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n\n                <FormField\n                  control={form.control}\n                  name=\"timezone\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>{t.timezone} *</FormLabel>\n                      <Select onValueChange={field.onChange} value={field.value}>\n                        <FormControl>\n                          <SelectTrigger data-testid=\"select-timezone\">\n                            <SelectValue placeholder={t.timezonePlaceholder} />\n                          </SelectTrigger>\n                        </FormControl>\n                        <SelectContent>\n                          {timezones.map((tz) => (\n                            <SelectItem key={tz.value} value={tz.value}>\n                              {tz.label[language]}\n                            </SelectItem>\n                          ))}\n                        </SelectContent>\n                      </Select>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n              </CardContent>\n            </Card>\n\n            <Card>\n              <CardHeader>\n                <div className=\"flex items-center justify-between\">\n                  <div className=\"flex items-center gap-2\">\n                    <Briefcase className=\"h-5 w-5 text-muted-foreground\" />\n                    <CardTitle className=\"text-lg\">{t.experienceTitle}</CardTitle>\n                  </div>\n                  <Button\n                    type=\"button\"\n                    variant=\"outline\"\n                    size=\"sm\"\n                    onClick={() =>\n                      appendExperience({\n                        company: \"\",\n                        title: \"\",\n                        fromMonth: \"\",\n                        fromYear: \"\",\n                        toMonth: \"\",\n                        toYear: \"\",\n                        isCurrent: false,\n                      })\n                    }\n                    className=\"gap-1\"\n                    data-testid=\"button-add-experience\"\n                  >\n                    <Plus className=\"h-4 w-4\" />\n                    {t.addExperience}\n                  </Button>\n                </div>\n              </CardHeader>\n              <CardContent className=\"space-y-6\">\n                {experienceFields.map((field, index) => (\n                  <div key={field.id} className=\"space-y-4 rounded-lg border p-4\">\n                    <div className=\"flex items-center justify-between\">\n                      <span className=\"text-sm font-medium text-muted-foreground\">\n                        #{index + 1}\n                      </span>\n                      {experienceFields.length > 1 && (\n                        <Button\n                          type=\"button\"\n                          variant=\"ghost\"\n                          size=\"sm\"\n                          onClick={() => removeExperience(index)}\n                          className=\"text-destructive hover:text-destructive\"\n                          data-testid={`button-remove-experience-${index}`}\n                        >\n                          <Trash2 className=\"h-4 w-4\" />\n                        </Button>\n                      )}\n                    </div>\n                    \n                    <div className=\"grid gap-4 sm:grid-cols-2\">\n                      <FormField\n                        control={form.control}\n                        name={`experiences.${index}.company`}\n                        render={({ field }) => (\n                          <FormItem>\n                            <FormLabel>{t.company} *</FormLabel>\n                            <FormControl>\n                              <Input placeholder={t.companyPlaceholder} {...field} data-testid={`input-company-${index}`} />\n                            </FormControl>\n                            <FormMessage />\n                          </FormItem>\n                        )}\n                      />\n                      <FormField\n                        control={form.control}\n                        name={`experiences.${index}.title`}\n                        render={({ field }) => (\n                          <FormItem>\n                            <FormLabel>{t.titleRole} *</FormLabel>\n                            <FormControl>\n                              <Input placeholder={t.titleRolePlaceholder} {...field} data-testid={`input-title-${index}`} />\n                            </FormControl>\n                            <FormMessage />\n                          </FormItem>\n                        )}\n                      />\n                    </div>\n\n                    <div className=\"grid gap-4 sm:grid-cols-2\">\n                      <div className=\"space-y-2\">\n                        <Label>{t.fromDate} *</Label>\n                        <div className=\"grid grid-cols-2 gap-2\">\n                          <FormField\n                            control={form.control}\n                            name={`experiences.${index}.fromMonth`}\n                            render={({ field }) => (\n                              <Select onValueChange={field.onChange} value={field.value}>\n                                <SelectTrigger data-testid={`select-from-month-${index}`}>\n                                  <SelectValue placeholder={t.month} />\n                                </SelectTrigger>\n                                <SelectContent>\n                                  {months.map((m) => (\n                                    <SelectItem key={m.value} value={m.value}>\n                                      {m.name[language]}\n                                    </SelectItem>\n                                  ))}\n                                </SelectContent>\n                              </Select>\n                            )}\n                          />\n                          <FormField\n                            control={form.control}\n                            name={`experiences.${index}.fromYear`}\n                            render={({ field }) => (\n                              <Select onValueChange={field.onChange} value={field.value}>\n                                <SelectTrigger data-testid={`select-from-year-${index}`}>\n                                  <SelectValue placeholder={t.year} />\n                                </SelectTrigger>\n                                <SelectContent>\n                                  {yearOptions.map((y) => (\n                                    <SelectItem key={y} value={y}>\n                                      {y}\n                                    </SelectItem>\n                                  ))}\n                                </SelectContent>\n                              </Select>\n                            )}\n                          />\n                        </div>\n                      </div>\n\n                      <div className=\"space-y-2\">\n                        <Label>{t.toDate}</Label>\n                        <div className=\"grid grid-cols-2 gap-2\">\n                          <FormField\n                            control={form.control}\n                            name={`experiences.${index}.toMonth`}\n                            render={({ field }) => (\n                              <Select\n                                onValueChange={field.onChange}\n                                value={field.value}\n                                disabled={form.watch(`experiences.${index}.isCurrent`)}\n                              >\n                                <SelectTrigger data-testid={`select-to-month-${index}`}>\n                                  <SelectValue placeholder={t.month} />\n                                </SelectTrigger>\n                                <SelectContent>\n                                  {months.map((m) => (\n                                    <SelectItem key={m.value} value={m.value}>\n                                      {m.name[language]}\n                                    </SelectItem>\n                                  ))}\n                                </SelectContent>\n                              </Select>\n                            )}\n                          />\n                          <FormField\n                            control={form.control}\n                            name={`experiences.${index}.toYear`}\n                            render={({ field }) => (\n                              <Select\n                                onValueChange={field.onChange}\n                                value={field.value}\n                                disabled={form.watch(`experiences.${index}.isCurrent`)}\n                              >\n                                <SelectTrigger data-testid={`select-to-year-${index}`}>\n                                  <SelectValue placeholder={t.year} />\n                                </SelectTrigger>\n                                <SelectContent>\n                                  {yearOptions.map((y) => (\n                                    <SelectItem key={y} value={y}>\n                                      {y}\n                                    </SelectItem>\n                                  ))}\n                                </SelectContent>\n                              </Select>\n                            )}\n                          />\n                        </div>\n                      </div>\n                    </div>\n\n                    <FormField\n                      control={form.control}\n                      name={`experiences.${index}.isCurrent`}\n                      render={({ field }) => (\n                        <FormItem className=\"flex items-center gap-2 space-y-0\">\n                          <FormControl>\n                            <Checkbox\n                              checked={field.value}\n                              onCheckedChange={field.onChange}\n                              data-testid={`checkbox-current-${index}`}\n                            />\n                          </FormControl>\n                          <FormLabel className=\"cursor-pointer font-normal\">\n                            {t.currentPosition}\n                          </FormLabel>\n                        </FormItem>\n                      )}\n                    />\n                  </div>\n                ))}\n              </CardContent>\n            </Card>\n\n            <Card>\n              <CardHeader>\n                <div className=\"flex items-center gap-2\">\n                  <FileText className=\"h-5 w-5 text-muted-foreground\" />\n                  <CardTitle className=\"text-lg\">{t.biographyTitle}</CardTitle>\n                </div>\n              </CardHeader>\n              <CardContent>\n                <FormField\n                  control={form.control}\n                  name=\"biography\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormControl>\n                        <Textarea\n                          placeholder={t.biographyPlaceholder}\n                          className=\"min-h-[150px] resize-none\"\n                          {...field}\n                          data-testid=\"input-biography\"\n                        />\n                      </FormControl>\n                      <FormDescription>{t.biographyDescription}</FormDescription>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n              </CardContent>\n            </Card>\n\n            <Card>\n              <CardHeader>\n                <div className=\"flex items-center gap-2\">\n                  <Briefcase className=\"h-5 w-5 text-muted-foreground\" />\n                  <CardTitle className=\"text-lg\">{t.workHistoryTitle}</CardTitle>\n                </div>\n              </CardHeader>\n              <CardContent>\n                <FormField\n                  control={form.control}\n                  name=\"workHistory\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormControl>\n                        <Textarea\n                          placeholder={t.workHistoryPlaceholder}\n                          className=\"min-h-[150px] resize-none\"\n                          {...field}\n                          data-testid=\"input-work-history\"\n                        />\n                      </FormControl>\n                      <FormDescription>{t.workHistoryDescription}</FormDescription>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n              </CardContent>\n            </Card>\n\n            <Card>\n              <CardHeader>\n                <div className=\"flex items-center gap-2\">\n                  <DollarSign className=\"h-5 w-5 text-muted-foreground\" />\n                  <CardTitle className=\"text-lg\">{t.hourlyRateTitle}</CardTitle>\n                </div>\n              </CardHeader>\n              <CardContent>\n                <div className=\"grid gap-4 sm:grid-cols-2\">\n                  <FormField\n                    control={form.control}\n                    name=\"hourlyRate\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>{t.hourlyRate} *</FormLabel>\n                        <FormControl>\n                          <Input\n                            type=\"number\"\n                            placeholder={t.hourlyRatePlaceholder}\n                            {...field}\n                            data-testid=\"input-hourly-rate\"\n                          />\n                        </FormControl>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n                  <FormField\n                    control={form.control}\n                    name=\"currency\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>{t.currency} *</FormLabel>\n                        <Select onValueChange={field.onChange} value={field.value}>\n                          <FormControl>\n                            <SelectTrigger data-testid=\"select-currency\">\n                              <SelectValue placeholder={t.currencyPlaceholder} />\n                            </SelectTrigger>\n                          </FormControl>\n                          <SelectContent>\n                            {currencies.map((c) => (\n                              <SelectItem key={c.code} value={c.code}>\n                                {c.symbol} {c.code} - {c.name[language]}\n                              </SelectItem>\n                            ))}\n                          </SelectContent>\n                        </Select>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n                </div>\n              </CardContent>\n            </Card>\n\n            {invitationData.vettingQuestions.length > 0 && (\n              <Card>\n                <CardHeader>\n                  <div className=\"flex items-center gap-2\">\n                    <ClipboardList className=\"h-5 w-5 text-muted-foreground\" />\n                    <CardTitle className=\"text-lg\">{t.vettingQuestionsTitle}</CardTitle>\n                  </div>\n                  <CardDescription>{t.vettingQuestionsDescription}</CardDescription>\n                </CardHeader>\n                <CardContent className=\"space-y-6\">\n                  {invitationData.vettingQuestions\n                    .sort((a, b) => a.orderIndex - b.orderIndex)\n                    .map((q, index) => (\n                      <FormField\n                        key={q.id}\n                        control={form.control}\n                        name={`vqAnswers.${index}.answer`}\n                        render={({ field }) => (\n                          <FormItem>\n                            <FormLabel className=\"flex items-start gap-2\">\n                              <span className=\"font-mono text-sm text-muted-foreground\">\n                                {index + 1}.\n                              </span>\n                              <span>\n                                {q.question}\n                                {q.isRequired && <span className=\"text-destructive ml-1\">*</span>}\n                              </span>\n                            </FormLabel>\n                            <FormControl>\n                              <Textarea\n                                className=\"min-h-[100px] resize-none\"\n                                {...field}\n                                data-testid={`input-vq-answer-${index}`}\n                              />\n                            </FormControl>\n                            <FormMessage />\n                          </FormItem>\n                        )}\n                      />\n                    ))}\n                </CardContent>\n              </Card>\n            )}\n\n            <Card>\n              <CardHeader>\n                <div className=\"flex items-center gap-2\">\n                  <Shield className=\"h-5 w-5 text-muted-foreground\" />\n                  <CardTitle className=\"text-lg\">{t.termsTitle}</CardTitle>\n                </div>\n              </CardHeader>\n              <CardContent>\n                <FormField\n                  control={form.control}\n                  name=\"termsAccepted\"\n                  render={({ field }) => (\n                    <FormItem className=\"flex flex-row items-start space-x-3 space-y-0\">\n                      <FormControl>\n                        <Checkbox\n                          checked={field.value}\n                          onCheckedChange={field.onChange}\n                          data-testid=\"checkbox-terms\"\n                        />\n                      </FormControl>\n                      <div className=\"space-y-1 leading-none\">\n                        <FormLabel className=\"cursor-pointer font-normal\">\n                          {t.termsCheckboxLabel}{\" \"}\n                          <a\n                            href=\"#terms\"\n                            className=\"text-primary underline\"\n                            target=\"_blank\"\n                            rel=\"noopener noreferrer\"\n                          >\n                            {t.termsLink}\n                          </a>{\" \"}\n                          {language === \"pt\" ? \"e\" : language === \"es\" ? \"y\" : \"and\"}{\" \"}\n                          <a\n                            href=\"#privacy\"\n                            className=\"text-primary underline\"\n                            target=\"_blank\"\n                            rel=\"noopener noreferrer\"\n                          >\n                            {t.privacyLink}\n                          </a>{\" \"}\n                          {language === \"pt\"\n                            ? \"da Mirae Connext.\"\n                            : language === \"es\"\n                            ? \"de Mirae Connext.\"\n                            : \"of Mirae Connext.\"}\n                        </FormLabel>\n                        <FormMessage />\n                      </div>\n                    </FormItem>\n                  )}\n                />\n              </CardContent>\n            </Card>\n\n            <div className=\"flex justify-center pb-8\">\n              <Button\n                type=\"submit\"\n                size=\"lg\"\n                disabled={registerMutation.isPending}\n                className=\"w-full max-w-md gap-2\"\n                data-testid=\"button-submit\"\n              >\n                {registerMutation.isPending ? (\n                  <>\n                    <Loader2 className=\"h-4 w-4 animate-spin\" />\n                    {t.submitting}\n                  </>\n                ) : (\n                  t.submitButton\n                )}\n              </Button>\n            </div>\n          </form>\n        </Form>\n      </div>\n    </div>\n  );\n}\n","path":null,"size_bytes":40572,"size_tokens":null},"server/email.ts":{"content":"import nodemailer from \"nodemailer\";\n\nconst transporter = nodemailer.createTransport({\n  host: process.env.SMTP_HOST || \"smtp.zoho.com\",\n  port: parseInt(process.env.SMTP_PORT || \"587\"),\n  secure: false,\n  auth: {\n    user: process.env.SMTP_USER,\n    pass: process.env.SMTP_PASSWORD,\n  },\n});\n\ninterface ExpertInvitationEmailParams {\n  expertName: string;\n  expertEmail: string;\n  projectName: string;\n  clientName: string;\n  industry?: string;\n  invitationUrl: string;\n  vettingQuestionsCount: number;\n}\n\nexport async function sendExpertInvitationEmail(params: ExpertInvitationEmailParams): Promise<boolean> {\n  const {\n    expertName,\n    expertEmail,\n    projectName,\n    clientName,\n    industry,\n    invitationUrl,\n    vettingQuestionsCount,\n  } = params;\n\n  const fromEmail = process.env.SMTP_FROM || process.env.SMTP_USER;\n\n  const htmlContent = `\n<!DOCTYPE html>\n<html>\n<head>\n  <meta charset=\"utf-8\">\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n  <title>Project Invitation - Mirae Connext</title>\n</head>\n<body style=\"margin: 0; padding: 0; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif; background-color: #f5f5f5;\">\n  <table role=\"presentation\" style=\"width: 100%; border-collapse: collapse;\">\n    <tr>\n      <td align=\"center\" style=\"padding: 40px 20px;\">\n        <table role=\"presentation\" style=\"width: 100%; max-width: 600px; border-collapse: collapse; background-color: #ffffff; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.08);\">\n          <!-- Header -->\n          <tr>\n            <td style=\"padding: 32px 40px 24px; border-bottom: 1px solid #eaeaea;\">\n              <h1 style=\"margin: 0; font-size: 24px; font-weight: 600; color: #1a1a1a;\">Mirae Connext</h1>\n            </td>\n          </tr>\n          \n          <!-- Content -->\n          <tr>\n            <td style=\"padding: 32px 40px;\">\n              <p style=\"margin: 0 0 20px; font-size: 16px; line-height: 1.6; color: #333;\">\n                Hello ${expertName},\n              </p>\n              \n              <p style=\"margin: 0 0 20px; font-size: 16px; line-height: 1.6; color: #333;\">\n                You have been invited to participate in a new project opportunity through Mirae Connext.\n              </p>\n              \n              <!-- Project Details Box -->\n              <table role=\"presentation\" style=\"width: 100%; border-collapse: collapse; background-color: #f8f9fa; border-radius: 6px; margin: 24px 0;\">\n                <tr>\n                  <td style=\"padding: 20px;\">\n                    <p style=\"margin: 0 0 12px; font-size: 14px; color: #666;\">PROJECT</p>\n                    <p style=\"margin: 0 0 16px; font-size: 18px; font-weight: 600; color: #1a1a1a;\">${projectName}</p>\n                    \n                    <p style=\"margin: 0 0 8px; font-size: 14px; color: #666;\">CLIENT</p>\n                    <p style=\"margin: 0 0 16px; font-size: 16px; color: #333;\">${clientName}</p>\n                    \n                    ${industry ? `\n                    <p style=\"margin: 0 0 8px; font-size: 14px; color: #666;\">INDUSTRY</p>\n                    <p style=\"margin: 0; font-size: 16px; color: #333;\">${industry}</p>\n                    ` : ''}\n                  </td>\n                </tr>\n              </table>\n              \n              <p style=\"margin: 0 0 24px; font-size: 16px; line-height: 1.6; color: #333;\">\n                Please review the project details and let us know if you're interested in participating. \n                ${vettingQuestionsCount > 0 ? `There are ${vettingQuestionsCount} screening question${vettingQuestionsCount > 1 ? 's' : ''} to help us understand your expertise.` : ''}\n              </p>\n              \n              <!-- CTA Button -->\n              <table role=\"presentation\" style=\"width: 100%; border-collapse: collapse;\">\n                <tr>\n                  <td align=\"center\" style=\"padding: 8px 0 24px;\">\n                    <a href=\"${invitationUrl}\" style=\"display: inline-block; padding: 14px 32px; background-color: #0066cc; color: #ffffff; text-decoration: none; font-size: 16px; font-weight: 500; border-radius: 6px;\">\n                      View Project &amp; Respond\n                    </a>\n                  </td>\n                </tr>\n              </table>\n              \n              <p style=\"margin: 0 0 8px; font-size: 14px; color: #666;\">\n                Or copy and paste this link into your browser:\n              </p>\n              <p style=\"margin: 0; font-size: 14px; color: #0066cc; word-break: break-all;\">\n                ${invitationUrl}\n              </p>\n            </td>\n          </tr>\n          \n          <!-- Footer -->\n          <tr>\n            <td style=\"padding: 24px 40px; border-top: 1px solid #eaeaea; background-color: #fafafa; border-radius: 0 0 8px 8px;\">\n              <p style=\"margin: 0 0 8px; font-size: 13px; color: #888;\">\n                This invitation was sent by Mirae Connext Expert Network.\n              </p>\n              <p style=\"margin: 0; font-size: 13px; color: #888;\">\n                If you have any questions, please contact us at ${fromEmail}\n              </p>\n            </td>\n          </tr>\n        </table>\n      </td>\n    </tr>\n  </table>\n</body>\n</html>\n  `;\n\n  const textContent = `\nHello ${expertName},\n\nYou have been invited to participate in a new project opportunity through Mirae Connext.\n\nPROJECT: ${projectName}\nCLIENT: ${clientName}\n${industry ? `INDUSTRY: ${industry}` : ''}\n\nPlease review the project details and let us know if you're interested in participating.\n${vettingQuestionsCount > 0 ? `There are ${vettingQuestionsCount} screening question${vettingQuestionsCount > 1 ? 's' : ''} to help us understand your expertise.` : ''}\n\nView Project & Respond: ${invitationUrl}\n\n---\nThis invitation was sent by Mirae Connext Expert Network.\nIf you have any questions, please contact us at ${fromEmail}\n  `;\n\n  try {\n    const info = await transporter.sendMail({\n      from: `\"Mirae Connext\" <${fromEmail}>`,\n      to: expertEmail,\n      subject: `Project Invitation: ${projectName} - Mirae Connext`,\n      text: textContent,\n      html: htmlContent,\n    });\n\n    console.log(`Email sent successfully to ${expertEmail}: ${info.messageId}`);\n    return true;\n  } catch (error) {\n    console.error(`Failed to send email to ${expertEmail}:`, error);\n    return false;\n  }\n}\n\nexport async function verifySmtpConnection(): Promise<boolean> {\n  try {\n    await transporter.verify();\n    console.log(\"SMTP connection verified successfully\");\n    return true;\n  } catch (error) {\n    console.error(\"SMTP connection verification failed:\", error);\n    return false;\n  }\n}\n","path":null,"size_bytes":6696,"size_tokens":null},"client/src/pages/expert-project-invite.tsx":{"content":"import { useState, useMemo } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { useParams, useLocation } from \"wouter\";\nimport {\n  Building2,\n  Briefcase,\n  Globe,\n  FileText,\n  CheckCircle2,\n  XCircle,\n  Clock,\n  Loader2,\n  AlertCircle,\n  Layers,\n} from \"lucide-react\";\nimport { Card, CardContent, CardHeader, CardTitle, CardDescription, CardFooter } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Separator } from \"@/components/ui/separator\";\nimport { useToast } from \"@/hooks/use-toast\";\n\ninterface VettingQuestion {\n  id: number;\n  question: string;\n  orderIndex: number;\n  isRequired: boolean;\n  angleId: number | null;\n  questionType?: string;\n}\n\ninterface ProjectAngle {\n  id: number;\n  title: string;\n  description?: string;\n}\n\ninterface ProjectInviteData {\n  project: {\n    id: number;\n    name: string;\n    clientName: string;\n    clientCompany?: string;\n    industry: string;\n    region?: string;\n    projectOverview?: string;\n    description?: string;\n  };\n  expert: {\n    id: number;\n    name: string;\n    email: string;\n  };\n  angles?: ProjectAngle[];\n  vettingQuestions: VettingQuestion[];\n  currentStatus: string;\n  hasResponded: boolean;\n}\n\nexport default function ExpertProjectInvite() {\n  const { token } = useParams<{ token: string }>();\n  const [, setLocation] = useLocation();\n  const { toast } = useToast();\n\n  const [vqAnswers, setVqAnswers] = useState<Record<number, string>>({});\n  const [availabilityNote, setAvailabilityNote] = useState(\"\");\n  const [showSuccess, setShowSuccess] = useState(false);\n  const [responseType, setResponseType] = useState<\"accept\" | \"decline\" | null>(null);\n\n  const { data, isLoading, error } = useQuery<ProjectInviteData>({\n    queryKey: [\"/api/expert/project-invite\", token],\n    queryFn: async () => {\n      const res = await fetch(`/api/expert/project-invite/${token}`);\n      if (!res.ok) {\n        const data = await res.json();\n        throw new Error(data.error || \"Failed to load invitation\");\n      }\n      return res.json();\n    },\n    enabled: !!token,\n  });\n\n  const respondMutation = useMutation({\n    mutationFn: async ({ response }: { response: \"accept\" | \"decline\" }) => {\n      const answersArray = Object.entries(vqAnswers).map(([questionId, answer]) => ({\n        questionId: parseInt(questionId),\n        answer,\n      }));\n\n      const res = await fetch(`/api/expert/project-invite/${token}/respond`, {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify({\n          response,\n          vqAnswers: answersArray,\n          availabilityNote,\n        }),\n      });\n      if (!res.ok) {\n        const data = await res.json();\n        throw new Error(data.error || \"Failed to submit response\");\n      }\n      return res.json();\n    },\n    onSuccess: (data) => {\n      setResponseType(data.response);\n      setShowSuccess(true);\n    },\n    onError: (error: Error) => {\n      toast({\n        title: \"Error\",\n        description: error.message,\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const handleVqAnswerChange = (questionId: number, value: string) => {\n    setVqAnswers((prev) => ({ ...prev, [questionId]: value }));\n  };\n\n  const handleAccept = () => {\n    const requiredQuestions = data?.vettingQuestions.filter((q) => q.isRequired) || [];\n    const missingAnswers = requiredQuestions.filter((q) => !vqAnswers[q.id]?.trim());\n\n    if (missingAnswers.length > 0) {\n      toast({\n        title: \"Required questions\",\n        description: \"Please answer all required questions before accepting.\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    respondMutation.mutate({ response: \"accept\" });\n  };\n\n  const handleDecline = () => {\n    respondMutation.mutate({ response: \"decline\" });\n  };\n\n  if (isLoading) {\n    return (\n      <div className=\"min-h-screen flex items-center justify-center bg-background\">\n        <div className=\"flex flex-col items-center gap-4\">\n          <Loader2 className=\"h-8 w-8 animate-spin text-primary\" />\n          <p className=\"text-muted-foreground\">Loading invitation...</p>\n        </div>\n      </div>\n    );\n  }\n\n  if (error) {\n    return (\n      <div className=\"min-h-screen flex items-center justify-center bg-background p-4\">\n        <Card className=\"max-w-md w-full\">\n          <CardContent className=\"pt-6\">\n            <div className=\"flex flex-col items-center gap-4 text-center\">\n              <AlertCircle className=\"h-12 w-12 text-destructive\" />\n              <h2 className=\"text-xl font-semibold\">Invalid Invitation</h2>\n              <p className=\"text-muted-foreground\">{(error as Error).message}</p>\n              <p className=\"text-sm text-muted-foreground\">\n                This invitation link may have expired, already been used, or is invalid.\n              </p>\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n    );\n  }\n\n  if (!data) return null;\n\n  if (data.hasResponded) {\n    return (\n      <div className=\"min-h-screen flex items-center justify-center bg-background p-4\">\n        <Card className=\"max-w-md w-full\">\n          <CardContent className=\"pt-6\">\n            <div className=\"flex flex-col items-center gap-4 text-center\">\n              <CheckCircle2 className=\"h-12 w-12 text-green-500\" />\n              <h2 className=\"text-xl font-semibold\">Already Responded</h2>\n              <p className=\"text-muted-foreground\">\n                You have already responded to this project invitation.\n              </p>\n              <p className=\"text-sm text-muted-foreground\">\n                Current status: <Badge variant=\"outline\">{data.currentStatus}</Badge>\n              </p>\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n    );\n  }\n\n  if (showSuccess) {\n    return (\n      <div className=\"min-h-screen flex items-center justify-center bg-background p-4\">\n        <Card className=\"max-w-md w-full\">\n          <CardContent className=\"pt-6\">\n            <div className=\"flex flex-col items-center gap-4 text-center\">\n              {responseType === \"accept\" ? (\n                <>\n                  <CheckCircle2 className=\"h-16 w-16 text-green-500\" />\n                  <h2 className=\"text-2xl font-semibold\">Thank You!</h2>\n                  <p className=\"text-muted-foreground\">\n                    You have accepted the project invitation for{\" \"}\n                    <span className=\"font-medium text-foreground\">{data.project.name}</span>.\n                  </p>\n                  <p className=\"text-sm text-muted-foreground\">\n                    The Mirae Connext team will be in touch soon to discuss next steps.\n                  </p>\n                </>\n              ) : (\n                <>\n                  <XCircle className=\"h-16 w-16 text-muted-foreground\" />\n                  <h2 className=\"text-2xl font-semibold\">Response Recorded</h2>\n                  <p className=\"text-muted-foreground\">\n                    Thank you for your response. We appreciate your time and will keep you in mind\n                    for future opportunities.\n                  </p>\n                </>\n              )}\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"min-h-screen bg-background py-8 px-4\">\n      <div className=\"max-w-2xl mx-auto space-y-6\">\n        <div className=\"text-center space-y-2\">\n          <h1 className=\"text-2xl font-bold\">Project Invitation</h1>\n          <p className=\"text-muted-foreground\">\n            Hello {data.expert.name}, you've been invited to participate in a project\n          </p>\n        </div>\n\n        <Card>\n          <CardHeader>\n            <CardTitle className=\"flex items-center gap-2\">\n              <Briefcase className=\"h-5 w-5\" />\n              {data.project.name}\n            </CardTitle>\n            <CardDescription>Review the project details and respond below</CardDescription>\n          </CardHeader>\n          <CardContent className=\"space-y-4\">\n            <div className=\"grid grid-cols-2 gap-4\">\n              <div className=\"flex items-center gap-2\">\n                <Building2 className=\"h-4 w-4 text-muted-foreground\" />\n                <div>\n                  <p className=\"text-xs text-muted-foreground\">Client</p>\n                  <p className=\"text-sm font-medium\">{data.project.clientName}</p>\n                </div>\n              </div>\n              <div className=\"flex items-center gap-2\">\n                <Globe className=\"h-4 w-4 text-muted-foreground\" />\n                <div>\n                  <p className=\"text-xs text-muted-foreground\">Industry</p>\n                  <p className=\"text-sm font-medium\">{data.project.industry}</p>\n                </div>\n              </div>\n              {data.project.region && (\n                <div className=\"flex items-center gap-2\">\n                  <Globe className=\"h-4 w-4 text-muted-foreground\" />\n                  <div>\n                    <p className=\"text-xs text-muted-foreground\">Region</p>\n                    <p className=\"text-sm font-medium\">{data.project.region}</p>\n                  </div>\n                </div>\n              )}\n            </div>\n\n            {data.project.projectOverview && (\n              <>\n                <Separator />\n                <div>\n                  <p className=\"text-sm font-medium mb-2\">Project Overview</p>\n                  <p className=\"text-sm text-muted-foreground whitespace-pre-wrap\">\n                    {data.project.projectOverview}\n                  </p>\n                </div>\n              </>\n            )}\n\n            {data.project.description && (\n              <>\n                <Separator />\n                <div>\n                  <p className=\"text-sm font-medium mb-2\">Description</p>\n                  <p className=\"text-sm text-muted-foreground whitespace-pre-wrap\">\n                    {data.project.description}\n                  </p>\n                </div>\n              </>\n            )}\n          </CardContent>\n        </Card>\n\n        {data.vettingQuestions.length > 0 && (\n          <Card>\n            <CardHeader>\n              <CardTitle className=\"flex items-center gap-2\">\n                <FileText className=\"h-5 w-5\" />\n                Screening Questions\n              </CardTitle>\n              <CardDescription>\n                Please answer the following questions to help us understand your fit for this project\n              </CardDescription>\n            </CardHeader>\n            <CardContent className=\"space-y-6\">\n              {/* Group questions by angle */}\n              {(() => {\n                const generalQuestions = data.vettingQuestions.filter(q => !q.angleId);\n                const angleQuestions = data.angles?.map(angle => ({\n                  angle,\n                  questions: data.vettingQuestions.filter(q => q.angleId === angle.id),\n                })).filter(group => group.questions.length > 0) || [];\n\n                let questionIndex = 0;\n\n                return (\n                  <>\n                    {/* General Questions (not assigned to any angle) */}\n                    {generalQuestions.length > 0 && (\n                      <div className=\"space-y-4\">\n                        {angleQuestions.length > 0 && (\n                          <div className=\"flex items-center gap-2 mb-2\">\n                            <FileText className=\"h-4 w-4 text-muted-foreground\" />\n                            <span className=\"text-sm font-medium text-muted-foreground\">General Questions</span>\n                          </div>\n                        )}\n                        {generalQuestions\n                          .sort((a, b) => a.orderIndex - b.orderIndex)\n                          .map((q) => {\n                            questionIndex++;\n                            return (\n                              <div key={q.id} className=\"space-y-2\">\n                                <div className=\"flex gap-2 items-start\">\n                                  <span className=\"font-mono text-sm text-muted-foreground w-6 flex-shrink-0\">\n                                    {questionIndex}.\n                                  </span>\n                                  <div className=\"flex-1\">\n                                    <div className=\"flex items-center gap-2 flex-wrap\">\n                                      <p className=\"text-sm font-medium\">\n                                        {q.question}\n                                        {q.isRequired && <span className=\"text-destructive ml-1\">*</span>}\n                                      </p>\n                                      {q.questionType && (\n                                        <Badge variant=\"outline\" className=\"text-xs\">\n                                          {q.questionType}\n                                        </Badge>\n                                      )}\n                                    </div>\n                                    <Textarea\n                                      placeholder=\"Your answer...\"\n                                      value={vqAnswers[q.id] || \"\"}\n                                      onChange={(e) => handleVqAnswerChange(q.id, e.target.value)}\n                                      className=\"mt-2\"\n                                      rows={3}\n                                      data-testid={`input-vq-answer-${q.id}`}\n                                    />\n                                  </div>\n                                </div>\n                              </div>\n                            );\n                          })}\n                      </div>\n                    )}\n\n                    {/* Questions grouped by angle */}\n                    {angleQuestions.map(({ angle, questions }) => (\n                      <div key={angle.id} className=\"space-y-4\">\n                        {generalQuestions.length > 0 && <Separator />}\n                        <div className=\"flex items-center gap-2 mb-2\">\n                          <Layers className=\"h-4 w-4 text-primary\" />\n                          <span className=\"text-sm font-medium\">{angle.title}</span>\n                          {angle.description && (\n                            <span className=\"text-xs text-muted-foreground\">- {angle.description}</span>\n                          )}\n                        </div>\n                        {questions\n                          .sort((a, b) => a.orderIndex - b.orderIndex)\n                          .map((q) => {\n                            questionIndex++;\n                            return (\n                              <div key={q.id} className=\"space-y-2 pl-4 border-l-2 border-primary/20\">\n                                <div className=\"flex gap-2 items-start\">\n                                  <span className=\"font-mono text-sm text-muted-foreground w-6 flex-shrink-0\">\n                                    {questionIndex}.\n                                  </span>\n                                  <div className=\"flex-1\">\n                                    <div className=\"flex items-center gap-2 flex-wrap\">\n                                      <p className=\"text-sm font-medium\">\n                                        {q.question}\n                                        {q.isRequired && <span className=\"text-destructive ml-1\">*</span>}\n                                      </p>\n                                      {q.questionType && (\n                                        <Badge variant=\"outline\" className=\"text-xs\">\n                                          {q.questionType}\n                                        </Badge>\n                                      )}\n                                    </div>\n                                    <Textarea\n                                      placeholder=\"Your answer...\"\n                                      value={vqAnswers[q.id] || \"\"}\n                                      onChange={(e) => handleVqAnswerChange(q.id, e.target.value)}\n                                      className=\"mt-2\"\n                                      rows={3}\n                                      data-testid={`input-vq-answer-${q.id}`}\n                                    />\n                                  </div>\n                                </div>\n                              </div>\n                            );\n                          })}\n                      </div>\n                    ))}\n                  </>\n                );\n              })()}\n            </CardContent>\n          </Card>\n        )}\n\n        <Card>\n          <CardHeader>\n            <CardTitle className=\"flex items-center gap-2\">\n              <Clock className=\"h-5 w-5\" />\n              Availability Note (Optional)\n            </CardTitle>\n            <CardDescription>\n              Let us know about your availability for this project\n            </CardDescription>\n          </CardHeader>\n          <CardContent>\n            <Textarea\n              placeholder=\"e.g., Available starting next week, preferred time slots, any scheduling constraints...\"\n              value={availabilityNote}\n              onChange={(e) => setAvailabilityNote(e.target.value)}\n              rows={3}\n              data-testid=\"input-availability-note\"\n            />\n          </CardContent>\n        </Card>\n\n        <Card>\n          <CardContent className=\"pt-6\">\n            <div className=\"flex flex-col sm:flex-row gap-3\">\n              <Button\n                variant=\"outline\"\n                className=\"flex-1\"\n                onClick={handleDecline}\n                disabled={respondMutation.isPending}\n                data-testid=\"button-decline\"\n              >\n                <XCircle className=\"h-4 w-4 mr-2\" />\n                Decline\n              </Button>\n              <Button\n                className=\"flex-1 bg-green-600 hover:bg-green-700\"\n                onClick={handleAccept}\n                disabled={respondMutation.isPending}\n                data-testid=\"button-accept\"\n              >\n                {respondMutation.isPending ? (\n                  <>\n                    <Loader2 className=\"h-4 w-4 mr-2 animate-spin\" />\n                    Submitting...\n                  </>\n                ) : (\n                  <>\n                    <CheckCircle2 className=\"h-4 w-4 mr-2\" />\n                    Accept Invitation\n                  </>\n                )}\n              </Button>\n            </div>\n          </CardContent>\n          <CardFooter className=\"flex justify-center pb-6\">\n            <p className=\"text-xs text-muted-foreground text-center\">\n              By accepting, you agree to participate in this project according to Mirae Connext terms.\n            </p>\n          </CardFooter>\n        </Card>\n\n        <div className=\"text-center\">\n          <p className=\"text-xs text-muted-foreground\">\n            Powered by <span className=\"font-semibold\">Mirae Connext</span>\n          </p>\n        </div>\n      </div>\n    </div>\n  );\n}\n","path":null,"size_bytes":19157,"size_tokens":null},"client/src/pages/expert-profile.tsx":{"content":"import { useParams, useLocation } from \"wouter\";\nimport { ExpertProfileEditor } from \"@/components/expert-profile-editor\";\n\nexport default function ExpertProfilePage() {\n  const params = useParams<{ id: string }>();\n  const expertId = parseInt(params.id || \"0\", 10);\n\n  if (!expertId) {\n    return (\n      <div className=\"flex flex-col items-center justify-center p-8\">\n        <h2 className=\"text-xl font-semibold\">Invalid Expert ID</h2>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"flex flex-col gap-4 p-8\">\n      <div>\n        <h1 className=\"text-3xl font-bold\">Expert Profile</h1>\n      </div>\n      <ExpertProfileEditor expertId={expertId} />\n    </div>\n  );\n}\n","path":null,"size_bytes":677,"size_tokens":null},"client/src/lib/mockProjects.js":{"content":"export const mockProjects = [\n  {\n    id: \"PRJ-MOCK-GLOBAL-01\",\n    name: \"Global Digital Payments Benchmarking Study\",\n    client: \"Alpha Capital Partners\",\n    region: \"Global (Brazil, India, Mexico, Indonesia)\",\n    description: \"Comparative benchmarking of digital wallets, BNPL, and merchant acquiring models across emerging markets.\",\n    vettingQuestions: [\n      \"What is your experience with digital wallet growth and user acquisition?\",\n      \"What were the key drivers of BNPL adoption in your market?\",\n      \"How are merchant fees structured in your region?\",\n      \"What regulatory shifts have impacted payments in the last 3 years?\",\n    ],\n    createdAt: \"2025-12-01\",\n    projectType: \"Expert Consultation\",\n    status: \"Open\",\n    requiredIndustry: [\"Fintech\", \"Digital Payments\"],\n    requiredSeniority: [\"Manager\", \"Director\", \"VP\"],\n    assignedRAs: [\"RA-001\"],\n    expertsAssigned: [],\n    notes: \"Mock project for end-to-end workflow testing including expert invitation, email delivery, and availability check.\"\n  }\n];\n","path":null,"size_bytes":1042,"size_tokens":null},"client/src/components/expert-profile-editor.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from \"@/components/ui/table\";\nimport { Trash2, Plus } from \"lucide-react\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport { useToast } from \"@/hooks/use-toast\";\n\ninterface WorkExperience {\n  company: string;\n  jobTitle: string;\n  fromYear: number;\n  toYear: number;\n}\n\ninterface Expert {\n  id: number;\n  name: string;\n  email: string;\n  phone?: string | null;\n  linkedinUrl?: string | null;\n  workHistory?: WorkExperience[] | null;\n  biography?: string | null;\n  [key: string]: any;\n}\n\ninterface ExpertProfileEditorProps {\n  expertId: number;\n}\n\nexport function ExpertProfileEditor({ expertId }: ExpertProfileEditorProps) {\n  const { toast } = useToast();\n  const [isEditing, setIsEditing] = useState(false);\n  const [formData, setFormData] = useState<Expert | null>(null);\n\n  // Fetch expert data on mount\n  const { data: expert, isLoading } = useQuery<Expert>({\n    queryKey: [\"/api/experts\", expertId],\n    queryFn: async () => {\n      const res = await fetch(`/api/experts/${expertId}`, {\n        headers: {\n          Authorization: `Bearer ${localStorage.getItem(\"authToken\")}`,\n        },\n      });\n      if (!res.ok) throw new Error(\"Failed to fetch expert\");\n      return res.json();\n    },\n  });\n\n  useEffect(() => {\n    if (expert) {\n      setFormData({\n        ...expert,\n        workHistory: expert.workHistory || [],\n      });\n    }\n  }, [expert]);\n\n  // Mutation to save expert profile\n  const saveMutation = useMutation({\n    mutationFn: async (data: Partial<Expert>) => {\n      const result = await apiRequest(\"PATCH\", `/api/experts/${expertId}`, data);\n      return result.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/experts\", expertId] });\n      setIsEditing(false);\n      toast({ title: \"Profile saved successfully\" });\n    },\n    onError: () => {\n      toast({ title: \"Failed to save profile\", variant: \"destructive\" });\n    },\n  });\n\n  const handleEdit = () => {\n    setIsEditing(true);\n  };\n\n  const handleSave = async () => {\n    if (!formData?.name || !formData?.email) {\n      toast({ title: \"Name and Email are required\", variant: \"destructive\" });\n      return;\n    }\n    await saveMutation.mutateAsync({\n      name: formData.name,\n      email: formData.email,\n      phone: formData.phone,\n      linkedinUrl: formData.linkedinUrl,\n      workHistory: formData.workHistory,\n      biography: formData.biography,\n    });\n  };\n\n  const handleCancel = () => {\n    setIsEditing(false);\n    // Reset to original data\n    if (expert) {\n      setFormData({\n        ...expert,\n        workHistory: expert.workHistory || [],\n      });\n    }\n  };\n\n  const handleAddExperience = () => {\n    if (!formData) return;\n    setFormData({\n      ...formData,\n      workHistory: [\n        ...(formData.workHistory || []),\n        { company: \"\", jobTitle: \"\", fromYear: new Date().getFullYear(), toYear: new Date().getFullYear() },\n      ],\n    });\n  };\n\n  const handleRemoveExperience = (index: number) => {\n    if (!formData) return;\n    setFormData({\n      ...formData,\n      workHistory: formData.workHistory.filter((_, i) => i !== index),\n    });\n  };\n\n  const handleExperienceChange = (index: number, field: keyof WorkExperience, value: any) => {\n    if (!formData) return;\n    const updated = [...formData.workHistory];\n    updated[index] = { ...updated[index], [field]: value };\n    setFormData({ ...formData, workHistory: updated });\n  };\n\n  if (isLoading || !formData) {\n    return <div className=\"flex items-center justify-center p-8\">Loading...</div>;\n  }\n\n  return (\n    <div className=\"w-full max-w-4xl\">\n      <Card>\n        <CardHeader className=\"flex flex-row items-start justify-between gap-4\">\n          <div>\n            <CardTitle>Advisor #{expertId}</CardTitle>\n            <CardDescription>Profile Information</CardDescription>\n          </div>\n          <div className=\"flex gap-2\">\n            {!isEditing ? (\n              <Button onClick={handleEdit} data-testid=\"button-edit-profile\">\n                Edit\n              </Button>\n            ) : (\n              <>\n                <Button\n                  variant=\"outline\"\n                  onClick={handleCancel}\n                  disabled={saveMutation.isPending}\n                  data-testid=\"button-cancel-profile\"\n                >\n                  Cancel\n                </Button>\n                <Button\n                  onClick={handleSave}\n                  disabled={saveMutation.isPending}\n                  data-testid=\"button-save-profile\"\n                >\n                  {saveMutation.isPending ? \"Saving...\" : \"Save\"}\n                </Button>\n              </>\n            )}\n          </div>\n        </CardHeader>\n\n        <CardContent className=\"space-y-8\">\n          {/* Basic Info Section */}\n          <div className=\"space-y-4\">\n            <h3 className=\"font-semibold text-lg\">Basic Information</h3>\n            <div className=\"grid grid-cols-2 gap-4\">\n              <div className=\"space-y-2\">\n                <label className=\"text-sm font-medium\">Name</label>\n                <Input\n                  value={formData.name}\n                  onChange={(e) => setFormData({ ...formData, name: e.target.value })}\n                  disabled={!isEditing}\n                  data-testid=\"input-profile-name\"\n                />\n              </div>\n              <div className=\"space-y-2\">\n                <label className=\"text-sm font-medium\">Email</label>\n                <Input\n                  type=\"email\"\n                  value={formData.email}\n                  onChange={(e) => setFormData({ ...formData, email: e.target.value })}\n                  disabled={!isEditing}\n                  data-testid=\"input-profile-email\"\n                />\n              </div>\n              <div className=\"space-y-2\">\n                <label className=\"text-sm font-medium\">Phone</label>\n                <Input\n                  value={formData.phone || \"\"}\n                  onChange={(e) => setFormData({ ...formData, phone: e.target.value })}\n                  disabled={!isEditing}\n                  placeholder=\"Optional\"\n                  data-testid=\"input-profile-phone\"\n                />\n              </div>\n              <div className=\"space-y-2\">\n                <label className=\"text-sm font-medium\">LinkedIn URL</label>\n                <Input\n                  value={formData.linkedinUrl || \"\"}\n                  onChange={(e) => setFormData({ ...formData, linkedinUrl: e.target.value })}\n                  disabled={!isEditing}\n                  placeholder=\"Optional\"\n                  data-testid=\"input-profile-linkedin\"\n                />\n              </div>\n            </div>\n          </div>\n\n          {/* Work History Section */}\n          <div className=\"space-y-4\">\n            <div className=\"flex items-center justify-between\">\n              <h3 className=\"font-semibold text-lg\">Work History</h3>\n              {isEditing && (\n                <Button\n                  variant=\"outline\"\n                  size=\"sm\"\n                  onClick={handleAddExperience}\n                  data-testid=\"button-add-experience\"\n                >\n                  <Plus className=\"w-4 h-4 mr-2\" />\n                  Add Experience\n                </Button>\n              )}\n            </div>\n\n            {formData.workHistory.length === 0 ? (\n              <p className=\"text-sm text-muted-foreground py-4\">No work history added yet.</p>\n            ) : (\n              <Table>\n                <TableHeader>\n                  <TableRow>\n                    <TableHead>Company</TableHead>\n                    <TableHead>Job Title</TableHead>\n                    <TableHead>From</TableHead>\n                    <TableHead>To</TableHead>\n                    {isEditing && <TableHead className=\"w-10\"></TableHead>}\n                  </TableRow>\n                </TableHeader>\n                <TableBody>\n                  {formData.workHistory.map((exp, index) => (\n                    <TableRow key={index}>\n                      <TableCell>\n                        <Input\n                          value={exp.company}\n                          onChange={(e) => handleExperienceChange(index, \"company\", e.target.value)}\n                          disabled={!isEditing}\n                          placeholder=\"Company name\"\n                          className=\"border-0 p-0\"\n                          data-testid={`input-company-${index}`}\n                        />\n                      </TableCell>\n                      <TableCell>\n                        <Input\n                          value={exp.jobTitle}\n                          onChange={(e) => handleExperienceChange(index, \"jobTitle\", e.target.value)}\n                          disabled={!isEditing}\n                          placeholder=\"Job title\"\n                          className=\"border-0 p-0\"\n                          data-testid={`input-jobtitle-${index}`}\n                        />\n                      </TableCell>\n                      <TableCell>\n                        <Input\n                          type=\"number\"\n                          value={exp.fromYear}\n                          onChange={(e) => handleExperienceChange(index, \"fromYear\", parseInt(e.target.value))}\n                          disabled={!isEditing}\n                          className=\"border-0 p-0 w-20\"\n                          data-testid={`input-fromyear-${index}`}\n                        />\n                      </TableCell>\n                      <TableCell>\n                        <Input\n                          type=\"number\"\n                          value={exp.toYear}\n                          onChange={(e) => handleExperienceChange(index, \"toYear\", parseInt(e.target.value))}\n                          disabled={!isEditing}\n                          className=\"border-0 p-0 w-20\"\n                          data-testid={`input-toyear-${index}`}\n                        />\n                      </TableCell>\n                      {isEditing && (\n                        <TableCell>\n                          <Button\n                            variant=\"ghost\"\n                            size=\"icon\"\n                            onClick={() => handleRemoveExperience(index)}\n                            data-testid={`button-remove-experience-${index}`}\n                          >\n                            <Trash2 className=\"w-4 h-4 text-destructive\" />\n                          </Button>\n                        </TableCell>\n                      )}\n                    </TableRow>\n                  ))}\n                </TableBody>\n              </Table>\n            )}\n          </div>\n\n          {/* Biography Section */}\n          <div className=\"space-y-4\">\n            <h3 className=\"font-semibold text-lg\">Biography</h3>\n            <p className=\"text-xs text-muted-foreground\">\n              Write the biography based on the expert's LinkedIn profile and direct communication.\n              Align it with the project's vetting questions when relevant.\n            </p>\n            <Textarea\n              value={formData.biography || \"\"}\n              onChange={(e) => setFormData({ ...formData, biography: e.target.value })}\n              disabled={!isEditing}\n              placeholder=\"Enter expert biography...\"\n              className=\"min-h-32\"\n              data-testid=\"textarea-biography\"\n            />\n          </div>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","path":null,"size_bytes":11892,"size_tokens":null},"client/src/lib/mockExperts.js":{"content":"export const mockExperts = [\n  {\n    id: \"EXP-001\",\n    name: \"Mirae Kim\",\n    email: \"kimmirae0305@gmail.com\",\n    country: \"Brazil\",\n    city: \"So Paulo\",\n    currentEmployer: \"Global Digital Bank\",\n    pastEmployers: [\"Guidepoint\", \"Benchlink\"],\n    industries: [\"Digital Payments\", \"Fintech\", \"Banking\"],\n    skills: [\n      \"Market entry\",\n      \"Expert networks\",\n      \"Latin America\",\n      \"B2B sales\",\n      \"Consulting operations\"\n    ],\n    title: \"Growth and Strategy Consultant\",\n    seniorityLevel: \"Manager\",\n    yearsExperience: 9,\n    languages: [\"English\", \"Korean\", \"Portuguese\"],\n    availableNow: true,\n    nextAvailableDate: \"2025-12-05\",\n    totalHoursWorked: 26,\n    projects: [\n      { projectId: \"PRJ-GLB-001\", hours: 4 },\n      { projectId: \"PRJ-BR-ENERGY-01\", hours: 8 }\n    ],\n    biography: \"\",\n    workHistory: [\n      {\n        company: \"Guidepoint\",\n        jobTitle: \"Research Manager\",\n        fromYear: 2021,\n        toYear: 2025\n      },\n      {\n        company: \"Benchlink\",\n        jobTitle: \"Business Development Lead\",\n        fromYear: 2025,\n        toYear: 2025\n      }\n    ]\n  },\n\n  {\n    id: \"EXP-002\",\n    name: \"Carlos Eduardo Silva\",\n    email: \"carlos.silva@example.com\",\n    country: \"Brazil\",\n    city: \"So Paulo\",\n    currentEmployer: \"Nubank\",\n    pastEmployers: [\"Itau Unibanco\"],\n    industries: [\"Digital Payments\", \"Fintech\", \"Banking\"],\n    skills: [\n      \"Digital wallets\",\n      \"Credit card\",\n      \"BNPL\",\n      \"Growth strategy\",\n      \"Unit economics\"\n    ],\n    title: \"Head of Digital Payments\",\n    seniorityLevel: \"Director\",\n    yearsExperience: 14,\n    languages: [\"Portuguese\", \"English\", \"Spanish\"],\n    availableNow: true,\n    nextAvailableDate: \"2025-12-03\",\n    totalHoursWorked: 42,\n    projects: [\n      { projectId: \"PRJ-BR-WALLET-01\", hours: 10 },\n      { projectId: \"PRJ-GLB-001\", hours: 6 }\n    ],\n    biography:\n      \"Brazil based digital payments leader with experience launching wallets and BNPL products across Latin America.\",\n    workHistory: [\n      {\n        company: \"Nubank\",\n        jobTitle: \"Head of Digital Payments\",\n        fromYear: 2020,\n        toYear: 2025\n      },\n      {\n        company: \"Itau Unibanco\",\n        jobTitle: \"Payments Product Manager\",\n        fromYear: 2014,\n        toYear: 2020\n      }\n    ]\n  },\n\n  {\n    id: \"EXP-003\",\n    name: \"Ana Luisa Rocha\",\n    email: \"ana.rocha@example.com\",\n    country: \"Brazil\",\n    city: \"Rio de Janeiro\",\n    currentEmployer: \"PicPay\",\n    pastEmployers: [\"StoneCo\"],\n    industries: [\"Digital Payments\", \"Fintech\", \"Merchant Acquiring\"],\n    skills: [\n      \"Merchant acquiring\",\n      \"QR payments\",\n      \"Partnerships\",\n      \"SME onboarding\",\n      \"KYC\"\n    ],\n    title: \"Senior Product Manager\",\n    seniorityLevel: \"Senior Manager\",\n    yearsExperience: 11,\n    languages: [\"Portuguese\", \"English\"],\n    availableNow: false,\n    nextAvailableDate: \"2025-12-10\",\n    totalHoursWorked: 18,\n    projects: [{ projectId: \"PRJ-BR-MERCHANT-02\", hours: 5 }],\n    biography:\n      \"Product leader focused on merchant acquiring and QR based payments in Brazil.\",\n    workHistory: [\n      {\n        company: \"PicPay\",\n        jobTitle: \"Senior Product Manager\",\n        fromYear: 2021,\n        toYear: 2025\n      },\n      {\n        company: \"StoneCo\",\n        jobTitle: \"Product Manager\",\n        fromYear: 2016,\n        toYear: 2021\n      }\n    ]\n  },\n\n  {\n    id: \"EXP-004\",\n    name: \"Rohit Verma\",\n    email: \"rohit.verma@example.com\",\n    country: \"India\",\n    city: \"Bengaluru\",\n    currentEmployer: \"Paytm\",\n    pastEmployers: [\"HDFC Bank\"],\n    industries: [\"Digital Payments\", \"Fintech\", \"Banking\"],\n    skills: [\n      \"UPI\",\n      \"Digital wallets\",\n      \"Super app\",\n      \"Product localization\",\n      \"Partnerships\"\n    ],\n    title: \"VP Product, Consumer Payments\",\n    seniorityLevel: \"VP\",\n    yearsExperience: 13,\n    languages: [\"Hindi\", \"English\"],\n    availableNow: true,\n    nextAvailableDate: \"2025-12-04\",\n    totalHoursWorked: 33,\n    projects: [\n      { projectId: \"PRJ-IN-UPI-01\", hours: 12 },\n      { projectId: \"PRJ-GLB-001\", hours: 3 }\n    ],\n    biography:\n      \"Leads consumer payments products including UPI and wallet solutions for a major Indian fintech.\",\n    workHistory: [\n      {\n        company: \"Paytm\",\n        jobTitle: \"VP Product, Consumer Payments\",\n        fromYear: 2019,\n        toYear: 2025\n      },\n      {\n        company: \"HDFC Bank\",\n        jobTitle: \"Digital Banking Product Lead\",\n        fromYear: 2013,\n        toYear: 2019\n      }\n    ]\n  },\n\n  {\n    id: \"EXP-005\",\n    name: \"Priya Nair\",\n    email: \"priya.nair@example.com\",\n    country: \"India\",\n    city: \"Mumbai\",\n    currentEmployer: \"Global Card Network\",\n    pastEmployers: [\"Axis Bank\"],\n    industries: [\"Payments\", \"Card Schemes\", \"Banking\"],\n    skills: [\n      \"Network partnerships\",\n      \"Issuing\",\n      \"Co branded cards\",\n      \"Regulatory\",\n      \"Risk\"\n    ],\n    title: \"Director Partnerships, South Asia\",\n    seniorityLevel: \"Director\",\n    yearsExperience: 15,\n    languages: [\"English\", \"Hindi\"],\n    availableNow: false,\n    nextAvailableDate: \"2025-12-08\",\n    totalHoursWorked: 21,\n    projects: [{ projectId: \"PRJ-SA-CARDS-01\", hours: 9 }],\n    biography:\n      \"Director responsible for payment network partnerships and co branded card launches across South Asia.\",\n    workHistory: [\n      {\n        company: \"Global Card Network\",\n        jobTitle: \"Director Partnerships, South Asia\",\n        fromYear: 2018,\n        toYear: 2025\n      },\n      {\n        company: \"Axis Bank\",\n        jobTitle: \"Senior Manager, Cards\",\n        fromYear: 2010,\n        toYear: 2018\n      }\n    ]\n  },\n\n  {\n    id: \"EXP-006\",\n    name: \"Mariana Torres\",\n    email: \"mariana.torres@example.com\",\n    country: \"Mexico\",\n    city: \"Mexico City\",\n    currentEmployer: \"Mercado Pago\",\n    pastEmployers: [\"BBVA Mexico\"],\n    industries: [\"Digital Payments\", \"E commerce\", \"Fintech\"],\n    skills: [\n      \"Wallets\",\n      \"BNPL\",\n      \"Online checkout\",\n      \"Risk models\",\n      \"Growth marketing\"\n    ],\n    title: \"Head of Product, Wallet and BNPL\",\n    seniorityLevel: \"Director\",\n    yearsExperience: 12,\n    languages: [\"Spanish\", \"English\"],\n    availableNow: true,\n    nextAvailableDate: \"2025-12-02\",\n    totalHoursWorked: 37,\n    projects: [\n      { projectId: \"PRJ-MX-BNPL-01\", hours: 15 },\n      { projectId: \"PRJ-GLB-001\", hours: 4 }\n    ],\n    biography:\n      \"Product lead for wallet and BNPL solutions across Mexico and LatAm markets.\",\n    workHistory: [\n      {\n        company: \"Mercado Pago\",\n        jobTitle: \"Head of Product, Wallet and BNPL\",\n        fromYear: 2020,\n        toYear: 2025\n      },\n      {\n        company: \"BBVA Mexico\",\n        jobTitle: \"Digital Product Manager\",\n        fromYear: 2013,\n        toYear: 2020\n      }\n    ]\n  },\n\n  {\n    id: \"EXP-007\",\n    name: \"Diego Hernandez\",\n    email: \"diego.hernandez@example.com\",\n    country: \"Mexico\",\n    city: \"Monterrey\",\n    currentEmployer: \"Regional Bank\",\n    pastEmployers: [\"Oxxo Pay\"],\n    industries: [\"Banking\", \"Payments\"],\n    skills: [\n      \"Agent network\",\n      \"Cash in cash out\",\n      \"Retail payments\",\n      \"POS\",\n      \"SME\"\n    ],\n    title: \"Digital Banking Manager\",\n    seniorityLevel: \"Manager\",\n    yearsExperience: 8,\n    languages: [\"Spanish\", \"English\"],\n    availableNow: true,\n    nextAvailableDate: \"2025-12-06\",\n    totalHoursWorked: 12,\n    projects: [{ projectId: \"PRJ-MX-RETAIL-01\", hours: 5 }],\n    biography:\n      \"Focus on digital banking for mass market and SME clients with experience in retail payment channels.\",\n    workHistory: [\n      {\n        company: \"Regional Bank\",\n        jobTitle: \"Digital Banking Manager\",\n        fromYear: 2020,\n        toYear: 2025\n      },\n      {\n        company: \"Oxxo Pay\",\n        jobTitle: \"Product Specialist\",\n        fromYear: 2016,\n        toYear: 2020\n      }\n    ]\n  },\n\n  {\n    id: \"EXP-008\",\n    name: \"Siti Aisyah\",\n    email: \"siti.aisyah@example.com\",\n    country: \"Indonesia\",\n    city: \"Jakarta\",\n    currentEmployer: \"Gojek\",\n    pastEmployers: [\"Local Fintech Startup\"],\n    industries: [\"Super app\", \"Digital Payments\", \"Fintech\"],\n    skills: [\n      \"Super app payments\",\n      \"Wallet integration\",\n      \"QRIS\",\n      \"Merchant ecosystem\",\n      \"Product operations\"\n    ],\n    title: \"Senior Product Lead, Payments\",\n    seniorityLevel: \"Senior Manager\",\n    yearsExperience: 10,\n    languages: [\"Bahasa Indonesia\", \"English\"],\n    availableNow: false,\n    nextAvailableDate: \"2025-12-12\",\n    totalHoursWorked: 20,\n    projects: [\n      { projectId: \"PRJ-ID-GOJEK-01\", hours: 10 },\n      { projectId: \"PRJ-GLB-001\", hours: 2 }\n    ],\n    biography:\n      \"Leads payments within a super app, with experience in merchant acceptance and QRIS rollout.\",\n    workHistory: [\n      {\n        company: \"Gojek\",\n        jobTitle: \"Senior Product Lead, Payments\",\n        fromYear: 2019,\n        toYear: 2025\n      },\n      {\n        company: \"Local Fintech Startup\",\n        jobTitle: \"Product Manager\",\n        fromYear: 2015,\n        toYear: 2019\n      }\n    ]\n  },\n\n  {\n    id: \"EXP-009\",\n    name: \"Johannes Mller\",\n    email: \"johannes.muller@example.com\",\n    country: \"Germany\",\n    city: \"Berlin\",\n    currentEmployer: \"European Neo Bank\",\n    pastEmployers: [\"Traditional Bank\"],\n    industries: [\"Neobanking\", \"Fintech\"],\n    skills: [\"Europe\", \"PSD2\", \"Open banking\", \"Cards\"],\n    title: \"Product Manager\",\n    seniorityLevel: \"Manager\",\n    yearsExperience: 6,\n    languages: [\"German\", \"English\"],\n    availableNow: true,\n    nextAvailableDate: \"2025-12-01\",\n    totalHoursWorked: 5,\n    projects: [{ projectId: \"PRJ-EU-OPENBANK-01\", hours: 5 }],\n    biography:\n      \"European neobank product manager focused on open banking and PSD2 use cases.\",\n    workHistory: [\n      {\n        company: \"European Neo Bank\",\n        jobTitle: \"Product Manager\",\n        fromYear: 2021,\n        toYear: 2025\n      },\n      {\n        company: \"Traditional Bank\",\n        jobTitle: \"Business Analyst\",\n        fromYear: 2018,\n        toYear: 2021\n      }\n    ]\n  },\n\n  {\n    id: \"EXP-010\",\n    name: \"Laura Kim\",\n    email: \"laura.kim@example.com\",\n    country: \"United States\",\n    city: \"San Francisco\",\n    currentEmployer: \"Big Tech\",\n    pastEmployers: [\"Startup\"],\n    industries: [\"Technology\"],\n    skills: [\"Cloud\", \"SaaS\", \"Data platforms\"],\n    title: \"Senior Program Manager\",\n    seniorityLevel: \"Senior Manager\",\n    yearsExperience: 9,\n    languages: [\"English\", \"Korean\"],\n    availableNow: true,\n    nextAvailableDate: \"2025-12-07\",\n    totalHoursWorked: 0,\n    projects: [],\n    biography:\n      \"Works on cloud and SaaS programs, not directly involved in digital payments.\",\n    workHistory: [\n      {\n        company: \"Big Tech\",\n        jobTitle: \"Senior Program Manager\",\n        fromYear: 2019,\n        toYear: 2025\n      },\n      {\n        company: \"Startup\",\n        jobTitle: \"Operations Manager\",\n        fromYear: 2014,\n        toYear: 2019\n      }\n    ]\n  }\n];\n","path":null,"size_bytes":11061,"size_tokens":null},"client/src/pages/invites.tsx":{"content":"import { useState, useMemo } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { format } from \"date-fns\";\nimport { \n  Mail, \n  Search, \n  RefreshCw, \n  Filter,\n  ChevronDown,\n  ExternalLink,\n  Copy,\n  Check,\n  X,\n  Clock,\n  AlertCircle\n} from \"lucide-react\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Badge } from \"@/components/ui/badge\";\nimport {\n  Table,\n  TableBody,\n  TableCell,\n  TableHead,\n  TableHeader,\n  TableRow,\n} from \"@/components/ui/table\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport {\n  DropdownMenu,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuTrigger,\n} from \"@/components/ui/dropdown-menu\";\nimport {\n  Popover,\n  PopoverContent,\n  PopoverTrigger,\n} from \"@/components/ui/popover\";\nimport { Calendar } from \"@/components/ui/calendar\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { useAuth } from \"@/lib/auth\";\nimport { normalizeRole } from \"@/lib/permissions\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport type { ExpertInvitationLink, Project, Expert } from \"@shared/schema\";\n\ninterface InviteWithDetails extends ExpertInvitationLink {\n  project?: Project;\n  expert?: Expert;\n}\n\nexport default function Invites() {\n  const { user } = useAuth();\n  const { toast } = useToast();\n  const normalizedRole = normalizeRole(user?.role);\n  const isRa = normalizedRole === \"ra\";\n  \n  const [searchTerm, setSearchTerm] = useState(\"\");\n  const [statusFilter, setStatusFilter] = useState<string>(\"all\");\n  const [projectFilter, setProjectFilter] = useState<string>(\"all\");\n  const [dateFrom, setDateFrom] = useState<Date | undefined>();\n  const [dateTo, setDateTo] = useState<Date | undefined>();\n  const [copiedToken, setCopiedToken] = useState<string | null>(null);\n\n  const { data: invites = [], isLoading: invitesLoading, refetch } = useQuery<InviteWithDetails[]>({\n    queryKey: [\"/api/invitation-links\"],\n  });\n\n  const { data: projects = [] } = useQuery<Project[]>({\n    queryKey: [\"/api/projects\"],\n  });\n\n  const { data: experts = [] } = useQuery<Expert[]>({\n    queryKey: [\"/api/experts\"],\n  });\n\n  const resendMutation = useMutation({\n    mutationFn: async (invite: InviteWithDetails) => {\n      if (!invite.projectId) {\n        throw new Error(\"Cannot resend invite without project\");\n      }\n      \n      if (invite.expertId) {\n        const projectExpertsResponse = await fetch(`/api/projects/${invite.projectId}/detail`, {\n          headers: { Authorization: `Bearer ${localStorage.getItem(\"authToken\")}` }\n        });\n        if (!projectExpertsResponse.ok) throw new Error(\"Failed to find project expert\");\n        const projectDetail = await projectExpertsResponse.json();\n        const projectExpert = projectDetail.internalExperts?.find(\n          (pe: any) => pe.expertId === invite.expertId\n        );\n        if (projectExpert) {\n          return apiRequest(\"POST\", `/api/project-experts/${projectExpert.id}/invite`);\n        }\n        throw new Error(\"Expert not assigned to this project\");\n      }\n      \n      if (invite.inviteType === \"ra\" && invite.raId) {\n        return apiRequest(\"POST\", `/api/projects/${invite.projectId}/ra-invite-link`, {\n          raId: invite.raId\n        });\n      }\n      \n      throw new Error(\"Cannot resend this type of invite\");\n    },\n    onSuccess: () => {\n      toast({\n        title: \"New Invitation Created\",\n        description: \"A new invitation link has been generated.\",\n      });\n      queryClient.invalidateQueries({ queryKey: [\"/api/invitation-links\"] });\n    },\n    onError: (error: Error) => {\n      toast({\n        title: \"Failed to Resend\",\n        description: error.message,\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const enrichedInvites = useMemo(() => {\n    return invites.map(invite => ({\n      ...invite,\n      project: projects.find(p => p.id === invite.projectId),\n      expert: experts.find(e => e.id === invite.expertId),\n    }));\n  }, [invites, projects, experts]);\n\n  const filteredInvites = useMemo(() => {\n    return enrichedInvites.filter(invite => {\n      if (statusFilter !== \"all\" && invite.status !== statusFilter) {\n        return false;\n      }\n      \n      if (projectFilter !== \"all\" && invite.projectId?.toString() !== projectFilter) {\n        return false;\n      }\n      \n      if (dateFrom && new Date(invite.createdAt) < dateFrom) {\n        return false;\n      }\n      \n      if (dateTo) {\n        const endOfDay = new Date(dateTo);\n        endOfDay.setHours(23, 59, 59, 999);\n        if (new Date(invite.createdAt) > endOfDay) {\n          return false;\n        }\n      }\n      \n      if (searchTerm) {\n        const search = searchTerm.toLowerCase();\n        const expertName = invite.expert?.name?.toLowerCase() || \"\";\n        const candidateName = invite.candidateName?.toLowerCase() || \"\";\n        const candidateEmail = invite.candidateEmail?.toLowerCase() || \"\";\n        const projectName = invite.project?.name?.toLowerCase() || \"\";\n        \n        if (!expertName.includes(search) && \n            !candidateName.includes(search) && \n            !candidateEmail.includes(search) &&\n            !projectName.includes(search)) {\n          return false;\n        }\n      }\n      \n      return true;\n    });\n  }, [enrichedInvites, statusFilter, projectFilter, dateFrom, dateTo, searchTerm]);\n\n  const getStatusBadge = (status: string, isActive: boolean, expiresAt: Date | null) => {\n    const isExpired = expiresAt && new Date(expiresAt) < new Date();\n    \n    if (isExpired && status === \"pending\") {\n      return <Badge variant=\"outline\" className=\"text-muted-foreground\">Expired</Badge>;\n    }\n    \n    switch (status) {\n      case \"accepted\":\n        return <Badge className=\"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200\">Accepted</Badge>;\n      case \"declined\":\n        return <Badge variant=\"destructive\">Declined</Badge>;\n      case \"pending\":\n        return isActive \n          ? <Badge variant=\"secondary\">Pending</Badge>\n          : <Badge variant=\"outline\" className=\"text-muted-foreground\">Inactive</Badge>;\n      default:\n        return <Badge variant=\"outline\">{status}</Badge>;\n    }\n  };\n\n  const getInviteTypeBadge = (inviteType: string) => {\n    switch (inviteType) {\n      case \"ra\":\n        return <Badge variant=\"outline\" className=\"text-blue-600 border-blue-300\">RA Sourcing</Badge>;\n      case \"existing\":\n        return <Badge variant=\"outline\" className=\"text-purple-600 border-purple-300\">Existing Expert</Badge>;\n      case \"general\":\n        return <Badge variant=\"outline\">General</Badge>;\n      default:\n        return <Badge variant=\"outline\">{inviteType}</Badge>;\n    }\n  };\n\n  const copyInviteLink = async (invite: InviteWithDetails) => {\n    const baseUrl = window.location.origin;\n    let inviteUrl: string;\n    \n    if (invite.inviteType === \"existing\" && invite.expertId) {\n      inviteUrl = `${baseUrl}/expert/project-invite/${invite.token}`;\n    } else if (invite.projectId) {\n      inviteUrl = `${baseUrl}/invite/${invite.projectId}/${invite.inviteType}/${invite.token}`;\n    } else {\n      inviteUrl = `${baseUrl}/expert-invite/${invite.token}`;\n    }\n    \n    try {\n      await navigator.clipboard.writeText(inviteUrl);\n      setCopiedToken(invite.token);\n      toast({\n        title: \"Link Copied\",\n        description: \"Invitation link copied to clipboard.\",\n      });\n      setTimeout(() => setCopiedToken(null), 2000);\n    } catch (err) {\n      toast({\n        title: \"Copy Failed\",\n        description: \"Could not copy link to clipboard.\",\n        variant: \"destructive\",\n      });\n    }\n  };\n\n  const clearFilters = () => {\n    setSearchTerm(\"\");\n    setStatusFilter(\"all\");\n    setProjectFilter(\"all\");\n    setDateFrom(undefined);\n    setDateTo(undefined);\n  };\n\n  const hasActiveFilters = searchTerm || statusFilter !== \"all\" || projectFilter !== \"all\" || dateFrom || dateTo;\n\n  const stats = useMemo(() => {\n    const total = enrichedInvites.length;\n    const pending = enrichedInvites.filter(i => i.status === \"pending\" && i.isActive).length;\n    const accepted = enrichedInvites.filter(i => i.status === \"accepted\").length;\n    const declined = enrichedInvites.filter(i => i.status === \"declined\").length;\n    const expired = enrichedInvites.filter(i => \n      i.status === \"pending\" && i.expiresAt && new Date(i.expiresAt) < new Date()\n    ).length;\n    \n    return { total, pending, accepted, declined, expired };\n  }, [enrichedInvites]);\n\n  if (invitesLoading) {\n    return (\n      <div className=\"p-6 space-y-6\">\n        <Skeleton className=\"h-8 w-48\" />\n        <div className=\"grid gap-4 md:grid-cols-4\">\n          {[...Array(4)].map((_, i) => (\n            <Skeleton key={i} className=\"h-24\" />\n          ))}\n        </div>\n        <Skeleton className=\"h-96\" />\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"p-6 space-y-6\">\n      <div className=\"flex items-center justify-between\">\n        <div>\n          <h1 className=\"text-2xl font-semibold\" data-testid=\"text-page-title\">\n            {isRa ? \"My Invitations\" : \"Invitation History\"}\n          </h1>\n          <p className=\"text-muted-foreground mt-1\">\n            {isRa \n              ? \"Track invitations you've created for expert sourcing\" \n              : \"Manage and track all expert invitation links\"}\n          </p>\n        </div>\n        <Button \n          variant=\"outline\" \n          onClick={() => refetch()}\n          data-testid=\"button-refresh-invites\"\n        >\n          <RefreshCw className=\"h-4 w-4 mr-2\" />\n          Refresh\n        </Button>\n      </div>\n\n      <div className=\"grid gap-4 md:grid-cols-4\">\n        <Card>\n          <CardHeader className=\"flex flex-row items-center justify-between gap-2 space-y-0 pb-2\">\n            <CardTitle className=\"text-sm font-medium\">Total Invites</CardTitle>\n            <Mail className=\"h-4 w-4 text-muted-foreground\" />\n          </CardHeader>\n          <CardContent>\n            <div className=\"text-2xl font-bold\" data-testid=\"stat-total-invites\">{stats.total}</div>\n          </CardContent>\n        </Card>\n        <Card>\n          <CardHeader className=\"flex flex-row items-center justify-between gap-2 space-y-0 pb-2\">\n            <CardTitle className=\"text-sm font-medium\">Pending</CardTitle>\n            <Clock className=\"h-4 w-4 text-yellow-500\" />\n          </CardHeader>\n          <CardContent>\n            <div className=\"text-2xl font-bold\" data-testid=\"stat-pending-invites\">{stats.pending}</div>\n          </CardContent>\n        </Card>\n        <Card>\n          <CardHeader className=\"flex flex-row items-center justify-between gap-2 space-y-0 pb-2\">\n            <CardTitle className=\"text-sm font-medium\">Accepted</CardTitle>\n            <Check className=\"h-4 w-4 text-green-500\" />\n          </CardHeader>\n          <CardContent>\n            <div className=\"text-2xl font-bold\" data-testid=\"stat-accepted-invites\">{stats.accepted}</div>\n          </CardContent>\n        </Card>\n        <Card>\n          <CardHeader className=\"flex flex-row items-center justify-between gap-2 space-y-0 pb-2\">\n            <CardTitle className=\"text-sm font-medium\">Declined</CardTitle>\n            <X className=\"h-4 w-4 text-red-500\" />\n          </CardHeader>\n          <CardContent>\n            <div className=\"text-2xl font-bold\" data-testid=\"stat-declined-invites\">{stats.declined}</div>\n          </CardContent>\n        </Card>\n      </div>\n\n      <Card>\n        <CardHeader>\n          <div className=\"flex flex-col gap-4 md:flex-row md:items-center md:justify-between\">\n            <CardTitle className=\"text-lg\">All Invitations</CardTitle>\n            <div className=\"flex flex-wrap items-center gap-2\">\n              <div className=\"relative flex-1 md:w-64 md:flex-none\">\n                <Search className=\"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground\" />\n                <Input\n                  placeholder=\"Search by name, email, project...\"\n                  value={searchTerm}\n                  onChange={(e) => setSearchTerm(e.target.value)}\n                  className=\"pl-9\"\n                  data-testid=\"input-search-invites\"\n                />\n              </div>\n              \n              <Select value={statusFilter} onValueChange={setStatusFilter}>\n                <SelectTrigger className=\"w-[130px]\" data-testid=\"select-status-filter\">\n                  <SelectValue placeholder=\"Status\" />\n                </SelectTrigger>\n                <SelectContent>\n                  <SelectItem value=\"all\">All Status</SelectItem>\n                  <SelectItem value=\"pending\">Pending</SelectItem>\n                  <SelectItem value=\"accepted\">Accepted</SelectItem>\n                  <SelectItem value=\"declined\">Declined</SelectItem>\n                </SelectContent>\n              </Select>\n              \n              <Select value={projectFilter} onValueChange={setProjectFilter}>\n                <SelectTrigger className=\"w-[150px]\" data-testid=\"select-project-filter\">\n                  <SelectValue placeholder=\"Project\" />\n                </SelectTrigger>\n                <SelectContent>\n                  <SelectItem value=\"all\">All Projects</SelectItem>\n                  {projects.map(project => (\n                    <SelectItem key={project.id} value={project.id.toString()}>\n                      {project.name}\n                    </SelectItem>\n                  ))}\n                </SelectContent>\n              </Select>\n\n              <Popover>\n                <PopoverTrigger asChild>\n                  <Button variant=\"outline\" className=\"w-[130px]\" data-testid=\"button-date-filter\">\n                    <Filter className=\"h-4 w-4 mr-2\" />\n                    Date Range\n                  </Button>\n                </PopoverTrigger>\n                <PopoverContent className=\"w-auto p-4\" align=\"end\">\n                  <div className=\"space-y-4\">\n                    <div>\n                      <p className=\"text-sm font-medium mb-2\">From Date</p>\n                      <Calendar\n                        mode=\"single\"\n                        selected={dateFrom}\n                        onSelect={setDateFrom}\n                        initialFocus\n                      />\n                    </div>\n                    <div>\n                      <p className=\"text-sm font-medium mb-2\">To Date</p>\n                      <Calendar\n                        mode=\"single\"\n                        selected={dateTo}\n                        onSelect={setDateTo}\n                      />\n                    </div>\n                    <Button \n                      variant=\"outline\" \n                      size=\"sm\" \n                      onClick={() => { setDateFrom(undefined); setDateTo(undefined); }}\n                      className=\"w-full\"\n                    >\n                      Clear Dates\n                    </Button>\n                  </div>\n                </PopoverContent>\n              </Popover>\n\n              {hasActiveFilters && (\n                <Button variant=\"ghost\" size=\"sm\" onClick={clearFilters} data-testid=\"button-clear-filters\">\n                  <X className=\"h-4 w-4 mr-1\" />\n                  Clear\n                </Button>\n              )}\n            </div>\n          </div>\n        </CardHeader>\n        <CardContent>\n          {filteredInvites.length === 0 ? (\n            <div className=\"flex flex-col items-center justify-center py-12 text-center\">\n              <AlertCircle className=\"h-12 w-12 text-muted-foreground mb-4\" />\n              <h3 className=\"text-lg font-medium\">No invitations found</h3>\n              <p className=\"text-muted-foreground mt-1\">\n                {hasActiveFilters \n                  ? \"Try adjusting your filters to see more results.\" \n                  : \"Invitations will appear here once they are created.\"}\n              </p>\n            </div>\n          ) : (\n            <div className=\"rounded-md border\">\n              <Table>\n                <TableHeader>\n                  <TableRow>\n                    <TableHead>Expert / Candidate</TableHead>\n                    <TableHead>Project</TableHead>\n                    <TableHead>Type</TableHead>\n                    <TableHead>Status</TableHead>\n                    <TableHead>Created</TableHead>\n                    <TableHead>Expires</TableHead>\n                    <TableHead className=\"text-right\">Actions</TableHead>\n                  </TableRow>\n                </TableHeader>\n                <TableBody>\n                  {filteredInvites.map((invite) => (\n                    <TableRow key={invite.id} data-testid={`row-invite-${invite.id}`}>\n                      <TableCell>\n                        <div>\n                          <div className=\"font-medium\">\n                            {invite.expert?.name || invite.candidateName || \"Unknown\"}\n                          </div>\n                          <div className=\"text-sm text-muted-foreground\">\n                            {invite.expert?.email || invite.candidateEmail || \"-\"}\n                          </div>\n                        </div>\n                      </TableCell>\n                      <TableCell>\n                        {invite.project?.name || (\n                          <span className=\"text-muted-foreground\">No project</span>\n                        )}\n                      </TableCell>\n                      <TableCell>{getInviteTypeBadge(invite.inviteType)}</TableCell>\n                      <TableCell>\n                        {getStatusBadge(invite.status || \"pending\", invite.isActive, invite.expiresAt)}\n                      </TableCell>\n                      <TableCell>\n                        {format(new Date(invite.createdAt), \"MMM d, yyyy\")}\n                      </TableCell>\n                      <TableCell>\n                        {invite.expiresAt \n                          ? format(new Date(invite.expiresAt), \"MMM d, yyyy\")\n                          : <span className=\"text-muted-foreground\">Never</span>\n                        }\n                      </TableCell>\n                      <TableCell className=\"text-right\">\n                        <DropdownMenu>\n                          <DropdownMenuTrigger asChild>\n                            <Button variant=\"ghost\" size=\"sm\" data-testid={`button-actions-${invite.id}`}>\n                              Actions\n                              <ChevronDown className=\"h-4 w-4 ml-1\" />\n                            </Button>\n                          </DropdownMenuTrigger>\n                          <DropdownMenuContent align=\"end\">\n                            <DropdownMenuItem \n                              onClick={() => copyInviteLink(invite)}\n                              data-testid={`action-copy-link-${invite.id}`}\n                            >\n                              {copiedToken === invite.token ? (\n                                <>\n                                  <Check className=\"h-4 w-4 mr-2\" />\n                                  Copied!\n                                </>\n                              ) : (\n                                <>\n                                  <Copy className=\"h-4 w-4 mr-2\" />\n                                  Copy Link\n                                </>\n                              )}\n                            </DropdownMenuItem>\n                            {invite.status === \"pending\" && invite.isActive && invite.projectId && (\n                              <DropdownMenuItem\n                                onClick={() => resendMutation.mutate(invite)}\n                                disabled={resendMutation.isPending}\n                                data-testid={`action-resend-${invite.id}`}\n                              >\n                                <RefreshCw className={`h-4 w-4 mr-2 ${resendMutation.isPending ? 'animate-spin' : ''}`} />\n                                Create New Invite\n                              </DropdownMenuItem>\n                            )}\n                            <DropdownMenuItem asChild>\n                              <a \n                                href={invite.inviteType === \"existing\" && invite.expertId \n                                  ? `/expert/project-invite/${invite.token}`\n                                  : invite.projectId \n                                    ? `/invite/${invite.projectId}/${invite.inviteType}/${invite.token}`\n                                    : `/expert-invite/${invite.token}`\n                                }\n                                target=\"_blank\"\n                                rel=\"noopener noreferrer\"\n                                data-testid={`action-view-link-${invite.id}`}\n                              >\n                                <ExternalLink className=\"h-4 w-4 mr-2\" />\n                                View Link\n                              </a>\n                            </DropdownMenuItem>\n                          </DropdownMenuContent>\n                        </DropdownMenu>\n                      </TableCell>\n                    </TableRow>\n                  ))}\n                </TableBody>\n              </Table>\n            </div>\n          )}\n          \n          {filteredInvites.length > 0 && (\n            <div className=\"mt-4 text-sm text-muted-foreground\">\n              Showing {filteredInvites.length} of {enrichedInvites.length} invitations\n            </div>\n          )}\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","path":null,"size_bytes":21691,"size_tokens":null},"client/src/components/experts/RegisterExpertForm.tsx":{"content":"import { useState } from \"react\";\nimport { useForm, useFieldArray } from \"react-hook-form\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport { z } from \"zod\";\nimport { useMutation } from \"@tanstack/react-query\";\nimport {\n  Loader2,\n  User,\n  Briefcase,\n  FileText,\n  DollarSign,\n  Shield,\n  Plus,\n  Trash2,\n  Globe,\n  CheckCircle,\n  Copy,\n  ExternalLink,\n} from \"lucide-react\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Checkbox } from \"@/components/ui/checkbox\";\nimport { RadioGroup, RadioGroupItem } from \"@/components/ui/radio-group\";\nimport { Label } from \"@/components/ui/label\";\nimport { ScrollArea } from \"@/components/ui/scroll-area\";\nimport {\n  Form,\n  FormControl,\n  FormDescription,\n  FormField,\n  FormItem,\n  FormLabel,\n  FormMessage,\n} from \"@/components/ui/form\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogHeader,\n  DialogTitle,\n  DialogDescription,\n} from \"@/components/ui/dialog\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport {\n  type Language,\n  translations,\n  detectBrowserLanguage,\n  countries,\n  countryCodes,\n  timezones,\n  currencies,\n  months,\n  getYearOptions,\n} from \"@/lib/translations/expert-onboarding\";\n\ninterface RegisterExpertFormProps {\n  projectId: number;\n  onSuccess: (data: { expertId: number; inviteUrl: string }) => void;\n  onCancel?: () => void;\n  minimalMode?: boolean;\n}\n\nconst experienceSchema = z.object({\n  company: z.string().min(1, \"Required\"),\n  title: z.string().min(1, \"Required\"),\n  fromMonth: z.string().min(1, \"Required\"),\n  fromYear: z.string().min(1, \"Required\"),\n  toMonth: z.string().optional(),\n  toYear: z.string().optional(),\n  isCurrent: z.boolean().default(false),\n});\n\nconst createFormSchema = (t: typeof translations.en) =>\n  z.object({\n    firstName: z.string().min(1, t.required),\n    lastName: z.string().min(1, t.required),\n    email: z.string().email(t.invalidEmail),\n    country: z.string().min(1, t.required),\n    region: z.string().optional(),\n    countryCode: z.string().min(1, t.required),\n    phoneNumber: z.string().min(1, t.required),\n    linkedinUrl: z.string().url(t.invalidUrl).optional().or(z.literal(\"\")),\n    city: z.string().optional(),\n    canConsultInEnglish: z.enum([\"yes\", \"no\"]),\n    timezone: z.string().min(1, t.required),\n    experiences: z.array(experienceSchema).min(1, t.required),\n    biography: z.string().min(50, t.required),\n    workHistory: z.string().min(50, t.required),\n    hourlyRate: z.string().min(1, t.required),\n    currency: z.string().min(1, t.required),\n    termsAccepted: z.boolean().refine((v) => v === true, t.termsRequired),\n    lgpdAccepted: z.boolean().refine((v) => v === true, t.lgpdRequired),\n  });\n\ntype FormData = z.infer<ReturnType<typeof createFormSchema>>;\n\nconst termsAndConditionsContent = {\n  pt: `\n    <h2>Termos e Condies de Uso</h2>\n    <p>Ao utilizar os servios da Mirae Connext, voc concorda com os seguintes termos:</p>\n    <h3>1. Aceitao dos Termos</h3>\n    <p>Ao acessar ou usar nossos servios, voc concorda em cumprir estes termos e condies.</p>\n    <h3>2. Uso dos Servios</h3>\n    <p>Voc concorda em usar nossos servios apenas para fins legais e de acordo com estes termos.</p>\n    <h3>3. Confidencialidade</h3>\n    <p>Voc concorda em manter confidenciais todas as informaes compartilhadas durante as consultorias.</p>\n    <h3>4. Pagamentos</h3>\n    <p>Os pagamentos sero processados de acordo com os termos acordados em cada projeto.</p>\n    <h3>5. Propriedade Intelectual</h3>\n    <p>Todo o contedo e propriedade intelectual permanecem com seus respectivos proprietrios.</p>\n  `,\n  es: `\n    <h2>Trminos y Condiciones de Uso</h2>\n    <p>Al utilizar los servicios de Mirae Connext, usted acepta los siguientes trminos:</p>\n    <h3>1. Aceptacin de los Trminos</h3>\n    <p>Al acceder o utilizar nuestros servicios, acepta cumplir con estos trminos y condiciones.</p>\n    <h3>2. Uso de los Servicios</h3>\n    <p>Acepta utilizar nuestros servicios solo para fines legales y de acuerdo con estos trminos.</p>\n    <h3>3. Confidencialidad</h3>\n    <p>Acepta mantener confidencial toda la informacin compartida durante las consultoras.</p>\n    <h3>4. Pagos</h3>\n    <p>Los pagos se procesarn de acuerdo con los trminos acordados en cada proyecto.</p>\n    <h3>5. Propiedad Intelectual</h3>\n    <p>Todo el contenido y propiedad intelectual permanece con sus respectivos propietarios.</p>\n  `,\n  en: `\n    <h2>Terms and Conditions of Use</h2>\n    <p>By using Mirae Connext services, you agree to the following terms:</p>\n    <h3>1. Acceptance of Terms</h3>\n    <p>By accessing or using our services, you agree to comply with these terms and conditions.</p>\n    <h3>2. Use of Services</h3>\n    <p>You agree to use our services only for lawful purposes and in accordance with these terms.</p>\n    <h3>3. Confidentiality</h3>\n    <p>You agree to maintain confidentiality of all information shared during consultations.</p>\n    <h3>4. Payments</h3>\n    <p>Payments will be processed according to the terms agreed upon in each project.</p>\n    <h3>5. Intellectual Property</h3>\n    <p>All content and intellectual property remains with their respective owners.</p>\n  `,\n};\n\nconst lgpdContent = {\n  pt: `\n    <h2>Poltica de Privacidade e LGPD</h2>\n    <p>Em conformidade com a Lei Geral de Proteo de Dados (LGPD - Lei n 13.709/2018):</p>\n    <h3>1. Coleta de Dados</h3>\n    <p>Coletamos apenas os dados necessrios para a prestao de nossos servios.</p>\n    <h3>2. Uso dos Dados</h3>\n    <p>Seus dados so utilizados exclusivamente para os fins descritos nesta poltica.</p>\n    <h3>3. Compartilhamento</h3>\n    <p>No compartilhamos seus dados com terceiros sem seu consentimento expresso.</p>\n    <h3>4. Segurana</h3>\n    <p>Implementamos medidas de segurana para proteger seus dados pessoais.</p>\n    <h3>5. Seus Direitos</h3>\n    <p>Voc tem direito a acessar, corrigir ou excluir seus dados a qualquer momento.</p>\n  `,\n  es: `\n    <h2>Poltica de Privacidad y LGPD</h2>\n    <p>En cumplimiento con la Ley General de Proteccin de Datos (LGPD):</p>\n    <h3>1. Recopilacin de Datos</h3>\n    <p>Recopilamos solo los datos necesarios para la prestacin de nuestros servicios.</p>\n    <h3>2. Uso de los Datos</h3>\n    <p>Sus datos se utilizan exclusivamente para los fines descritos en esta poltica.</p>\n    <h3>3. Compartir Datos</h3>\n    <p>No compartimos sus datos con terceros sin su consentimiento expreso.</p>\n    <h3>4. Seguridad</h3>\n    <p>Implementamos medidas de seguridad para proteger sus datos personales.</p>\n    <h3>5. Sus Derechos</h3>\n    <p>Tiene derecho a acceder, corregir o eliminar sus datos en cualquier momento.</p>\n  `,\n  en: `\n    <h2>Privacy Policy and LGPD</h2>\n    <p>In compliance with the General Data Protection Law (LGPD - Law No. 13.709/2018):</p>\n    <h3>1. Data Collection</h3>\n    <p>We collect only the data necessary for the provision of our services.</p>\n    <h3>2. Use of Data</h3>\n    <p>Your data is used exclusively for the purposes described in this policy.</p>\n    <h3>3. Data Sharing</h3>\n    <p>We do not share your data with third parties without your express consent.</p>\n    <h3>4. Security</h3>\n    <p>We implement security measures to protect your personal data.</p>\n    <h3>5. Your Rights</h3>\n    <p>You have the right to access, correct, or delete your data at any time.</p>\n  `,\n};\n\nexport function RegisterExpertForm({\n  projectId,\n  onSuccess,\n  onCancel,\n  minimalMode = false,\n}: RegisterExpertFormProps) {\n  const { toast } = useToast();\n  const [language, setLanguage] = useState<Language>(detectBrowserLanguage);\n  const [isSubmitted, setIsSubmitted] = useState(false);\n  const [inviteUrl, setInviteUrl] = useState<string | null>(null);\n  const [showTermsModal, setShowTermsModal] = useState(false);\n  const [showLgpdModal, setShowLgpdModal] = useState(false);\n  const [copiedLink, setCopiedLink] = useState(false);\n\n  const t = translations[language];\n  const formSchema = createFormSchema(t);\n  const yearOptions = getYearOptions();\n\n  const form = useForm<FormData>({\n    resolver: zodResolver(formSchema),\n    defaultValues: {\n      firstName: \"\",\n      lastName: \"\",\n      email: \"\",\n      country: \"\",\n      region: \"\",\n      countryCode: \"+55\",\n      phoneNumber: \"\",\n      linkedinUrl: \"\",\n      city: \"\",\n      canConsultInEnglish: \"yes\",\n      timezone: \"America/Sao_Paulo\",\n      experiences: [\n        {\n          company: \"\",\n          title: \"\",\n          fromMonth: \"\",\n          fromYear: \"\",\n          toMonth: \"\",\n          toYear: \"\",\n          isCurrent: false,\n        },\n      ],\n      biography: \"\",\n      workHistory: \"\",\n      hourlyRate: \"\",\n      currency: \"USD\",\n      termsAccepted: false,\n      lgpdAccepted: false,\n    },\n  });\n\n  const {\n    fields: experienceFields,\n    append: appendExperience,\n    remove: removeExperience,\n  } = useFieldArray({\n    control: form.control,\n    name: \"experiences\",\n  });\n\n  const registerMutation = useMutation({\n    mutationFn: async (data: FormData) => {\n      const response = await apiRequest(\n        \"POST\",\n        `/api/projects/${projectId}/register-expert`,\n        data\n      );\n      return response.json();\n    },\n    onSuccess: (data) => {\n      setIsSubmitted(true);\n      setInviteUrl(data.inviteUrl);\n      toast({ title: t.expertRegistered });\n      onSuccess({ expertId: data.expertId, inviteUrl: data.inviteUrl });\n    },\n    onError: (error: Error) => {\n      toast({\n        title: t.errorTitle,\n        description: error.message,\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const onSubmit = (data: FormData) => {\n    registerMutation.mutate(data);\n  };\n\n  const copyInviteLink = async () => {\n    if (inviteUrl) {\n      const fullUrl = `${window.location.origin}${inviteUrl}`;\n      await navigator.clipboard.writeText(fullUrl);\n      setCopiedLink(true);\n      toast({ title: t.inviteLinkCopied });\n      setTimeout(() => setCopiedLink(false), 2000);\n    }\n  };\n\n  const LanguageToggle = () => (\n    <div className=\"flex items-center gap-2\">\n      <Globe className=\"h-4 w-4 text-muted-foreground\" />\n      <Select value={language} onValueChange={(v) => setLanguage(v as Language)}>\n        <SelectTrigger className=\"w-[140px]\" data-testid=\"select-language\">\n          <SelectValue />\n        </SelectTrigger>\n        <SelectContent>\n          <SelectItem value=\"pt\">Portugues</SelectItem>\n          <SelectItem value=\"es\">Espanol</SelectItem>\n          <SelectItem value=\"en\">English</SelectItem>\n        </SelectContent>\n      </Select>\n    </div>\n  );\n\n  if (isSubmitted && inviteUrl) {\n    return (\n      <div className=\"flex flex-col items-center gap-4 py-8 text-center\">\n        <div className=\"flex h-16 w-16 items-center justify-center rounded-full bg-green-500/10\">\n          <CheckCircle className=\"h-8 w-8 text-green-500\" />\n        </div>\n        <div>\n          <h2 className=\"text-xl font-semibold\">{t.inviteLinkCreated}</h2>\n          <p className=\"mt-2 text-muted-foreground\">{t.expertRegistered}</p>\n        </div>\n        <div className=\"flex items-center gap-2 p-3 bg-muted rounded-lg w-full max-w-md\">\n          <code className=\"flex-1 text-sm truncate\">\n            {`${window.location.origin}${inviteUrl}`}\n          </code>\n          <Button\n            variant=\"outline\"\n            size=\"sm\"\n            onClick={copyInviteLink}\n            data-testid=\"button-copy-invite-url\"\n          >\n            {copiedLink ? (\n              <CheckCircle className=\"h-4 w-4\" />\n            ) : (\n              <Copy className=\"h-4 w-4\" />\n            )}\n          </Button>\n          <Button\n            variant=\"outline\"\n            size=\"sm\"\n            onClick={() => window.open(inviteUrl, \"_blank\")}\n            data-testid=\"button-open-invite-url\"\n          >\n            <ExternalLink className=\"h-4 w-4\" />\n          </Button>\n        </div>\n        {onCancel && (\n          <Button onClick={onCancel} className=\"mt-4\" data-testid=\"button-close\">\n            {t.closeButton}\n          </Button>\n        )}\n      </div>\n    );\n  }\n\n  return (\n    <>\n      <div className={minimalMode ? \"\" : \"p-4\"}>\n        <div className=\"flex items-center justify-between mb-4\">\n          <div>\n            <h2 className=\"text-lg font-semibold\">{t.registerExpertModalTitle}</h2>\n            <p className=\"text-sm text-muted-foreground\">\n              {t.registerExpertModalSubtitle}\n            </p>\n          </div>\n          <LanguageToggle />\n        </div>\n\n        <ScrollArea className={minimalMode ? \"h-[60vh]\" : \"h-auto\"}>\n          <Form {...form}>\n            <form onSubmit={form.handleSubmit(onSubmit)} className=\"space-y-6 pr-4\">\n              <Card>\n                <CardHeader className=\"pb-3\">\n                  <div className=\"flex items-center gap-2\">\n                    <User className=\"h-5 w-5 text-muted-foreground\" />\n                    <CardTitle className=\"text-base\">{t.basicInfoTitle}</CardTitle>\n                  </div>\n                </CardHeader>\n                <CardContent className=\"space-y-4\">\n                  <div className=\"grid gap-4 sm:grid-cols-2\">\n                    <FormField\n                      control={form.control}\n                      name=\"firstName\"\n                      render={({ field }) => (\n                        <FormItem>\n                          <FormLabel>{t.firstName} *</FormLabel>\n                          <FormControl>\n                            <Input\n                              placeholder={t.firstNamePlaceholder}\n                              {...field}\n                              data-testid=\"input-first-name\"\n                            />\n                          </FormControl>\n                          <FormMessage />\n                        </FormItem>\n                      )}\n                    />\n                    <FormField\n                      control={form.control}\n                      name=\"lastName\"\n                      render={({ field }) => (\n                        <FormItem>\n                          <FormLabel>{t.lastName} *</FormLabel>\n                          <FormControl>\n                            <Input\n                              placeholder={t.lastNamePlaceholder}\n                              {...field}\n                              data-testid=\"input-last-name\"\n                            />\n                          </FormControl>\n                          <FormMessage />\n                        </FormItem>\n                      )}\n                    />\n                  </div>\n\n                  <FormField\n                    control={form.control}\n                    name=\"email\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>{t.email} *</FormLabel>\n                        <FormControl>\n                          <Input\n                            placeholder={t.emailPlaceholder}\n                            {...field}\n                            data-testid=\"input-email\"\n                          />\n                        </FormControl>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n\n                  <div className=\"grid gap-4 sm:grid-cols-2\">\n                    <FormField\n                      control={form.control}\n                      name=\"country\"\n                      render={({ field }) => (\n                        <FormItem>\n                          <FormLabel>{t.country} *</FormLabel>\n                          <Select onValueChange={field.onChange} value={field.value}>\n                            <FormControl>\n                              <SelectTrigger data-testid=\"select-country\">\n                                <SelectValue placeholder={t.countryPlaceholder} />\n                              </SelectTrigger>\n                            </FormControl>\n                            <SelectContent>\n                              {countries.map((c) => (\n                                <SelectItem key={c.code} value={c.code}>\n                                  {c.name[language]}\n                                </SelectItem>\n                              ))}\n                            </SelectContent>\n                          </Select>\n                          <FormMessage />\n                        </FormItem>\n                      )}\n                    />\n                    <FormField\n                      control={form.control}\n                      name=\"region\"\n                      render={({ field }) => (\n                        <FormItem>\n                          <FormLabel>{t.region}</FormLabel>\n                          <FormControl>\n                            <Input\n                              placeholder={t.regionPlaceholder}\n                              {...field}\n                              data-testid=\"input-region\"\n                            />\n                          </FormControl>\n                          <FormMessage />\n                        </FormItem>\n                      )}\n                    />\n                  </div>\n\n                  <FormField\n                    control={form.control}\n                    name=\"city\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>{t.city}</FormLabel>\n                        <FormControl>\n                          <Input\n                            placeholder={t.cityPlaceholder}\n                            {...field}\n                            data-testid=\"input-city\"\n                          />\n                        </FormControl>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n\n                  <div className=\"grid gap-4 sm:grid-cols-3\">\n                    <FormField\n                      control={form.control}\n                      name=\"countryCode\"\n                      render={({ field }) => (\n                        <FormItem>\n                          <FormLabel>{t.countryCode} *</FormLabel>\n                          <Select onValueChange={field.onChange} value={field.value}>\n                            <FormControl>\n                              <SelectTrigger data-testid=\"select-country-code\">\n                                <SelectValue placeholder={t.countryCodePlaceholder} />\n                              </SelectTrigger>\n                            </FormControl>\n                            <SelectContent>\n                              {countryCodes.map((cc) => (\n                                <SelectItem key={cc.code} value={cc.code}>\n                                  {cc.code} ({cc.country})\n                                </SelectItem>\n                              ))}\n                            </SelectContent>\n                          </Select>\n                          <FormMessage />\n                        </FormItem>\n                      )}\n                    />\n                    <FormField\n                      control={form.control}\n                      name=\"phoneNumber\"\n                      render={({ field }) => (\n                        <FormItem className=\"sm:col-span-2\">\n                          <FormLabel>{t.phoneNumber} *</FormLabel>\n                          <FormControl>\n                            <Input\n                              placeholder={t.phoneNumberPlaceholder}\n                              {...field}\n                              data-testid=\"input-phone\"\n                            />\n                          </FormControl>\n                          <FormMessage />\n                        </FormItem>\n                      )}\n                    />\n                  </div>\n\n                  <FormField\n                    control={form.control}\n                    name=\"linkedinUrl\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>{t.linkedinUrl}</FormLabel>\n                        <FormControl>\n                          <Input\n                            placeholder={t.linkedinUrlPlaceholder}\n                            {...field}\n                            data-testid=\"input-linkedin\"\n                          />\n                        </FormControl>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n\n                  <FormField\n                    control={form.control}\n                    name=\"canConsultInEnglish\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>{t.canConsultInEnglish} *</FormLabel>\n                        <FormControl>\n                          <RadioGroup\n                            onValueChange={field.onChange}\n                            value={field.value}\n                            className=\"flex gap-6\"\n                          >\n                            <div className=\"flex items-center gap-2\">\n                              <RadioGroupItem\n                                value=\"yes\"\n                                id=\"english-yes\"\n                                data-testid=\"radio-english-yes\"\n                              />\n                              <Label htmlFor=\"english-yes\">{t.yes}</Label>\n                            </div>\n                            <div className=\"flex items-center gap-2\">\n                              <RadioGroupItem\n                                value=\"no\"\n                                id=\"english-no\"\n                                data-testid=\"radio-english-no\"\n                              />\n                              <Label htmlFor=\"english-no\">{t.no}</Label>\n                            </div>\n                          </RadioGroup>\n                        </FormControl>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n\n                  <FormField\n                    control={form.control}\n                    name=\"timezone\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>{t.timezone} *</FormLabel>\n                        <Select onValueChange={field.onChange} value={field.value}>\n                          <FormControl>\n                            <SelectTrigger data-testid=\"select-timezone\">\n                              <SelectValue placeholder={t.timezonePlaceholder} />\n                            </SelectTrigger>\n                          </FormControl>\n                          <SelectContent>\n                            {timezones.map((tz) => (\n                              <SelectItem key={tz.value} value={tz.value}>\n                                {tz.label[language]}\n                              </SelectItem>\n                            ))}\n                          </SelectContent>\n                        </Select>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n                </CardContent>\n              </Card>\n\n              <Card>\n                <CardHeader className=\"pb-3\">\n                  <div className=\"flex items-center justify-between\">\n                    <div className=\"flex items-center gap-2\">\n                      <Briefcase className=\"h-5 w-5 text-muted-foreground\" />\n                      <CardTitle className=\"text-base\">{t.experienceTitle}</CardTitle>\n                    </div>\n                    <Button\n                      type=\"button\"\n                      variant=\"outline\"\n                      size=\"sm\"\n                      onClick={() =>\n                        appendExperience({\n                          company: \"\",\n                          title: \"\",\n                          fromMonth: \"\",\n                          fromYear: \"\",\n                          toMonth: \"\",\n                          toYear: \"\",\n                          isCurrent: false,\n                        })\n                      }\n                      className=\"gap-1\"\n                      data-testid=\"button-add-experience\"\n                    >\n                      <Plus className=\"h-4 w-4\" />\n                      {t.addExperience}\n                    </Button>\n                  </div>\n                </CardHeader>\n                <CardContent className=\"space-y-6\">\n                  {experienceFields.map((expField, index) => (\n                    <div\n                      key={expField.id}\n                      className=\"space-y-4 p-4 border rounded-lg relative\"\n                    >\n                      {experienceFields.length > 1 && (\n                        <Button\n                          type=\"button\"\n                          variant=\"ghost\"\n                          size=\"sm\"\n                          onClick={() => removeExperience(index)}\n                          className=\"absolute top-2 right-2 text-destructive\"\n                          data-testid={`button-remove-experience-${index}`}\n                        >\n                          <Trash2 className=\"h-4 w-4\" />\n                        </Button>\n                      )}\n\n                      <div className=\"grid gap-4 sm:grid-cols-2\">\n                        <FormField\n                          control={form.control}\n                          name={`experiences.${index}.company`}\n                          render={({ field }) => (\n                            <FormItem>\n                              <FormLabel>{t.company} *</FormLabel>\n                              <FormControl>\n                                <Input\n                                  placeholder={t.companyPlaceholder}\n                                  {...field}\n                                  data-testid={`input-company-${index}`}\n                                />\n                              </FormControl>\n                              <FormMessage />\n                            </FormItem>\n                          )}\n                        />\n                        <FormField\n                          control={form.control}\n                          name={`experiences.${index}.title`}\n                          render={({ field }) => (\n                            <FormItem>\n                              <FormLabel>{t.titleRole} *</FormLabel>\n                              <FormControl>\n                                <Input\n                                  placeholder={t.titleRolePlaceholder}\n                                  {...field}\n                                  data-testid={`input-title-${index}`}\n                                />\n                              </FormControl>\n                              <FormMessage />\n                            </FormItem>\n                          )}\n                        />\n                      </div>\n\n                      <div className=\"grid gap-4 sm:grid-cols-2\">\n                        <div className=\"space-y-2\">\n                          <Label>{t.fromDate} *</Label>\n                          <div className=\"grid grid-cols-2 gap-2\">\n                            <FormField\n                              control={form.control}\n                              name={`experiences.${index}.fromMonth`}\n                              render={({ field }) => (\n                                <Select onValueChange={field.onChange} value={field.value}>\n                                  <SelectTrigger data-testid={`select-from-month-${index}`}>\n                                    <SelectValue placeholder={t.month} />\n                                  </SelectTrigger>\n                                  <SelectContent>\n                                    {months.map((m) => (\n                                      <SelectItem key={m.value} value={m.value}>\n                                        {m.name[language]}\n                                      </SelectItem>\n                                    ))}\n                                  </SelectContent>\n                                </Select>\n                              )}\n                            />\n                            <FormField\n                              control={form.control}\n                              name={`experiences.${index}.fromYear`}\n                              render={({ field }) => (\n                                <Select onValueChange={field.onChange} value={field.value}>\n                                  <SelectTrigger data-testid={`select-from-year-${index}`}>\n                                    <SelectValue placeholder={t.year} />\n                                  </SelectTrigger>\n                                  <SelectContent>\n                                    {yearOptions.map((y) => (\n                                      <SelectItem key={y} value={y}>\n                                        {y}\n                                      </SelectItem>\n                                    ))}\n                                  </SelectContent>\n                                </Select>\n                              )}\n                            />\n                          </div>\n                        </div>\n\n                        <div className=\"space-y-2\">\n                          <Label>{t.toDate}</Label>\n                          <div className=\"grid grid-cols-2 gap-2\">\n                            <FormField\n                              control={form.control}\n                              name={`experiences.${index}.toMonth`}\n                              render={({ field }) => (\n                                <Select\n                                  onValueChange={field.onChange}\n                                  value={field.value}\n                                  disabled={form.watch(`experiences.${index}.isCurrent`)}\n                                >\n                                  <SelectTrigger data-testid={`select-to-month-${index}`}>\n                                    <SelectValue placeholder={t.month} />\n                                  </SelectTrigger>\n                                  <SelectContent>\n                                    {months.map((m) => (\n                                      <SelectItem key={m.value} value={m.value}>\n                                        {m.name[language]}\n                                      </SelectItem>\n                                    ))}\n                                  </SelectContent>\n                                </Select>\n                              )}\n                            />\n                            <FormField\n                              control={form.control}\n                              name={`experiences.${index}.toYear`}\n                              render={({ field }) => (\n                                <Select\n                                  onValueChange={field.onChange}\n                                  value={field.value}\n                                  disabled={form.watch(`experiences.${index}.isCurrent`)}\n                                >\n                                  <SelectTrigger data-testid={`select-to-year-${index}`}>\n                                    <SelectValue placeholder={t.year} />\n                                  </SelectTrigger>\n                                  <SelectContent>\n                                    {yearOptions.map((y) => (\n                                      <SelectItem key={y} value={y}>\n                                        {y}\n                                      </SelectItem>\n                                    ))}\n                                  </SelectContent>\n                                </Select>\n                              )}\n                            />\n                          </div>\n                        </div>\n                      </div>\n\n                      <FormField\n                        control={form.control}\n                        name={`experiences.${index}.isCurrent`}\n                        render={({ field }) => (\n                          <FormItem className=\"flex items-center gap-2 space-y-0\">\n                            <FormControl>\n                              <Checkbox\n                                checked={field.value}\n                                onCheckedChange={field.onChange}\n                                data-testid={`checkbox-current-${index}`}\n                              />\n                            </FormControl>\n                            <FormLabel className=\"cursor-pointer font-normal\">\n                              {t.currentPosition}\n                            </FormLabel>\n                          </FormItem>\n                        )}\n                      />\n                    </div>\n                  ))}\n                </CardContent>\n              </Card>\n\n              <Card>\n                <CardHeader className=\"pb-3\">\n                  <div className=\"flex items-center gap-2\">\n                    <FileText className=\"h-5 w-5 text-muted-foreground\" />\n                    <CardTitle className=\"text-base\">{t.biographyTitle}</CardTitle>\n                  </div>\n                </CardHeader>\n                <CardContent>\n                  <FormField\n                    control={form.control}\n                    name=\"biography\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormControl>\n                          <Textarea\n                            placeholder={t.biographyPlaceholder}\n                            className=\"min-h-[100px] resize-none\"\n                            {...field}\n                            data-testid=\"input-biography\"\n                          />\n                        </FormControl>\n                        <FormDescription>{t.biographyDescription}</FormDescription>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n                </CardContent>\n              </Card>\n\n              <Card>\n                <CardHeader className=\"pb-3\">\n                  <div className=\"flex items-center gap-2\">\n                    <Briefcase className=\"h-5 w-5 text-muted-foreground\" />\n                    <CardTitle className=\"text-base\">{t.workHistoryTitle}</CardTitle>\n                  </div>\n                </CardHeader>\n                <CardContent>\n                  <FormField\n                    control={form.control}\n                    name=\"workHistory\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormControl>\n                          <Textarea\n                            placeholder={t.workHistoryPlaceholder}\n                            className=\"min-h-[100px] resize-none\"\n                            {...field}\n                            data-testid=\"input-work-history\"\n                          />\n                        </FormControl>\n                        <FormDescription>{t.workHistoryDescription}</FormDescription>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n                </CardContent>\n              </Card>\n\n              <Card>\n                <CardHeader className=\"pb-3\">\n                  <div className=\"flex items-center gap-2\">\n                    <DollarSign className=\"h-5 w-5 text-muted-foreground\" />\n                    <CardTitle className=\"text-base\">{t.hourlyRateTitle}</CardTitle>\n                  </div>\n                </CardHeader>\n                <CardContent>\n                  <div className=\"grid gap-4 sm:grid-cols-2\">\n                    <FormField\n                      control={form.control}\n                      name=\"hourlyRate\"\n                      render={({ field }) => (\n                        <FormItem>\n                          <FormLabel>{t.hourlyRate} *</FormLabel>\n                          <FormControl>\n                            <Input\n                              type=\"number\"\n                              placeholder={t.hourlyRatePlaceholder}\n                              {...field}\n                              data-testid=\"input-hourly-rate\"\n                            />\n                          </FormControl>\n                          <FormMessage />\n                        </FormItem>\n                      )}\n                    />\n                    <FormField\n                      control={form.control}\n                      name=\"currency\"\n                      render={({ field }) => (\n                        <FormItem>\n                          <FormLabel>{t.currency} *</FormLabel>\n                          <Select onValueChange={field.onChange} value={field.value}>\n                            <FormControl>\n                              <SelectTrigger data-testid=\"select-currency\">\n                                <SelectValue placeholder={t.currencyPlaceholder} />\n                              </SelectTrigger>\n                            </FormControl>\n                            <SelectContent>\n                              {currencies.map((c) => (\n                                <SelectItem key={c.code} value={c.code}>\n                                  {c.symbol} {c.code} - {c.name[language]}\n                                </SelectItem>\n                              ))}\n                            </SelectContent>\n                          </Select>\n                          <FormMessage />\n                        </FormItem>\n                      )}\n                    />\n                  </div>\n                </CardContent>\n              </Card>\n\n              <Card>\n                <CardHeader className=\"pb-3\">\n                  <div className=\"flex items-center gap-2\">\n                    <Shield className=\"h-5 w-5 text-muted-foreground\" />\n                    <CardTitle className=\"text-base\">{t.termsTitle}</CardTitle>\n                  </div>\n                </CardHeader>\n                <CardContent className=\"space-y-4\">\n                  <FormField\n                    control={form.control}\n                    name=\"termsAccepted\"\n                    render={({ field }) => (\n                      <FormItem className=\"flex flex-row items-start space-x-3 space-y-0\">\n                        <FormControl>\n                          <Checkbox\n                            checked={field.value}\n                            onCheckedChange={field.onChange}\n                            data-testid=\"checkbox-terms\"\n                          />\n                        </FormControl>\n                        <div className=\"space-y-1 leading-none\">\n                          <FormLabel className=\"cursor-pointer font-normal\">\n                            {t.termsCheckboxLabel}{\" \"}\n                            <button\n                              type=\"button\"\n                              className=\"text-primary underline\"\n                              onClick={() => setShowTermsModal(true)}\n                            >\n                              {t.termsLink}\n                            </button>{\" \"}\n                            {language === \"pt\" ? \"e\" : language === \"es\" ? \"y\" : \"and\"}{\" \"}\n                            <button\n                              type=\"button\"\n                              className=\"text-primary underline\"\n                              onClick={() => setShowTermsModal(true)}\n                            >\n                              {t.privacyLink}\n                            </button>\n                          </FormLabel>\n                          <FormMessage />\n                        </div>\n                      </FormItem>\n                    )}\n                  />\n\n                  <FormField\n                    control={form.control}\n                    name=\"lgpdAccepted\"\n                    render={({ field }) => (\n                      <FormItem className=\"flex flex-row items-start space-x-3 space-y-0\">\n                        <FormControl>\n                          <Checkbox\n                            checked={field.value}\n                            onCheckedChange={field.onChange}\n                            data-testid=\"checkbox-lgpd\"\n                          />\n                        </FormControl>\n                        <div className=\"space-y-1 leading-none\">\n                          <FormLabel className=\"cursor-pointer font-normal\">\n                            {t.lgpdCheckboxLabel}{\" \"}\n                            <button\n                              type=\"button\"\n                              className=\"text-primary underline\"\n                              onClick={() => setShowLgpdModal(true)}\n                            >\n                              {t.lgpdLink}\n                            </button>\n                          </FormLabel>\n                          <FormMessage />\n                        </div>\n                      </FormItem>\n                    )}\n                  />\n                </CardContent>\n              </Card>\n\n              <div className=\"flex justify-end gap-3 pt-4\">\n                {onCancel && (\n                  <Button\n                    type=\"button\"\n                    variant=\"outline\"\n                    onClick={onCancel}\n                    data-testid=\"button-cancel\"\n                  >\n                    {t.closeButton}\n                  </Button>\n                )}\n                <Button\n                  type=\"submit\"\n                  disabled={registerMutation.isPending}\n                  className=\"gap-2\"\n                  data-testid=\"button-submit\"\n                >\n                  {registerMutation.isPending ? (\n                    <>\n                      <Loader2 className=\"h-4 w-4 animate-spin\" />\n                      {t.submitting}\n                    </>\n                  ) : (\n                    t.registerExpertButton\n                  )}\n                </Button>\n              </div>\n            </form>\n          </Form>\n        </ScrollArea>\n      </div>\n\n      <Dialog open={showTermsModal} onOpenChange={setShowTermsModal}>\n        <DialogContent className=\"max-w-2xl max-h-[80vh] overflow-y-auto\">\n          <DialogHeader>\n            <DialogTitle>{t.termsLink}</DialogTitle>\n            <DialogDescription>\n              {language === \"pt\"\n                ? \"Leia os termos abaixo\"\n                : language === \"es\"\n                ? \"Lea los terminos a continuacion\"\n                : \"Read the terms below\"}\n            </DialogDescription>\n          </DialogHeader>\n          <div\n            className=\"prose prose-sm dark:prose-invert max-w-none\"\n            dangerouslySetInnerHTML={{\n              __html: termsAndConditionsContent[language],\n            }}\n          />\n        </DialogContent>\n      </Dialog>\n\n      <Dialog open={showLgpdModal} onOpenChange={setShowLgpdModal}>\n        <DialogContent className=\"max-w-2xl max-h-[80vh] overflow-y-auto\">\n          <DialogHeader>\n            <DialogTitle>{t.lgpdLink}</DialogTitle>\n            <DialogDescription>\n              {language === \"pt\"\n                ? \"Leia a politica LGPD abaixo\"\n                : language === \"es\"\n                ? \"Lea la politica LGPD a continuacion\"\n                : \"Read the LGPD policy below\"}\n            </DialogDescription>\n          </DialogHeader>\n          <div\n            className=\"prose prose-sm dark:prose-invert max-w-none\"\n            dangerouslySetInnerHTML={{\n              __html: lgpdContent[language],\n            }}\n          />\n        </DialogContent>\n      </Dialog>\n    </>\n  );\n}\n","path":null,"size_bytes":44034,"size_tokens":null},"client/src/components/experts/QuickInviteForm.tsx":{"content":"import { useState } from \"react\";\nimport { useForm } from \"react-hook-form\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport { z } from \"zod\";\nimport { useMutation } from \"@tanstack/react-query\";\nimport { CheckCircle, Copy, ExternalLink } from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport {\n  Form,\n  FormControl,\n  FormDescription,\n  FormField,\n  FormItem,\n  FormLabel,\n  FormMessage,\n} from \"@/components/ui/form\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { apiRequest } from \"@/lib/queryClient\";\n\ninterface QuickInviteFormProps {\n  projectId: number;\n  onSuccess: (data: { inviteUrl: string }) => void;\n  onCancel?: () => void;\n}\n\nconst formSchema = z.object({\n  candidateName: z.string().min(1, \"Candidate name is required\"),\n  linkedinUrl: z.string().url(\"Invalid LinkedIn URL\").optional().or(z.literal(\"\")),\n  email: z.string().email(\"Invalid email\").optional().or(z.literal(\"\")),\n  phoneNumber: z.string().optional().or(z.literal(\"\")),\n}).refine(\n  (data) => data.linkedinUrl || data.email || data.phoneNumber,\n  {\n    message: \"At least one of LinkedIn URL, Email, or Phone number is required\",\n    path: [\"linkedinUrl\"],\n  }\n);\n\ntype FormData = z.infer<typeof formSchema>;\n\nexport function QuickInviteForm({ projectId, onSuccess, onCancel }: QuickInviteFormProps) {\n  const { toast } = useToast();\n  const [isSubmitted, setIsSubmitted] = useState(false);\n  const [inviteUrl, setInviteUrl] = useState<string | null>(null);\n  const [copiedLink, setCopiedLink] = useState(false);\n\n  const form = useForm<FormData>({\n    resolver: zodResolver(formSchema),\n    defaultValues: {\n      candidateName: \"\",\n      linkedinUrl: \"\",\n      email: \"\",\n      phoneNumber: \"\",\n    },\n  });\n\n  const quickInviteMutation = useMutation({\n    mutationFn: async (data: FormData) => {\n      const response = await apiRequest(\n        \"POST\",\n        `/api/projects/${projectId}/quick-invite`,\n        {\n          candidateName: data.candidateName,\n          linkedinUrl: data.linkedinUrl || null,\n          email: data.email || null,\n          phoneNumber: data.phoneNumber || null,\n        }\n      );\n      return response.json();\n    },\n    onSuccess: (data) => {\n      setIsSubmitted(true);\n      setInviteUrl(data.inviteUrl);\n      toast({ title: \"Invite link generated successfully\" });\n      onSuccess({ inviteUrl: data.inviteUrl });\n    },\n    onError: (error: Error) => {\n      toast({\n        title: \"Error\",\n        description: error.message,\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const onSubmit = (data: FormData) => {\n    quickInviteMutation.mutate(data);\n  };\n\n  const copyInviteLink = async () => {\n    if (inviteUrl) {\n      const fullUrl = `${window.location.origin}${inviteUrl}`;\n      await navigator.clipboard.writeText(fullUrl);\n      setCopiedLink(true);\n      toast({ \n        title: \"Invite link copied\",\n        description: \"Link copied to clipboard and ready to share\"\n      });\n      setTimeout(() => setCopiedLink(false), 2000);\n    }\n  };\n\n  if (isSubmitted && inviteUrl) {\n    return (\n      <div className=\"flex flex-col items-center gap-4 py-8 text-center\">\n        <div className=\"flex h-16 w-16 items-center justify-center rounded-full bg-green-500/10\">\n          <CheckCircle className=\"h-8 w-8 text-green-500\" />\n        </div>\n        <div>\n          <h2 className=\"text-xl font-semibold\">Invite Link Generated</h2>\n          <p className=\"mt-2 text-muted-foreground\">Share this link with the candidate</p>\n        </div>\n        <div className=\"flex items-center gap-2 p-3 bg-muted rounded-lg w-full max-w-md\">\n          <code className=\"flex-1 text-sm truncate\">\n            {`${window.location.origin}${inviteUrl}`}\n          </code>\n          <Button\n            variant=\"outline\"\n            size=\"sm\"\n            onClick={copyInviteLink}\n            data-testid=\"button-copy-invite-url\"\n          >\n            {copiedLink ? (\n              <CheckCircle className=\"h-4 w-4\" />\n            ) : (\n              <Copy className=\"h-4 w-4\" />\n            )}\n          </Button>\n          <Button\n            variant=\"outline\"\n            size=\"sm\"\n            onClick={() => window.open(inviteUrl, \"_blank\")}\n            data-testid=\"button-open-invite-url\"\n          >\n            <ExternalLink className=\"h-4 w-4\" />\n          </Button>\n        </div>\n        {onCancel && (\n          <Button onClick={onCancel} className=\"mt-4\" data-testid=\"button-close\">\n            Close\n          </Button>\n        )}\n      </div>\n    );\n  }\n\n  return (\n    <Form {...form}>\n      <form onSubmit={form.handleSubmit(onSubmit)} className=\"space-y-6\">\n        <div className=\"mb-6\">\n          <h2 className=\"text-lg font-semibold\">Invite New Expert</h2>\n          <p className=\"text-sm text-muted-foreground mt-1\">\n            Generate a quick invite link with minimal information\n          </p>\n        </div>\n\n        <FormField\n          control={form.control}\n          name=\"candidateName\"\n          render={({ field }) => (\n            <FormItem>\n              <FormLabel>\n                Candidate Name <span className=\"text-destructive\">*</span>\n              </FormLabel>\n              <FormControl>\n                <Input placeholder=\"John Doe\" {...field} data-testid=\"input-candidate-name\" />\n              </FormControl>\n              <FormMessage />\n            </FormItem>\n          )}\n        />\n\n        <FormField\n          control={form.control}\n          name=\"linkedinUrl\"\n          render={({ field }) => (\n            <FormItem>\n              <FormLabel>LinkedIn URL</FormLabel>\n              <FormControl>\n                <Input\n                  placeholder=\"https://linkedin.com/in/johndoe\"\n                  {...field}\n                  data-testid=\"input-linkedin-url\"\n                />\n              </FormControl>\n              <FormMessage />\n            </FormItem>\n          )}\n        />\n\n        <FormField\n          control={form.control}\n          name=\"email\"\n          render={({ field }) => (\n            <FormItem>\n              <FormLabel>Email</FormLabel>\n              <FormControl>\n                <Input\n                  type=\"email\"\n                  placeholder=\"john@example.com\"\n                  {...field}\n                  data-testid=\"input-email\"\n                />\n              </FormControl>\n              <FormMessage />\n            </FormItem>\n          )}\n        />\n\n        <FormField\n          control={form.control}\n          name=\"phoneNumber\"\n          render={({ field }) => (\n            <FormItem>\n              <FormLabel>Phone Number</FormLabel>\n              <FormControl>\n                <Input\n                  placeholder=\"+1 (555) 123-4567\"\n                  {...field}\n                  data-testid=\"input-phone-number\"\n                />\n              </FormControl>\n              <FormMessage />\n            </FormItem>\n          )}\n        />\n\n        <FormDescription>\n          At least one of LinkedIn URL, Email, or Phone Number is required\n        </FormDescription>\n\n        <div className=\"flex gap-3 pt-4\">\n          <Button\n            type=\"submit\"\n            disabled={quickInviteMutation.isPending}\n            data-testid=\"button-generate-invite\"\n          >\n            {quickInviteMutation.isPending ? \"Generating...\" : \"Generate Invite Link\"}\n          </Button>\n          {onCancel && (\n            <Button type=\"button\" variant=\"outline\" onClick={onCancel} data-testid=\"button-cancel\">\n              Cancel\n            </Button>\n          )}\n        </div>\n      </form>\n    </Form>\n  );\n}\n","path":null,"size_bytes":7625,"size_tokens":null},"client/src/pages/quick-invite-onboarding.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { useParams } from \"wouter\";\nimport { AlertCircle, Loader2, X } from \"lucide-react\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Checkbox } from \"@/components/ui/checkbox\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle } from \"@/components/ui/dialog\";\nimport { ScrollArea } from \"@/components/ui/scroll-area\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport logoPath from \"@assets/Logo_1764384177823.png\";\n\ninterface InviteData {\n  candidateName: string;\n  projectName: string;\n  projectId: number;\n}\n\nconst i18n = {\n  en: {\n    title: \"Complete Your Profile\",\n    subtitle: \"Fill in your information to join the project\",\n    firstName: \"First Name\",\n    lastName: \"Last Name\",\n    email: \"Email\",\n    phone: \"Phone (optional)\",\n    acceptTermsPrefix: \"I accept the \",\n    termsLink: \"Terms & Conditions\",\n    acceptLGPDPrefix: \"I accept the \",\n    lgpdLink: \"LGPD Data Privacy Policy\",\n    continue: \"Continue to Project\",\n    loading: \"Loading...\",\n    submitting: \"Submitting...\",\n    invalidLink: \"Invalid Invite Link\",\n    linkExpired: \"This link has expired or is no longer valid\",\n    termsModalTitle: \"Terms & Conditions\",\n    lgpdModalTitle: \"LGPD Data Privacy Policy\",\n    close: \"Close\",\n  },\n  pt: {\n    title: \"Complete Seu Perfil\",\n    subtitle: \"Preencha suas informaes para participar do projeto\",\n    firstName: \"Primeiro Nome\",\n    lastName: \"Sobrenome\",\n    email: \"Email\",\n    phone: \"Telefone (opcional)\",\n    acceptTermsPrefix: \"Aceito os \",\n    termsLink: \"Termos & Condies\",\n    acceptLGPDPrefix: \"Aceito a \",\n    lgpdLink: \"Poltica de Privacidade LGPD\",\n    continue: \"Continuar para o Projeto\",\n    loading: \"Carregando...\",\n    submitting: \"Enviando...\",\n    invalidLink: \"Link de Convite Invlido\",\n    linkExpired: \"Este link expirou ou no  mais vlido\",\n    termsModalTitle: \"Termos & Condies\",\n    lgpdModalTitle: \"Poltica de Privacidade LGPD\",\n    close: \"Fechar\",\n  },\n  es: {\n    title: \"Completa Tu Perfil\",\n    subtitle: \"Rellena tu informacin para unirte al proyecto\",\n    firstName: \"Nombre\",\n    lastName: \"Apellido\",\n    email: \"Correo Electrnico\",\n    phone: \"Telfono (opcional)\",\n    acceptTermsPrefix: \"Acepto los \",\n    termsLink: \"Trminos y Condiciones\",\n    acceptLGPDPrefix: \"Acepto la \",\n    lgpdLink: \"Poltica de Privacidad LGPD\",\n    continue: \"Continuar al Proyecto\",\n    loading: \"Cargando...\",\n    submitting: \"Enviando...\",\n    invalidLink: \"Enlace de Invitacin Invlido\",\n    linkExpired: \"Este enlace ha expirado o ya no es vlido\",\n    termsModalTitle: \"Trminos y Condiciones\",\n    lgpdModalTitle: \"Poltica de Privacidad LGPD\",\n    close: \"Cerrar\",\n  },\n};\n\nconst termsContent = {\n  en: `TERMS AND CONDITIONS OF USE\n\nLast updated: November 2024\n\n1. ACCEPTANCE OF TERMS\nBy accessing and using the Mirae Connext platform (\"Platform\"), you agree to be bound by these Terms and Conditions. If you do not agree with any part of these terms, you may not use our services.\n\n2. DESCRIPTION OF SERVICES\nMirae Connext provides an expert network platform connecting professionals with organizations seeking specialized knowledge and insights. Our services include:\n- Expert profile management\n- Project matching and assignments\n- Consultation scheduling\n- Payment processing for expert services\n\n3. USER RESPONSIBILITIES\nAs a user of our Platform, you agree to:\n- Provide accurate and complete information\n- Maintain the confidentiality of your account credentials\n- Comply with all applicable laws and regulations\n- Not misrepresent your qualifications or expertise\n- Respect intellectual property rights\n\n4. EXPERT OBLIGATIONS\nExperts registered on the Platform agree to:\n- Provide truthful information about their background and expertise\n- Maintain professional conduct during all engagements\n- Protect confidential information shared during consultations\n- Comply with any non-disclosure agreements\n- Not engage in activities that conflict with client interests\n\n5. INTELLECTUAL PROPERTY\nAll content, trademarks, and materials on the Platform are owned by Mirae Connext or its licensors. Users may not reproduce, distribute, or create derivative works without prior written consent.\n\n6. LIMITATION OF LIABILITY\nMirae Connext shall not be liable for any indirect, incidental, special, or consequential damages arising from the use of our services.\n\n7. TERMINATION\nWe reserve the right to terminate or suspend accounts that violate these terms or engage in fraudulent activities.\n\n8. GOVERNING LAW\nThese terms shall be governed by and construed in accordance with applicable laws.\n\n9. CONTACT INFORMATION\nFor questions about these Terms, please contact: legal@miraeconnext.com`,\n\n  pt: `TERMOS E CONDIES DE USO\n\nltima atualizao: Novembro de 2024\n\n1. ACEITAO DOS TERMOS\nAo acessar e usar a plataforma Mirae Connext (\"Plataforma\"), voc concorda em estar vinculado a estes Termos e Condies. Se voc no concordar com qualquer parte destes termos, no poder usar nossos servios.\n\n2. DESCRIO DOS SERVIOS\nA Mirae Connext fornece uma plataforma de rede de especialistas conectando profissionais com organizaes que buscam conhecimento e insights especializados. Nossos servios incluem:\n- Gerenciamento de perfil de especialista\n- Correspondncia e atribuies de projetos\n- Agendamento de consultas\n- Processamento de pagamentos para servios de especialistas\n\n3. RESPONSABILIDADES DO USURIO\nComo usurio de nossa Plataforma, voc concorda em:\n- Fornecer informaes precisas e completas\n- Manter a confidencialidade de suas credenciais de conta\n- Cumprir todas as leis e regulamentos aplicveis\n- No deturpar suas qualificaes ou expertise\n- Respeitar direitos de propriedade intelectual\n\n4. OBRIGAES DO ESPECIALISTA\nEspecialistas registrados na Plataforma concordam em:\n- Fornecer informaes verdadeiras sobre sua formao e expertise\n- Manter conduta profissional durante todos os engajamentos\n- Proteger informaes confidenciais compartilhadas durante consultas\n- Cumprir quaisquer acordos de no divulgao\n- No se envolver em atividades que conflitem com interesses do cliente\n\n5. PROPRIEDADE INTELECTUAL\nTodo o contedo, marcas registradas e materiais na Plataforma so de propriedade da Mirae Connext ou de seus licenciadores.\n\n6. LIMITAO DE RESPONSABILIDADE\nA Mirae Connext no ser responsvel por quaisquer danos indiretos, incidentais, especiais ou consequentes decorrentes do uso de nossos servios.\n\n7. RESCISO\nReservamo-nos o direito de encerrar ou suspender contas que violem estes termos ou se envolvam em atividades fraudulentas.\n\n8. LEI APLICVEL\nEstes termos sero regidos e interpretados de acordo com as leis aplicveis.\n\n9. INFORMAES DE CONTATO\nPara perguntas sobre estes Termos, entre em contato: legal@miraeconnext.com`,\n\n  es: `TRMINOS Y CONDICIONES DE USO\n\nltima actualizacin: Noviembre de 2024\n\n1. ACEPTACIN DE LOS TRMINOS\nAl acceder y utilizar la plataforma Mirae Connext (\"Plataforma\"), acepta estar sujeto a estos Trminos y Condiciones. Si no est de acuerdo con alguna parte de estos trminos, no podr utilizar nuestros servicios.\n\n2. DESCRIPCIN DE LOS SERVICIOS\nMirae Connext proporciona una plataforma de red de expertos que conecta profesionales con organizaciones que buscan conocimientos e informacin especializada. Nuestros servicios incluyen:\n- Gestin de perfiles de expertos\n- Emparejamiento y asignaciones de proyectos\n- Programacin de consultas\n- Procesamiento de pagos por servicios de expertos\n\n3. RESPONSABILIDADES DEL USUARIO\nComo usuario de nuestra Plataforma, acepta:\n- Proporcionar informacin precisa y completa\n- Mantener la confidencialidad de sus credenciales de cuenta\n- Cumplir con todas las leyes y regulaciones aplicables\n- No tergiversar sus calificaciones o experiencia\n- Respetar los derechos de propiedad intelectual\n\n4. OBLIGACIONES DEL EXPERTO\nLos expertos registrados en la Plataforma aceptan:\n- Proporcionar informacin veraz sobre su formacin y experiencia\n- Mantener una conducta profesional durante todos los compromisos\n- Proteger la informacin confidencial compartida durante las consultas\n- Cumplir con cualquier acuerdo de confidencialidad\n- No participar en actividades que entren en conflicto con los intereses del cliente\n\n5. PROPIEDAD INTELECTUAL\nTodo el contenido, marcas comerciales y materiales en la Plataforma son propiedad de Mirae Connext o sus licenciantes.\n\n6. LIMITACIN DE RESPONSABILIDAD\nMirae Connext no ser responsable de ningn dao indirecto, incidental, especial o consecuente que surja del uso de nuestros servicios.\n\n7. TERMINACIN\nNos reservamos el derecho de terminar o suspender cuentas que violen estos trminos o participen en actividades fraudulentas.\n\n8. LEY APLICABLE\nEstos trminos se regirn e interpretarn de acuerdo con las leyes aplicables.\n\n9. INFORMACIN DE CONTACTO\nPara preguntas sobre estos Trminos, comunquese con: legal@miraeconnext.com`,\n};\n\nconst lgpdContent = {\n  en: `LGPD DATA PRIVACY POLICY\n\nLast updated: November 2024\n\nThis Privacy Policy describes how Mirae Connext collects, uses, and protects your personal data in accordance with the Brazilian General Data Protection Law (LGPD - Lei Geral de Proteo de Dados).\n\n1. DATA CONTROLLER\nMirae Connext is the data controller responsible for processing your personal data.\n\n2. PERSONAL DATA WE COLLECT\nWe collect the following categories of personal data:\n- Identification data: name, email, phone number\n- Professional data: job title, company, expertise, work history\n- Usage data: platform interactions, consultation history\n- Communication data: messages exchanged through the platform\n\n3. PURPOSE OF DATA PROCESSING\nYour personal data is processed for:\n- Account creation and management\n- Expert-client matching\n- Consultation scheduling and management\n- Payment processing\n- Communication regarding our services\n- Legal compliance\n\n4. LEGAL BASIS FOR PROCESSING\nWe process your data based on:\n- Consent: when you accept these terms\n- Contract performance: to provide our services\n- Legitimate interests: to improve our platform\n- Legal obligations: to comply with applicable laws\n\n5. DATA SHARING\nYour data may be shared with:\n- Clients seeking expert consultations\n- Payment processors\n- Service providers (hosting, analytics)\n- Legal authorities when required by law\n\n6. DATA RETENTION\nWe retain your personal data for as long as necessary to fulfill the purposes described in this policy, or as required by law.\n\n7. YOUR RIGHTS\nUnder LGPD, you have the right to:\n- Access your personal data\n- Correct inaccurate data\n- Request deletion of your data\n- Revoke consent\n- Request data portability\n- Object to processing\n\n8. DATA SECURITY\nWe implement appropriate technical and organizational measures to protect your personal data against unauthorized access, alteration, disclosure, or destruction.\n\n9. INTERNATIONAL TRANSFERS\nYour data may be transferred to countries outside Brazil. We ensure adequate protection measures are in place for such transfers.\n\n10. CONTACT\nFor questions about this policy or to exercise your rights:\nData Protection Officer: dpo@miraeconnext.com\n\n11. UPDATES\nWe may update this policy periodically. Significant changes will be communicated through the platform.`,\n\n  pt: `POLTICA DE PRIVACIDADE LGPD\n\nltima atualizao: Novembro de 2024\n\nEsta Poltica de Privacidade descreve como a Mirae Connext coleta, usa e protege seus dados pessoais em conformidade com a Lei Geral de Proteo de Dados (LGPD).\n\n1. CONTROLADOR DE DADOS\nA Mirae Connext  o controlador de dados responsvel pelo tratamento de seus dados pessoais.\n\n2. DADOS PESSOAIS QUE COLETAMOS\nColetamos as seguintes categorias de dados pessoais:\n- Dados de identificao: nome, email, telefone\n- Dados profissionais: cargo, empresa, expertise, histrico de trabalho\n- Dados de uso: interaes na plataforma, histrico de consultas\n- Dados de comunicao: mensagens trocadas atravs da plataforma\n\n3. FINALIDADE DO TRATAMENTO DE DADOS\nSeus dados pessoais so tratados para:\n- Criao e gerenciamento de conta\n- Correspondncia entre especialistas e clientes\n- Agendamento e gerenciamento de consultas\n- Processamento de pagamentos\n- Comunicao sobre nossos servios\n- Conformidade legal\n\n4. BASE LEGAL PARA O TRATAMENTO\nTratamos seus dados com base em:\n- Consentimento: quando voc aceita estes termos\n- Execuo de contrato: para fornecer nossos servios\n- Interesses legtimos: para melhorar nossa plataforma\n- Obrigaes legais: para cumprir as leis aplicveis\n\n5. COMPARTILHAMENTO DE DADOS\nSeus dados podem ser compartilhados com:\n- Clientes que buscam consultas com especialistas\n- Processadores de pagamento\n- Prestadores de servios (hospedagem, anlise)\n- Autoridades legais quando exigido por lei\n\n6. RETENO DE DADOS\nRetemos seus dados pessoais pelo tempo necessrio para cumprir as finalidades descritas nesta poltica, ou conforme exigido por lei.\n\n7. SEUS DIREITOS\nDe acordo com a LGPD, voc tem o direito de:\n- Acessar seus dados pessoais\n- Corrigir dados imprecisos\n- Solicitar excluso de seus dados\n- Revogar consentimento\n- Solicitar portabilidade de dados\n- Opor-se ao tratamento\n\n8. SEGURANA DOS DADOS\nImplementamos medidas tcnicas e organizacionais apropriadas para proteger seus dados pessoais contra acesso, alterao, divulgao ou destruio no autorizados.\n\n9. TRANSFERNCIAS INTERNACIONAIS\nSeus dados podem ser transferidos para pases fora do Brasil. Garantimos que medidas de proteo adequadas estejam em vigor para tais transferncias.\n\n10. CONTATO\nPara perguntas sobre esta poltica ou para exercer seus direitos:\nEncarregado de Proteo de Dados: dpo@miraeconnext.com\n\n11. ATUALIZAES\nPodemos atualizar esta poltica periodicamente. Mudanas significativas sero comunicadas atravs da plataforma.`,\n\n  es: `POLTICA DE PRIVACIDAD LGPD\n\nltima actualizacin: Noviembre de 2024\n\nEsta Poltica de Privacidad describe cmo Mirae Connext recopila, utiliza y protege sus datos personales de acuerdo con la Ley General de Proteccin de Datos de Brasil (LGPD).\n\n1. CONTROLADOR DE DATOS\nMirae Connext es el controlador de datos responsable del tratamiento de sus datos personales.\n\n2. DATOS PERSONALES QUE RECOPILAMOS\nRecopilamos las siguientes categoras de datos personales:\n- Datos de identificacin: nombre, correo electrnico, telfono\n- Datos profesionales: cargo, empresa, experiencia, historial laboral\n- Datos de uso: interacciones en la plataforma, historial de consultas\n- Datos de comunicacin: mensajes intercambiados a travs de la plataforma\n\n3. PROPSITO DEL TRATAMIENTO DE DATOS\nSus datos personales se procesan para:\n- Creacin y gestin de cuentas\n- Emparejamiento entre expertos y clientes\n- Programacin y gestin de consultas\n- Procesamiento de pagos\n- Comunicacin sobre nuestros servicios\n- Cumplimiento legal\n\n4. BASE LEGAL PARA EL TRATAMIENTO\nProcesamos sus datos basndonos en:\n- Consentimiento: cuando acepta estos trminos\n- Ejecucin de contrato: para proporcionar nuestros servicios\n- Intereses legtimos: para mejorar nuestra plataforma\n- Obligaciones legales: para cumplir con las leyes aplicables\n\n5. COMPARTIR DATOS\nSus datos pueden compartirse con:\n- Clientes que buscan consultas con expertos\n- Procesadores de pagos\n- Proveedores de servicios (alojamiento, anlisis)\n- Autoridades legales cuando lo exija la ley\n\n6. RETENCIN DE DATOS\nConservamos sus datos personales durante el tiempo necesario para cumplir los propsitos descritos en esta poltica, o segn lo exija la ley.\n\n7. SUS DERECHOS\nSegn la LGPD, tiene derecho a:\n- Acceder a sus datos personales\n- Corregir datos inexactos\n- Solicitar la eliminacin de sus datos\n- Revocar el consentimiento\n- Solicitar la portabilidad de datos\n- Oponerse al tratamiento\n\n8. SEGURIDAD DE DATOS\nImplementamos medidas tcnicas y organizativas apropiadas para proteger sus datos personales contra acceso, alteracin, divulgacin o destruccin no autorizados.\n\n9. TRANSFERENCIAS INTERNACIONALES\nSus datos pueden transferirse a pases fuera de Brasil. Garantizamos que existan medidas de proteccin adecuadas para dichas transferencias.\n\n10. CONTACTO\nPara preguntas sobre esta poltica o para ejercer sus derechos:\nOficial de Proteccin de Datos: dpo@miraeconnext.com\n\n11. ACTUALIZACIONES\nPodemos actualizar esta poltica peridicamente. Los cambios significativos se comunicarn a travs de la plataforma.`,\n};\n\nexport default function QuickInviteOnboarding() {\n  const { token } = useParams<{ token: string }>();\n  const { toast } = useToast();\n  const [language, setLanguage] = useState<\"en\" | \"pt\" | \"es\">(\"en\");\n  const [formData, setFormData] = useState({\n    firstName: \"\",\n    lastName: \"\",\n    email: \"\",\n    phone: \"\",\n  });\n  const [acceptedTerms, setAcceptedTerms] = useState(false);\n  const [acceptedLGPD, setAcceptedLGPD] = useState(false);\n  const [showTermsModal, setShowTermsModal] = useState(false);\n  const [showLGPDModal, setShowLGPDModal] = useState(false);\n\n  const t = i18n[language];\n\n  const { data: inviteData, isLoading, error } = useQuery({\n    queryKey: [`/api/quick-invite/${token}`],\n    queryFn: async () => {\n      const res = await fetch(`/api/quick-invite/${token}`);\n      if (!res.ok) throw new Error(\"Invalid invite link\");\n      return res.json() as Promise<InviteData>;\n    },\n  });\n\n  const submitMutation = useMutation({\n    mutationFn: async () => {\n      const res = await fetch(`/api/quick-invite/${token}/onboard`, {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify(formData),\n      });\n      if (!res.ok) {\n        const errorData = await res.json();\n        throw new Error(errorData.error || \"Submission failed\");\n      }\n      return res.json();\n    },\n    onSuccess: () => {\n      toast({ title: \"Profile saved!\", description: \"Now let's learn about the project\" });\n      setTimeout(() => {\n        window.location.href = `/invite/decide/${token}`;\n      }, 1500);\n    },\n    onError: (error: Error) => {\n      toast({\n        title: \"Error\",\n        description: error.message,\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  if (isLoading) {\n    return (\n      <div className=\"flex min-h-screen items-center justify-center bg-background p-4\">\n        <Card className=\"w-full max-w-md\">\n          <CardContent className=\"flex flex-col items-center gap-4 py-12\">\n            <Loader2 className=\"h-8 w-8 animate-spin text-primary\" />\n            <p className=\"text-muted-foreground\">{t.loading}</p>\n          </CardContent>\n        </Card>\n      </div>\n    );\n  }\n\n  if (error || !inviteData) {\n    return (\n      <div className=\"flex min-h-screen items-center justify-center bg-background p-4\">\n        <Card className=\"w-full max-w-md\">\n          <CardContent className=\"flex flex-col items-center gap-4 py-12 text-center\">\n            <AlertCircle className=\"h-8 w-8 text-destructive\" />\n            <div>\n              <h2 className=\"text-xl font-semibold\">{t.invalidLink}</h2>\n              <p className=\"mt-2 text-muted-foreground\">{t.linkExpired}</p>\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"min-h-screen bg-background p-4 py-8\">\n      <div className=\"mx-auto max-w-md\">\n        <div className=\"mb-6 flex items-center justify-between\">\n          <img src={logoPath} alt=\"Mirae Connext\" className=\"h-10 w-auto\" />\n          <select\n            value={language}\n            onChange={(e) => setLanguage(e.target.value as \"en\" | \"pt\" | \"es\")}\n            className=\"text-sm border rounded px-2 py-1\"\n            data-testid=\"select-language\"\n          >\n            <option value=\"en\">English</option>\n            <option value=\"pt\">Portugus</option>\n            <option value=\"es\">Espaol</option>\n          </select>\n        </div>\n\n        <Card>\n          <CardHeader>\n            <CardTitle>{t.title}</CardTitle>\n            <CardDescription>{t.subtitle}</CardDescription>\n          </CardHeader>\n          <CardContent className=\"space-y-4\">\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"firstName\">{t.firstName}</Label>\n              <Input\n                id=\"firstName\"\n                placeholder=\"John\"\n                value={formData.firstName}\n                onChange={(e) => setFormData({ ...formData, firstName: e.target.value })}\n                data-testid=\"input-firstName\"\n              />\n            </div>\n\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"lastName\">{t.lastName}</Label>\n              <Input\n                id=\"lastName\"\n                placeholder=\"Doe\"\n                value={formData.lastName}\n                onChange={(e) => setFormData({ ...formData, lastName: e.target.value })}\n                data-testid=\"input-lastName\"\n              />\n            </div>\n\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"email\">{t.email}</Label>\n              <Input\n                id=\"email\"\n                type=\"email\"\n                placeholder=\"john@example.com\"\n                value={formData.email}\n                onChange={(e) => setFormData({ ...formData, email: e.target.value })}\n                data-testid=\"input-email\"\n              />\n            </div>\n\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"phone\">{t.phone}</Label>\n              <Input\n                id=\"phone\"\n                placeholder=\"+1 (555) 000-0000\"\n                value={formData.phone}\n                onChange={(e) => setFormData({ ...formData, phone: e.target.value })}\n                data-testid=\"input-phone\"\n              />\n            </div>\n\n            <div className=\"space-y-3 border-t pt-4\">\n              <div className=\"flex items-start gap-2\">\n                <Checkbox\n                  id=\"terms\"\n                  checked={acceptedTerms}\n                  onCheckedChange={(checked) => setAcceptedTerms(checked as boolean)}\n                  className=\"mt-0.5\"\n                  data-testid=\"checkbox-terms\"\n                />\n                <label htmlFor=\"terms\" className=\"text-sm cursor-pointer\">\n                  {t.acceptTermsPrefix}\n                  <button\n                    type=\"button\"\n                    onClick={(e) => {\n                      e.preventDefault();\n                      setShowTermsModal(true);\n                    }}\n                    className=\"text-primary underline hover:text-primary/80\"\n                    data-testid=\"link-terms\"\n                  >\n                    {t.termsLink}\n                  </button>\n                </label>\n              </div>\n\n              <div className=\"flex items-start gap-2\">\n                <Checkbox\n                  id=\"lgpd\"\n                  checked={acceptedLGPD}\n                  onCheckedChange={(checked) => setAcceptedLGPD(checked as boolean)}\n                  className=\"mt-0.5\"\n                  data-testid=\"checkbox-lgpd\"\n                />\n                <label htmlFor=\"lgpd\" className=\"text-sm cursor-pointer\">\n                  {t.acceptLGPDPrefix}\n                  <button\n                    type=\"button\"\n                    onClick={(e) => {\n                      e.preventDefault();\n                      setShowLGPDModal(true);\n                    }}\n                    className=\"text-primary underline hover:text-primary/80\"\n                    data-testid=\"link-lgpd\"\n                  >\n                    {t.lgpdLink}\n                  </button>\n                </label>\n              </div>\n            </div>\n\n            <Button\n              onClick={() => submitMutation.mutate()}\n              disabled={\n                !formData.firstName ||\n                !formData.lastName ||\n                !formData.email ||\n                !acceptedTerms ||\n                !acceptedLGPD ||\n                submitMutation.isPending\n              }\n              className=\"w-full\"\n              data-testid=\"button-continue\"\n            >\n              {submitMutation.isPending ? t.submitting : t.continue}\n            </Button>\n          </CardContent>\n        </Card>\n      </div>\n\n      <Dialog open={showTermsModal} onOpenChange={setShowTermsModal}>\n        <DialogContent className=\"max-w-2xl max-h-[80vh]\">\n          <DialogHeader>\n            <DialogTitle>{t.termsModalTitle}</DialogTitle>\n          </DialogHeader>\n          <ScrollArea className=\"h-[60vh] pr-4\">\n            <div className=\"whitespace-pre-wrap text-sm text-muted-foreground\">\n              {termsContent[language]}\n            </div>\n          </ScrollArea>\n          <div className=\"flex justify-end pt-4\">\n            <Button onClick={() => setShowTermsModal(false)} data-testid=\"button-close-terms\">\n              {t.close}\n            </Button>\n          </div>\n        </DialogContent>\n      </Dialog>\n\n      <Dialog open={showLGPDModal} onOpenChange={setShowLGPDModal}>\n        <DialogContent className=\"max-w-2xl max-h-[80vh]\">\n          <DialogHeader>\n            <DialogTitle>{t.lgpdModalTitle}</DialogTitle>\n          </DialogHeader>\n          <ScrollArea className=\"h-[60vh] pr-4\">\n            <div className=\"whitespace-pre-wrap text-sm text-muted-foreground\">\n              {lgpdContent[language]}\n            </div>\n          </ScrollArea>\n          <div className=\"flex justify-end pt-4\">\n            <Button onClick={() => setShowLGPDModal(false)} data-testid=\"button-close-lgpd\">\n              {t.close}\n            </Button>\n          </div>\n        </DialogContent>\n      </Dialog>\n    </div>\n  );\n}\n","path":null,"size_bytes":25985,"size_tokens":null},"client/src/pages/quick-invite-decision.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { useParams } from \"wouter\";\nimport { AlertCircle, Loader2, Building2, ClipboardList, CheckCircle, XCircle } from \"lucide-react\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport logoPath from \"@assets/Logo_1764384177823.png\";\n\ninterface DecisionData {\n  project: {\n    id: number;\n    name: string;\n    clientName: string;\n    industry: string;\n    projectOverview: string | null;\n  };\n  vettingQuestions: Array<{\n    id: number;\n    question: string;\n    isRequired: boolean;\n  }>;\n}\n\nexport default function QuickInviteDecision() {\n  const { token } = useParams<{ token: string }>();\n  const { toast } = useToast();\n  const [sampleAnswers, setSampleAnswers] = useState<Record<number, string>>({});\n  const [submitted, setSubmitted] = useState(false);\n  const [submittedStatus, setSubmittedStatus] = useState<\"accepted\" | \"declined\" | null>(null);\n\n  const { data: decisionData, isLoading, error } = useQuery({\n    queryKey: [`/api/quick-invite/${token}/decision`],\n    queryFn: async () => {\n      const res = await fetch(`/api/quick-invite/${token}/decision`);\n      if (!res.ok) throw new Error(\"Invalid invite link\");\n      return res.json() as Promise<DecisionData>;\n    },\n  });\n\n  const decisionMutation = useMutation({\n    mutationFn: async (action: \"accepted\" | \"declined\") => {\n      const res = await fetch(`/api/quick-invite/${token}/decide`, {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify({\n          decision: action,\n          sampleAnswers: action === \"accepted\" ? sampleAnswers : {},\n        }),\n      });\n      if (!res.ok) {\n        const errorData = await res.json();\n        throw new Error(errorData.error || \"Failed to submit decision\");\n      }\n      return res.json();\n    },\n    onSuccess: (data, decision) => {\n      setSubmitted(true);\n      setSubmittedStatus(decision);\n      toast({\n        title: decision === \"accepted\" ? \"Great!\" : \"Noted\",\n        description:\n          decision === \"accepted\"\n            ? \"You've been added to the project pipeline\"\n            : \"We've noted your unavailability\",\n      });\n      setTimeout(() => window.close(), 3000);\n    },\n    onError: (error: Error) => {\n      toast({\n        title: \"Error\",\n        description: error.message,\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  if (isLoading) {\n    return (\n      <div className=\"flex min-h-screen items-center justify-center bg-background p-4\">\n        <Card className=\"w-full max-w-lg\">\n          <CardContent className=\"flex flex-col items-center gap-4 py-12\">\n            <Loader2 className=\"h-8 w-8 animate-spin text-primary\" />\n            <p className=\"text-muted-foreground\">Loading project details...</p>\n          </CardContent>\n        </Card>\n      </div>\n    );\n  }\n\n  if (error || !decisionData) {\n    return (\n      <div className=\"flex min-h-screen items-center justify-center bg-background p-4\">\n        <Card className=\"w-full max-w-lg\">\n          <CardContent className=\"flex flex-col items-center gap-4 py-12 text-center\">\n            <AlertCircle className=\"h-8 w-8 text-destructive\" />\n            <div>\n              <h2 className=\"text-xl font-semibold\">Invalid Invite Link</h2>\n              <p className=\"mt-2 text-muted-foreground\">This link has expired or is no longer valid</p>\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n    );\n  }\n\n  if (submitted) {\n    return (\n      <div className=\"flex min-h-screen items-center justify-center bg-background p-4\">\n        <Card className=\"w-full max-w-lg\">\n          <CardContent className=\"flex flex-col items-center gap-4 py-12 text-center\">\n            <div className=\"flex h-16 w-16 items-center justify-center rounded-full bg-green-500/10\">\n              {submittedStatus === \"accepted\" ? (\n                <CheckCircle className=\"h-8 w-8 text-green-500\" />\n              ) : (\n                <XCircle className=\"h-8 w-8 text-muted-foreground\" />\n              )}\n            </div>\n            <div>\n              <h2 className=\"text-xl font-semibold\">\n                {submittedStatus === \"accepted\"\n                  ? \"You're all set!\"\n                  : \"Thank you for letting us know\"}\n              </h2>\n              <p className=\"mt-2 text-muted-foreground\">\n                {submittedStatus === \"accepted\"\n                  ? \"You've been added to the project pipeline. The RA will contact you soon.\"\n                  : \"We'll keep your contact for future opportunities.\"}\n              </p>\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"min-h-screen bg-background p-4 py-8\">\n      <div className=\"mx-auto max-w-4xl\">\n        <div className=\"mb-6\">\n          <img src={logoPath} alt=\"Mirae Connext\" className=\"h-10 w-auto\" />\n        </div>\n\n        <div className=\"mb-8\">\n          <h1 className=\"text-2xl font-bold\">Project Information</h1>\n          <p className=\"mt-2 text-muted-foreground\">\n            Review the project details and let us know if you're interested\n          </p>\n        </div>\n\n        <Card className=\"mb-6\">\n          <CardHeader>\n            <div className=\"flex items-center gap-2\">\n              <Building2 className=\"h-5 w-5 text-muted-foreground\" />\n              <CardTitle className=\"text-lg\">{decisionData.project.name}</CardTitle>\n            </div>\n          </CardHeader>\n          <CardContent className=\"space-y-3\">\n            <div>\n              <p className=\"text-sm font-medium\">{decisionData.project.clientName}</p>\n              <p className=\"text-sm text-muted-foreground\">{decisionData.project.industry}</p>\n            </div>\n            {decisionData.project.projectOverview && (\n              <p className=\"text-sm text-muted-foreground\">{decisionData.project.projectOverview}</p>\n            )}\n          </CardContent>\n        </Card>\n\n        {decisionData.vettingQuestions.length > 0 && (\n          <Card className=\"mb-6\">\n            <CardHeader>\n              <div className=\"flex items-center gap-2\">\n                <ClipboardList className=\"h-5 w-5 text-muted-foreground\" />\n                <CardTitle className=\"text-lg\">Vetting Questions</CardTitle>\n              </div>\n              <CardDescription>\n                Optional: Share your thoughts on the project or questions below\n              </CardDescription>\n            </CardHeader>\n            <CardContent className=\"space-y-6\">\n              {decisionData.vettingQuestions.map((question) => (\n                <div key={question.id} className=\"space-y-2\">\n                  <label className=\"text-sm font-medium\">{question.question}</label>\n                  <Textarea\n                    placeholder=\"Your answer (optional)...\"\n                    className=\"min-h-20\"\n                    value={sampleAnswers[question.id] || \"\"}\n                    onChange={(e) =>\n                      setSampleAnswers({ ...sampleAnswers, [question.id]: e.target.value })\n                    }\n                  />\n                </div>\n              ))}\n            </CardContent>\n          </Card>\n        )}\n\n        <div className=\"flex gap-3\">\n          <Button\n            onClick={() => decisionMutation.mutate(\"declined\")}\n            variant=\"outline\"\n            disabled={decisionMutation.isPending}\n            className=\"flex-1\"\n            data-testid=\"button-decline\"\n          >\n            {decisionMutation.isPending && submittedStatus === \"declined\" ? \"Submitting...\" : \"Not Available\"}\n          </Button>\n          <Button\n            onClick={() => decisionMutation.mutate(\"accepted\")}\n            disabled={decisionMutation.isPending}\n            className=\"flex-1\"\n            data-testid=\"button-accept\"\n          >\n            {decisionMutation.isPending && submittedStatus === \"accepted\" ? \"Submitting...\" : \"I'm Interested\"}\n          </Button>\n        </div>\n      </div>\n    </div>\n  );\n}\n","path":null,"size_bytes":8230,"size_tokens":null},"client/src/pages/ra-performance.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { useParams } from \"wouter\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from \"@/components/ui/table\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Users, TrendingUp, DollarSign, Calendar, ArrowLeft } from \"lucide-react\";\nimport { format, startOfMonth, endOfMonth, subMonths } from \"date-fns\";\nimport { Link } from \"wouter\";\nimport { apiRequest } from \"@/lib/queryClient\";\n\ninterface RaIncentiveSummary {\n  raId: number;\n  raName: string;\n  raEmail: string;\n  totalRecruitedExperts: number;\n  expertsWithCompletedCalls: number;\n  totalEligibleCalls: number;\n  totalIncentiveBRL: number;\n}\n\ninterface RaIncentiveDetail {\n  raId: number;\n  raName: string;\n  raEmail: string;\n  totalRecruitedExperts: number;\n  expertsWithCompletedCalls: number;\n  totalEligibleCalls: number;\n  totalIncentiveBRL: number;\n  eligibleExperts: Array<{\n    expertId: number;\n    expertName: string;\n    recruitedAt: string | null;\n    eligibleCalls: number;\n    incentiveBRL: number;\n  }>;\n  period: {\n    fromDate: string | null;\n    toDate: string | null;\n  };\n  incentivePerCallBRL: number;\n  eligibilityWindowDays: number;\n}\n\ninterface AllRaIncentivesResponse {\n  period: {\n    fromDate: string | null;\n    toDate: string | null;\n  };\n  incentivePerCallBRL: number;\n  eligibilityWindowDays: number;\n  summaries: RaIncentiveSummary[];\n}\n\nconst periodOptions = [\n  { label: \"All Time\", value: \"all\" },\n  { label: \"This Month\", value: \"this-month\" },\n  { label: \"Last Month\", value: \"last-month\" },\n  { label: \"Last 3 Months\", value: \"last-3-months\" },\n  { label: \"Last 6 Months\", value: \"last-6-months\" },\n];\n\nfunction getPeriodDates(period: string): { fromDate?: Date; toDate?: Date } {\n  const now = new Date();\n  switch (period) {\n    case \"this-month\":\n      return { fromDate: startOfMonth(now), toDate: endOfMonth(now) };\n    case \"last-month\":\n      return { fromDate: startOfMonth(subMonths(now, 1)), toDate: endOfMonth(subMonths(now, 1)) };\n    case \"last-3-months\":\n      return { fromDate: startOfMonth(subMonths(now, 2)), toDate: endOfMonth(now) };\n    case \"last-6-months\":\n      return { fromDate: startOfMonth(subMonths(now, 5)), toDate: endOfMonth(now) };\n    default:\n      return {};\n  }\n}\n\nexport default function RaPerformance() {\n  const { raId } = useParams<{ raId?: string }>();\n  const [selectedPeriod, setSelectedPeriod] = useState(\"all\");\n\n  const periodDates = getPeriodDates(selectedPeriod);\n  const queryParams = new URLSearchParams();\n  if (periodDates.fromDate) queryParams.set(\"fromDate\", periodDates.fromDate.toISOString());\n  if (periodDates.toDate) queryParams.set(\"toDate\", periodDates.toDate.toISOString());\n  const queryString = queryParams.toString() ? `?${queryParams.toString()}` : \"\";\n\n  const { data: allRaData, isLoading: isLoadingAll } = useQuery<AllRaIncentivesResponse>({\n    queryKey: [\"/api/ra-incentives\", selectedPeriod],\n    queryFn: async () => {\n      const res = await apiRequest(\"GET\", `/api/ra-incentives${queryString}`);\n      return res.json();\n    },\n    enabled: !raId,\n  });\n\n  const { data: raDetail, isLoading: isLoadingDetail } = useQuery<RaIncentiveDetail>({\n    queryKey: [\"/api/ra-incentives\", raId, selectedPeriod],\n    queryFn: async () => {\n      const res = await apiRequest(\"GET\", `/api/ra-incentives/${raId}${queryString}`);\n      return res.json();\n    },\n    enabled: !!raId,\n  });\n\n  if (raId && raDetail) {\n    return (\n      <div className=\"space-y-6 p-8\">\n        <div className=\"flex items-center gap-4\">\n          <Link href=\"/ra-performance\">\n            <Button variant=\"ghost\" size=\"icon\" data-testid=\"button-back\">\n              <ArrowLeft className=\"h-4 w-4\" />\n            </Button>\n          </Link>\n          <div>\n            <h1 className=\"text-3xl font-semibold text-foreground\">{raDetail.raName}</h1>\n            <p className=\"text-sm text-muted-foreground\">{raDetail.raEmail}</p>\n          </div>\n        </div>\n\n        <div className=\"flex items-center gap-4\">\n          <Select value={selectedPeriod} onValueChange={setSelectedPeriod}>\n            <SelectTrigger className=\"w-48\" data-testid=\"select-period-detail\">\n              <SelectValue placeholder=\"Select period\" />\n            </SelectTrigger>\n            <SelectContent>\n              {periodOptions.map((opt) => (\n                <SelectItem key={opt.value} value={opt.value}>\n                  {opt.label}\n                </SelectItem>\n              ))}\n            </SelectContent>\n          </Select>\n        </div>\n\n        <div className=\"grid gap-4 sm:grid-cols-2 lg:grid-cols-4\">\n          <Card>\n            <CardHeader className=\"flex flex-row items-center justify-between gap-2 space-y-0 pb-2\">\n              <CardTitle className=\"text-sm font-medium\">Total Recruited</CardTitle>\n              <Users className=\"h-4 w-4 text-muted-foreground\" />\n            </CardHeader>\n            <CardContent>\n              <div className=\"text-2xl font-bold\">{raDetail.totalRecruitedExperts}</div>\n              <p className=\"text-xs text-muted-foreground\">experts sourced</p>\n            </CardContent>\n          </Card>\n\n          <Card>\n            <CardHeader className=\"flex flex-row items-center justify-between gap-2 space-y-0 pb-2\">\n              <CardTitle className=\"text-sm font-medium\">With Completed Calls</CardTitle>\n              <TrendingUp className=\"h-4 w-4 text-muted-foreground\" />\n            </CardHeader>\n            <CardContent>\n              <div className=\"text-2xl font-bold\">{raDetail.expertsWithCompletedCalls}</div>\n              <p className=\"text-xs text-muted-foreground\">experts with calls</p>\n            </CardContent>\n          </Card>\n\n          <Card>\n            <CardHeader className=\"flex flex-row items-center justify-between gap-2 space-y-0 pb-2\">\n              <CardTitle className=\"text-sm font-medium\">Eligible Calls</CardTitle>\n              <Calendar className=\"h-4 w-4 text-muted-foreground\" />\n            </CardHeader>\n            <CardContent>\n              <div className=\"text-2xl font-bold\">{raDetail.totalEligibleCalls}</div>\n              <p className=\"text-xs text-muted-foreground\">within {raDetail.eligibilityWindowDays} days</p>\n            </CardContent>\n          </Card>\n\n          <Card className=\"bg-green-50 dark:bg-green-950/20\">\n            <CardHeader className=\"flex flex-row items-center justify-between gap-2 space-y-0 pb-2\">\n              <CardTitle className=\"text-sm font-medium\">Total Incentive</CardTitle>\n              <DollarSign className=\"h-4 w-4 text-green-600\" />\n            </CardHeader>\n            <CardContent>\n              <div className=\"text-2xl font-bold text-green-600\">\n                R$ {raDetail.totalIncentiveBRL.toLocaleString(\"pt-BR\")}\n              </div>\n              <p className=\"text-xs text-muted-foreground\">@ R${raDetail.incentivePerCallBRL}/call</p>\n            </CardContent>\n          </Card>\n        </div>\n\n        <Card>\n          <CardHeader>\n            <CardTitle>Eligible Experts</CardTitle>\n            <CardDescription>\n              Experts who completed calls within {raDetail.eligibilityWindowDays} days of recruitment\n            </CardDescription>\n          </CardHeader>\n          <CardContent>\n            {raDetail.eligibleExperts.length === 0 ? (\n              <p className=\"text-center py-8 text-muted-foreground\">\n                No eligible experts with completed calls in this period\n              </p>\n            ) : (\n              <Table>\n                <TableHeader>\n                  <TableRow>\n                    <TableHead>Expert Name</TableHead>\n                    <TableHead>Recruited On</TableHead>\n                    <TableHead className=\"text-right\">Eligible Calls</TableHead>\n                    <TableHead className=\"text-right\">Incentive (BRL)</TableHead>\n                  </TableRow>\n                </TableHeader>\n                <TableBody>\n                  {raDetail.eligibleExperts.map((expert) => (\n                    <TableRow key={expert.expertId} data-testid={`row-expert-${expert.expertId}`}>\n                      <TableCell className=\"font-medium\">{expert.expertName}</TableCell>\n                      <TableCell>\n                        {expert.recruitedAt\n                          ? format(new Date(expert.recruitedAt), \"MMM d, yyyy\")\n                          : \"-\"}\n                      </TableCell>\n                      <TableCell className=\"text-right\">{expert.eligibleCalls}</TableCell>\n                      <TableCell className=\"text-right font-mono text-green-600\">\n                        R$ {expert.incentiveBRL.toLocaleString(\"pt-BR\")}\n                      </TableCell>\n                    </TableRow>\n                  ))}\n                </TableBody>\n              </Table>\n            )}\n          </CardContent>\n        </Card>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"space-y-6 p-8\">\n      <div className=\"flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between\">\n        <div>\n          <h1 className=\"text-3xl font-semibold text-foreground\">RA Performance</h1>\n          <p className=\"text-sm text-muted-foreground\">\n            Track RA recruitment incentives and expert sourcing metrics\n          </p>\n        </div>\n        <Select value={selectedPeriod} onValueChange={setSelectedPeriod}>\n          <SelectTrigger className=\"w-48\" data-testid=\"select-period\">\n            <SelectValue placeholder=\"Select period\" />\n          </SelectTrigger>\n          <SelectContent>\n            {periodOptions.map((opt) => (\n              <SelectItem key={opt.value} value={opt.value}>\n                {opt.label}\n              </SelectItem>\n            ))}\n          </SelectContent>\n        </Select>\n      </div>\n\n      {allRaData && (\n        <Card className=\"bg-muted/50\">\n          <CardContent className=\"py-4\">\n            <div className=\"flex flex-wrap items-center gap-6 text-sm\">\n              <div>\n                <span className=\"text-muted-foreground\">Incentive Rate:</span>{\" \"}\n                <Badge variant=\"secondary\">R$ {allRaData.incentivePerCallBRL} per call</Badge>\n              </div>\n              <div>\n                <span className=\"text-muted-foreground\">Eligibility Window:</span>{\" \"}\n                <Badge variant=\"secondary\">{allRaData.eligibilityWindowDays} days</Badge>\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n      )}\n\n      {isLoadingAll ? (\n        <div className=\"grid gap-4 sm:grid-cols-2 lg:grid-cols-3\">\n          {Array.from({ length: 3 }).map((_, i) => (\n            <Card key={i}>\n              <CardContent className=\"p-6\">\n                <div className=\"space-y-3\">\n                  <Skeleton className=\"h-5 w-32\" />\n                  <Skeleton className=\"h-4 w-24\" />\n                  <div className=\"grid grid-cols-2 gap-4 pt-2\">\n                    <Skeleton className=\"h-12\" />\n                    <Skeleton className=\"h-12\" />\n                  </div>\n                </div>\n              </CardContent>\n            </Card>\n          ))}\n        </div>\n      ) : allRaData?.summaries.length === 0 ? (\n        <Card>\n          <CardContent className=\"py-12 text-center\">\n            <Users className=\"mx-auto h-12 w-12 text-muted-foreground/50\" />\n            <h3 className=\"mt-4 text-lg font-medium\">No RA Data</h3>\n            <p className=\"mt-2 text-sm text-muted-foreground\">\n              No Research Associates found or no incentive data available for this period.\n            </p>\n          </CardContent>\n        </Card>\n      ) : (\n        <div className=\"grid gap-4 sm:grid-cols-2 lg:grid-cols-3\">\n          {allRaData?.summaries.map((ra) => (\n            <Link key={ra.raId} href={`/ra-performance/${ra.raId}`}>\n              <Card className=\"cursor-pointer transition-colors hover-elevate\" data-testid={`card-ra-${ra.raId}`}>\n                <CardHeader className=\"pb-2\">\n                  <CardTitle className=\"text-lg\">{ra.raName}</CardTitle>\n                  <CardDescription>{ra.raEmail}</CardDescription>\n                </CardHeader>\n                <CardContent>\n                  <div className=\"grid grid-cols-2 gap-4\">\n                    <div className=\"space-y-1\">\n                      <p className=\"text-xs text-muted-foreground\">Recruited</p>\n                      <p className=\"text-xl font-semibold\">{ra.totalRecruitedExperts}</p>\n                    </div>\n                    <div className=\"space-y-1\">\n                      <p className=\"text-xs text-muted-foreground\">Eligible Calls</p>\n                      <p className=\"text-xl font-semibold\">{ra.totalEligibleCalls}</p>\n                    </div>\n                  </div>\n                  <div className=\"mt-4 flex items-center justify-between border-t pt-4\">\n                    <span className=\"text-sm text-muted-foreground\">Total Incentive</span>\n                    <span className=\"text-lg font-bold text-green-600\">\n                      R$ {ra.totalIncentiveBRL.toLocaleString(\"pt-BR\")}\n                    </span>\n                  </div>\n                </CardContent>\n              </Card>\n            </Link>\n          ))}\n        </div>\n      )}\n    </div>\n  );\n}\n","path":null,"size_bytes":13550,"size_tokens":null},"client/src/pages/client-shortlist.tsx":{"content":"import { useQuery } from \"@tanstack/react-query\";\nimport { useParams, Link } from \"wouter\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { ScrollArea } from \"@/components/ui/scroll-area\";\nimport { \n  ArrowLeft, \n  Copy,\n  CopyCheck,\n  FileText,\n  CheckCircle2\n} from \"lucide-react\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { useState } from \"react\";\n\ninterface AvailabilitySlot {\n  date: string;\n  startTime: string;\n  endTime: string;\n  timezone: string;\n}\n\ninterface EmploymentHistory {\n  company: string;\n  jobTitle: string;\n  fromYear: number;\n  toYear: number;\n}\n\ninterface VettingAnswer {\n  questionId: number;\n  questionText: string;\n  answerText: string | null;\n  angleName: string | null;\n}\n\ninterface ExpertProfile {\n  name: string;\n  email: string;\n  jobTitle: string | null;\n  company: string | null;\n  location: string | null;\n  timezone: string | null;\n  yearsOfExperience: number | null;\n  industry: string | null;\n  expertise: string | null;\n  biography: string | null;\n}\n\ninterface ClientShortlistExpert {\n  projectExpertId: number;\n  expertId: number;\n  pipelineStatus: string;\n  angles: string[];\n  respondedAt: string | null;\n  profile: ExpertProfile;\n  employmentHistory: EmploymentHistory[];\n  vettingAnswers: VettingAnswer[];\n  availability: {\n    note: string | null;\n    slots: AvailabilitySlot[];\n  };\n}\n\ninterface ClientShortlistResponse {\n  projectId: number;\n  projectTitle: string;\n  totalExperts: number;\n  experts: ClientShortlistExpert[];\n}\n\nfunction escapeHtml(text: string | null | undefined): string {\n  if (!text) return \"\";\n  return text\n    .replace(/&/g, \"&amp;\")\n    .replace(/</g, \"&lt;\")\n    .replace(/>/g, \"&gt;\")\n    .replace(/\"/g, \"&quot;\")\n    .replace(/'/g, \"&#039;\")\n    .replace(/\\n/g, \"<br>\");\n}\n\nfunction escapeHtmlNoBreaks(text: string | null | undefined): string {\n  if (!text) return \"\";\n  return text\n    .replace(/&/g, \"&amp;\")\n    .replace(/</g, \"&lt;\")\n    .replace(/>/g, \"&gt;\")\n    .replace(/\"/g, \"&quot;\")\n    .replace(/'/g, \"&#039;\");\n}\n\nfunction generateExpertHTML(expert: ClientShortlistExpert): string {\n  const statusColor = expert.pipelineStatus === \"accepted\" \n    ? \"#2563eb\" \n    : expert.pipelineStatus === \"scheduled\" \n    ? \"#16a34a\" \n    : \"#6366f1\";\n\n  const workHistoryRows = expert.employmentHistory.length > 0\n    ? expert.employmentHistory.map(job => `\n        <tr>\n          <td style=\"padding: 8px 12px; border-bottom: 1px solid #e5e7eb; font-size: 14px; color: #374151;\">${escapeHtmlNoBreaks(job.company) || \"-\"}</td>\n          <td style=\"padding: 8px 12px; border-bottom: 1px solid #e5e7eb; font-size: 14px; color: #374151;\">${escapeHtmlNoBreaks(job.jobTitle) || \"-\"}</td>\n          <td style=\"padding: 8px 12px; border-bottom: 1px solid #e5e7eb; font-size: 14px; color: #374151;\">${job.fromYear} - ${job.toYear || \"Present\"}</td>\n        </tr>\n      `).join(\"\")\n    : `<tr><td colspan=\"3\" style=\"padding: 8px 12px; font-size: 14px; color: #9ca3af; font-style: italic;\">No employment history available</td></tr>`;\n\n  const anglesHTML = expert.angles.length > 0\n    ? expert.angles.map(angle => \n        `<span style=\"display: inline-block; background-color: #f3f4f6; color: #374151; padding: 4px 10px; border-radius: 12px; font-size: 12px; margin-right: 6px; margin-bottom: 4px;\">${escapeHtmlNoBreaks(angle)}</span>`\n      ).join(\"\")\n    : \"\";\n\n  const bioHTML = expert.profile.biography\n    ? `<p style=\"margin: 0; font-size: 14px; color: #374151; line-height: 1.6;\">${escapeHtml(expert.profile.biography)}</p>`\n    : `<p style=\"margin: 0; font-size: 14px; color: #9ca3af; font-style: italic;\">No biography available</p>`;\n\n  const vqHTML = expert.vettingAnswers.length > 0\n    ? expert.vettingAnswers.map((vq, i) => `\n        <div style=\"margin-bottom: 16px;\">\n          <p style=\"margin: 0 0 6px 0; font-size: 14px; font-weight: 600; color: #1f2937;\">\n            Q${i + 1}: ${vq.angleName ? `<span style=\"color: #2563eb;\">[${escapeHtmlNoBreaks(vq.angleName)}]</span> ` : \"\"}${escapeHtmlNoBreaks(vq.questionText)}\n          </p>\n          <div style=\"padding-left: 16px; border-left: 3px solid #e5e7eb;\">\n            <p style=\"margin: 0; font-size: 14px; color: #4b5563; line-height: 1.6;\">\n              ${vq.answerText ? escapeHtml(vq.answerText) : `<span style=\"color: #9ca3af; font-style: italic;\">No answer provided</span>`}\n            </p>\n          </div>\n        </div>\n      `).join(\"\")\n    : `<p style=\"margin: 0; font-size: 14px; color: #9ca3af; font-style: italic;\">No vetting questions for this project</p>`;\n\n  let availabilityHTML = \"\";\n  if (expert.availability.slots.length > 0) {\n    availabilityHTML = expert.availability.slots.map(slot => \n      `<p style=\"margin: 0 0 4px 0; font-size: 14px; color: #374151;\">${escapeHtmlNoBreaks(slot.date)}, ${escapeHtmlNoBreaks(slot.startTime)} - ${escapeHtmlNoBreaks(slot.endTime)} (${escapeHtmlNoBreaks(slot.timezone)})</p>`\n    ).join(\"\");\n  } else if (expert.availability.note) {\n    availabilityHTML = `<p style=\"margin: 0; font-size: 14px; color: #374151;\">${escapeHtml(expert.availability.note)}</p>`;\n  } else {\n    availabilityHTML = `<p style=\"margin: 0; font-size: 14px; color: #9ca3af; font-style: italic;\">No availability submitted yet</p>`;\n  }\n\n  return `\n<div style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif; max-width: 700px; margin: 0 auto 24px auto;\">\n  <div style=\"background-color: #ffffff; border-radius: 12px; box-shadow: 0 1px 3px rgba(0,0,0,0.1), 0 1px 2px rgba(0,0,0,0.06); overflow: hidden; border: 1px solid #e5e7eb;\">\n    \n    <!-- Header -->\n    <div style=\"padding: 20px 24px; border-bottom: 1px solid #e5e7eb;\">\n      <div style=\"display: flex; align-items: center; justify-content: space-between; flex-wrap: wrap; gap: 12px;\">\n        <div>\n          <h2 style=\"margin: 0 0 4px 0; font-size: 22px; font-weight: 700; color: #111827;\">${escapeHtmlNoBreaks(expert.profile.name)}</h2>\n          ${(expert.profile.jobTitle || expert.profile.company) \n            ? `<p style=\"margin: 0; font-size: 14px; color: #6b7280;\">${[escapeHtmlNoBreaks(expert.profile.jobTitle), escapeHtmlNoBreaks(expert.profile.company)].filter(Boolean).join(\" at \")}</p>` \n            : \"\"}\n        </div>\n        <span style=\"display: inline-block; background-color: ${statusColor}; color: white; padding: 6px 14px; border-radius: 20px; font-size: 13px; font-weight: 600; text-transform: capitalize;\">\n          ${escapeHtmlNoBreaks(expert.pipelineStatus)}\n        </span>\n      </div>\n      ${anglesHTML ? `<div style=\"margin-top: 12px;\">${anglesHTML}</div>` : \"\"}\n    </div>\n\n    <!-- Work History Section -->\n    <div style=\"padding: 20px 24px; border-bottom: 1px solid #e5e7eb;\">\n      <h3 style=\"margin: 0 0 12px 0; font-size: 16px; font-weight: 700; color: #111827;\">Work History</h3>\n      <table style=\"width: 100%; border-collapse: collapse; border: 1px solid #e5e7eb; border-radius: 8px; overflow: hidden;\">\n        <thead>\n          <tr style=\"background-color: #f9fafb;\">\n            <th style=\"padding: 10px 12px; text-align: left; font-size: 13px; font-weight: 600; color: #374151; border-bottom: 1px solid #e5e7eb;\">Company</th>\n            <th style=\"padding: 10px 12px; text-align: left; font-size: 13px; font-weight: 600; color: #374151; border-bottom: 1px solid #e5e7eb;\">Job Title</th>\n            <th style=\"padding: 10px 12px; text-align: left; font-size: 13px; font-weight: 600; color: #374151; border-bottom: 1px solid #e5e7eb;\">Period</th>\n          </tr>\n        </thead>\n        <tbody>\n          ${workHistoryRows}\n        </tbody>\n      </table>\n    </div>\n\n    <!-- Bio Section -->\n    <div style=\"padding: 20px 24px; border-bottom: 1px solid #e5e7eb;\">\n      <h3 style=\"margin: 0 0 12px 0; font-size: 16px; font-weight: 700; color: #111827;\">Bio</h3>\n      ${bioHTML}\n    </div>\n\n    <!-- Comments on Questions Section -->\n    <div style=\"padding: 20px 24px; border-bottom: 1px solid #e5e7eb;\">\n      <h3 style=\"margin: 0 0 16px 0; font-size: 16px; font-weight: 700; color: #111827;\">Comments on Questions</h3>\n      ${vqHTML}\n    </div>\n\n    <!-- Availability Section -->\n    <div style=\"padding: 20px 24px;\">\n      <h3 style=\"margin: 0 0 12px 0; font-size: 16px; font-weight: 700; color: #111827;\">Availability</h3>\n      ${availabilityHTML}\n    </div>\n\n  </div>\n</div>\n  `.trim();\n}\n\nfunction generateAllExpertsHTML(experts: ClientShortlistExpert[], projectTitle: string): string {\n  const header = `\n<div style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif; max-width: 700px; margin: 0 auto 24px auto;\">\n  <h1 style=\"margin: 0 0 8px 0; font-size: 24px; font-weight: 700; color: #111827;\">Client Shortlist</h1>\n  <p style=\"margin: 0 0 4px 0; font-size: 16px; color: #6b7280;\">${escapeHtmlNoBreaks(projectTitle)}</p>\n  <p style=\"margin: 0; font-size: 14px; color: #9ca3af;\">${experts.length} Expert(s)</p>\n  <hr style=\"margin: 20px 0; border: none; border-top: 1px solid #e5e7eb;\">\n</div>\n  `.trim();\n\n  const expertsHTML = experts.map(expert => generateExpertHTML(expert)).join(\"\\n\\n\");\n\n  return `${header}\\n\\n${expertsHTML}`;\n}\n\nasync function copyToClipboard(html: string, toast: any, description: string) {\n  try {\n    const blob = new Blob([html], { type: \"text/html\" });\n    const data = [new ClipboardItem({ \"text/html\": blob, \"text/plain\": new Blob([html], { type: \"text/plain\" }) })];\n    await navigator.clipboard.write(data);\n    toast({\n      title: \"Copied to clipboard\",\n      description,\n    });\n    return true;\n  } catch (error) {\n    try {\n      await navigator.clipboard.writeText(html);\n      toast({\n        title: \"Copied to clipboard\",\n        description: `${description} (as text)`,\n      });\n      return true;\n    } catch (fallbackError) {\n      toast({\n        title: \"Copy failed\",\n        description: \"Unable to copy to clipboard. Please try again.\",\n        variant: \"destructive\",\n      });\n      return false;\n    }\n  }\n}\n\nexport default function ClientShortlistPage() {\n  const params = useParams<{ projectId: string }>();\n  const projectId = parseInt(params.projectId || \"0\");\n  const { toast } = useToast();\n  const [copiedExpertId, setCopiedExpertId] = useState<number | null>(null);\n  const [copiedAll, setCopiedAll] = useState(false);\n\n  const { data: shortlistData, isLoading, error } = useQuery<ClientShortlistResponse>({\n    queryKey: [\"/api/projects\", projectId, \"client-shortlist\"],\n    enabled: projectId > 0,\n  });\n\n  const handleCopyProfile = async (expert: ClientShortlistExpert) => {\n    const html = generateExpertHTML(expert);\n    const success = await copyToClipboard(html, toast, `${expert.profile.name}'s profile copied`);\n    if (success) {\n      setCopiedExpertId(expert.expertId);\n      setTimeout(() => setCopiedExpertId(null), 2000);\n    }\n  };\n\n  const handleCopyAll = async () => {\n    if (!shortlistData?.experts?.length) return;\n    \n    const html = generateAllExpertsHTML(shortlistData.experts, shortlistData.projectTitle);\n    const success = await copyToClipboard(html, toast, `All ${shortlistData.experts.length} expert(s) copied`);\n    if (success) {\n      setCopiedAll(true);\n      setTimeout(() => setCopiedAll(false), 2000);\n    }\n  };\n\n  if (isLoading) {\n    return (\n      <div className=\"flex items-center justify-center h-64\">\n        <div className=\"text-muted-foreground\">Loading shortlist...</div>\n      </div>\n    );\n  }\n\n  if (error) {\n    return (\n      <div className=\"p-6\">\n        <div className=\"text-destructive\">Error loading client shortlist. Please try again.</div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"flex flex-col h-full\">\n      <div className=\"flex items-center justify-between p-4 border-b bg-background sticky top-0 z-10\">\n        <div className=\"flex items-center gap-4\">\n          <Link href={`/projects/${projectId}`}>\n            <Button variant=\"ghost\" size=\"sm\" data-testid=\"button-back-to-project\">\n              <ArrowLeft className=\"h-4 w-4 mr-2\" />\n              Back to Project\n            </Button>\n          </Link>\n          <div>\n            <h1 className=\"text-xl font-semibold\" data-testid=\"text-page-title\">Client Shortlist</h1>\n            <p className=\"text-sm text-muted-foreground\" data-testid=\"text-project-title\">\n              {shortlistData?.projectTitle || \"Project\"}\n            </p>\n          </div>\n        </div>\n        <div className=\"flex items-center gap-2\">\n          <Badge variant=\"secondary\" data-testid=\"badge-expert-count\">\n            {shortlistData?.totalExperts || 0} Expert(s)\n          </Badge>\n          <Button \n            onClick={handleCopyAll}\n            disabled={!shortlistData?.totalExperts}\n            variant={copiedAll ? \"default\" : \"outline\"}\n            data-testid=\"button-copy-all\"\n          >\n            {copiedAll ? (\n              <>\n                <CopyCheck className=\"h-4 w-4 mr-2\" />\n                Copied!\n              </>\n            ) : (\n              <>\n                <Copy className=\"h-4 w-4 mr-2\" />\n                Copy All Profiles\n              </>\n            )}\n          </Button>\n        </div>\n      </div>\n\n      <ScrollArea className=\"flex-1\">\n        <div className=\"p-6 space-y-6 max-w-4xl mx-auto\">\n          {!shortlistData?.experts?.length ? (\n            <Card>\n              <CardContent className=\"flex flex-col items-center justify-center py-12\">\n                <FileText className=\"h-12 w-12 text-muted-foreground mb-4\" />\n                <h3 className=\"text-lg font-medium text-muted-foreground\">No accepted experts available yet</h3>\n                <p className=\"text-sm text-muted-foreground mt-1\">\n                  Experts who accept the consultation will appear here.\n                </p>\n              </CardContent>\n            </Card>\n          ) : (\n            shortlistData.experts.map((expert) => (\n              <ExpertCard \n                key={expert.projectExpertId} \n                expert={expert} \n                onCopy={handleCopyProfile}\n                isCopied={copiedExpertId === expert.expertId}\n              />\n            ))\n          )}\n        </div>\n      </ScrollArea>\n    </div>\n  );\n}\n\nfunction ExpertCard({ \n  expert, \n  onCopy, \n  isCopied \n}: { \n  expert: ClientShortlistExpert; \n  onCopy: (expert: ClientShortlistExpert) => void;\n  isCopied: boolean;\n}) {\n  const statusColor = expert.pipelineStatus === \"accepted\" \n    ? \"bg-blue-600 text-white\" \n    : expert.pipelineStatus === \"scheduled\" \n    ? \"bg-green-600 text-white\" \n    : \"bg-indigo-600 text-white\";\n\n  return (\n    <Card \n      className=\"overflow-hidden shadow-sm hover:shadow-md transition-shadow\"\n      data-testid={`card-expert-${expert.expertId}`}\n    >\n      {/* Header */}\n      <div className=\"p-5 border-b bg-card\">\n        <div className=\"flex items-start justify-between gap-4 flex-wrap\">\n          <div className=\"flex-1\">\n            <h2 className=\"text-xl font-bold text-foreground mb-1\" data-testid={`text-expert-name-${expert.expertId}`}>\n              {expert.profile.name}\n            </h2>\n            {(expert.profile.jobTitle || expert.profile.company) && (\n              <p className=\"text-sm text-muted-foreground\">\n                {[expert.profile.jobTitle, expert.profile.company].filter(Boolean).join(\" at \")}\n              </p>\n            )}\n          </div>\n          <div className=\"flex items-center gap-2\">\n            <Badge className={`${statusColor} capitalize px-3 py-1`}>\n              {expert.pipelineStatus}\n            </Badge>\n            <Button\n              variant={isCopied ? \"default\" : \"outline\"}\n              size=\"sm\"\n              onClick={() => onCopy(expert)}\n              data-testid={`button-copy-profile-${expert.expertId}`}\n            >\n              {isCopied ? (\n                <>\n                  <CheckCircle2 className=\"h-4 w-4 mr-1\" />\n                  Copied\n                </>\n              ) : (\n                <>\n                  <Copy className=\"h-4 w-4 mr-1\" />\n                  Copy Profile\n                </>\n              )}\n            </Button>\n          </div>\n        </div>\n\n        {expert.angles.length > 0 && (\n          <div className=\"flex flex-wrap gap-1.5 mt-3\">\n            {expert.angles.map((angle, i) => (\n              <Badge key={i} variant=\"secondary\" className=\"text-xs font-normal\">\n                {angle}\n              </Badge>\n            ))}\n          </div>\n        )}\n      </div>\n\n      <CardContent className=\"p-0\">\n        {/* Work History Section */}\n        <div className=\"p-5 border-b\">\n          <h3 className=\"text-base font-bold text-foreground mb-3\">Work History</h3>\n          {expert.employmentHistory.length > 0 ? (\n            <div className=\"overflow-x-auto\">\n              <table className=\"w-full text-sm border border-border rounded-lg overflow-hidden\">\n                <thead>\n                  <tr className=\"bg-muted/50\">\n                    <th className=\"px-3 py-2.5 text-left font-semibold text-foreground border-b\">Company</th>\n                    <th className=\"px-3 py-2.5 text-left font-semibold text-foreground border-b\">Job Title</th>\n                    <th className=\"px-3 py-2.5 text-left font-semibold text-foreground border-b\">Period</th>\n                  </tr>\n                </thead>\n                <tbody>\n                  {expert.employmentHistory.map((job, i) => (\n                    <tr key={i} className=\"border-b last:border-b-0\">\n                      <td className=\"px-3 py-2.5 text-muted-foreground\">{job.company || \"-\"}</td>\n                      <td className=\"px-3 py-2.5 text-muted-foreground\">{job.jobTitle || \"-\"}</td>\n                      <td className=\"px-3 py-2.5 text-muted-foreground\">{job.fromYear} - {job.toYear || \"Present\"}</td>\n                    </tr>\n                  ))}\n                </tbody>\n              </table>\n            </div>\n          ) : (\n            <p className=\"text-sm text-muted-foreground italic\">No employment history available</p>\n          )}\n        </div>\n\n        {/* Bio Section */}\n        <div className=\"p-5 border-b\">\n          <h3 className=\"text-base font-bold text-foreground mb-3\">Bio</h3>\n          {expert.profile.biography ? (\n            <p className=\"text-sm text-muted-foreground leading-relaxed whitespace-pre-wrap\">\n              {expert.profile.biography}\n            </p>\n          ) : (\n            <p className=\"text-sm text-muted-foreground italic\">No biography available</p>\n          )}\n        </div>\n\n        {/* Comments on Questions Section */}\n        <div className=\"p-5 border-b\">\n          <h3 className=\"text-base font-bold text-foreground mb-4\">Comments on Questions</h3>\n          {expert.vettingAnswers.length > 0 ? (\n            <div className=\"space-y-4\">\n              {expert.vettingAnswers.map((vq, i) => (\n                <div key={vq.questionId}>\n                  <p className=\"text-sm font-semibold text-foreground mb-1.5\">\n                    Q{i + 1}: {vq.angleName && <span className=\"text-primary\">[{vq.angleName}] </span>}\n                    {vq.questionText}\n                  </p>\n                  <div className=\"pl-4 border-l-2 border-muted\">\n                    <p className=\"text-sm text-muted-foreground leading-relaxed whitespace-pre-wrap\">\n                      {vq.answerText || <span className=\"italic\">No answer provided</span>}\n                    </p>\n                  </div>\n                </div>\n              ))}\n            </div>\n          ) : (\n            <p className=\"text-sm text-muted-foreground italic\">No vetting questions for this project</p>\n          )}\n        </div>\n\n        {/* Availability Section */}\n        <div className=\"p-5\">\n          <h3 className=\"text-base font-bold text-foreground mb-3\">Availability</h3>\n          {expert.availability.slots.length > 0 ? (\n            <div className=\"space-y-1\">\n              {expert.availability.slots.map((slot, i) => (\n                <p key={i} className=\"text-sm text-muted-foreground\">\n                  {slot.date}, {slot.startTime} - {slot.endTime} ({slot.timezone})\n                </p>\n              ))}\n            </div>\n          ) : expert.availability.note ? (\n            <p className=\"text-sm text-muted-foreground\">{expert.availability.note}</p>\n          ) : (\n            <p className=\"text-sm text-muted-foreground italic\">No availability submitted yet</p>\n          )}\n        </div>\n      </CardContent>\n    </Card>\n  );\n}\n","path":null,"size_bytes":20552,"size_tokens":null}},"version":2}